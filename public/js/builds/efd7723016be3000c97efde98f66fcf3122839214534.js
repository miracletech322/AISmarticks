/*! X-editable - v1.5.1 
* In-place editing with Twitter Bootstrap, jQuery UI or pure jQuery
* http://github.com/vitalets/x-editable
* Copyright (c) 2013 Vitaliy Potapov; Licensed MIT */!function(a){"use strict";var b=function(b,c){this.options=a.extend({},a.fn.editableform.defaults,c),this.$div=a(b),this.options.scope||(this.options.scope=this)};b.prototype={constructor:b,initInput:function(){this.input=this.options.input,this.value=this.input.str2value(this.options.value),this.input.prerender()},initTemplate:function(){this.$form=a(a.fn.editableform.template)},initButtons:function(){var b=this.$form.find(".editable-buttons");b.append(a.fn.editableform.buttons),"bottom"===this.options.showbuttons&&b.addClass("editable-buttons-bottom")},render:function(){this.$loading=a(a.fn.editableform.loading),this.$div.empty().append(this.$loading),this.initTemplate(),this.options.showbuttons?this.initButtons():this.$form.find(".editable-buttons").remove(),this.showLoading(),this.isSaving=!1,this.$div.triggerHandler("rendering"),this.initInput(),this.$form.find("div.editable-input").append(this.input.$tpl),this.$div.append(this.$form),a.when(this.input.render()).then(a.proxy(function(){if(this.options.showbuttons||this.input.autosubmit(),this.$form.find(".editable-cancel").click(a.proxy(this.cancel,this)),this.input.error)this.error(this.input.error),this.$form.find(".editable-submit").attr("disabled",!0),this.input.$input.attr("disabled",!0),this.$form.submit(function(a){a.preventDefault()});else{this.error(!1),this.input.$input.removeAttr("disabled"),this.$form.find(".editable-submit").removeAttr("disabled");var b=null===this.value||void 0===this.value||""===this.value?this.options.defaultValue:this.value;this.input.value2input(b),this.$form.submit(a.proxy(this.submit,this))}this.$div.triggerHandler("rendered"),this.showForm(),this.input.postrender&&this.input.postrender()},this))},cancel:function(){this.$div.triggerHandler("cancel")},showLoading:function(){var a,b;this.$form?(a=this.$form.outerWidth(),b=this.$form.outerHeight(),a&&this.$loading.width(a),b&&this.$loading.height(b),this.$form.hide()):(a=this.$loading.parent().width(),a&&this.$loading.width(a)),this.$loading.show()},showForm:function(a){this.$loading.hide(),this.$form.show(),a!==!1&&this.input.activate(),this.$div.triggerHandler("show")},error:function(b){var c,d=this.$form.find(".control-group"),e=this.$form.find(".editable-error-block");if(b===!1)d.removeClass(a.fn.editableform.errorGroupClass),e.removeClass(a.fn.editableform.errorBlockClass).empty().hide();else{if(b){c=(""+b).split("\n");for(var f=0;f<c.length;f++)c[f]=a("<div>").text(c[f]).html();b=c.join("<br>")}d.addClass(a.fn.editableform.errorGroupClass),e.addClass(a.fn.editableform.errorBlockClass).html(b).show()}},submit:function(b){b.stopPropagation(),b.preventDefault();var c=this.input.input2value(),d=this.validate(c);if("object"===a.type(d)&&void 0!==d.newValue){if(c=d.newValue,this.input.value2input(c),"string"==typeof d.msg)return this.error(d.msg),this.showForm(),void 0}else if(d)return this.error(d),this.showForm(),void 0;if(!this.options.savenochange&&this.input.value2str(c)==this.input.value2str(this.value))return this.$div.triggerHandler("nochange"),void 0;var e=this.input.value2submit(c);this.isSaving=!0,a.when(this.save(e)).done(a.proxy(function(a){this.isSaving=!1;var b="function"==typeof this.options.success?this.options.success.call(this.options.scope,a,c):null;return b===!1?(this.error(!1),this.showForm(!1),void 0):"string"==typeof b?(this.error(b),this.showForm(),void 0):(b&&"object"==typeof b&&b.hasOwnProperty("newValue")&&(c=b.newValue),this.error(!1),this.value=c,this.$div.triggerHandler("save",{newValue:c,submitValue:e,response:a}),void 0)},this)).fail(a.proxy(function(a){this.isSaving=!1;var b;b="function"==typeof this.options.error?this.options.error.call(this.options.scope,a,c):"string"==typeof a?a:a.responseText||a.statusText||"Unknown error!",this.error(b),this.showForm()},this))},save:function(b){this.options.pk=a.fn.editableutils.tryParseJson(this.options.pk,!0);var c,d="function"==typeof this.options.pk?this.options.pk.call(this.options.scope):this.options.pk,e=!!("function"==typeof this.options.url||this.options.url&&("always"===this.options.send||"auto"===this.options.send&&null!==d&&void 0!==d));return e?(this.showLoading(),c={name:this.options.name||"",value:b,pk:d},"function"==typeof this.options.params?c=this.options.params.call(this.options.scope,c):(this.options.params=a.fn.editableutils.tryParseJson(this.options.params,!0),a.extend(c,this.options.params)),"function"==typeof this.options.url?this.options.url.call(this.options.scope,c):a.ajax(a.extend({url:this.options.url,data:c,type:"POST"},this.options.ajaxOptions))):void 0},validate:function(a){return void 0===a&&(a=this.value),"function"==typeof this.options.validate?this.options.validate.call(this.options.scope,a):void 0},option:function(a,b){a in this.options&&(this.options[a]=b),"value"===a&&this.setValue(b)},setValue:function(a,b){this.value=b?this.input.str2value(a):a,this.$form&&this.$form.is(":visible")&&this.input.value2input(this.value)}},a.fn.editableform=function(c){var d=arguments;return this.each(function(){var e=a(this),f=e.data("editableform"),g="object"==typeof c&&c;f||e.data("editableform",f=new b(this,g)),"string"==typeof c&&f[c].apply(f,Array.prototype.slice.call(d,1))})},a.fn.editableform.Constructor=b,a.fn.editableform.defaults={type:"text",url:null,params:null,name:null,pk:null,value:null,defaultValue:null,send:"auto",validate:null,success:null,error:null,ajaxOptions:null,showbuttons:!0,scope:null,savenochange:!1},a.fn.editableform.template='<form class="form-inline editableform"><div class="control-group"><div><div class="editable-input"></div><div class="editable-buttons"></div></div><div class="editable-error-block"></div></div></form>',a.fn.editableform.loading='<div class="editableform-loading"></div>',a.fn.editableform.buttons='<button type="submit" class="editable-submit">ok</button><button type="button" class="editable-cancel">cancel</button>',a.fn.editableform.errorGroupClass=null,a.fn.editableform.errorBlockClass="editable-error",a.fn.editableform.engine="jquery"}(window.jQuery),function(a){"use strict";a.fn.editableutils={inherit:function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype},setCursorPosition:function(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},tryParseJson:function(a,b){if("string"==typeof a&&a.length&&a.match(/^[\{\[].*[\}\]]$/))if(b)try{a=new Function("return "+a)()}catch(c){}finally{return a}else a=new Function("return "+a)();return a},sliceObj:function(b,c,d){var e,f,g={};if(!a.isArray(c)||!c.length)return g;for(var h=0;h<c.length;h++)e=c[h],b.hasOwnProperty(e)&&(g[e]=b[e]),d!==!0&&(f=e.toLowerCase(),b.hasOwnProperty(f)&&(g[e]=b[f]));return g},getConfigData:function(b){var c={};return a.each(b.data(),function(a,b){("object"!=typeof b||b&&"object"==typeof b&&(b.constructor===Object||b.constructor===Array))&&(c[a]=b)}),c},objectKeys:function(a){if(Object.keys)return Object.keys(a);if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c},escape:function(b){return a("<div>").text(b).html()},itemsByValue:function(b,c,d){if(!c||null===b)return[];if("function"!=typeof d){var e=d||"value";d=function(a){return a[e]}}var f=a.isArray(b),g=[],h=this;return a.each(c,function(c,e){if(e.children)g=g.concat(h.itemsByValue(b,e.children,d));else if(f)a.grep(b,function(a){return a==(e&&"object"==typeof e?d(e):e)}).length&&g.push(e);else{var i=e&&"object"==typeof e?d(e):e;b==i&&g.push(e)}}),g},createInput:function(b){var c,d,e,f=b.type;return"date"===f&&("inline"===b.mode?a.fn.editabletypes.datefield?f="datefield":a.fn.editabletypes.dateuifield&&(f="dateuifield"):a.fn.editabletypes.date?f="date":a.fn.editabletypes.dateui&&(f="dateui"),"date"!==f||a.fn.editabletypes.date||(f="combodate")),"datetime"===f&&"inline"===b.mode&&(f="datetimefield"),"wysihtml5"!==f||a.fn.editabletypes[f]||(f="textarea"),"function"==typeof a.fn.editabletypes[f]?(c=a.fn.editabletypes[f],d=this.sliceObj(b,this.objectKeys(c.defaults)),e=new c(d)):(a.error("Unknown type: "+f),!1)},supportsTransitions:function(){var a=document.body||document.documentElement,b=a.style,c="transition",d=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof b[c])return!0;c=c.charAt(0).toUpperCase()+c.substr(1);for(var e=0;e<d.length;e++)if("string"==typeof b[d[e]+c])return!0;return!1}}}(window.jQuery),function(a){"use strict";var b=function(a,b){this.init(a,b)},c=function(a,b){this.init(a,b)};b.prototype={containerName:null,containerDataName:null,innerCss:null,containerClass:"editable-container editable-popup",defaults:{},init:function(c,d){this.$element=a(c),this.options=a.extend({},a.fn.editableContainer.defaults,d),this.splitOptions(),this.formOptions.scope=this.$element[0],this.initContainer(),this.delayedHide=!1,this.$element.on("destroyed",a.proxy(function(){this.destroy()},this)),a(document).data("editable-handlers-attached")||(a(document).on("keyup.editable",function(b){27===b.which&&a(".editable-open").editableContainer("hide")}),a(document).on("click.editable",function(c){var d,e=a(c.target),f=[".editable-container",".ui-datepicker-header",".datepicker",".modal-backdrop",".bootstrap-wysihtml5-insert-image-modal",".bootstrap-wysihtml5-insert-link-modal"];if(a.contains(document.documentElement,c.target)&&!e.is(document)){for(d=0;d<f.length;d++)if(e.is(f[d])||e.parents(f[d]).length)return;b.prototype.closeOthers(c.target)}}),a(document).data("editable-handlers-attached",!0))},splitOptions:function(){if(this.containerOptions={},this.formOptions={},!a.fn[this.containerName])throw new Error(this.containerName+" not found. Have you included corresponding js file?");for(var b in this.options)b in this.defaults?this.containerOptions[b]=this.options[b]:this.formOptions[b]=this.options[b]},tip:function(){return this.container()?this.container().$tip:null},container:function(){var a;return this.containerDataName&&(a=this.$element.data(this.containerDataName))?a:a=this.$element.data(this.containerName)},call:function(){this.$element[this.containerName].apply(this.$element,arguments)},initContainer:function(){this.call(this.containerOptions)},renderForm:function(){this.$form.editableform(this.formOptions).on({save:a.proxy(this.save,this),nochange:a.proxy(function(){this.hide("nochange")},this),cancel:a.proxy(function(){this.hide("cancel")},this),show:a.proxy(function(){this.delayedHide?(this.hide(this.delayedHide.reason),this.delayedHide=!1):this.setPosition()},this),rendering:a.proxy(this.setPosition,this),resize:a.proxy(this.setPosition,this),rendered:a.proxy(function(){this.$element.triggerHandler("shown",a(this.options.scope).data("editable"))},this)}).editableform("render")},show:function(b){this.$element.addClass("editable-open"),b!==!1&&this.closeOthers(this.$element[0]),this.innerShow(),this.tip().addClass(this.containerClass),this.$form,this.$form=a("<div>"),this.tip().is(this.innerCss)?this.tip().append(this.$form):this.tip().find(this.innerCss).append(this.$form),this.renderForm()},hide:function(a){if(this.tip()&&this.tip().is(":visible")&&this.$element.hasClass("editable-open")){if(this.$form.data("editableform").isSaving)return this.delayedHide={reason:a},void 0;this.delayedHide=!1,this.$element.removeClass("editable-open"),this.innerHide(),this.$element.triggerHandler("hidden",a||"manual")}},innerShow:function(){},innerHide:function(){},toggle:function(a){this.container()&&this.tip()&&this.tip().is(":visible")?this.hide():this.show(a)},setPosition:function(){},save:function(a,b){this.$element.triggerHandler("save",b),this.hide("save")},option:function(a,b){this.options[a]=b,a in this.containerOptions?(this.containerOptions[a]=b,this.setContainerOption(a,b)):(this.formOptions[a]=b,this.$form&&this.$form.editableform("option",a,b))},setContainerOption:function(a,b){this.call("option",a,b)},destroy:function(){this.hide(),this.innerDestroy(),this.$element.off("destroyed"),this.$element.removeData("editableContainer")},innerDestroy:function(){},closeOthers:function(b){a(".editable-open").each(function(c,d){if(d!==b&&!a(d).find(b).length){var e=a(d),f=e.data("editableContainer");f&&("cancel"===f.options.onblur?e.data("editableContainer").hide("onblur"):"submit"===f.options.onblur&&e.data("editableContainer").tip().find("form").submit())}})},activate:function(){this.tip&&this.tip().is(":visible")&&this.$form&&this.$form.data("editableform").input.activate()}},a.fn.editableContainer=function(d){var e=arguments;return this.each(function(){var f=a(this),g="editableContainer",h=f.data(g),i="object"==typeof d&&d,j="inline"===i.mode?c:b;h||f.data(g,h=new j(this,i)),"string"==typeof d&&h[d].apply(h,Array.prototype.slice.call(e,1))})},a.fn.editableContainer.Popup=b,a.fn.editableContainer.Inline=c,a.fn.editableContainer.defaults={value:null,placement:"top",autohide:!0,onblur:"cancel",anim:!1,mode:"popup"},jQuery.event.special.destroyed={remove:function(a){a.handler&&a.handler()}}}(window.jQuery),function(a){"use strict";a.extend(a.fn.editableContainer.Inline.prototype,a.fn.editableContainer.Popup.prototype,{containerName:"editableform",innerCss:".editable-inline",containerClass:"editable-container editable-inline",initContainer:function(){this.$tip=a("<span></span>"),this.options.anim||(this.options.anim=0)},splitOptions:function(){this.containerOptions={},this.formOptions=this.options},tip:function(){return this.$tip},innerShow:function(){this.$element.hide(),this.tip().insertAfter(this.$element).show()},innerHide:function(){this.$tip.hide(this.options.anim,a.proxy(function(){this.$element.show(),this.innerDestroy()},this))},innerDestroy:function(){this.tip()&&this.tip().empty().remove()}})}(window.jQuery),function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.editable.defaults,c,a.fn.editableutils.getConfigData(this.$element)),this.options.selector?this.initLive():this.init(),this.options.highlight&&!a.fn.editableutils.supportsTransitions()&&(this.options.highlight=!1)};b.prototype={constructor:b,init:function(){var b,c=!1;if(this.options.name=this.options.name||this.$element.attr("id"),this.options.scope=this.$element[0],this.input=a.fn.editableutils.createInput(this.options),this.input){switch(void 0===this.options.value||null===this.options.value?(this.value=this.input.html2value(a.trim(this.$element.html())),c=!0):(this.options.value=a.fn.editableutils.tryParseJson(this.options.value,!0),this.value="string"==typeof this.options.value?this.input.str2value(this.options.value):this.options.value),this.$element.addClass("editable"),"textarea"===this.input.type&&this.$element.addClass("editable-pre-wrapped"),"manual"!==this.options.toggle?(this.$element.addClass("editable-click"),this.$element.on(this.options.toggle+".editable",a.proxy(function(a){if(this.options.disabled||a.preventDefault(),"mouseenter"===this.options.toggle)this.show();else{var b="click"!==this.options.toggle;this.toggle(b)}},this))):this.$element.attr("tabindex",-1),"function"==typeof this.options.display&&(this.options.autotext="always"),this.options.autotext){case"always":b=!0;break;case"auto":b=!a.trim(this.$element.text()).length&&null!==this.value&&void 0!==this.value&&!c;break;default:b=!1}a.when(b?this.render():!0).then(a.proxy(function(){this.options.disabled?this.disable():this.enable(),this.$element.triggerHandler("init",this)},this))}},initLive:function(){var b=this.options.selector;this.options.selector=!1,this.options.autotext="never",this.$element.on(this.options.toggle+".editable",b,a.proxy(function(b){var c=a(b.target);c.data("editable")||(c.hasClass(this.options.emptyclass)&&c.empty(),c.editable(this.options).trigger(b))},this))},render:function(a){return this.options.display!==!1?this.input.value2htmlFinal?this.input.value2html(this.value,this.$element[0],this.options.display,a):"function"==typeof this.options.display?this.options.display.call(this.$element[0],this.value,a):this.input.value2html(this.value,this.$element[0]):void 0},enable:function(){this.options.disabled=!1,this.$element.removeClass("editable-disabled"),this.handleEmpty(this.isEmpty),"manual"!==this.options.toggle&&"-1"===this.$element.attr("tabindex")&&this.$element.removeAttr("tabindex")},disable:function(){this.options.disabled=!0,this.hide(),this.$element.addClass("editable-disabled"),this.handleEmpty(this.isEmpty),this.$element.attr("tabindex",-1)},toggleDisabled:function(){this.options.disabled?this.enable():this.disable()},option:function(b,c){return b&&"object"==typeof b?(a.each(b,a.proxy(function(b,c){this.option(a.trim(b),c)},this)),void 0):(this.options[b]=c,"disabled"===b?c?this.disable():this.enable():("value"===b&&this.setValue(c),this.container&&this.container.option(b,c),this.input.option&&this.input.option(b,c),void 0))},handleEmpty:function(b){this.options.display!==!1&&(this.isEmpty=void 0!==b?b:"function"==typeof this.input.isEmpty?this.input.isEmpty(this.$element):""===a.trim(this.$element.html()),this.options.disabled?this.isEmpty&&(this.$element.empty(),this.options.emptyclass&&this.$element.removeClass(this.options.emptyclass)):this.isEmpty?(this.$element.html(this.options.emptytext),this.options.emptyclass&&this.$element.addClass(this.options.emptyclass)):this.options.emptyclass&&this.$element.removeClass(this.options.emptyclass))},show:function(b){if(!this.options.disabled){if(this.container){if(this.container.tip().is(":visible"))return}else{var c=a.extend({},this.options,{value:this.value,input:this.input});this.$element.editableContainer(c),this.$element.on("save.internal",a.proxy(this.save,this)),this.container=this.$element.data("editableContainer")}this.container.show(b)}},hide:function(){this.container&&this.container.hide()},toggle:function(a){this.container&&this.container.tip().is(":visible")?this.hide():this.show(a)},save:function(a,b){if(this.options.unsavedclass){var c=!1;c=c||"function"==typeof this.options.url,c=c||this.options.display===!1,c=c||void 0!==b.response,c=c||this.options.savenochange&&this.input.value2str(this.value)!==this.input.value2str(b.newValue),c?this.$element.removeClass(this.options.unsavedclass):this.$element.addClass(this.options.unsavedclass)}if(this.options.highlight){var d=this.$element,e=d.css("background-color");d.css("background-color",this.options.highlight),setTimeout(function(){"transparent"===e&&(e=""),d.css("background-color",e),d.addClass("editable-bg-transition"),setTimeout(function(){d.removeClass("editable-bg-transition")},1700)},10)}this.setValue(b.newValue,!1,b.response)},validate:function(){return"function"==typeof this.options.validate?this.options.validate.call(this,this.value):void 0},setValue:function(b,c,d){this.value=c?this.input.str2value(b):b,this.container&&this.container.option("value",this.value),a.when(this.render(d)).then(a.proxy(function(){this.handleEmpty()},this))},activate:function(){this.container&&this.container.activate()},destroy:function(){this.disable(),this.container&&this.container.destroy(),this.input.destroy(),"manual"!==this.options.toggle&&(this.$element.removeClass("editable-click"),this.$element.off(this.options.toggle+".editable")),this.$element.off("save.internal"),this.$element.removeClass("editable editable-open editable-disabled"),this.$element.removeData("editable")}},a.fn.editable=function(c){var d={},e=arguments,f="editable";switch(c){case"validate":return this.each(function(){var b,c=a(this),e=c.data(f);e&&(b=e.validate())&&(d[e.options.name]=b)}),d;case"getValue":return 2===arguments.length&&arguments[1]===!0?d=this.eq(0).data(f).value:this.each(function(){var b=a(this),c=b.data(f);c&&void 0!==c.value&&null!==c.value&&(d[c.options.name]=c.input.value2submit(c.value))}),d;case"submit":var g=arguments[1]||{},h=this,i=this.editable("validate");if(a.isEmptyObject(i)){var j={};if(1===h.length){var k=h.data("editable"),l={name:k.options.name||"",value:k.input.value2submit(k.value),pk:"function"==typeof k.options.pk?k.options.pk.call(k.options.scope):k.options.pk};"function"==typeof k.options.params?l=k.options.params.call(k.options.scope,l):(k.options.params=a.fn.editableutils.tryParseJson(k.options.params,!0),a.extend(l,k.options.params)),j={url:k.options.url,data:l,type:"POST"},g.success=g.success||k.options.success,g.error=g.error||k.options.error}else{var m=this.editable("getValue");j={url:g.url,data:m,type:"POST"}}j.success="function"==typeof g.success?function(a){g.success.call(h,a,g)}:a.noop,j.error="function"==typeof g.error?function(){g.error.apply(h,arguments)}:a.noop,g.ajaxOptions&&a.extend(j,g.ajaxOptions),g.data&&a.extend(j.data,g.data),a.ajax(j)}else"function"==typeof g.error&&g.error.call(h,i);return this}return this.each(function(){var d=a(this),g=d.data(f),h="object"==typeof c&&c;return h&&h.selector?(g=new b(this,h),void 0):(g||d.data(f,g=new b(this,h)),"string"==typeof c&&g[c].apply(g,Array.prototype.slice.call(e,1)),void 0)})},a.fn.editable.defaults={type:"text",disabled:!1,toggle:"click",emptytext:"Empty",autotext:"auto",value:null,display:null,emptyclass:"editable-empty",unsavedclass:"editable-unsaved",selector:null,highlight:"#FFFF80"}}(window.jQuery),function(a){"use strict";a.fn.editabletypes={};var b=function(){};b.prototype={init:function(b,c,d){this.type=b,this.options=a.extend({},d,c)},prerender:function(){this.$tpl=a(this.options.tpl),this.$input=this.$tpl,this.$clear=null,this.error=null},render:function(){},value2html:function(b,c){a(c)[this.options.escape?"text":"html"](a.trim(b))},html2value:function(b){return a("<div>").html(b).text()},value2str:function(a){return a},str2value:function(a){return a},value2submit:function(a){return a},value2input:function(a){this.$input.val(a)},input2value:function(){return this.$input.val()},activate:function(){this.$input.is(":visible")&&this.$input.focus()},clear:function(){this.$input.val(null)},escape:function(b){return a("<div>").text(b).html()},autosubmit:function(){},destroy:function(){},setClass:function(){this.options.inputclass&&this.$input.addClass(this.options.inputclass)},setAttr:function(a){void 0!==this.options[a]&&null!==this.options[a]&&this.$input.attr(a,this.options[a])},option:function(a,b){this.options[a]=b}},b.defaults={tpl:"",inputclass:null,escape:!0,scope:null,showbuttons:!0},a.extend(a.fn.editabletypes,{abstractinput:b})}(window.jQuery),function(a){"use strict";var b=function(){};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){var b=a.Deferred();return this.error=null,this.onSourceReady(function(){this.renderList(),b.resolve()},function(){this.error=this.options.sourceError,b.resolve()}),b.promise()},html2value:function(){return null},value2html:function(b,c,d,e){var f=a.Deferred(),g=function(){"function"==typeof d?d.call(c,b,this.sourceData,e):this.value2htmlFinal(b,c),f.resolve()};return null===b?g.call(this):this.onSourceReady(g,function(){f.resolve()}),f.promise()},onSourceReady:function(b,c){var d;if(a.isFunction(this.options.source)?(d=this.options.source.call(this.options.scope),this.sourceData=null):d=this.options.source,this.options.sourceCache&&a.isArray(this.sourceData))return b.call(this),void 0;try{d=a.fn.editableutils.tryParseJson(d,!1)}catch(e){return c.call(this),void 0}if("string"==typeof d){if(this.options.sourceCache){var f,g=d;if(a(document).data(g)||a(document).data(g,{}),f=a(document).data(g),f.loading===!1&&f.sourceData)return this.sourceData=f.sourceData,this.doPrepend(),b.call(this),void 0;if(f.loading===!0)return f.callbacks.push(a.proxy(function(){this.sourceData=f.sourceData,this.doPrepend(),b.call(this)},this)),f.err_callbacks.push(a.proxy(c,this)),void 0;f.loading=!0,f.callbacks=[],f.err_callbacks=[]}var h=a.extend({url:d,type:"get",cache:!1,dataType:"json",success:a.proxy(function(d){f&&(f.loading=!1),this.sourceData=this.makeArray(d),a.isArray(this.sourceData)?(f&&(f.sourceData=this.sourceData,a.each(f.callbacks,function(){this.call()})),this.doPrepend(),b.call(this)):(c.call(this),f&&a.each(f.err_callbacks,function(){this.call()}))},this),error:a.proxy(function(){c.call(this),f&&(f.loading=!1,a.each(f.err_callbacks,function(){this.call()}))},this)},this.options.sourceOptions);a.ajax(h)}else this.sourceData=this.makeArray(d),a.isArray(this.sourceData)?(this.doPrepend(),b.call(this)):c.call(this)},doPrepend:function(){null!==this.options.prepend&&void 0!==this.options.prepend&&(a.isArray(this.prependData)||(a.isFunction(this.options.prepend)&&(this.options.prepend=this.options.prepend.call(this.options.scope)),this.options.prepend=a.fn.editableutils.tryParseJson(this.options.prepend,!0),"string"==typeof this.options.prepend&&(this.options.prepend={"":this.options.prepend}),this.prependData=this.makeArray(this.options.prepend)),a.isArray(this.prependData)&&a.isArray(this.sourceData)&&(this.sourceData=this.prependData.concat(this.sourceData)))},renderList:function(){},value2htmlFinal:function(){},makeArray:function(b){var c,d,e,f,g=[];if(!b||"string"==typeof b)return null;if(a.isArray(b)){f=function(a,b){return d={value:a,text:b},c++>=2?!1:void 0};for(var h=0;h<b.length;h++)e=b[h],"object"==typeof e?(c=0,a.each(e,f),1===c?g.push(d):c>1&&(e.children&&(e.children=this.makeArray(e.children)),g.push(e))):g.push({value:e,text:e})}else a.each(b,function(a,b){g.push({value:a,text:b})});return g},option:function(a,b){this.options[a]=b,"source"===a&&(this.sourceData=null),"prepend"===a&&(this.prependData=null)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{source:null,prepend:!1,sourceError:"Error when loading list",sourceCache:!0,sourceOptions:null}),a.fn.editabletypes.list=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("text",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.renderClear(),this.setClass(),this.setAttr("placeholder")},activate:function(){this.$input.is(":visible")&&(this.$input.focus(),a.fn.editableutils.setCursorPosition(this.$input.get(0),this.$input.val().length),this.toggleClear&&this.toggleClear())},renderClear:function(){this.options.clear&&(this.$clear=a('<span class="editable-clear-x"></span>'),this.$input.after(this.$clear).css("padding-right",24).keyup(a.proxy(function(b){if(!~a.inArray(b.keyCode,[40,38,9,13,27])){clearTimeout(this.t);var c=this;this.t=setTimeout(function(){c.toggleClear(b)},100)}},this)).parent().css("position","relative"),this.$clear.click(a.proxy(this.clear,this)))},postrender:function(){},toggleClear:function(){if(this.$clear){var a=this.$input.val().length,b=this.$clear.is(":visible");a&&!b&&this.$clear.show(),!a&&b&&this.$clear.hide()}},clear:function(){this.$clear.hide(),this.$input.val("").focus()}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',placeholder:null,clear:!0}),a.fn.editabletypes.text=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("textarea",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass(),this.setAttr("placeholder"),this.setAttr("rows"),this.$input.keydown(function(b){b.ctrlKey&&13===b.which&&a(this).closest("form").submit()})},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:"<textarea></textarea>",inputclass:"input-large",placeholder:null,rows:7}),a.fn.editabletypes.textarea=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("select",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list),a.extend(b.prototype,{renderList:function(){this.$input.empty();var b=function(c,d){var e;if(a.isArray(d))for(var f=0;f<d.length;f++)e={},d[f].children?(e.label=d[f].text,c.append(b(a("<optgroup>",e),d[f].children))):(e.value=d[f].value,d[f].disabled&&(e.disabled=!0),c.append(a("<option>",e).text(d[f].text)));return c};b(this.$input,this.sourceData),this.setClass(),this.$input.on("keydown.editable",function(b){13===b.which&&a(this).closest("form").submit()})},value2htmlFinal:function(b,c){var d="",e=a.fn.editableutils.itemsByValue(b,this.sourceData);e.length&&(d=e[0].text),a.fn.editabletypes.abstractinput.prototype.value2html.call(this,d,c)},autosubmit:function(){this.$input.off("keydown.editable").on("change.editable",function(){a(this).closest("form").submit()})}}),b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:"<select></select>"}),a.fn.editabletypes.select=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("checklist",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list),a.extend(b.prototype,{renderList:function(){var b;if(this.$tpl.empty(),a.isArray(this.sourceData)){for(var c=0;c<this.sourceData.length;c++)b=a("<label>").append(a("<input>",{type:"checkbox",value:this.sourceData[c].value})).append(a("<span>").text(" "+this.sourceData[c].text)),a("<div>").append(b).appendTo(this.$tpl);this.$input=this.$tpl.find('input[type="checkbox"]'),this.setClass()}},value2str:function(b){return a.isArray(b)?b.sort().join(a.trim(this.options.separator)):""},str2value:function(b){var c,d=null;return"string"==typeof b&&b.length?(c=new RegExp("\\s*"+a.trim(this.options.separator)+"\\s*"),d=b.split(c)):d=a.isArray(b)?b:[b],d},value2input:function(b){this.$input.prop("checked",!1),a.isArray(b)&&b.length&&this.$input.each(function(c,d){var e=a(d);a.each(b,function(a,b){e.val()==b&&e.prop("checked",!0)})})},input2value:function(){var b=[];return this.$input.filter(":checked").each(function(c,d){b.push(a(d).val())}),b},value2htmlFinal:function(b,c){var d=[],e=a.fn.editableutils.itemsByValue(b,this.sourceData),f=this.options.escape;e.length?(a.each(e,function(b,c){var e=f?a.fn.editableutils.escape(c.text):c.text;d.push(e)}),a(c).html(d.join("<br>"))):a(c).empty()},activate:function(){this.$input.first().focus()},autosubmit:function(){this.$input.on("keydown",function(b){13===b.which&&a(this).closest("form").submit()})}}),b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:'<div class="editable-checklist"></div>',inputclass:null,separator:","}),a.fn.editabletypes.checklist=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("password",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),a.extend(b.prototype,{value2html:function(b,c){b?a(c).text("[hidden]"):a(c).empty()},html2value:function(){return null}}),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="password">'}),a.fn.editabletypes.password=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("email",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="email">'}),a.fn.editabletypes.email=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("url",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="url">'}),a.fn.editabletypes.url=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("tel",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="tel">'}),a.fn.editabletypes.tel=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("number",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),a.extend(b.prototype,{render:function(){b.superclass.render.call(this),this.setAttr("min"),this.setAttr("max"),this.setAttr("step")},postrender:function(){this.$clear&&this.$clear.css({right:24})}}),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="number">',inputclass:"input-mini",min:null,max:null,step:null}),a.fn.editabletypes.number=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("range",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.number),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.setAttr("min"),this.setAttr("max"),this.setAttr("step"),this.$input.on("input",function(){a(this).siblings("output").text(a(this).val())})},activate:function(){this.$input.focus()}}),b.defaults=a.extend({},a.fn.editabletypes.number.defaults,{tpl:'<input type="range"><output style="width: 30px; display: inline-block"></output>',inputclass:"input-medium"}),a.fn.editabletypes.range=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("time",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass()}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="time">'}),a.fn.editabletypes.time=b}(window.jQuery),function(a){"use strict";var b=function(c){if(this.init("select2",c,b.defaults),c.select2=c.select2||{},this.sourceData=null,c.placeholder&&(c.select2.placeholder=c.placeholder),!c.select2.tags&&c.source){var d=c.source;a.isFunction(c.source)&&(d=c.source.call(c.scope)),"string"==typeof d?(c.select2.ajax=c.select2.ajax||{},c.select2.ajax.data||(c.select2.ajax.data=function(a){return{query:a}}),c.select2.ajax.results||(c.select2.ajax.results=function(a){return{results:a}}),c.select2.ajax.url=d):(this.sourceData=this.convertSource(d),c.select2.data=this.sourceData)}if(this.options.select2=a.extend({},b.defaults.select2,c.select2),this.isMultiple=this.options.select2.tags||this.options.select2.multiple,this.isRemote="ajax"in this.options.select2,this.idFunc=this.options.select2.id,"function"!=typeof this.idFunc){var e=this.idFunc||"id";this.idFunc=function(a){return a[e]}}this.formatSelection=this.options.select2.formatSelection,"function"!=typeof this.formatSelection&&(this.formatSelection=function(a){return a.text})};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass(),this.isRemote&&this.$input.on("select2-loaded",a.proxy(function(a){this.sourceData=a.items.results},this)),this.isMultiple&&this.$input.on("change",function(){a(this).closest("form").parent().triggerHandler("resize")})},value2html:function(c,d){var e,f="",g=this;this.options.select2.tags?e=c:this.sourceData&&(e=a.fn.editableutils.itemsByValue(c,this.sourceData,this.idFunc)),a.isArray(e)?(f=[],a.each(e,function(a,b){f.push(b&&"object"==typeof b?g.formatSelection(b):b)})):e&&(f=g.formatSelection(e)),f=a.isArray(f)?f.join(this.options.viewseparator):f,b.superclass.value2html.call(this,f,d)},html2value:function(a){return this.options.select2.tags?this.str2value(a,this.options.viewseparator):null},value2input:function(b){if(a.isArray(b)&&(b=b.join(this.getSeparator())),this.$input.data("select2")?this.$input.val(b).trigger("change",!0):(this.$input.val(b),this.$input.select2(this.options.select2)),this.isRemote&&!this.isMultiple&&!this.options.select2.initSelection){var c=this.options.select2.id,d=this.options.select2.formatSelection;if(!c&&!d){var e=a(this.options.scope);if(!e.data("editable").isEmpty){var f={id:b,text:e.text()};this.$input.select2("data",f)}}}},input2value:function(){return this.$input.select2("val")},str2value:function(b,c){if("string"!=typeof b||!this.isMultiple)return b;c=c||this.getSeparator();var d,e,f;if(null===b||b.length<1)return null;for(d=b.split(c),e=0,f=d.length;f>e;e+=1)d[e]=a.trim(d[e]);return d},autosubmit:function(){this.$input.on("change",function(b,c){c||a(this).closest("form").submit()})},getSeparator:function(){return this.options.select2.separator||a.fn.select2.defaults.separator},convertSource:function(b){if(a.isArray(b)&&b.length&&void 0!==b[0].value)for(var c=0;c<b.length;c++)void 0!==b[c].value&&(b[c].id=b[c].value,delete b[c].value);return b},destroy:function(){this.$input.data("select2")&&this.$input.select2("destroy")}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="hidden">',select2:null,placeholder:null,source:null,viewseparator:", "}),a.fn.editabletypes.select2=b}(window.jQuery),function(a){var b=function(b,c){return this.$element=a(b),this.$element.is("input")?(this.options=a.extend({},a.fn.combodate.defaults,c,this.$element.data()),this.init(),void 0):(a.error("Combodate should be applied to INPUT element"),void 0)};b.prototype={constructor:b,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=a('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.$widget.on("change","select",a.proxy(function(b){this.$element.val(this.getValue()).change(),this.options.smartDays&&(a(b.target).is(".month")||a(b.target).is(".year"))&&this.fillCombo("day")},this)),this.$widget.find("select").css("width","auto"),this.$element.hide().after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var b=this.options.template;return a.each(this.map,function(a,c){c=c[0];var d=new RegExp(c+"+"),e=c.length>1?c.substring(1,2):c;b=b.replace(d,"{"+e+"}")}),b=b.replace(/ /g,"&nbsp;"),a.each(this.map,function(a,c){c=c[0];var d=c.length>1?c.substring(1,2):c;b=b.replace("{"+d+"}",'<select class="'+a+'"></select>')}),b},initCombos:function(){for(var a in this.map){var b=this.$widget.find("."+a);this["$"+a]=b.length?b:null,this.fillCombo(a)}},fillCombo:function(a){var b=this["$"+a];if(b){var c="fill"+a.charAt(0).toUpperCase()+a.slice(1),d=this[c](),e=b.val();b.empty();for(var f=0;f<d.length;f++)b.append('<option value="'+d[f][0]+'">'+d[f][1]+"</option>");b.val(e)}},fillCommon:function(a){var b,c=[];if("name"===this.options.firstItem){b=moment.relativeTime||moment.langData()._relativeTime;var d="function"==typeof b[a]?b[a](1,!0,a,!1):b[a];d=d.split(" ").reverse()[0],c.push(["",d])}else"empty"===this.options.firstItem&&c.push(["",""]);return c},fillDay:function(){var a,b,c=this.fillCommon("d"),d=-1!==this.options.template.indexOf("DD"),e=31;if(this.options.smartDays&&this.$month&&this.$year){var f=parseInt(this.$month.val(),10),g=parseInt(this.$year.val(),10);isNaN(f)||isNaN(g)||(e=moment([g,f]).daysInMonth())}for(b=1;e>=b;b++)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillMonth:function(){var a,b,c=this.fillCommon("M"),d=-1!==this.options.template.indexOf("MMMM"),e=-1!==this.options.template.indexOf("MMM"),f=-1!==this.options.template.indexOf("MM");for(b=0;11>=b;b++)a=d?moment().date(1).month(b).format("MMMM"):e?moment().date(1).month(b).format("MMM"):f?this.leadZero(b+1):b+1,c.push([b,a]);return c},fillYear:function(){var a,b,c=[],d=-1!==this.options.template.indexOf("YYYY");for(b=this.options.maxYear;b>=this.options.minYear;b--)a=d?b:(b+"").substring(2),c[this.options.yearDescending?"push":"unshift"]([b,a]);return c=this.fillCommon("y").concat(c)},fillHour:function(){var a,b,c=this.fillCommon("h"),d=-1!==this.options.template.indexOf("h"),e=(-1!==this.options.template.indexOf("H"),-1!==this.options.template.toLowerCase().indexOf("hh")),f=d?1:0,g=d?12:23;for(b=f;g>=b;b++)a=e?this.leadZero(b):b,c.push([b,a]);return c},fillMinute:function(){var a,b,c=this.fillCommon("m"),d=-1!==this.options.template.indexOf("mm");for(b=0;59>=b;b+=this.options.minuteStep)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillSecond:function(){var a,b,c=this.fillCommon("s"),d=-1!==this.options.template.indexOf("ss");for(b=0;59>=b;b+=this.options.secondStep)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillAmpm:function(){var a=-1!==this.options.template.indexOf("a"),b=(-1!==this.options.template.indexOf("A"),[["am",a?"am":"AM"],["pm",a?"pm":"PM"]]);return b},getValue:function(b){var c,d={},e=this,f=!1;return a.each(this.map,function(a){if("ampm"!==a){var b="day"===a?1:0;return d[a]=e["$"+a]?parseInt(e["$"+a].val(),10):b,isNaN(d[a])?(f=!0,!1):void 0}}),f?"":(this.$ampm&&(d.hour=12===d.hour?"am"===this.$ampm.val()?0:12:"am"===this.$ampm.val()?d.hour:d.hour+12),c=moment([d.year,d.month,d.day,d.hour,d.minute,d.second]),this.highlight(c),b=void 0===b?this.options.format:b,null===b?c.isValid()?c:null:c.isValid()?c.format(b):"")},setValue:function(b){function c(b,c){var d={};return b.children("option").each(function(b,e){var f,g=a(e).attr("value");""!==g&&(f=Math.abs(g-c),("undefined"==typeof d.distance||f<d.distance)&&(d={value:g,distance:f}))}),d.value}if(b){var d="string"==typeof b?moment(b,this.options.format):moment(b),e=this,f={};d.isValid()&&(a.each(this.map,function(a,b){"ampm"!==a&&(f[a]=d[b[1]]())}),this.$ampm&&(f.hour>=12?(f.ampm="pm",f.hour>12&&(f.hour-=12)):(f.ampm="am",0===f.hour&&(f.hour=12))),a.each(f,function(a,b){e["$"+a]&&("minute"===a&&e.options.minuteStep>1&&e.options.roundTime&&(b=c(e["$"+a],b)),"second"===a&&e.options.secondStep>1&&e.options.roundTime&&(b=c(e["$"+a],b)),e["$"+a].val(b))}),this.options.smartDays&&this.fillCombo("day"),this.$element.val(d.format(this.options.format)).change())}},highlight:function(a){a.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(a){return 9>=a?"0"+a:a},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},a.fn.combodate=function(c){var d,e=Array.apply(null,arguments);return e.shift(),"getValue"===c&&this.length&&(d=this.eq(0).data("combodate"))?d.getValue.apply(d,e):this.each(function(){var d=a(this),f=d.data("combodate"),g="object"==typeof c&&c;f||d.data("combodate",f=new b(this,g)),"string"==typeof c&&"function"==typeof f[c]&&f[c].apply(f,e)})},a.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,roundTime:!0,smartDays:!1}}(window.jQuery),function(a){"use strict";var b=function(c){this.init("combodate",c,b.defaults),this.options.viewformat||(this.options.viewformat=this.options.format),c.combodate=a.fn.editableutils.tryParseJson(c.combodate,!0),this.options.combodate=a.extend({},b.defaults.combodate,c.combodate,{format:this.options.format,template:this.options.template})};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.$input.combodate(this.options.combodate),"bs3"===a.fn.editableform.engine&&this.$input.siblings().find("select").addClass("form-control"),this.options.inputclass&&this.$input.siblings().find("select").addClass(this.options.inputclass)},value2html:function(a,c){var d=a?a.format(this.options.viewformat):"";b.superclass.value2html.call(this,d,c)},html2value:function(a){return a?moment(a,this.options.viewformat):null},value2str:function(a){return a?a.format(this.options.format):""},str2value:function(a){return a?moment(a,this.options.format):null},value2submit:function(a){return this.value2str(a)},value2input:function(a){this.$input.combodate("setValue",a)},input2value:function(){return this.$input.combodate("getValue",null)},activate:function(){this.$input.siblings(".combodate").find("select").eq(0).focus()},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',inputclass:null,format:"YYYY-MM-DD",viewformat:null,template:"D / MMM / YYYY",combodate:null}),a.fn.editabletypes.combodate=b}(window.jQuery),function(a){"use strict";var b=a.fn.editableform.Constructor.prototype.initInput;a.extend(a.fn.editableform.Constructor.prototype,{initTemplate:function(){this.$form=a(a.fn.editableform.template),this.$form.find(".control-group").addClass("form-group"),this.$form.find(".editable-error-block").addClass("help-block")},initInput:function(){b.apply(this);var c=null===this.input.options.inputclass||this.input.options.inputclass===!1,d="input-sm",e="text,select,textarea,password,email,url,tel,number,range,time,typeaheadjs".split(",");~a.inArray(this.input.type,e)&&(this.input.$input.addClass("form-control"),c&&(this.input.options.inputclass=d,this.input.$input.addClass(d)));for(var f=this.$form.find(".editable-buttons"),g=c?[d]:this.input.options.inputclass.split(" "),h=0;h<g.length;h++)"input-lg"===g[h].toLowerCase()&&f.find("button").removeClass("btn-sm").addClass("btn-lg")}}),a.fn.editableform.buttons='<button type="submit" class="btn btn-primary btn-sm editable-submit"><i class="glyphicon glyphicon-ok"></i></button><button type="button" class="btn btn-default btn-sm editable-cancel"><i class="glyphicon glyphicon-remove"></i></button>',a.fn.editableform.errorGroupClass="has-error",a.fn.editableform.errorBlockClass=null,a.fn.editableform.engine="bs3"}(window.jQuery),function(a){"use strict";a.extend(a.fn.editableContainer.Popup.prototype,{containerName:"popover",containerDataName:"bs.popover",innerCss:".popover-content",defaults:a.fn.popover.Constructor.DEFAULTS,initContainer:function(){a.extend(this.containerOptions,{trigger:"manual",selector:!1,content:" ",template:this.defaults.template});var b;this.$element.data("template")&&(b=this.$element.data("template"),this.$element.removeData("template")),this.call(this.containerOptions),b&&this.$element.data("template",b)},innerShow:function(){this.call("show")},innerHide:function(){this.call("hide")},innerDestroy:function(){this.call("destroy")},setContainerOption:function(a,b){this.container().options[a]=b},setPosition:function(){!function(){var a=this.tip(),b="function"==typeof this.options.placement?this.options.placement.call(this,a[0],this.$element[0]):this.options.placement,c=/\s?auto?\s?/i,d=c.test(b);d&&(b=b.replace(c,"")||"top");var e=this.getPosition(),f=a[0].offsetWidth,g=a[0].offsetHeight;if(d){var h=this.$element.parent(),i=b,j=document.documentElement.scrollTop||document.body.scrollTop,k="body"==this.options.container?window.innerWidth:h.outerWidth(),l="body"==this.options.container?window.innerHeight:h.outerHeight(),m="body"==this.options.container?0:h.offset().left;b="bottom"==b&&e.top+e.height+g-j>l?"top":"top"==b&&e.top-j-g<0?"bottom":"right"==b&&e.right+f>k?"left":"left"==b&&e.left-f<m?"right":b,a.removeClass(i).addClass(b)}var n=this.getCalculatedOffset(b,e,f,g);this.applyPlacement(n,b)}.call(this.container())}})}(window.jQuery),function(a){function b(){return new Date(Date.UTC.apply(Date,arguments))}function c(b,c){var d,e=a(b).data(),f={},g=new RegExp("^"+c.toLowerCase()+"([A-Z])"),c=new RegExp("^"+c.toLowerCase());for(var h in e)c.test(h)&&(d=h.replace(g,function(a,b){return b.toLowerCase()}),f[d]=e[h]);return f}function d(b){var c={};if(k[b]||(b=b.split("-")[0],k[b])){var d=k[b];return a.each(j,function(a,b){b in d&&(c[b]=d[b])}),c}}var e=function(b,c){this._process_options(c),this.element=a(b),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=a(l.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&(this.picker.addClass("datepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",function(a,b){return parseInt(b)+1}),this._allow_update=!1,this.setStartDate(this.o.startDate),this.setEndDate(this.o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};e.prototype={constructor:e,_process_options:function(b){this._o=a.extend({},this._o,b);var c=this.o=a.extend({},this._o),d=c.language;switch(k[d]||(d=d.split("-")[0],k[d]||(d=i.language)),c.language=d,c.startView){case 2:case"decade":c.startView=2;break;case 1:case"year":c.startView=1;break;default:c.startView=0}switch(c.minViewMode){case 1:case"months":c.minViewMode=1;break;case 2:case"years":c.minViewMode=2;break;default:c.minViewMode=0}c.startView=Math.max(c.startView,c.minViewMode),c.weekStart%=7,c.weekEnd=(c.weekStart+6)%7;var e=l.parseFormat(c.format);c.startDate!==-1/0&&(c.startDate=l.parseDate(c.startDate,e,c.language)),1/0!==c.endDate&&(c.endDate=l.parseDate(c.endDate,e,c.language)),c.daysOfWeekDisabled=c.daysOfWeekDisabled||[],a.isArray(c.daysOfWeekDisabled)||(c.daysOfWeekDisabled=c.daysOfWeekDisabled.split(/[,\s]*/)),c.daysOfWeekDisabled=a.map(c.daysOfWeekDisabled,function(a){return parseInt(a,10)})},_events:[],_secondaryEvents:[],_applyEvents:function(a){for(var b,c,d=0;d<a.length;d++)b=a[d][0],c=a[d][1],b.on(c)},_unapplyEvents:function(a){for(var b,c,d=0;d<a.length;d++)b=a[d][0],c=a[d][1],b.off(c)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}],[this.component,{click:a.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:a.proxy(this.show,this)}]],this._secondaryEvents=[[this.picker,{click:a.proxy(this.click,this)}],[a(window),{resize:a.proxy(this.place,this)}],[a(document),{mousedown:a.proxy(function(a){this.element.is(a.target)||this.element.find(a.target).size()||this.picker.is(a.target)||this.picker.find(a.target).size()||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(b,c){var d=c||this.date,e=new Date(d.getTime()+6e4*d.getTimezoneOffset());this.element.trigger({type:b,date:e,format:a.proxy(function(a){var b=a||this.o.format;return l.formatDate(d,b,this.o.language)},this)})},show:function(a){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),this._attachSecondaryEvents(),a&&a.preventDefault(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},getDate:function(){var a=this.getUTCDate();return new Date(a.getTime()+6e4*a.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(a){this.setUTCDate(new Date(a.getTime()-6e4*a.getTimezoneOffset()))},setUTCDate:function(a){this.date=a,this.setValue()},setValue:function(){var a=this.getFormattedDate();this.isInput?this.element.val(a):this.component&&this.element.find("input").val(a)},getFormattedDate:function(a){return void 0===a&&(a=this.o.format),l.formatDate(this.date,a,this.o.language)},setStartDate:function(a){this._process_options({startDate:a}),this.update(),this.updateNavArrows()},setEndDate:function(a){this._process_options({endDate:a}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(a){this._process_options({daysOfWeekDisabled:a}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var b=parseInt(this.element.parents().filter(function(){return"auto"!=a(this).css("z-index")}).first().css("z-index"))+10,c=this.component?this.component.parent().offset():this.element.offset(),d=this.component?this.component.outerHeight(!0):this.element.outerHeight(!0);this.picker.css({top:c.top+d,left:c.left,zIndex:b})}},_allow_update:!0,update:function(){if(this._allow_update){var a,b=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(a=arguments[0],b=!0):(a=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),delete this.element.data().date),this.date=l.parseDate(a,this.o.format,this.o.language),b&&this.setValue(),this.viewDate=this.date<this.o.startDate?new Date(this.o.startDate):this.date>this.o.endDate?new Date(this.o.endDate):new Date(this.date),this.fill()}},fillDow:function(){var a=this.o.weekStart,b="<tr>";if(this.o.calendarWeeks){var c='<th class="cw">&nbsp;</th>';b+=c,this.picker.find(".datepicker-days thead tr:first-child").prepend(c)}for(;a<this.o.weekStart+7;)b+='<th class="dow">'+k[this.o.language].daysMin[a++%7]+"</th>";b+="</tr>",this.picker.find(".datepicker-days thead").append(b)},fillMonths:function(){for(var a="",b=0;12>b;)a+='<span class="month">'+k[this.o.language].monthsShort[b++]+"</span>";this.picker.find(".datepicker-months td").html(a)},setRange:function(b){b&&b.length?this.range=a.map(b,function(a){return a.valueOf()}):delete this.range,this.fill()},getClassNames:function(b){var c=[],d=this.viewDate.getUTCFullYear(),e=this.viewDate.getUTCMonth(),f=this.date.valueOf(),g=new Date;return b.getUTCFullYear()<d||b.getUTCFullYear()==d&&b.getUTCMonth()<e?c.push("old"):(b.getUTCFullYear()>d||b.getUTCFullYear()==d&&b.getUTCMonth()>e)&&c.push("new"),this.o.todayHighlight&&b.getUTCFullYear()==g.getFullYear()&&b.getUTCMonth()==g.getMonth()&&b.getUTCDate()==g.getDate()&&c.push("today"),f&&b.valueOf()==f&&c.push("active"),(b.valueOf()<this.o.startDate||b.valueOf()>this.o.endDate||-1!==a.inArray(b.getUTCDay(),this.o.daysOfWeekDisabled))&&c.push("disabled"),this.range&&(b>this.range[0]&&b<this.range[this.range.length-1]&&c.push("range"),-1!=a.inArray(b.valueOf(),this.range)&&c.push("selected")),c},fill:function(){var c,d=new Date(this.viewDate),e=d.getUTCFullYear(),f=d.getUTCMonth(),g=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,h=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,i=1/0!==this.o.endDate?this.o.endDate.getUTCFullYear():1/0,j=1/0!==this.o.endDate?this.o.endDate.getUTCMonth():1/0;this.date&&this.date.valueOf(),this.picker.find(".datepicker-days thead th.datepicker-switch").text(k[this.o.language].months[f]+" "+e),this.picker.find("tfoot th.today").text(k[this.o.language].today).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(k[this.o.language].clear).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var m=b(e,f-1,28,0,0,0,0),n=l.getDaysInMonth(m.getUTCFullYear(),m.getUTCMonth());m.setUTCDate(n),m.setUTCDate(n-(m.getUTCDay()-this.o.weekStart+7)%7);var o=new Date(m);o.setUTCDate(o.getUTCDate()+42),o=o.valueOf();for(var p,q=[];m.valueOf()<o;){if(m.getUTCDay()==this.o.weekStart&&(q.push("<tr>"),this.o.calendarWeeks)){var r=new Date(+m+864e5*((this.o.weekStart-m.getUTCDay()-7)%7)),s=new Date(+r+864e5*((11-r.getUTCDay())%7)),t=new Date(+(t=b(s.getUTCFullYear(),0,1))+864e5*((11-t.getUTCDay())%7)),u=(s-t)/864e5/7+1;q.push('<td class="cw">'+u+"</td>")}p=this.getClassNames(m),p.push("day");var v=this.o.beforeShowDay(m);void 0===v?v={}:"boolean"==typeof v?v={enabled:v}:"string"==typeof v&&(v={classes:v}),v.enabled===!1&&p.push("disabled"),v.classes&&(p=p.concat(v.classes.split(/\s+/))),v.tooltip&&(c=v.tooltip),p=a.unique(p),q.push('<td class="'+p.join(" ")+'"'+(c?' title="'+c+'"':"")+">"+m.getUTCDate()+"</td>"),m.getUTCDay()==this.o.weekEnd&&q.push("</tr>"),m.setUTCDate(m.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(q.join(""));var w=this.date&&this.date.getUTCFullYear(),x=this.picker.find(".datepicker-months").find("th:eq(1)").text(e).end().find("span").removeClass("active");w&&w==e&&x.eq(this.date.getUTCMonth()).addClass("active"),(g>e||e>i)&&x.addClass("disabled"),e==g&&x.slice(0,h).addClass("disabled"),e==i&&x.slice(j+1).addClass("disabled"),q="",e=10*parseInt(e/10,10);var y=this.picker.find(".datepicker-years").find("th:eq(1)").text(e+"-"+(e+9)).end().find("td");e-=1;for(var z=-1;11>z;z++)q+='<span class="year'+(-1==z?" old":10==z?" new":"")+(w==e?" active":"")+(g>e||e>i?" disabled":"")+'">'+e+"</span>",e+=1;y.html(q)},updateNavArrows:function(){if(this._allow_update){var a=new Date(this.viewDate),b=a.getUTCFullYear(),c=a.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-1/0&&b<=this.o.startDate.getUTCFullYear()&&c<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&b>=this.o.endDate.getUTCFullYear()&&c>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-1/0&&b<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&b>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(c){c.preventDefault();var d=a(c.target).closest("span, td, th");if(1==d.length)switch(d[0].nodeName.toLowerCase()){case"th":switch(d[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var e=l.modes[this.viewMode].navStep*("prev"==d[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,e);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,e)}this.fill();break;case"today":var f=new Date;f=b(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),this.showMode(-2);var g="linked"==this.o.todayBtn?null:"view";this._setDate(f,g);break;case"clear":var h;this.isInput?h=this.element:this.component&&(h=this.element.find("input")),h&&h.val("").change(),this._trigger("changeDate"),this.update(),this.o.autoclose&&this.hide()}break;case"span":if(!d.is(".disabled")){if(this.viewDate.setUTCDate(1),d.is(".month")){var i=1,j=d.parent().find("span").index(d),k=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(j),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(b(k,j,i,0,0,0,0))}else{var k=parseInt(d.text(),10)||0,i=1,j=0;this.viewDate.setUTCFullYear(k),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(b(k,j,i,0,0,0,0))}this.showMode(-1),this.fill()}break;case"td":if(d.is(".day")&&!d.is(".disabled")){var i=parseInt(d.text(),10)||1,k=this.viewDate.getUTCFullYear(),j=this.viewDate.getUTCMonth();d.is(".old")?0===j?(j=11,k-=1):j-=1:d.is(".new")&&(11==j?(j=0,k+=1):j+=1),this._setDate(b(k,j,i,0,0,0,0))}}},_setDate:function(a,b){b&&"date"!=b||(this.date=new Date(a)),b&&"view"!=b||(this.viewDate=new Date(a)),this.fill(),this.setValue(),this._trigger("changeDate");var c;this.isInput?c=this.element:this.component&&(c=this.element.find("input")),c&&(c.change(),!this.o.autoclose||b&&"date"!=b||this.hide())},moveMonth:function(a,b){if(!b)return a;var c,d,e=new Date(a.valueOf()),f=e.getUTCDate(),g=e.getUTCMonth(),h=Math.abs(b);if(b=b>0?1:-1,1==h)d=-1==b?function(){return e.getUTCMonth()==g}:function(){return e.getUTCMonth()!=c},c=g+b,e.setUTCMonth(c),(0>c||c>11)&&(c=(c+12)%12);else{for(var i=0;h>i;i++)e=this.moveMonth(e,b);c=e.getUTCMonth(),e.setUTCDate(f),d=function(){return c!=e.getUTCMonth()}}for(;d();)e.setUTCDate(--f),e.setUTCMonth(c);return e},moveYear:function(a,b){return this.moveMonth(a,12*b)},dateWithinRange:function(a){return a>=this.o.startDate&&a<=this.o.endDate},keydown:function(a){if(this.picker.is(":not(:visible)"))return 27==a.keyCode&&this.show(),void 0;var b,c,d,e=!1;switch(a.keyCode){case 27:this.hide(),a.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;b=37==a.keyCode?-1:1,a.ctrlKey?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):a.shiftKey?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):(c=new Date(this.date),c.setUTCDate(this.date.getUTCDate()+b),d=new Date(this.viewDate),d.setUTCDate(this.viewDate.getUTCDate()+b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 38:case 40:if(!this.o.keyboardNavigation)break;b=38==a.keyCode?-1:1,a.ctrlKey?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):a.shiftKey?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):(c=new Date(this.date),c.setUTCDate(this.date.getUTCDate()+7*b),d=new Date(this.viewDate),d.setUTCDate(this.viewDate.getUTCDate()+7*b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 13:this.hide(),a.preventDefault();break;case 9:this.hide()}if(e){this._trigger("changeDate");var f;this.isInput?f=this.element:this.component&&(f=this.element.find("input")),f&&f.change()}},showMode:function(a){a&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+a))),this.picker.find(">div").hide().filter(".datepicker-"+l.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var f=function(b,c){this.element=a(b),this.inputs=a.map(c.inputs,function(a){return a.jquery?a[0]:a}),delete c.inputs,a(this.inputs).datepicker(c).bind("changeDate",a.proxy(this.dateUpdated,this)),this.pickers=a.map(this.inputs,function(b){return a(b).data("datepicker")}),this.updateDates()};f.prototype={updateDates:function(){this.dates=a.map(this.pickers,function(a){return a.date}),this.updateRanges()},updateRanges:function(){var b=a.map(this.dates,function(a){return a.valueOf()});a.each(this.pickers,function(a,c){c.setRange(b)})},dateUpdated:function(b){var c=a(b.target).data("datepicker"),d=c.getUTCDate(),e=a.inArray(b.target,this.inputs),f=this.inputs.length;if(-1!=e){if(d<this.dates[e])for(;e>=0&&d<this.dates[e];)this.pickers[e--].setUTCDate(d);else if(d>this.dates[e])for(;f>e&&d>this.dates[e];)this.pickers[e++].setUTCDate(d);this.updateDates()}},remove:function(){a.map(this.pickers,function(a){a.remove()}),delete this.element.data().datepicker}};var g=a.fn.datepicker,h=a.fn.datepicker=function(b){var g=Array.apply(null,arguments);g.shift();var h;return this.each(function(){var j=a(this),k=j.data("datepicker"),l="object"==typeof b&&b;if(!k){var m=c(this,"date"),n=a.extend({},i,m,l),o=d(n.language),p=a.extend({},i,o,m,l);if(j.is(".input-daterange")||p.inputs){var q={inputs:p.inputs||j.find("input").toArray()};j.data("datepicker",k=new f(this,a.extend(p,q)))}else j.data("datepicker",k=new e(this,p))}return"string"==typeof b&&"function"==typeof k[b]&&(h=k[b].apply(k,g),void 0!==h)?!1:void 0}),void 0!==h?h:this},i=a.fn.datepicker.defaults={autoclose:!1,beforeShowDay:a.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},j=a.fn.datepicker.locale_opts=["format","rtl","weekStart"];a.fn.datepicker.Constructor=e;var k=a.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},l={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(a){return 0===a%4&&0!==a%100||0===a%400},getDaysInMonth:function(a,b){return[31,l.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(a){var b=a.replace(this.validParts,"\0").split("\0"),c=a.match(this.validParts);if(!b||!b.length||!c||0===c.length)throw new Error("Invalid date format.");return{separators:b,parts:c}},parseDate:function(c,d,f){if(c instanceof Date)return c;if("string"==typeof d&&(d=l.parseFormat(d)),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(c)){var g,h,i=/([\-+]\d+)([dmwy])/,j=c.match(/([\-+]\d+)([dmwy])/g);c=new Date;for(var m=0;m<j.length;m++)switch(g=i.exec(j[m]),h=parseInt(g[1]),g[2]){case"d":c.setUTCDate(c.getUTCDate()+h);break;case"m":c=e.prototype.moveMonth.call(e.prototype,c,h);break;case"w":c.setUTCDate(c.getUTCDate()+7*h);break;case"y":c=e.prototype.moveYear.call(e.prototype,c,h)}return b(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),0,0,0)}var n,o,g,j=c&&c.match(this.nonpunctuation)||[],c=new Date,p={},q=["yyyy","yy","M","MM","m","mm","d","dd"],r={yyyy:function(a,b){return a.setUTCFullYear(b)},yy:function(a,b){return a.setUTCFullYear(2e3+b)},m:function(a,b){for(b-=1;0>b;)b+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!=b;)a.setUTCDate(a.getUTCDate()-1);return a},d:function(a,b){return a.setUTCDate(b)}};r.M=r.MM=r.mm=r.m,r.dd=r.d,c=b(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0);var s=d.parts.slice();if(j.length!=s.length&&(s=a(s).filter(function(b,c){return-1!==a.inArray(c,q)}).toArray()),j.length==s.length){for(var m=0,t=s.length;t>m;m++){if(n=parseInt(j[m],10),g=s[m],isNaN(n))switch(g){case"MM":o=a(k[f].months).filter(function(){var a=this.slice(0,j[m].length),b=j[m].slice(0,a.length);return a==b}),n=a.inArray(o[0],k[f].months)+1;break;case"M":o=a(k[f].monthsShort).filter(function(){var a=this.slice(0,j[m].length),b=j[m].slice(0,a.length);return a==b}),n=a.inArray(o[0],k[f].monthsShort)+1}p[g]=n}for(var u,m=0;m<q.length;m++)u=q[m],u in p&&!isNaN(p[u])&&r[u](c,p[u])}return c},formatDate:function(b,c,d){"string"==typeof c&&(c=l.parseFormat(c));var e={d:b.getUTCDate(),D:k[d].daysShort[b.getUTCDay()],DD:k[d].days[b.getUTCDay()],m:b.getUTCMonth()+1,M:k[d].monthsShort[b.getUTCMonth()],MM:k[d].months[b.getUTCMonth()],yy:b.getUTCFullYear().toString().substring(2),yyyy:b.getUTCFullYear()};e.dd=(e.d<10?"0":"")+e.d,e.mm=(e.m<10?"0":"")+e.m;for(var b=[],f=a.extend([],c.separators),g=0,h=c.parts.length;h>=g;g++)f.length&&b.push(f.shift()),b.push(e[c.parts[g]]);return b.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="datepicker-switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};l.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+l.headTemplate+"<tbody></tbody>"+l.footTemplate+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+l.headTemplate+l.contTemplate+l.footTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+l.headTemplate+l.contTemplate+l.footTemplate+"</table>"+"</div>"+"</div>",a.fn.datepicker.DPGlobal=l,a.fn.datepicker.noConflict=function(){return a.fn.datepicker=g,this},a(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(b){var c=a(this);c.data("datepicker")||(b.preventDefault(),h.call(c,"show"))}),a(function(){h.call(a('[data-provide="datepicker-inline"]'))})}(window.jQuery),function(a){"use strict";a.fn.bdatepicker=a.fn.datepicker.noConflict(),a.fn.datepicker||(a.fn.datepicker=a.fn.bdatepicker);var b=function(a){this.init("date",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{initPicker:function(b,c){this.options.viewformat||(this.options.viewformat=this.options.format),b.datepicker=a.fn.editableutils.tryParseJson(b.datepicker,!0),this.options.datepicker=a.extend({},c.datepicker,b.datepicker,{format:this.options.viewformat}),this.options.datepicker.language=this.options.datepicker.language||"en",this.dpg=a.fn.bdatepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat)},render:function(){this.$input.bdatepicker(this.options.datepicker),this.options.clear&&(this.$clear=a('<a href="#"></a>').html(this.options.clear).click(a.proxy(function(a){a.preventDefault(),a.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(a('<div class="editable-clear">').append(this.$clear)))},value2html:function(a,c){var d=a?this.dpg.formatDate(a,this.parsedViewFormat,this.options.datepicker.language):"";b.superclass.value2html.call(this,d,c)},html2value:function(a){return this.parseDate(a,this.parsedViewFormat)},value2str:function(a){return a?this.dpg.formatDate(a,this.parsedFormat,this.options.datepicker.language):""},str2value:function(a){return this.parseDate(a,this.parsedFormat)},value2submit:function(a){return this.value2str(a)},value2input:function(a){this.$input.bdatepicker("update",a)},input2value:function(){return this.$input.data("datepicker").date},activate:function(){},clear:function(){this.$input.data("datepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".day",function(b){if(!a(b.currentTarget).is(".old")&&!a(b.currentTarget).is(".new")){var c=a(this).closest("form");setTimeout(function(){c.submit()},200)}})},parseDate:function(a,b){var c,d=null;return a&&(d=this.dpg.parseDate(a,b,this.options.datepicker.language),"string"==typeof a&&(c=this.dpg.formatDate(d,b,this.options.datepicker.language),a!==c&&(d=null))),d}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd",viewformat:null,datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!1},clear:"&times; clear"}),a.fn.editabletypes.date=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datefield",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.date),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.bdatepicker(this.options.datepicker),this.$input.off("focus keydown"),this.$input.keyup(a.proxy(function(){this.$tpl.removeData("date"),this.$tpl.bdatepicker("update")},this))},value2input:function(a){this.$input.val(a?this.dpg.formatDate(a,this.parsedViewFormat,this.options.datepicker.language):""),this.$tpl.bdatepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.date.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-small",datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!0}}),a.fn.editabletypes.datefield=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datetime",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{initPicker:function(b,c){this.options.viewformat||(this.options.viewformat=this.options.format),b.datetimepicker=a.fn.editableutils.tryParseJson(b.datetimepicker,!0),this.options.datetimepicker=a.extend({},c.datetimepicker,b.datetimepicker,{format:this.options.viewformat}),this.options.datetimepicker.language=this.options.datetimepicker.language||"en",this.dpg=a.fn.datetimepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format,this.options.formatType),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat,this.options.formatType)},render:function(){this.$input.datetimepicker(this.options.datetimepicker),this.$input.on("changeMode",function(){var b=a(this).closest("form").parent();setTimeout(function(){b.triggerHandler("resize")},0)}),this.options.clear&&(this.$clear=a('<a href="#"></a>').html(this.options.clear).click(a.proxy(function(a){a.preventDefault(),a.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(a('<div class="editable-clear">').append(this.$clear)))},value2html:function(a,c){var d=a?this.dpg.formatDate(this.toUTC(a),this.parsedViewFormat,this.options.datetimepicker.language,this.options.formatType):"";return c?(b.superclass.value2html.call(this,d,c),void 0):d},html2value:function(a){var b=this.parseDate(a,this.parsedViewFormat);return b?this.fromUTC(b):null},value2str:function(a){return a?this.dpg.formatDate(this.toUTC(a),this.parsedFormat,this.options.datetimepicker.language,this.options.formatType):""},str2value:function(a){var b=this.parseDate(a,this.parsedFormat);return b?this.fromUTC(b):null},value2submit:function(a){return this.value2str(a)},value2input:function(a){a&&this.$input.data("datetimepicker").setDate(a)},input2value:function(){var a=this.$input.data("datetimepicker");return a.date?a.getDate():null},activate:function(){},clear:function(){this.$input.data("datetimepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".minute",function(){var b=a(this).closest("form");setTimeout(function(){b.submit()},200)})},toUTC:function(a){return a?new Date(a.valueOf()-6e4*a.getTimezoneOffset()):a},fromUTC:function(a){return a?new Date(a.valueOf()+6e4*a.getTimezoneOffset()):a},parseDate:function(a,b){var c,d=null;return a&&(d=this.dpg.parseDate(a,b,this.options.datetimepicker.language,this.options.formatType),"string"==typeof a&&(c=this.dpg.formatDate(d,b,this.options.datetimepicker.language,this.options.formatType),a!==c&&(d=null))),d}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd hh:ii",formatType:"standard",viewformat:null,datetimepicker:{todayHighlight:!1,autoclose:!1},clear:"&times; clear"}),a.fn.editabletypes.datetime=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datetimefield",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.datetime),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.datetimepicker(this.options.datetimepicker),this.$input.off("focus keydown"),this.$input.keyup(a.proxy(function(){this.$tpl.removeData("date"),this.$tpl.datetimepicker("update")},this))},value2input:function(a){this.$input.val(this.value2html(a)),this.$tpl.datetimepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.datetime.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-medium",datetimepicker:{todayHighlight:!1,autoclose:!0}}),a.fn.editabletypes.datetimefield=b}(window.jQuery);(function(){var module_routes=[{"uri":"api-webhooks\/ajax","name":"apiwebhooks.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initApiWebhooksSettings(msg_confirm_delete,msg_mailboxes_hint){$(document).ready(function(){$(".apiwh-delete").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'apiwh-delete-ok',{on_show:function(modal){var webhook_id=button.attr('data-webhook_id');if(!webhook_id){return;}
modal.children().find('.apiwh-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',webhook_id:webhook_id},laroute.route('apiwebhooks.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxResult(response);button.button('reset');}});});}},Lang.get("messages.delete"));e.preventDefault();});$(".apiwh-input-events").select2();$(".apiwh-input-mailboxes").select2({placeholder:msg_mailboxes_hint});});}!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});function chatInitSettings(){$(document).ready(function(){$('#chat-show-preview').click(function(e){SmarticksW=JSON.parse($('#chat-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="smarticks-w";a.src=$('#chat-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#chat-widget-form input:visible,#chat-widget-form select:visible').on('change keyup',function(e){$('#chat-widget-code-wrapper').addClass('hidden');$('#chat-widget-save-wrapper').removeClass('hidden');});$(".chat-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#chat-widget-code-wrapper').addClass('hidden');$('#chat-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");});}
(function(){var module_routes=[{"uri":"checklists\/ajax","name":"checklists.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function clInit(){$(document).ready(function(){clApplyListeners();$('#cl-add-toggler').click(function(e){$('#cl-add-group').removeClass('hidden');$(this).hide();$('#cl-add-text').focus();});$('#cl-add-form').submit(function(e){var button=$('#cl-add-trigger');var input=$('#cl-add-text');button.button('loading');fsAjax({action:'add',conversation_id:getGlobalAttr('conversation_id'),text:input.val()},laroute.route('checklists.ajax'),function(response){clRefreshItems(response.html);$('#cl-add-toggler').show();$('#cl-add-group').addClass('hidden');button.button('reset');input.val('');},true);return false;});});}
function clApplyListeners(){$('.cl-item input[type="checkbox"]').change(function(){var checkbox=$(this);var item_container=$(this).parents('.cl-item:first');fsAjax({action:'change_status',item_id:item_container.attr('data-cl-item-id'),completed:(this.checked?1:0)},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){if(checkbox.is(':checked')){item_container.addClass('cl-item-completed');}else{item_container.removeClass('cl-item-completed');}}else{showAjaxError(response);}},true,function(){checkbox.attr('checked',!checkbox.is(':checked'));showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();},);});$('.cl-conv-unlink').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'unlink_conversation',item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.button('reset');},true);return false;});$('.cl-conv-delete').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'delete',item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.button('reset');},true);return false;});$('.cl-item-text').click(function(e){$(this).parents('.cl-item:first').addClass('cl-item-editing');});$('.cl-edit-cancel').click(function(e){$(this).parents('.cl-item:first').removeClass('cl-item-editing');});$('.cl-edit-save').click(function(e){var button=$(this);button.attr('disabled','disabled');fsAjax({action:'save',text:button.parents('.cl-item:first').children().find('.cl-edit-text:first').val(),item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.removeAttr('disabled');},true);return false;});}
function clInitLinkConvModal(){$(document).ready(function(){$('#cl-link-conv-number:visible:first').focus();$('.cl-link-conv-form:visible:first').on('submit',function(e){var item_id=$(this).attr('data-item-id');var data=$(this).serialize();data+='&action=link_conversation';data+='&item_id='+item_id;var button=$(this).children().find('.cl-link-conv-submit:first');button.button('loading');fsAjax(data,laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){var number=event.data.replace('kn.pick_conversation:','');if(number){$('#cl-link-conv-number').val(number);$('.modal:visible:first').animate({scrollTop:0},600,'swing');}}});});}
function clInitPickConv(){$(document).ready(function(){$('.kn-btn-pick').click(function(e){clPickConv($(this).attr('data-conv-number'),$(this)[0]);e.preventDefault();e.stopPropagation();});});}
function clPickConv(number,btn){if(typeof(window.parent)!="undefined"){window.parent.postMessage('kn.pick_conversation:'+number);$('.kn-btn-pick.btn-primary').removeClass('btn-primary').addClass('btn-default');$(btn).addClass('btn-primary');}}
function clRefreshItems(html){$('#cl-conv-checklist').html(html);clApplyListeners();initModals();}
(function(){var module_routes=[{"uri":"customers\/fields\/ajax-search","name":"crm.ajax_search"},{"uri":"crm\/ajax","name":"crm.ajax"},{"uri":"crm\/ajax-admin","name":"crm.ajax_admin"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();if(typeof(DragDropTouch)=="undefined"){DragDropTouch={};}
(function(DragDropTouch_1){'use strict';let DataTransfer=(function(){function DataTransfer(){this._dropEffect='move';this._effectAllowed='all';this._data={};}
Object.defineProperty(DataTransfer.prototype,"dropEffect",{get:function(){return this._dropEffect;},set:function(value){this._dropEffect=value;},enumerable:true,configurable:true});Object.defineProperty(DataTransfer.prototype,"effectAllowed",{get:function(){return this._effectAllowed;},set:function(value){this._effectAllowed=value;},enumerable:true,configurable:true});Object.defineProperty(DataTransfer.prototype,"types",{get:function(){return Object.keys(this._data);},enumerable:true,configurable:true});DataTransfer.prototype.clearData=function(type){if(type!==null){delete this._data[type.toLowerCase()];}
else{this._data={};}};DataTransfer.prototype.getData=function(type){let lcType=type.toLowerCase(),data=this._data[lcType];if(lcType==="text"&&data==null){data=this._data["text/plain"];}
return data||"";};DataTransfer.prototype.setData=function(type,value){this._data[type.toLowerCase()]=value;};DataTransfer.prototype.setDragImage=function(img,offsetX,offsetY){let ddt=DragDropTouch._instance;ddt._imgCustom=img;ddt._imgOffset={x:offsetX,y:offsetY};};return DataTransfer;}());DragDropTouch_1.DataTransfer=DataTransfer;let DragDropTouch=(function(){function DragDropTouch(){this._lastClick=0;if(DragDropTouch._instance){throw'DragDropTouch instance already created.';}
let supportsPassive=false;document.addEventListener('test',function(){},{get passive(){supportsPassive=true;return true;}});if(navigator.maxTouchPoints){let d=document,ts=this._touchstart.bind(this),tm=this._touchmove.bind(this),te=this._touchend.bind(this),opt=supportsPassive?{passive:false,capture:false}:false;d.addEventListener('touchstart',ts,opt);d.addEventListener('touchmove',tm,opt);d.addEventListener('touchend',te);d.addEventListener('touchcancel',te);}}
DragDropTouch.getInstance=function(){return DragDropTouch._instance;};DragDropTouch.prototype._touchstart=function(e){let _this=this;if(this._shouldHandle(e)){this._reset();let src=this._closestDraggable(e.target);if(src){if(!this._dispatchEvent(e,'mousemove',e.target)&&!this._dispatchEvent(e,'mousedown',e.target)){this._dragSource=src;this._ptDown=this._getPoint(e);this._lastTouch=e;setTimeout(function(){if(_this._dragSource===src&&_this._img===null){if(_this._dispatchEvent(e,'contextmenu',src)){_this._reset();}}},DragDropTouch._CTXMENU);if(DragDropTouch._ISPRESSHOLDMODE){this._pressHoldInterval=setTimeout(function(){_this._isDragEnabled=true;_this._touchmove(e);},DragDropTouch._PRESSHOLDAWAIT);}}}}};DragDropTouch.prototype._touchmove=function(e){if(this._shouldCancelPressHoldMove(e)){this._reset();return;}
if(this._shouldHandleMove(e)||this._shouldHandlePressHoldMove(e)){let target=this._getTarget(e);if(this._dispatchEvent(e,'mousemove',target)){this._lastTouch=e;e.preventDefault();return;}
if(this._dragSource&&!this._img&&this._shouldStartDragging(e)){if(this._dispatchEvent(this._lastTouch,'dragstart',this._dragSource)){this._dragSource=null;return;}
this._createImage(e);this._dispatchEvent(e,'dragenter',target);}
if(this._img){this._lastTouch=e;e.preventDefault();this._dispatchEvent(e,'drag',this._dragSource);if(target!==this._lastTarget){this._dispatchEvent(this._lastTouch,'dragleave',this._lastTarget);this._dispatchEvent(e,'dragenter',target);this._lastTarget=target;}
this._moveImage(e);this._isDropZone=this._dispatchEvent(e,'dragover',target);}}};DragDropTouch.prototype._touchend=function(e){if(this._shouldHandle(e)){if(this._dispatchEvent(this._lastTouch,'mouseup',e.target)){e.preventDefault();return;}
if(!this._img){this._dragSource=null;this._dispatchEvent(this._lastTouch,'click',e.target);this._lastClick=Date.now();}
this._destroyImage();if(this._dragSource){if(e.type.indexOf('cancel')<0&&this._isDropZone){this._dispatchEvent(this._lastTouch,'drop',this._lastTarget);}
this._dispatchEvent(this._lastTouch,'dragend',this._dragSource);this._reset();}}};DragDropTouch.prototype._shouldHandle=function(e){var j_target=$(e.target);if(!j_target.attr('draggable')&&(typeof(e.target.parentElement)!="undefined"&&!$(e.target.parentElement).attr('draggable'))&&(typeof(e.target.parentElement.parentElement)!="undefined"&&!$(e.target.parentElement.parentElement).attr('draggable'))&&!j_target.parent().parent().parent().hasClass('panel-sortable')){return false;}
return e&&!e.defaultPrevented&&e.touches&&e.touches.length<2;};DragDropTouch.prototype._shouldHandleMove=function(e){return!DragDropTouch._ISPRESSHOLDMODE&&this._shouldHandle(e);};DragDropTouch.prototype._shouldHandlePressHoldMove=function(e){return DragDropTouch._ISPRESSHOLDMODE&&this._isDragEnabled&&e&&e.touches&&e.touches.length;};DragDropTouch.prototype._shouldCancelPressHoldMove=function(e){return DragDropTouch._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(e)>DragDropTouch._PRESSHOLDMARGIN;};DragDropTouch.prototype._shouldStartDragging=function(e){let delta=this._getDelta(e);return delta>DragDropTouch._THRESHOLD||(DragDropTouch._ISPRESSHOLDMODE&&delta>=DragDropTouch._PRESSHOLDTHRESHOLD);}
DragDropTouch.prototype._reset=function(){this._destroyImage();this._dragSource=null;this._lastTouch=null;this._lastTarget=null;this._ptDown=null;this._isDragEnabled=false;this._isDropZone=false;this._dataTransfer=new DataTransfer();clearInterval(this._pressHoldInterval);};DragDropTouch.prototype._getPoint=function(e,page){if(e&&e.touches){e=e.touches[0];}
return{x:page?e.pageX:e.clientX,y:page?e.pageY:e.clientY};};DragDropTouch.prototype._getDelta=function(e){if(DragDropTouch._ISPRESSHOLDMODE&&!this._ptDown){return 0;}
let p=this._getPoint(e);return Math.abs(p.x-this._ptDown.x)+Math.abs(p.y-this._ptDown.y);};DragDropTouch.prototype._getTarget=function(e){let pt=this._getPoint(e),el=document.elementFromPoint(pt.x,pt.y);while(el&&getComputedStyle(el).pointerEvents=='none'){el=el.parentElement;}
return el;};DragDropTouch.prototype._createImage=function(e){if(this._img){this._destroyImage();}
let src=this._imgCustom||this._dragSource;this._img=src.cloneNode(true);this._copyStyle(src,this._img);this._img.style.top=this._img.style.left='-9999px';if(!this._imgCustom){let rc=src.getBoundingClientRect(),pt=this._getPoint(e);this._imgOffset={x:pt.x-rc.left,y:pt.y-rc.top};this._img.style.opacity=DragDropTouch._OPACITY.toString();}
this._moveImage(e);document.body.appendChild(this._img);};DragDropTouch.prototype._destroyImage=function(){if(this._img&&this._img.parentElement){this._img.parentElement.removeChild(this._img);}
this._img=null;this._imgCustom=null;};DragDropTouch.prototype._moveImage=function(e){let _this=this;requestAnimationFrame(function(){if(_this._img){let pt=_this._getPoint(e,true),s=_this._img.style;s.position='absolute';s.pointerEvents='none';s.zIndex='999999';s.left=Math.round(pt.x-_this._imgOffset.x)+'px';s.top=Math.round(pt.y-_this._imgOffset.y)+'px';}});};DragDropTouch.prototype._copyProps=function(dst,src,props){for(let i=0;i<props.length;i++){let p=props[i];dst[p]=src[p];}};DragDropTouch.prototype._copyStyle=function(src,dst){DragDropTouch._rmvAtts.forEach(function(att){dst.removeAttribute(att);});if(src instanceof HTMLCanvasElement){let cSrc=src,cDst=dst;cDst.width=cSrc.width;cDst.height=cSrc.height;cDst.getContext('2d').drawImage(cSrc,0,0);}
let cs=getComputedStyle(src);for(let i=0;i<cs.length;i++){let key=cs[i];if(key.indexOf('transition')<0){dst.style[key]=cs[key];}}
dst.style.pointerEvents='none';for(let i=0;i<src.children.length;i++){this._copyStyle(src.children[i],dst.children[i]);}};DragDropTouch.prototype._setOffsetAndLayerProps=function(e,target){let rect=undefined;if(e.offsetX===undefined){rect=target.getBoundingClientRect();e.offsetX=e.clientX-rect.x;e.offsetY=e.clientY-rect.y;}
if(e.layerX===undefined){rect=rect||target.getBoundingClientRect();e.layerX=e.pageX-rect.left;e.layerY=e.pageY-rect.top;}}
DragDropTouch.prototype._dispatchEvent=function(e,type,target){if(e&&target){let evt=new Event(type,{bubbles:true,cancelable:true}),touch=e.touches?e.touches[0]:e;evt.button=0;evt.which=evt.buttons=1;this._copyProps(evt,e,DragDropTouch._kbdProps);this._copyProps(evt,touch,DragDropTouch._ptProps);this._setOffsetAndLayerProps(evt,target);evt.dataTransfer=this._dataTransfer;target.dispatchEvent(evt);return evt.defaultPrevented;}
return false;};DragDropTouch.prototype._closestDraggable=function(e){for(;e;e=e.parentElement){if(e.draggable){return e;}}
return null;};return DragDropTouch;}());DragDropTouch._instance=new DragDropTouch();DragDropTouch._THRESHOLD=5;DragDropTouch._OPACITY=0.5;DragDropTouch._DBLCLICK=500;DragDropTouch._CTXMENU=900;DragDropTouch._ISPRESSHOLDMODE=false;DragDropTouch._PRESSHOLDAWAIT=400;DragDropTouch._PRESSHOLDMARGIN=25;DragDropTouch._PRESSHOLDTHRESHOLD=0;DragDropTouch._rmvAtts='id,class,style,draggable'.split(',');DragDropTouch._kbdProps='altKey,ctrlKey,metaKey,shiftKey'.split(',');DragDropTouch._ptProps='pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY'.split(',');DragDropTouch_1.DragDropTouch=DragDropTouch;})(DragDropTouch||(DragDropTouch={}));var sortable=function(){"use strict";function d(e,t,n){if(void 0===n)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=n}var v=function(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter(function(e){return 1===e.nodeType&&e.matches(t)})},y=new Map,t=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var n={};return this._config.forEach(function(e,t){n[t]=e}),n},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!1,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}(),E=function(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return y.has(e)||y.set(e,new t),y.get(e)};function i(e,t,n){if(e instanceof Array)for(var r=0;r<e.length;++r)i(e[r],t,n);else e.addEventListener(t,n),E(e).setData("event"+t,n)}function a(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)a(e[n],t);else e.removeEventListener(t,E(e).getData("event"+t)),E(e).deleteData("event"+t)}function l(e,t,n){if(e instanceof Array)for(var r=0;r<e.length;++r)l(e[r],t,n);else e.setAttribute(t,n)}function r(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)r(e[n],t);else e.removeAttribute(t)}var w=function(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}},c=function(n,r){var o;return void 0===r&&(r=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];clearTimeout(o),o=setTimeout(function(){n.apply(void 0,e)},r)}},b=function(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)},f=function(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode},n=function(e,t,n){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===n?e:e.nextElementSibling)},T=function(e,t){return n(e,t,"before")},C=function(e,t){return n(e,t,"after")},o=function(t,n,e){if(void 0===n&&(n=function(e,t){return e}),void 0===e&&(e=function(e){return e}),!(t instanceof HTMLElement)||!0==!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof n||"function"!=typeof e)throw new Error("You need to provide a valid serializer for items and the container.");var r=d(t,"opts").items,o=v(t.children,r),a=o.map(function(e){return{parent:t,node:e,html:e.outerHTML,index:b(e,o)}});return{container:e({node:t,itemCount:a.length}),items:a.map(function(e){return n(e,t)})}},u=function(e,t,n){var r;if(void 0===n&&(n="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof n&&(r=t.classList).add.apply(r,n.split(" ")),t},L=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var n=window.getComputedStyle(e);return"border-box"===n.getPropertyValue("box-sizing")?parseInt(n.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map(function(e){var t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce(function(e,t){return e+t})},x=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var n=window.getComputedStyle(e);return["width","padding-left","padding-right"].map(function(e){var t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce(function(e,t){return e+t})},s=function(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter(function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement}).map(function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)})},p=function(e){return e.composedPath&&e.composedPath()[0]||e.target},m=function(e,t,n){return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}},g=function(e,t,n){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=m),e.dataTransfer&&e.dataTransfer.setDragImage){var r=n(t,w(t),e);if(!(r.element instanceof HTMLElement)||"number"!=typeof r.posX||"number"!=typeof r.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",p(e).id),e.dataTransfer.setDragImage(r.element,r.posX,r.posY)}},D=function(e,t){if(!0===e.isSortable){var n=E(e).getConfig("acceptFrom");if(null!==n&&!1!==n&&"string"!=typeof n)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==n)return!1!==n&&0<n.split(",").filter(function(e){return 0<e.length&&t.matches(e)}).length;if(e===t)return!0;if(void 0!==E(e).getConfig("connectWith")&&null!==E(e).getConfig("connectWith"))return E(e).getConfig("connectWith")===E(t).getConfig("connectWith")}return!1},M={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"};var H,I,A,S,Y,_,O,P,z,h=function(e,t){if("string"==typeof E(e).getConfig("hoverClass")){var o=E(e).getConfig("hoverClass").split(" ");!0===t?(i(e,"mousemove",function(r,o){var a=this;if(void 0===o&&(o=250),"function"!=typeof r)throw new Error("You must provide a function as the first argument for throttle.");if("number"!=typeof o)throw new Error("You must provide a number as the second argument for throttle.");var i=null;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Date.now();(null===i||o<=n-i)&&(i=n,r.apply(a,e))}}(function(r){0===r.buttons&&v(e.children,E(e).getConfig("items")).forEach(function(e){var t,n;e===r.target||e.contains(r.target)?(t=e.classList).add.apply(t,o):(n=e.classList).remove.apply(n,o)})},E(e).getConfig("throttleTime"))),i(e,"mouseleave",function(){v(e.children,E(e).getConfig("items")).forEach(function(e){var t;(t=e.classList).remove.apply(t,o)})})):(a(e,"mousemove"),a(e,"mouseleave"))}},W=function(e){a(e,"dragstart"),a(e,"dragend"),a(e,"dragover"),a(e,"dragenter"),a(e,"drop"),a(e,"mouseenter"),a(e,"mouseleave")},N=function(e,t){e&&a(e,"dragleave"),t&&t!==e&&a(t,"dragleave")},j=function(e,t){var n=e;return!0===E(t).getConfig("copy")&&(l(n=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=e.style.display),n},F=function(e){var t;(t=e).h5s&&delete t.h5s.data,r(e,"aria-dropeffect")},q=function(e){r(e,"aria-grabbed"),r(e,"aria-copied"),r(e,"draggable"),r(e,"role")};function R(e,t){if(t.composedPath)return t.composedPath().find(function(e){return e.isSortable});for(;!0!==e.isSortable;)e=e.parentElement;return e}function X(e,t){var n=d(e,"opts"),r=v(e.children,n.items).filter(function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)});return 0<r.length?r[0]:t}var B=function(e){var t=d(e,"opts"),n=v(e.children,t.items),r=s(n,t.handle);(l(e,"aria-dropeffect","move"),d(e,"_disabled","false"),l(r,"draggable","true"),h(e,!0),!1===t.disableIEFix)&&("function"==typeof(document||window.document).createElement("span").dragDrop&&i(r,"mousedown",function(){if(-1!==n.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===n.indexOf(e);)e=e.parentElement;e.dragDrop()}}))},k=function(e){var t=d(e,"opts"),n=v(e.children,t.items),r=s(n,t.handle);d(e,"_disabled","false"),W(n),N(S,P),a(r,"mousedown"),a(e,"dragover"),a(e,"dragenter"),a(e,"drop")};function U(e,h){var a=String(h);return h=h||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(a)?e.map(function(e){var t=d(e,"opts");return o(e,t.itemSerializer,t.containerSerializer)}):(e.forEach(function(s){if(/enable|disable|destroy/.test(a))return U[a](s);["connectWith","disableIEFix"].forEach(function(e){Object.prototype.hasOwnProperty.call(h,e)&&null!==h[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')}),h=Object.assign({},M,E(s).config,h),E(s).config=h,d(s,"opts",h),s.isSortable=!0,k(s);var e,t=v(s.children,h.items);if(null!==h.placeholder&&void 0!==h.placeholder){var n=document.createElement(s.tagName);h.placeholder instanceof HTMLElement?n.appendChild(h.placeholder):n.innerHTML=h.placeholder,e=n.children[0]}E(s).placeholder=u(s,e,h.placeholderClass),d(s,"items",h.items),h.acceptFrom?d(s,"acceptFrom",h.acceptFrom):h.connectWith&&d(s,"connectWith",h.connectWith),B(s),l(t,"role","option"),l(t,"aria-grabbed","false"),i(s,"dragstart",function(e){var t=p(e);if(!0!==t.isSortable&&(e.stopImmediatePropagation(),(!h.handle||t.matches(h.handle))&&"false"!==t.getAttribute("draggable"))){var n=R(t,e),r=X(n,t);O=v(n.children,h.items),Y=O.indexOf(r),_=b(r,n.children),S=n,g(e,r,h.customDragImage),I=L(r),A=x(r),r.classList.add(h.draggingClass),l(H=j(r,n),"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H,originalTarget:t}}))}}),i(s,"dragenter",function(e){var n=p(e),r=R(n,e);r&&r!==P&&(z=v(r.children,d(r,"items")).filter(function(e){return e!==E(s).placeholder}),h.dropTargetContainerClass&&r.classList.add(h.dropTargetContainerClass),r.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:_,index:Y,container:S},destination:{container:r,itemsBeforeUpdate:z},item:H,originalTarget:n}})),i(r,"dragleave",function(e){var t=e.relatedTarget||e.fromElement;e.currentTarget.contains(t)||(h.dropTargetContainerClass&&r.classList.remove(h.dropTargetContainerClass),r.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:_,index:Y,container:r},item:H,originalTarget:n}})))})),P=r}),i(s,"dragend",function(e){if(H){H.classList.remove(h.draggingClass),l(H,"aria-grabbed","false"),"true"===H.getAttribute("aria-copied")&&"true"!==d(H,"dropped")&&H.remove(),void 0!==H.oldDisplay&&(H.style.display=H.oldDisplay,delete H.oldDisplay);var t=Array.from(y.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(f)[0];t&&t.remove(),s.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H}})),A=I=H=P=null}}),i(s,"drop",function(e){if(D(s,H.parentElement)){e.preventDefault(),e.stopPropagation(),d(H,"dropped","true");var t=Array.from(y.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(f)[0];if(t){t.replaceWith(H),void 0!==H.oldDisplay&&(H.style.display=H.oldDisplay,delete H.oldDisplay),s.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H}}));var n=E(s).placeholder,r=v(S.children,h.items).filter(function(e){return e!==n}),o=!0===this.isSortable?this:this.parentElement,a=v(o.children,d(o,"items")).filter(function(e){return e!==n}),i=b(H,Array.from(H.parentElement.children).filter(function(e){return e!==n})),l=b(H,a);h.dropTargetContainerClass&&o.classList.remove(h.dropTargetContainerClass),_===i&&S===o||s.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:_,index:Y,container:S,itemsBeforeUpdate:O,items:r},destination:{index:l,elementIndex:i,container:o,itemsBeforeUpdate:z,items:a},item:H}}))}else d(H,"dropped","false")}});var o=c(function(t,e,n,r){if(H)if(h.forcePlaceholderSize&&(E(t).placeholder.style.height=I+"px",E(t).placeholder.style.width=A+"px"),-1<Array.from(t.children).indexOf(e)){var o=L(e),a=x(e),i=b(E(t).placeholder,e.parentElement.children),l=b(e,e.parentElement.children);if(I<o||A<a){var s=o-I,d=a-A,c=w(e).top,f=w(e).left;if(i<l&&("vertical"===h.orientation&&r<c||"horizontal"===h.orientation&&n<f))return;if(l<i&&("vertical"===h.orientation&&c+o-s<r||"horizontal"===h.orientation&&f+a-d<n))return}void 0===H.oldDisplay&&(H.oldDisplay=H.style.display),"none"!==H.style.display&&(H.style.display="none");var u=!1;try{var p=w(e).top+e.offsetHeight/2,m=w(e).left+e.offsetWidth/2;u="vertical"===h.orientation&&p<=r||"horizontal"===h.orientation&&m<=n}catch(e){u=i<l}u?C(e,E(t).placeholder):T(e,E(t).placeholder),Array.from(y.values()).filter(function(e){return void 0!==e.placeholder}).forEach(function(e){e.placeholder!==E(t).placeholder&&e.placeholder.remove()})}else{var g=Array.from(y.values()).filter(function(e){return void 0!==e.placeholder}).map(function(e){return e.placeholder});-1!==g.indexOf(e)||t!==e||v(e.children,h.items).length||(g.forEach(function(e){return e.remove()}),e.appendChild(E(t).placeholder))}},h.debounce),r=function(e){var t=e.target,n=!0===t.isSortable?t:R(t,e);if(t=X(n,t),H&&D(n,H.parentElement)&&"true"!==d(n,"_disabled")){var r=d(n,"opts");parseInt(r.maxItems)&&v(n.children,d(n,"items")).length>parseInt(r.maxItems)&&H.parentElement!==n||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===E(n).getConfig("copy")?"copy":"move",o(n,t,e.pageX,e.pageY))}};i(t.concat(s),"dragover",r),i(t.concat(s),"dragenter",r)}),e)}return U.destroy=function(e){var t,n,r,o;n=d(t=e,"opts")||{},r=v(t.children,n.items),o=s(r,n.handle),h(t,!1),a(t,"dragover"),a(t,"dragenter"),a(t,"dragstart"),a(t,"dragend"),a(t,"drop"),F(t),a(o,"mousedown"),W(r),q(r),N(S,P),t.isSortable=!1},U.enable=function(e){B(e)},U.disable=function(e){var t,n,r,o;n=d(t=e,"opts"),r=v(t.children,n.items),o=s(r,n.handle),l(t,"aria-dropeffect","none"),d(t,"_disabled","true"),l(o,"draggable","false"),a(o,"mousedown"),h(t,!1)},U.__testing={data:d,removeItemEvents:W,removeItemData:q,removeSortableData:F,removeContainerEvents:N},U}();function initCrm(){$(document).ready(function(){window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){if(event.data=='crm.refresh'){loadCustomers();}
if(event.data=='crm.close'){$('.modal').modal('hide');}}});});}
function crmTriggerRefresh(){if(typeof(window.parent)!="undefined"){window.parent.postMessage('crm.refresh');}}
function crmInitCustomerFieldsAdmin(){$(document).ready(function(){crmInitCustomerFieldsForm('.crm-customer-field-form','customer_field_update');$(".crm-customer-field-delete").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.crm_confirm_delete_customer_field"),'crm-delete-ok',{on_show:function(modal){var customer_field_id=button.attr('data-customer_field_id');modal.children().find('.crm-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'customer_field_delete',customer_field_id:customer_field_id},laroute.route('crm.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#crm-customer-field-'+customer_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#cmr-customer-fields-index').length){sortable('#cmr-customer-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var customer_fields=[];$('#cmr-customer-fields-index > .panel').each(function(idx,el){customer_fields.push($(this).attr('data-customer-field-id'));});fsAjax({action:'customer_field_update_sort_order',customer_fields:customer_fields,},laroute.route('crm.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function crmInitNewCustomerField(jmodal){$(document).ready(function(){crmInitCustomerFieldsForm('.crm-new-customer-field-form','customer_field_create');});}
function crmInitCustomerFieldsForm(selector,action){$(selector).on('submit',function(e){var customer_field_id=$(this).attr('data-customer_field_id');var data=$(this).serialize();data+='&action='+action;if(customer_field_id){data+='&customer_field_id='+customer_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('crm.ajax_admin'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html='';if(response.display){html+='<small class="glyphicon glyphicon-eye-open"></small>';}else{html+='<small class="glyphicon glyphicon-eye-close "></small>';}
html+=' '+htmlEscape(response.name)+' <small>(ID: '+customer_field_id+')</small>';if(response.required){html+=' <i class="required-asterisk"></i>';}
$('#crm-customer-field-'+customer_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});crmApplyOptionsListeners(selector);}
function crmApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.crm_confirm_delete_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function crmInitCustomerFields(){$(document).ready(function(){$('.crm-cf-type-date').flatpickr({allowInput:true});crmCfInitAutosuggest();crmCfInitMultiselect();});}
function crmCfInitAutosuggest(){$('.crm-cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('crm.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function crmCfInitMultiselect(){$('.crm-cf-multiselect:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.attr('placeholder');}
var options={ajax:{url:laroute.route('crm.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},placeholder:placeholder,tags:true,multiple:true,tokenSeparators:[",",", "],minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function crmInitDeleteCustomer(){var customer_id=getGlobalAttr('customer_id');var button=$('.crm-delete-customer-ok:visible');button.click(function(){button.button('loading');var data={action:'delete_customer',customer_id:customer_id};fsAjax(data,laroute.route('crm.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);window.parent.postMessage('crm.refresh');setTimeout(function(){window.parent.postMessage('crm.close');},300);}}else{showAjaxError(response);button.button('reset');}},true);});}
function crmInitDeleteWithoutConv(){var button=$('.crm-delete-customers-ok:visible');button.click(function(){button.button('loading');var data={action:'delete_without_conv'};fsAjax(data,laroute.route('crm.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){showFloatingAlert('success',response.msg_success);window.location.href="";}else{button.button('reset');}}else{showAjaxError(response);button.button('reset');}},true);});}
function crmImportModal(){$(document).ready(function(){$('.crm-import-back:first').click(function(e){$('.crm-import-step1').removeClass('hidden');$('.crm-import-step2').addClass('hidden');var button=$('.crm-import-form button:visible:first');button.addClass('hidden');button.prev().removeClass('hidden');e.preventDefault();});$('.crm-import-form:visible:first').on('submit',function(e){var file_input=$('.crm-import-file:first');ajaxSetup();var data=new FormData();data.append('file',file_input[0].files[0]);data.append("separator",$('.crm-import-form:visible:first :input[name="separator"]').val());data.append("enclosure",$('.crm-import-form:visible:first :input[name="enclosure"]').val());data.append("encoding",$('.crm-import-form:visible:first :input[name="encoding"]').val());data.append("skip_header",$('.crm-import-form:visible:first :input[name="skip_header"]:checked').length);var button=$(this).children().find('button:visible');button.button('loading');if($('.crm-import-step1:visible').length){data.append("action",'import_parse');$.ajax({url:laroute.route('crm.ajax_admin'),data:data,cache:false,contentType:false,processData:false,type:'POST',success:function(response){button.button('reset');if(isAjaxSuccess(response)){$('.crm-import-step1').addClass('hidden');$('.crm-import-step2').removeClass('hidden');button.addClass('hidden');button.next().removeClass('hidden');var options_html='<option value=""></option>';for(var i in response.cols){options_html+='<option value="'+i+'">'+response.cols[i]+'</option>';}
$('.crm-import-mapping').html(options_html);$('.crm-import-mapping').each(function(i,el){$(this).children('option:eq('+(i+1)+')').attr('selected','selected');});}else{showAjaxError(response);}},error:function(jqXHR,textStatus,errorThrown){showFloatingAlert('error',Lang.get("messages.error_occured"));button.button('reset');}});}else{data.append("action",'import_import');var mapping={};$('.crm-import-mapping').each(function(i,el){mapping[$(this).attr('data-field-name')]=$(this).val();});data.append("mapping",JSON.stringify(mapping));$.ajax({url:laroute.route('crm.ajax_admin'),data:data,cache:false,contentType:false,processData:false,type:'POST',success:function(response){button.button('reset');if(isAjaxSuccess(response)){$('.crm-import-result').html(response.result_html).removeClass('hidden');$('.crm-import-notice').addClass('hidden');$('.crm-import-step2').addClass('hidden');button.addClass('hidden');}else{showAjaxError(response);}},error:function(jqXHR,textStatus,errorThrown){showFloatingAlert('error',Lang.get("messages.error_occured"));button.button('reset');}});}
e.preventDefault();return false;});});}
function crmInitVars(customer_vars){fsAddFilter('editor.vars',function(vars){vars.customer={...vars.customer,...customer_vars};return vars;});}
(function(){var module_routes=[{"uri":"mailbox\/custom-fields\/ajax-html\/{action}","name":"mailboxes.custom_fields.ajax_html"},{"uri":"custom-fields\/ajax-admin","name":"mailboxes.custom_fields.ajax_admin"},{"uri":"custom-fields\/ajax","name":"mailboxes.custom_fields.ajax"},{"uri":"custom-fields\/ajax-search","name":"mailboxes.customfields.ajax_search"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var cf_save_period=5;var cf_save_fields=[];function initCustomFieldsAdmin(){$(document).ready(function(){initCustomFieldsForm('.custom-field-form','update');$(".cf-delete-trigger").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.confirm_delete_custom_field"),'cf-delete-ok',{on_show:function(modal){var custom_field_id=button.attr('data-custom_field_id');modal.children().find('.cf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',custom_field_id:custom_field_id},laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#custom-field-'+custom_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#custom-fields-index').length){sortable('#custom-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var custom_fields=[];$('#custom-fields-index > .panel').each(function(idx,el){custom_fields.push($(this).attr('data-custom-field-id'));});fsAjax({action:'update_sort_order',custom_fields:custom_fields,},laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function initNewCustomField(jmodal){$(document).ready(function(){initCustomFieldsForm('.new-custom-field-form','create');});}
function initCustomFieldsForm(selector,action){$(selector).on('submit',function(e){var custom_field_id=$(this).attr('data-custom_field_id');var data=$(this).serialize();data+='&mailbox_id='+getGlobalAttr('mailbox_id');data+='&action='+action;if(custom_field_id){data+='&custom_field_id='+custom_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html=htmlEscape(response.name);if(response.required){html+='<i class="required-asterisk"></i>';}
$('#custom-field-'+custom_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});cfApplyOptionsListeners(selector);}
function cfApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.confirm_delete_cf_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function initCustomFields(){$(document).ready(function(){if(!$('#custom-fields-form').length){return;}
$('#custom-fields-form .cf-type-date').flatpickr({allowInput:true});$('#custom-fields-form').on('submit',function(e){e.preventDefault();});$('#custom-fields-form .custom-field :input').on('keyup keypress change',function(e){$(this).attr('data-dirty',1);cf_save_fields[$(this).attr('name')]=1;});$('#custom-fields-form .custom-field :input').on('focusout',function(e){if(!$(this).attr('data-dirty')){return;}
cf_save_fields[$(this).attr('name')]=1;saveCustomFields();});$('#custom-fields-form select').on('change',function(e){if($(this).attr('required')){return;}
if($(this).val()){$(this).removeClass('placeholdered');}else{$(this).addClass('placeholdered');}});setInterval(saveCustomFields,cf_save_period*1000);fsAddFilter('conversation.can_submit',function(value){return cfFilter(value);});fsAddFilter('conversation.can_change_user',function(value){return cfFilter(value);});fsAddFilter('conversation.can_change_status',function(value){return cfFilter(value);});cfInitAutosuggest();cfInitMultiselect();if(isNewConversation()){$('#custom-fields-form .cf-show-fields').click(function(e){$('#custom-fields-form .form-group.hidden').removeClass('hidden');cfInitAutosuggest();cfInitMultiselect();$(this).remove();e.preventDefault();});if(!getGlobalAttr('conversation_id')){fs_reply_changed=true;saveDraft(false);}
$('#custom-fields-form').addClass('cf-mode-create');}});}
function cfInitAutosuggest(){$('#custom-fields-form .cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('mailboxes.customfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);input.on('select2:selecting',function(e){cfSaveField(input);});});}
function cfInitMultiselect(){$('.cf-multiselect-dropdown:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.attr('placeholder');}
var options={allowClear:true,};input.select2(options);input.on('select2:selecting',function(e){cfSaveField(input);});});$('.cf-multiselect:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.attr('placeholder');}
var options={ajax:{url:laroute.route('mailboxes.customfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},placeholder:placeholder,tags:true,multiple:true,tokenSeparators:[",",", "],minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);input.on('select2:selecting',function(e){cfSaveField(input);});});}
function cfSaveField(input){input.attr('data-dirty',1);cf_save_fields[input.attr('name')]=1;saveCustomFields();}
function cfFilter(value){if(!value){return value;}
var form=$('form#custom-fields-form');if(!form.length){return value;}
if(!form[0].checkValidity()){$('#custom-fields-form :submit:first').click();return false;}
return value;}
function saveCustomFields(){if(Object.keys(cf_save_fields).length===0){return;}
var fields=cf_save_fields;cf_save_fields=[];var data={fields:{},action:'save_fields',conversation_id:getGlobalAttr('conversation_id')};for(name in fields){if(name.indexOf('[]')!=-1){$('#custom-fields-form :input[name="'+name.replace('[]','\[\]')+'"]').each(function(i,el){var input=$(this);if(typeof(data['fields'][name])=='undefined'){data['fields'][name]='';}
if(typeof(input.val())=="string"){data['fields'][name]=input.val();}else{data['fields'][name]=input.val().join(',');}
input.removeAttr('data-dirty');});}else{var input=$('#custom-fields-form :input[name="'+name+'"]');data['fields'][name]=input.val();input.removeAttr('data-dirty');}}
fsAjax(data,laroute.route('mailboxes.custom_fields.ajax'),function(response){var html='';if(typeof(response.status)!="undefined"&&response.status=='success'){html='<span class="cf-result text-success"><i class="glyphicon glyphicon-ok"></i> '+Lang.get("messages.saved")+'</span>';for(name in fields){name=name.replace('[]','');el=$('#custom-field-'+name+' div:first .cf-result:first');if(el.length){el.show();}else{$('#custom-field-'+name+' div:first').append(html);el=$('#custom-field-'+name+' div:first .cf-result:first');}
el.fadeOut(3000);}}else{for(name in fields){cf_save_fields[name]=1;}}},true);}
function cfInitVars(cf_vars){fsAddFilter('editor.vars',function(vars){vars.conversation={...vars.conversation,...cf_vars};return vars;});}
(function(){var module_routes=[{"uri":"mailbox\/custom-folders\/ajax-html\/{action}","name":"mailboxes.custom_folders.ajax_html"},{"uri":"mailbox\/custom-folders\/ajax","name":"mailboxes.custom_folders.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initCustomFoldersAdmin(msg_confirm_delete){$(document).ready(function(){initCustomFoldersForm('.custom-folders-form','update');$(".folder-delete-trigger").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'folder-delete-ok',{on_show:function(modal){var folder_id=button.attr('data-folder_id');modal.children().find('.folder-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',folder_id:folder_id},laroute.route('mailboxes.custom_folders.ajax'),function(response){showAjaxResult(response);button.button('reset');if(typeof(response.msg_success)!="undefined"){$('#folder-'+folder_id).remove();}});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#custom-folders-index').length){sortable('#custom-folders-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var folders=[];$('#custom-folders-index > .panel').each(function(idx,el){folders.push($(this).attr('data-folder-id'));});fsAjax({action:'update_sort_order',folders:folders,},laroute.route('mailboxes.custom_folders.ajax'),function(response){showAjaxResult(response);});});}});}
function initNewFolder(jmodal){$(document).ready(function(){initCustomFoldersForm('.new-folder-form','create');});}
function initCustomFoldersForm(selector,action){$(selector).on('submit',function(e){var folder_id=$(this).attr('data-folder_id');var data=$(this).serialize();data+='&mailbox_id='+getGlobalAttr('mailbox_id');data+='&action='+action;if(folder_id){data+='&folder_id='+folder_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('mailboxes.custom_folders.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);$('#folder-'+folder_id+' .panel-title a:first span:first').html(response.name);$('#folder-'+folder_id+' .panel-title a:first span.tag').html(response.tag_name);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});var options={ajax:{url:laroute.route('tags.ajax'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,action:'autocomplete'};}},tags:true,allowClear:true,placeholder:' ',minimumInputLength:1,language:{inputTooShort:function(args){return"";}}};if(action=='create'){options.dropdownParent=$('.modal-dialog:visible:first');}
$(selector+' select[name="tag_name"]').select2(options);}
function chInit(){$(document).ready(function(){summernoteInit('#ch_homepage_html',{insertVar:false,disableDragAndDrop:false,height:275,toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['picture','video']],['view',['codeview']]],buttons:{removeformat:EditorRemoveFormatButton,lists:EditorListsButton},callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#ch_homepage_html');}}}});$('#ch-dashboard-path').on('keyup',function(event){var val=$(this).val().replace(/[^a-zA-Z0-9]/,'');$(this).val(val);if(val){$('#ch-options').removeClass('hidden');}else{$('#ch-options').addClass('hidden');}});$('#ch-login-path').on('keyup',function(event){var val=$(this).val().replace(/[^a-zA-Z0-9]/,'');$(this).val(val);});$('#ch-type').on('change',function(event){if($(this).val()=='page'){$('.ch-homepage-page').removeClass('hidden');$('.ch-homepage-redirect').addClass('hidden');$('#ch-homepage-redirect').val('');}else{$('.ch-homepage-redirect').removeClass('hidden');$('.ch-homepage-page').addClass('hidden');}});});}
(function(){var module_routes=[{"uri":"custom-signatures\/ajax","name":"custom_signatures.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function csInitMailboxSettings(){$(document).ready(function(){$('.cs-signature-text:visible').each(function(i,el){var selector='#'+$(el).attr('id');csInitSignatureBlock(selector);});});$("#cs-add-signature").click(function(e){var pattern_html=$('#cs-signature-pattern').html();var new_block=$(pattern_html).insertBefore($('#cs-signature-pattern'));new_block.removeClass('hidden');new_block.children().find('.cs-signature-name:first').attr('required','required');var selector='cs_signature_text_'+generateDummyId();new_block.children().find('.cs-signature-text:first').attr('id',selector);csInitSignatureBlock('#'+selector);});}
function csInitSignatureBlock(selector){summernoteInit(selector,{insertVar:true,disableDragAndDrop:false,callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();$(selector).parent().children().find('.summernote-inservar:first').on('change',function(event){$(selector).summernote('insertText',$(this).val());$(this).val('');});},onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,false,selector);}}}});$(selector).parents('.cs-signature-block:first').children().find('.cs-delete:first').click(function(e){$(this).parents('.cs-signature-block:first').remove();});}
function csInitSignatureSelect(){$(document).ready(function(){$('.cs-signature-select').change(function(e){var select=$(e.target);var signature_id=select.val();if(!signature_id){$('#editor_signature:visible').html($('#editor_signature:visible').parent().children('.cs_signature_default:first').html());return;}
select.attr('disabled','disabled');fsAjax({action:'load_signature',signature_id:signature_id,conversation_id:getGlobalAttr('conversation_id')},laroute.route('custom_signatures.ajax'),function(response){select.removeAttr('disabled');if(isAjaxSuccess(response)){var signature_container=$('#editor_signature:visible');if(!$('.cs_signature_default:first').length){$('<div class="cs_signature_default hidden">'+signature_container.html()+'</div>').insertAfter(signature_container);}
signature_container.html(response.html);}else{showAjaxError(response);}},true,function(){select.removeAttr('disabled');});});});}
function initCustomization(){$(document).ready(function(){$('.cust-img-remove').click(function(e){var wrapper=$(this).parents('.cust-img-wrapper:first');wrapper.children('.cust-img-remove-input:first').val(1);wrapper.children().find('.cust-img-custom').hide();wrapper.children().find('.cust-img-default').removeClass('hidden');$(this).remove();e.preventDefault();});$('#cust-header-input').keyup(function(e){$('#cust-header-color').val('#'+$(this).val());custSetHeaderColor($(this).val());});$('#cust-header-color').change(function(e){var color=$(this).val().replace('#','');$('#cust-header-input').val(color);custSetHeaderColor(color);});$('#cust-header-reset').click(function(e){custHeaderReset($(this).attr('data-default-color'));e.preventDefault();});summernoteInit('#customization_footer',{insertVar:false,disableDragAndDrop:true});});}
function custSetHeaderColor(color){$('.navbar-static-top:first').css({'background-color':'#'+color});$('.navbar-default .navbar-nav > .active > a:first').css({'background-color':'#'+color});}
function custHeaderReset(color){$('#cust-header-color').val('#'+color);$('#cust-header-input').val(color);custSetHeaderColor(color);}
$('document').ready(function(){$("#dm-switch input:first").on('change',function(){if($(this).is(':checked')){dmEnable();}else{dmDisable();}});var darkModeMediaQuery=window.matchMedia('(prefers-color-scheme: dark)');if(darkModeMediaQuery.matches&&!$("#dm-switch input:first").is(':checked')&&typeof(getCookie('dm_enabled'))=="undefined"){if(!$("#dm-switch input:first").is(':checked')){$("#dm-switch input:first").prop("checked",true);}
dmEnable();}
darkModeMediaQuery.addListener((e)=>{var darkModeOn=e.matches;if(darkModeOn){if(!$("#dm-switch input:first").is(':checked')){$("#dm-switch input:first").prop("checked",true);}
dmEnable();}else{if($("#dm-switch input:first").is(':checked')){$("#dm-switch input:first").prop("checked",false);}
dmDisable();}});});function dmEnable(){setCookie('dm_enabled',1);dmSwitchMode(true);}
function dmDisable(){setCookie('dm_enabled',0);dmSwitchMode(false);}
function dmSwitchMode(on){var body=$('body');if(on){body.addClass('dm');}else{body.removeClass('dm');}}
(function(){var module_routes=[{"uri":"edd\/ajax","name":"edd.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var edd_customer_email='';function initEdd(customer_email,load){edd_customer_email=customer_email;$(document).ready(function(){if(load){eddLoadOrders();}
$('.edd-refresh').click(function(e){eddLoadOrders();e.preventDefault();});});}
function eddLoadOrders(){$('#edd-orders').addClass('edd-loading');fsAjax({action:'orders',customer_email:edd_customer_email,mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('edd.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.html)!="undefined"&&response.html){$('#edd-orders').html(response.html);$('#edd-orders').removeClass('edd-loading');$('.edd-refresh').click(function(e){eddLoadOrders();e.preventDefault();});}else{}},true);}!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});function eupInitSettings(){$(document).ready(function(){summernoteInit('#eup-settings-footer',{insertVar:false,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#eup-settings-footer');}}}});summernoteInit('#eup-privacy',{toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['picture']],['view',['codeview']]],insertVar:false,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#eup-privacy');}}}});$('#eup-show-preview').click(function(e){SmarticksW=JSON.parse($('#eup-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="smarticks-w";a.src=$('#eup-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#eup-widget-form input:visible,#eup-widget-form select:visible').on('change keyup',function(e){$('#eup-widget-code-wrapper').addClass('hidden');$('#eup-widget-save-wrapper').removeClass('hidden');});$(".eup-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#eup-widget-code-wrapper').addClass('hidden');$('#eup-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");$('#eup_consent').change(function(e){$('#eup-privacy-container').toggleClass('hidden');});});}
(function(){var module_routes=[{"uri":"export-conversations\/ajax-html\/{action}","name":"exportconversations.ajax_html"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();fsAddAction('reports.before_refresh',function(params){var filters=params.data.filters;var route_params={action:'export'};for(var param_name in filters){var value=filters[param_name];if(param_name=='tag'){value=$('#rpt-filters select[name="tag"] option[value="'+value+'"]').text();}
if(param_name=='from'){param_name='after';}
if(param_name=='to'){param_name='before';}
if(param_name=='custom_field'){for(var custom_field_id in value){if(value[custom_field_id]!==''){custom_field_name=$('#rpt-filters :input[name="custom_field['+custom_field_id+']"]:first').prev().text();route_params['f[%23'+custom_field_name+']']=value[custom_field_id];}}
continue;}
route_params['f['+param_name+']']=value;}
route_params['f[state][]']=2;route_params['f[status][0]']=1;route_params['f[status][1]']=2;route_params['f[status][2]']=3;var url=laroute.route('exportconversations.ajax_html',route_params);$('#rpt-btn-export').attr('data-remote',url);});(function(){var module_routes=[{"uri":"attachments\/ajax","name":"extendedattachments.ajax"},{"uri":"attachments\/eml_viewer","name":"extendedattachments.eml_viewer"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var av_i18n;var av_scroll;var av_att;var av_viewable_extensions=['txt','diff','patch','json'];var av_viewable_mime_types=['text/plain','text/x-diff','application/json'];function eaInitDeleteModal(){$(document).ready(function(){$('.ea-confirm-delete:visible:first').click(function(e){var attachment_id=$(this).attr('data-attachment-id');var button=$(this);button.button('loading');fsAjax({action:'delete_attachment',attachment_id:attachment_id},laroute.route('extendedattachments.ajax'),function(response){if(isAjaxSuccess(response)){$('.thread-attachments li[data-attachment-id="'+attachment_id+'"').hide();$('.attachments-list li[data-attachment-id="'+attachment_id+'"').hide();button.parents('.modal:first').modal('hide');}else{showAjaxError(response);}
button.button('reset');},true);return false;});});}
function avInit(i18n){av_i18n=i18n;$(document).ready(function(){$('.attachment-link').click(function(e){var att=$(this);avOpenInViewer($(this));e.preventDefault();});});}
function avOpenInViewer(att){if(!att.length){return;}
av_att=att;var att_url=att.attr('href');var att_name=att.text();var container=$('#av-container');if(!container.length){var html='<div id="av-bg" class="av-close-trigger av-element">';html+='</div>';html+='<div id="av-container" class="av-element av-close-trigger">';html+='<div id="av-header">';html+='<span id="av-name"></span>';html+='<a href="" class="btn btn-primary" id="av-download" download>'+av_i18n.download+' &nbsp;<i class="glyphicon glyphicon-download-alt small"></i></a>';html+='<a href="#" id="av-close" class="pull-right av-close-trigger">✕</a>';html+='</div>';html+='<div id="av-content">';html+='</div>';html+='<div id="av-prev" class="av-nav">';html+='<i class="glyphicon glyphicon-menu-left"></i>';html+='</div>';html+='<div id="av-next" class="av-nav">';html+='<i class="glyphicon glyphicon-menu-right"></i>';html+='</div>';html+='</div>';$('body:first').prepend(html);$('.av-close-trigger').click(function(e){avCloseViewer();});$('#av-header').click(function(e){e.stopPropagation();});$('#av-next').click(function(e){if(!$(this).hasClass('av-inactive')){var next_li=av_att.parent().next();if(next_li.attr('data-attachment-id')){avOpenInViewer(next_li.children('.attachment-link:first'));}}
e.stopPropagation();});$('#av-prev').click(function(e){if(!$(this).hasClass('av-inactive')){var prev_li=av_att.parent().prev();if(prev_li.attr('data-attachment-id')){avOpenInViewer(prev_li.children('.attachment-link:first'));}}
e.stopPropagation();});}else{$('.av-element').show();}
$('#av-name').text(att_name);$('#av-download').attr('href',att_url);var mime_type=att.parent().attr('data-mime');var mime_category=mime_type.split('/')[0];var ext=att_url.replace(/.*\.([^\.]+)\?.*/,'$1').toLowerCase();var content='<span class="av-content-text">'+av_i18n.unsupported+'<br/><a href="'+att_url+'" download class="av-content-download"><i class="glyphicon glyphicon-download-alt"></i></a></span>';if(mime_type=='application/pdf'){content='<iframe src="'+att_url+'" frameborder="0" id="av-iframe"></iframe>';}else if(mime_type=='message/rfc822'||att_name.toUpperCase()=='RFC822'||ext=='eml'){content='<iframe sandbox="allow-popups allow-downloads" src="'+laroute.route('extendedattachments.eml_viewer',{attachment_url:encodeURIComponent(att_url),mailbox_id:getGlobalAttr('mailbox_id'),t:Date.now()})+'" frameborder="0" id="av-iframe" style="background-color: white;"></iframe>';}else if(av_viewable_extensions.indexOf(ext)!=-1&&av_viewable_mime_types.indexOf(mime_type)!=-1){content='<iframe src="'+att_url+'" frameborder="0" id="av-iframe" class="av-iframe-white"></iframe>';}else if(mime_category=='audio'){content='<audio controls src="'+att_url+'" class="av-content-item">'+av_i18n.unsupported+'</audio>';}else if(mime_category=='video'){content='<video controls class="av-content-item"><source src="'+att_url+'" type="video/mp4">'+av_i18n.unsupported+'</video>';}else if(mime_category=='image'){content='<img src="'+att_url+'" class="av-content-item" />';}
$('#av-content').html(content);av_scroll=$(window).scrollTop();$('html:first').addClass('av-no-scroll');if(!att.parent().next().attr('data-attachment-id')){$('#av-next').addClass('av-inactive');}else{$('#av-next').removeClass('av-inactive');}
if(!att.parent().prev().attr('data-attachment-id')){$('#av-prev').addClass('av-inactive');}else{$('#av-prev').removeClass('av-inactive');}}
function avCloseViewer(){$('.av-element').hide();$('#av-content').html('');$('html:first').removeClass('av-no-scroll');$("html").scrollTop(av_scroll);setTimeout(function(){$("html").scrollTop(av_scroll);},10);setTimeout(function(){$("html").scrollTop(av_scroll);},100);}
function eaReminderInit(phrases,dialog_text,dialog_submit_text){fsAddFilter('conversation.can_submit',function(value,params){if(!value){return value;}
if($('body:first').attr('data-ea-send-anyway')=='1'){return true;}
if($('.attachments-upload .attachment-loaded').length){return value;}
var body=stripTags(getReplyBody());var phrase='';for(var i in phrases){if(body.indexOf(phrases[i])!=-1){phrase=phrases[i]
break;}}
if(!phrase){return value;}
dialog_text=dialog_text.replace(':phrase','<strong>"'+phrase+'"</strong>');showModalConfirm(dialog_text,'ea-send-anyway',{on_show:function(modal){modal.children().find('.ea-send-anyway:first').click(function(e){$('body:first').attr('data-ea-send-anyway','1');$(".btn-reply-submit:visible:first").click();modal.modal('hide');});}},dialog_submit_text);return false;},100);}
fsAddFilter('conversation.editor_toolbar',function(value){if(typeof(value[0][1])!='undefined'){value[0][1].splice(6,0,'style');value[0][1].splice(8,0,'table');value[0][1].splice(4,0,'color');}
return value;});(function(){var module_routes=[{"uri":"jira\/ajax","name":"jira.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function jiraInitLinkIssue(){$(document).ready(function(){$(".jira-search-form:visible:first").submit(function(e){jiraSearch($(".jira-search-issue:visible:first"));return false;});$(".jira-search-issue:visible:first").click(function(e){jiraSearch($(this));});$(".modal:visible .jira-link-issue-switch").click(function(e){$('.jira-link-issue-container').toggleClass('hidden');});$(".modal:visible .jira-project:first").change(function(e){var project_key=$(this).val();if(project_key){$('.jira-issue-type:visible:first').removeAttr('disabled').children('option[value!=""]').hide().filter('option[data-project-key="'+project_key+'"]').show();}else{$('.jira-issue-type:visible:first').attr('disabled','disabled');}});$(".modal:visible .jira-issue-form:first").submit(function(e){alert('preventDefault');e.preventDefault();});$(".modal:visible .jira-create-issue:first").click(function(e){var button=$(this);button.button('loading');data=new FormData();var form=$('.jira-issue-form:visible:first').serializeArray();for(var field in form){data.append(form[field].name,form[field].value);}
data.append('action','create_issue');data.append('conversation_id',getGlobalAttr('conversation_id'));fsAjax(data,laroute.route('jira.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);}},true,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();},{cache:false,contentType:false,processData:false});return false;});});}
function jiraSearch(button){var container=$('.jira-remote-issues:visible:first');var input=$(".jira-search-q:visible:first");var not_found_text=$(".jira-not-found:first");button.button('loading');input.attr('disabled','disabled');not_found_text.addClass('hidden');container.html('');fsAjax({action:'search',q:input.val()},laroute.route('jira.ajax'),function(response){button.button('reset');input.removeAttr('disabled');if(isAjaxSuccess(response)){var html='';var text_link_issue=button.attr('data-text-link');if(response.issues.length){for(var i in response.issues){var issue=response.issues[i];html+='<div class="row jira-issue-search-item">';html+='<div class="col-sm-9">';html+='<img src="'+htmlEscape(issue.issuetype.iconUrl)+'" class="jira-issuetype-icon" title="'+htmlEscape(issue.issuetype.name)+'"/> ';html+='<a href="'+issue.url+'" target="_blank" class="text-large">'+issue.key+' - <span class="jira-issue-search-summary">'+htmlEscape(issue.summary)+'</span></a>';html+=' <small class="jira-status-name">('+htmlEscape(issue.status.name)+')</small>';html+='<p>'+htmlEscape(issue.description)+'</p>';html+='</div>';html+='<div class="col-sm-3">';html+='<button type="button" class="btn btn-xs btn-default jira-btn-link-issue" data-loading-text="'+text_link_issue+'…" data-issue-key="'+issue.key+'" data-issue-type="'+issue.issuetype.id+'" data-issue-status="'+issue.status.id+'">'+text_link_issue+'</button>';html+='</div>';html+='</div>';if(i!=response.issues.length-1){html+='<hr/>';}}}else{not_found_text.removeClass('hidden');}
container.html(html);}else{container.html('');showAjaxError(response);}
$(".jira-btn-link-issue").click(function(e){var button=$(this);button.button('loading');fsAjax({action:'link',conversation_id:getGlobalAttr('conversation_id'),issue_key:button.attr('data-issue-key'),issue_type:button.attr('data-issue-type'),issue_status:button.attr('data-issue-status'),issue_summary:button.parents('.jira-issue-search-item:first').children().find('.jira-issue-search-summary:first').html()},laroute.route('jira.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);}},true);});},true);}
function jiraInit(){$(document).ready(function(){$(".jira-remove").click(function(e){var button=$(this);var container=button.parents('li:first');container.hide();fsAjax({action:'unlink_issue',conversation_id:getGlobalAttr('conversation_id'),jira_issue_id:container.attr('data-jira-issue-id'),},laroute.route('jira.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){}else{showAjaxError(response);container.show();}},true,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();container.show();});});});}
(function(){var module_routes=[{"uri":"kanban\/ajax","name":"kanban.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var KN_STATUS_CLOSED=3;var KN_SORT_CLOSED_NEW='closed_new';var KN_FILTERS_SEPARATOR='|';var kn_redirect_on_card_create=0;function knInit(text_delete){$(document).ready(function(){$('#kn-boards-list').change(function(e){window.location.href=$(this).val();});$(window).on('resize',function(){knResizeBoard();}).resize();knApplyListeners();knShowParams();$('.kn-param li a').click(function(e){var li=$(this).parent();var param=li.parents('.kn-param').attr('data-param');if(param!='filters'){li.parent().children('li').removeClass('active');li.addClass('active');}
knShow();e.preventDefault();});$('#kn-btn-refresh').click(function(e){knShow();e.preventDefault();});$('#kn-delete-board').click(function(e){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+text_delete+'</span>','kn-confirm-delete-board',{on_show:function(modal){modal.children().find('.kn-confirm-delete-board:first').click(function(e){var button=$(this);button.attr('data-loading-text',Lang.get("messages.delete")+'…');button.button('loading');fsAjax({action:'delete_board',board_id:getGlobalAttr('board_id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';modal.modal('hide');}else{showAjaxError(response);}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('#kn-copy-link').click(function(e){var url=window.location.origin+window.location.pathname+'?';var params=knGetParams();var kn=[];for(var param_name in params){var value=params[param_name];if(param_name=='filters'){for(var filter_name in value){var filter_values=value[filter_name].join(KN_FILTERS_SEPARATOR);if(!filter_values.length){continue;}
kn.push('kn%5B'+param_name+'%5D%5B'+filter_name+'%5D='+encodeURIComponent(filter_values));}}else{kn.push('kn%5B'+param_name+'%5D='+encodeURIComponent(value));}}
url+=kn.join('&');copyToClipboard(url);e.preventDefault();});$('#kn-reset-filter').click(function(e){window.location.href=$(this).attr('href');e.preventDefault();});});}
function knApplyListeners(){$('.kn-more').off('click').click(function(e){knLoadCards($(this),false);});$('.kn-show-closed').off('click').click(function(e){var button=$(this);if(button.next().length){if(button.next().is(':visible')){button.nextAll().hide();}else{button.nextAll().show();}}else{knLoadCards($(this),true);}});initModals('div');$('.kn-card-footer a').off('click').click(function(e){e.stopPropagation();});var cols=sortable('.kn-sortable',{connectWith:'kn-sortable',items:'.kn-card',forcePlaceholderSize:true});for(var i in cols){cols[i].addEventListener('sortupdate',function(e){var col=$(e.target);var card=$(e.detail.item);fsAjax({action:'move_card',group_by:knGetParams()['group_by'],column_id:col.attr('data-column-id'),swimlane_id:col.attr('data-swimlane-id'),card_id:card.attr('data-card-id'),conversation_id:card.attr('data-conversation-id'),prev_card_id:card.next().attr('data-card-id'),closed:card.prevAll('.kn-show-closed:first').length},laroute.route('kanban.ajax'),function(response){showAjaxResult(response);},true);});}}
function knLoadCards(button,closed){button.button('loading');var col_container=button.parents('.kn-col:first');var params=knGetParams();var offset=col_container.children('.kn-card').length;var more_in_closed=false;if(button.prevAll('.kn-show-closed:first').length){closed=true;more_in_closed=true;}
if(closed){params.sort=KN_SORT_CLOSED_NEW;params.filters.status=[KN_STATUS_CLOSED];if(more_in_closed){offset=button.prevAll('.kn-show-closed:first').nextAll('.kn-card').length;}else{offset=button.nextAll('.kn-card').length;}}
fsAjax({action:'more',column_id:col_container.attr('data-column-id'),swimlane_id:col_container.attr('data-swimlane-id'),offset:offset,kn:params},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)&&response.html){if(button.hasClass('kn-show-closed')){$(response.html).insertAfter(button);}else{$(response.html).insertBefore(button);button.remove();}
knApplyListeners();}else{showAjaxResult(response);}},true);}
function knGetParams(){var params={};$('.kn-param').each(function(i,el){var j_el=$(el);var param=j_el.attr('data-param');if(param=='filters'){}else{params[param]=j_el.children().find('li.active:first').attr('data-param-value');}});params.mailbox_id=getGlobalAttr('mailbox_id');params.board_id=getGlobalAttr('board_id');params.filters={};$('.kn-param[data-param="filters"] li').each(function(i,el){var li=$(el);var param_name=li.attr('data-param-name');var param_value=li.attr('data-param-value');params.filters[param_name]=[];if(param_value){params.filters[param_name]=param_value.split(KN_FILTERS_SEPARATOR);}
if(params.filters[param_name].length==1&&typeof(params.filters[param_name][0])!="undefined"&&params.filters[param_name][0]==''){params.filters[param_name]=[];}});return params;}
function knShowParams(){$('.kn-param-counter').each(function(i,el){var j_el=$(el);var count=j_el.parents('.kn-param:first').children('ul:first').children('li.active').length;if(!count){j_el.text('');}else{j_el.text(' ('+count+')');}});}
function knResizeBoard(){var padding=Math.ceil($('nav.navbar:first').outerHeight()+$('#kn-heading').outerHeight());$('#kn-board').css('height','calc(100vh - '+padding+'px)');}
function knShow(){$('#kn-btn-refresh i:first').addClass('glyphicon-spin');fsAjax({action:'show',kn:knGetParams()},laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)&&response.html){$('#kn-board').html(response.html);knApplyListeners();initModals();initTooltips();}else{showAjaxResult(response);}
loaderHide();$('#kn-btn-refresh i:first').removeClass('glyphicon-spin');},false,function(response){showAjaxResult(response);loaderHide();$('#kn-btn-refresh i:first').removeClass('glyphicon-spin');});}
function knInitBoardModal(){$(document).ready(function(){$('.kn-board-name:visible:first').focus();$('.kn-board-form:visible:first').on('submit',function(e){var board_id=$(this).attr('data-board-id');var data=$(this).serialize();if(board_id){data+='&board_id='+board_id;data+='&action=update_board';}else{data+='&action=new_board';}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(board_id){window.location.href='';}else{window.location.href=response.board_url;}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$('.kn-add-column:visible:first').click(function(e){var columns_container=$('.kn-board-columns:visible:first');var column_id=parseInt(columns_container.attr('data-max-id'))+1;var html=$('.kn-board-column-pattern:first').html();html=replaceAll(html,'-1',column_id);html=replaceAll(html,'required-x','required');columns_container.append(html);columns_container.attr('data-max-id',column_id);knColumnsListeners();e.preventDefault();});knColumnsListeners();$('.kn-add-swimlane:visible:first').click(function(e){var swimlanes_container=$('.kn-board-swimlanes:visible:first');var swimlane_id=parseInt(swimlanes_container.attr('data-max-id'))+1;var html=$('.kn-board-swimlane-pattern:first').html();html=replaceAll(html,'-1',swimlane_id);html=replaceAll(html,'required-x','required');swimlanes_container.append(html);swimlanes_container.attr('data-max-id',swimlane_id);knSwimlanesListeners();e.preventDefault();});knSwimlanesListeners();});}
function knInitCardModal(){$(document).ready(function(){$('.kn-card-form-name:visible:first').focus();$('#link_to_conversation').change(function(e){if(!$(this).is(':checked')){$('.kn-card-linked').addClass('hidden');$('.kn-card-standalone').removeClass('hidden');$('.kn-card-linked :input').removeAttr("required");}else{$('.kn-card-linked').removeClass('hidden');$('.kn-card-standalone').addClass('hidden');$('.kn-card-linked :input').attr("required","required");}});$('#link_to_conversation:visible').change();var editor_buttons=fs_conv_editor_buttons;$.extend(editor_buttons,{removeformat:EditorRemoveFormatButton,lists:EditorListsButton});var editor_toolbar=fs_conv_editor_toolbar;var remove_button=false;for(var i in editor_toolbar[0][1]){if(remove_button){editor_toolbar[0][1].splice(i,1);continue;}
if(editor_toolbar[0][1][i]=='codeview'){remove_button=true;}}
var options={minHeight:120,dialogsInBody:true,dialogsFade:true,disableResizeEditor:true,followingToolbar:false,toolbar:editor_toolbar,buttons:editor_buttons,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,false,'#kn-card-body');}}}};$('.kn-card-body:visible:first').summernote(options);$('.kn-card-submit:visible:first').click(function(e){kn_redirect_on_card_create=0;});$('.kn-card-submit-redirect:visible:first').click(function(e){kn_redirect_on_card_create=1;});$('.kn-card-form:visible:first').on('submit',function(e){var card_id=$(this).attr('data-card-id');var data=$(this).serialize();if(card_id){data+='&card_id='+card_id;data+='&action=update_card';}else{data+='&action=new_card';}
if(kn_redirect_on_card_create){var button=$(this).children().find('.kn-card-submit-redirect:first');}else{var button=$(this).children().find('.kn-card-submit:first');}
button.button('loading');fsAjax(data,laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(kn_redirect_on_card_create&&response.board_url){window.location.href=response.board_url;}else{if(response.msg_success){showFloatingAlert("success",response.msg_success);}
knShow();}
$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});$('#kn-delete-card').click(function(e){var button=$(this);showModalConfirm(kn_text_delete_card,'kn-confirm-delete-card',{on_show:function(modal){modal.children().find('.kn-confirm-delete-card:first').click(function(e){button.button('loading');modal.modal('hide');var card_id=button.parents('.kn-card-form:first').attr('data-card-id');fsAjax({action:'delete_card',card_id:card_id},laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
$('.modal:visible').modal('hide');knShow();}else{showAjaxError(response);button.button('reset');}},true);});}},Lang.get("messages.delete"));e.preventDefault();});window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){var number=event.data.split('kn.pick_conversation:');if(typeof(number[1])){$('#kn-card-conv').val(number[1]);$('.modal:visible:first').animate({scrollTop:0},600,'swing');}}});$('#kn-board-input').change(function(e){var board_id=$(this).val();$('.kn-board-inputs').addClass('hidden').attr('disabled','disabled');$('#kn-board-columns-select-'+board_id).removeClass('hidden').removeAttr('disabled');$('#kn-board-swimlane-select-'+board_id).removeClass('hidden').removeAttr('disabled');});$('.modal button.close').click(function(e){knShow();});initTooltips();});}
function knColumnsListeners(){sortable('.kn-board-columns',{handle:'.handle',forcePlaceholderSize:true});$('.kn-delete-column').off('click').click(function(e){if($('.kn-delete-column:visible').length<2){return;}
var button=$(this);button.button('loading');var container=button.parents('.panel:first');fsAjax({action:'delete_column',board_id:$('.kn-board-form:visible:first').attr('data-board-id'),column_id:container.attr('data-column-id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){if(response.confirmation_text){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+response.confirmation_text+'</span>','kn-confirm-delete-column',{on_show:function(modal){modal.children().find('.kn-confirm-delete-column:first').click(function(e){button.parents('.panel:first').remove();modal.modal('hide');});}},Lang.get("messages.delete"));}else{container.remove();}}else{showAjaxError(response);}},true);e.preventDefault();});}
function knSwimlanesListeners(){sortable('.kn-board-swimlanes',{handle:'.handle',forcePlaceholderSize:true});$('.kn-delete-swimlane').off('click').click(function(e){if($('.kn-delete-swimlane:visible').length<2){return;}
var button=$(this);button.button('loading');var container=button.parents('.panel:first');fsAjax({action:'delete_swimlane',board_id:$('.kn-board-form:visible:first').attr('data-board-id'),swimlane_id:container.attr('data-swimlane-id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){if(response.confirmation_text){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+response.confirmation_text+'</span>','kn-confirm-delete-swimlane',{on_show:function(modal){modal.children().find('.kn-confirm-delete-swimlane:first').click(function(e){button.parents('.panel:first').remove();modal.modal('hide');});}},Lang.get("messages.delete"));}else{container.remove();}}else{showAjaxError(response);}},true);e.preventDefault();});}
function knInitFilterModal(){$(document).ready(function(){$('.kn-type-date:visible').flatpickr({allowInput:true});$('.kn-filter-form:visible:first').on('submit',function(e){var fields=$(this).serializeArray();var filter=$(this).children(':input[name="filter"]').val();var selected=[];var cf_data={};for(var i in fields){if(filter=='custom_field'){matches=fields[i].name.match(/selected\[op\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['op']=fields[i].value;}
matches=fields[i].name.match(/selected\[value\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['value']=fields[i].value;}}else{if(fields[i].name=='selected[]'){selected.push(fields[i].value);}}}
if(filter=='custom_field'){for(var cf_id in cf_data){if(cf_data[cf_id].value!=''){selected.push(value=JSON.stringify({id:cf_id,value:cf_data[cf_id].value,op:cf_data[cf_id].op}));}}}
var li=$('.kn-param[data-param="filters"] li[data-param-name="'+filter+'"]');li.attr('data-param-value',selected.join(KN_FILTERS_SEPARATOR));var a=li.children('a:first');if(selected.length){li.addClass('active');a.children('.kn-filter-counter:first').text('('+selected.length+')');}else{li.removeClass('active');a.children('.kn-filter-counter:first').text('');}
var href=a.attr('href');href=href.replace(/&selected.*/,'');for(var i in selected){href+='&selected%5B'+i+'%5D='+encodeURIComponent(selected[i]);}
a.attr('href',href);$('.kn-reset-filter').removeClass('hidden');knShow();knShowParams();$('.modal:visible:first').modal('hide');e.preventDefault();return false;});});}
function knInitPickConv(){$(document).ready(function(){$('.kn-btn-pick').click(function(e){knPickConv($(this).attr('data-conv-number'),$(this)[0]);e.preventDefault();e.stopPropagation();});});}
function knPickConv(number,btn){if(typeof(window.parent)!="undefined"){window.parent.postMessage('kn.pick_conversation:'+number);$('.kn-btn-pick.btn-primary').removeClass('btn-primary').addClass('btn-default');$(btn).addClass('btn-primary');}}
(function(){var module_routes=[{"uri":"knowledge-base\/ajax-admin","name":"mailboxes.knowledgebase.ajax_admin"},{"uri":"knowledge-base\/ajax_html\/{action}","name":"knowledgebase.ajax_html"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});var KbEditorButton=function(context){var ui=$.summernote.ui;var button=ui.buttonGroup([ui.button({className:'fs-trigger-modal',contents:'<i class="glyphicon glyphicon-education"></i>',tooltip:Lang.get("messages.kb_reference_title"),container:'body',data:{trigger:'modal',remote:laroute.route('knowledgebase.ajax_html',{action:'reference'}),'modal-no-footer':'true','modal-title':Lang.get("messages.kb_reference_title"),'modal-on-show':'kbInitReferenceModal'},click:function(e){$('#body').summernote('editor.saveRange');}})]);var obj=button.render();return obj;}
fs_conv_editor_buttons['kb']=KbEditorButton;fs_conv_editor_toolbar[0][1].push('kb');function kbInitCategories(msg_delete){$(document).ready(function(){if($('.kb-category-tree').length){var elements=sortable('.kb-category-tree',{handle:'.handle',});for(var i in elements){elements[i].addEventListener('sortupdate',function(e){var categories=[];$(e.target).children('.panel').each(function(idx,el){categories.push($(this).attr('data-category-id'));});fsAjax({action:'update_categories_sort_order',categories:categories,},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);});});}}
$(".kb-category-delete").click(function(e){var button=$(this);showModalConfirm(msg_delete,'kb-category-delete-ok',{on_show:function(modal){var category_id=button.attr('data-category_id');modal.children().find('.kb-category-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete_category',category_id:category_id},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){window.location.href='';}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function kbInitArticles(){$(document).ready(function(){if($('#kb-articles-list').length&&$("#kb-category-sorting").length){sortable('#kb-articles-list',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var articles=[];$(e.target).children('.panel').each(function(idx,el){articles.push($(this).attr('data-article-id'));});fsAjax({action:'update_articles_sort_order',articles:articles,},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){if(isAjaxSuccess(response)){$('#kb-category-sorting').val(3).attr('data-forced-change','1').change();}
showAjaxResult(response);},true);});}
$("#kb-categories-select").change(function(e){window.location.href=$(e.target).val();});$("#kb-category-sorting").change(function(e){var articles_order=$(e.target).val();var forced_change=$(e.target).attr('data-forced-change');$(e.target).removeAttr('data-forced-change');fsAjax({action:'update_category_articles_order',category_id:$('#kb-categories-select').attr('data-category-id'),articles_order:articles_order},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);if(isAjaxSuccess(response)&&!forced_change){window.location.href='';}});});});}
function kbInitArticle(category_placeholder,msg_delete,redirect_url){$(document).ready(function(){var selector='#kb-article-text';summernoteInit(selector,{insertVar:false,disableDragAndDrop:false,toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['attachment','picture','video']],['view',['codeview']]],buttons:{attachment:function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-paperclip"></i>',tooltip:Lang.get("messages.upload_attachments"),container:'body',click:function(){var element=document.createElement('div');element.innerHTML='<input type="file" multiple>';var fileInput=element.firstChild;fileInput.addEventListener('change',function(){if(fileInput.files){for(var i=0;i<fileInput.files.length;i++){editorSendFile(fileInput.files[i],true,false,'#kb-article-text');}}});fileInput.click();}});return button.render();},removeformat:EditorRemoveFormatButton,lists:EditorListsButton},callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();},onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#kb-article-text');}}}});if($('#kb-article-text-primary').length){summernoteInit('#kb-article-text-primary',{insertVar:false,disableDragAndDrop:true,toolbar:[]});$('#kb-article-text-primary').summernote('disable')}
$('#kb-article-categories').select2({multiple:true,tags:true,placeholder:category_placeholder});$("#kb-article-delete").click(function(e){var button=$(this);showModalConfirm(msg_delete,'kb-article-delete-ok',{on_show:function(modal){var article_id=button.attr('data-article_id');modal.children().find('.kb-article-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete_article',article_id:article_id},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){window.location.href=redirect_url;}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function kbInitSettings(){$(document).ready(function(){summernoteInit('#kb-settings-footer',{insertVar:false,disableDragAndDrop:true});$('#kb-show-preview').click(function(e){SmarticksW=JSON.parse($('#kb-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="smarticks-w";a.src=$('#kb-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#kb-locales').select2({multiple:true}).on('select2:select',function(e){var element=e.params.data.element;var $element=$(element);$(this).append($element);$(this).trigger("change");});$('#kb-widget-form input:visible,#kb-widget-form select:visible').on('change keyup',function(e){$('#kb-widget-code-wrapper').addClass('hidden');$('#kb-widget-save-wrapper').removeClass('hidden');});$(".kb-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#kb-widget-code-wrapper').addClass('hidden');$('#kb-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");});}
function kbInitReferenceModal(){var text=$('#body').summernote('createRange').toString();$('.kb-ref-text:visible:first').val(text);$(".kb-ref-search-button:visible:first").click(function(e){var button=$(this);var q_input=$('.kb-ref-search-q:visible:first');var container=$('.kb-ref-table-container:visible:first');var empty_container=$('.kb-ref-search-empty:first');var submit_btn=$('.kb-ref-insert:visible:first');button.button('loading');q_input.attr('disabled','disabled');empty_container.addClass('hidden');submit_btn.attr('disabled','disabled');container.html('');fsAjax({action:'reference_search',q:q_input.val()},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');button.attr('disabled','disabled');q_input.removeAttr('disabled');if(isAjaxSuccess(response)){if(!response.html){empty_container.removeClass('hidden');}else{container.html(response.html);$('.kb-ref-search-item').click(function(e){submit_btn.removeAttr('disabled');});}}},true,function(){showFloatingAlert('error',Lang.get("messages.ajax_error"));loaderHide();button.button('reset');q_input.removeAttr('disabled');});}).click();$(".kb-reference-form:visible:first").submit(function(e){var url=$('.kb-ref-table-container .kb-ref-search-item:checked:first').parents('tr:first').children().find('a:first').attr('href');var html='<a href="'+url+'">'+$('.kb-ref-text:visible:first').val()+'</a>';var body=$('#body');body.summernote('restoreRange');body.summernote('pasteHTML',html);closeAllModals();e.preventDefault();return false;});}
function mailsigningInit(){$(document).ready(function(){$(':input[name="settings\[protocol\]"]').change(function(e){$('.ms-protocol').addClass('hidden');$('.ms-protocol-'+$(':input[name="settings\[protocol\]"]:checked').val()).removeClass('hidden');});$(':input[name="settings\[mode\]"]').change(function(e){$('.ms-mode').addClass('hidden');$('.ms-mode-'+$(':input[name="settings\[mode\]"]:checked').val()).removeClass('hidden');});$('.content-2col :input[id!="send_test"]').on("change keyup",function(e){$('#send_test').attr('disabled','disabled');});$('#send-test-trigger').click(function(event){var button=$(this);button.button('loading');fsAjax({action:'send_test',mailbox_id:getGlobalAttr('mailbox_id'),to:$('#send_test').val()},laroute.route('mailboxes.ajax'),function(response){if(isAjaxSuccess(response)){showFloatingAlert('success',Lang.get("messages.email_sent"));}else{showAjaxError(response,true);}
button.button('reset');},true);});});}
(function(){var module_routes=[{"uri":"mentions\/ajax","name":"mentions.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var mentions_users=[];function mentionsInitConv(){fsAddFilter('editor.options',function(options,params){if(typeof(options.hint)=="undefined"){options.hint=[];}
options.hint.push({match:/\B@([\w\p{L}_]*)$/u,search:function(keyword,callback){if(!isNote()){return;}
if(!mentions_users.length){callback(['...']);fsAjax({action:'users',mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('mentions.ajax'),function(response){if(isAjaxSuccess(response)&&response.users){mentions_users=response.users;callback(mentionsGrepUsers(keyword));}},true,function(response){});}else{callback(mentionsGrepUsers(keyword));}},template:function(item){var parts=item.split('|');var name=item;if(parts.length>1){name=parts[0];}
return name;},content:function(item){var parts=item.split('|');var name=item;var id='';if(parts.length>1){name=parts[0];id=parts[parts.length-1];}
name=name.replaceAll(' ','_').toLowerCase();return $('<span><b data-mentioned-id="'+id+'">@'+name+'</b>&nbsp;</span>')[0];}});return options;});}
function mentionsGrepUsers(keyword){if(!keyword){return mentions_users;}
return $.grep(mentions_users,function(item){return item.replaceAll(' ','').toLowerCase().indexOf(keyword.replaceAll('_','').toLowerCase())==0;})}
function noreplyInitConv(noreply_emails,alert_message){fsAddFilter('conversation.recipient_selector',function(result,params){result.on('select2:select',function(e){var select=$(e.target);var selected_noreply_emails=noreplyGetNoreplyEmails(select,noreply_emails);for(var i in selected_noreply_emails){noreplyAddAlert(select,selected_noreply_emails[i],alert_message);}});result.on('select2:unselect',function(e){var select=$(e.target);noreplyHideAlerts(select,noreply_emails);});result.on('select2:clear',function(e){var select=$(e.target);noreplyHideAlerts(select,noreply_emails);});return result;});fsAddAction('conversation.recipient_selector_initialized',function(params){params.selector.each(function(i,el){var select=$(el);var selected_noreply_emails=noreplyGetNoreplyEmails(select,noreply_emails);for(var i in selected_noreply_emails){noreplyAddAlert(select,selected_noreply_emails[i],alert_message);}});});}
function noreplyAddAlert(select,email,text){var has_alert=false;select.parent().children('.noreply-alert').each(function(i,el){if($(el).attr('data-noreply-email')==email){has_alert=true;}});if(has_alert){return;}
text=text.replace(':email','<strong>&lt;'+email+'&gt;</strong>');var html='<div class="alert alert-warning alert-narrow margin-bottom-0 noreply-alert" data-noreply-email="'+email+'">'+text+'</div>';select.parent().append(html);}
function noreplyHideAlerts(select,noreply_emails){var selected_noreply_emails=noreplyGetNoreplyEmails(select,noreply_emails);if(selected_noreply_emails.length){select.parent().children('.noreply-alert').each(function(i,el){if(selected_noreply_emails.indexOf($(el).attr('data-noreply-email'))==-1){$(el).remove();}});}else{select.parent().children('.noreply-alert').remove();}}
function noreplyGetNoreplyEmails(select,noreply_emails){var result=[];var emails=select.val();for(var i in emails){for(var j in noreply_emails){var pattern=noreply_emails[j];pattern=pattern.replace(/\-/g,'\\-?');pattern=pattern.replace(/\*/g,'.*');var re=new RegExp('.*'+pattern+'.*');if(re.test(emails[i])){result.push(emails[i]);}}}
return result;}
(function(){var module_routes=[{"uri":"oauth-login\/callback\/{provider_id}","name":"oauthlogin.callback"},{"uri":"oauth-login\/logout\/{provider_id}\/{logout_secret}","name":"oauthlogin.logout"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function olInit(){$(document).ready(function(){olRenderProviders(ol_providers);});}
function olApplyListeners(){$('.ol-add-provider').click(function(e){ol_providers.push({id:olGenerateProviderId(),active:1});olRenderProviders(ol_providers);return false;});$('.ol-delete-provider').click(function(e){var index=parseInt($(this).attr('data-ol-provider-index'));if(typeof(ol_providers[index])!="undefined"){var deleted_provider=ol_providers[index];ol_providers.splice(index,1);if(typeof(deleted_provider.default)!="undefined"&&deleted_provider.default){if(typeof(ol_providers[0])!="undefined"){ol_providers[0].default=1;}}
olRenderProviders(ol_providers);}
return false;});$('.ol-provider-field-default').click(function(e){$('.ol-provider-field-default[name!="'+$(this).attr('name')+'"]').prop('checked',false);});$('.ol-provider-field-provider').change(function(e){var provider_code=$(this).val();var provider_block=$(this).parents('.ol-provider:first');provider_block.children().find(':input[data-ol-no-clear!="1"]').val('');for(var field in ol_providers_config[provider_code]){var value=ol_providers_config[provider_code][field];provider_block.children().find('.ol-provider-field-'+field+':first').val(value);}});$('[data-toggle="popover"]').popover({container:'body'});}
function olRenderProviders(providers){if(!Array.isArray(providers)){providers=[];}
if(providers.length==0){providers.push({id:olGenerateProviderId(),active:1,default:1,provider:'oauth'});}
var pattern_html=$('#ol-provider-pattern').html();$('.ol-provider').remove();var index=0;for(var i in providers){var provider=providers[i];var html=replaceAll(pattern_html,'provider_index',index);var provider_block=$('<div class="ol-provider">'+html+'</div>');provider_block.children().find(':input').removeAttr('disabled');for(var field in provider){var input=provider_block.children().find('.ol-provider-field-'+field+':first');if(input.is(':checkbox')||input.is(':radio')){if(provider[field]==1){input.prop('checked',true);}else{input.prop('checked',false);}}else{input.val(provider[field]);}}
if(index!=providers.length-1){provider_block.children().find('.ol-add-provider:first').remove();}
if(providers.length==1){provider_block.children().find('.ol-delete-provider:first').remove();}
provider_block.children().find('.ol-provider-redirect-uri:first').val(laroute.route('oauthlogin.callback',{provider_id:provider.id}));var logout_input=provider_block.children().find('.ol-provider-logout-uri:first');logout_input.val(laroute.route('oauthlogin.logout',{provider_id:provider.id,logout_secret:logout_input.attr('data-ol-logout-secret')}));provider_block.insertBefore('#ol-provider-pattern');index++;}
olApplyListeners();}
function olGenerateProviderId(){return Math.random().toString(36).substr(2,9);}
(function(){var module_routes=[{"uri":"reports\/ajax","name":"reports.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initReports(){$(document).ready(function(){rptRefresh();$('#rpt-filters .input-date').flatpickr({allowInput:true});$('#rpt-btn-loader').click(function(e){rptRefresh();});$('.rpt-filter :input').change(function(e){rptRefresh();});$('.rpt-filter-date').flatpickr();$('.rpt-filter select[name="mailbox"]:first').change(function(e){$('.rpt-cf-mailbox').addClass('hidden');$('.rpt-cf-mailbox-'+$(this).val()).removeClass('hidden');});});}
function rptRefresh(){var data={};var loader=$('#rpt-btn-loader');data.action='report';data.report_name=$('#rpt-report').attr('data-report-name');data.filters={};var filters=$('#rpt-filters').serializeArray();for(var i in filters){var filter=filters[i];var m=filter.name.match(/^custom_field\[(\d+)\]$/);if(m&&typeof(m[1])!="undefined"){if(!$('.rpt-filter :input[name="'+filter.name+'"]').parent().is(":visible")){continue;}
if(typeof(data.filters['custom_field'])=="undefined"){data.filters['custom_field']={};}
data.filters['custom_field'][m[1]]=filter.value;}else{data.filters[filter.name]=filter.value;}}
data.chart={};data.chart.group_by=$('#rpt-group-by button.active').val();data.chart.type=$('#rpt-chart-type').val();fsDoAction('reports.before_refresh',{data:data});loader.attr('disabled','disabled').children('.glyphicon:first').addClass('glyphicon-spin');$('.rpt-filter :input').attr('disabled','disabled');$('#rpt-options :input').attr('disabled','disabled');fsAjax(data,laroute.route('reports.ajax'),function(response){if(isAjaxSuccess(response)&&response.report){$('#rpt-report').html(response.report);var chart_type=$('#rpt-report').attr('data-chart-type');if(chart_type=='pie'){rptShowChartPie(response.chart);}else if(chart_type=='column'){rptShowChartColumn(response.chart);}else{rptShowChart(response.chart);}
initTooltips();$('#rpt-group-by button').click(function(e){if($(this).hasClass('active')){return;}
$('#rpt-group-by button').removeClass('active');$(this).addClass('active');rptRefresh();});$('#rpt-chart-type').change(function(e){rptRefresh();});}else{showAjaxResult(response);}
loader.removeAttr('disabled').children('.glyphicon:first').removeClass('glyphicon-spin');$('.rpt-filter :input').removeAttr('disabled');$('#rpt-options :input').removeAttr('disabled');},true,function(response){showAjaxResult(response);loader.removeAttr('disabled').children('.glyphicon:first').removeClass('glyphicon-spin');$('.rpt-filter :input').removeAttr('disabled');$('#rpt-options :input').removeAttr('disabled');});}
function rptShowChart(data){Highcharts.chart('rpt-chart',{chart:{type:'area'},title:{text:''},legend:{verticalAlign:'top',floating:true},xAxis:{categories:data.categories,},yAxis:{title:{text:' '}},tooltip:{shared:true},plotOptions:{area:{marker:{enabled:false,symbol:'circle',radius:2,states:{hover:{enabled:true}}}}},series:data.series});}
function rptShowChartPie(data){Highcharts.chart('rpt-chart',{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,type:'pie'},title:{text:''},tooltip:{pointFormat:'<b>{point.y}%</b>'},accessibility:{point:{valueSuffix:'%'}},plotOptions:{series:{animation:false},pie:{allowPointSelect:true,cursor:'pointer',dataLabels:{enabled:true,format:'<b>{point.name}</b>: {point.y} %'}}},series:data.series});}
function rptShowChartColumn(data){Highcharts.chart('rpt-chart',{chart:{type:'column'},title:{text:''},tooltip:{pointFormat:'<b>{point.y}</b>'},plotOptions:{column:{pointPadding:0.2,borderWidth:0}},yAxis:{min:0,title:{text:data.y_title}},xAxis:{categories:data.categories,crosshair:true},series:data.series});}
function initSatRatingsSettings(confirm_reset_text){$(document).ready(function(){summernoteInit('#ratings_text',{buttons:{insertvar:function(context){var ui=$.summernote.ui;var contents='<select class="form-control summernote-inservar" tabindex="-1">'+'<option value="">'+Lang.get("messages.insert_var")+' ...</option>'+'<optgroup label="'+Lang.get("messages.mailbox")+'">'+'<option value="{%mailbox.email%}">'+Lang.get("messages.email")+'</option>'+'<option value="{%mailbox.name%}">'+Lang.get("messages.name")+'</option>'+'</optgroup>'+'</select>';var button=ui.button({contents:contents,tooltip:Lang.get("messages.insert_var"),container:'body'});return button.render();}}});$('.reset-trigger').click(function(e){showModalConfirm(confirm_reset_text,'confirm-reset',{on_show:function(modal){modal.children().find('.confirm-reset:first').click(function(e){$('#ratings_placement_1').prop("checked",true);var def_text=$('#default_ratings_text').val();$('#ratings_text').val(def_text);setSummernoteText($('#ratings_text'),def_text);modal.modal('hide');});}});e.preventDefault();});});}
function initSatRatingsTrans(confirm_reset_text){$(document).ready(function(){$('.reset-trigger').click(function(e){showModalConfirm(confirm_reset_text,'confirm-reset',{on_show:function(modal){modal.children().find('.confirm-reset:first').click(function(e){$('#form-trans :input').each(function(i,el){var jel=$(el);if(jel.attr('data-default')){jel.val(jel.attr('data-default'));}});modal.modal('hide');});}});e.preventDefault();});});}
function satrInitConv(){$(document).ready(function(){$('#conv-layout-main .satr-comment').click(function(e){e.preventDefault();});});}
(function(){var module_routes=[{"uri":"mailbox\/saved-replies\/ajax-html\/{action}","name":"mailboxes.saved_replies.ajax_html"},{"uri":"mailbox\/saved-replies\/ajax","name":"mailboxes.saved_replies.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var EditorSavedRepliesButton=function(context){var ui=$.summernote.ui;var button=ui.buttonGroup([ui.button({className:'dropdown-toggle',contents:'<i class="glyphicon glyphicon-comment"></i>',tooltip:Lang.get("messages.saved_replies"),container:'body',data:{toggle:'dropdown'},click:function(e){if(typeof(e.target)=="undefined"){return;}
var trigger=$(e.target);if(trigger.hasClass('glyphicon')){trigger=trigger.parent();}
setTimeout(function(){trigger.next().children().find('.sr-li-search:first .form-control:first').focus();},100);}}),ui.dropdown({className:'dropdown-menu-right dropdown-saved-replies',contents:$('#sr-dropdown-list').html(),click:function(e){if(typeof(e.target)=="undefined"){return;}
var target=$(e.target);if($(e.target).hasClass('caret')){target=target.parent();}
if($(e.target).hasClass('sr-li-search')||$(e.target).parent().hasClass('sr-li-search')){e.stopPropagation();return false;}
var saved_reply_id=target.attr('data-value');if(saved_reply_id){if(target.children('.caret:first').length){target.parent().parent().children('li[data-parent-id="'+saved_reply_id+'"]').toggleClass('hidden');if(target.parent().parent().children('li[data-parent-id="'+saved_reply_id+'"]:first').hasClass('hidden')){target.parent().parent().children('li[data-parents]:visible').each(function(index,el){var parents=$(el).attr('data-parents').split(',');for(var i in parents){if(parents[i]==saved_reply_id){$(el).addClass('hidden');return;}}});}
e.stopPropagation();}else{fsAjax({action:'get',saved_reply_id:saved_reply_id,conversation_id:getGlobalAttr('conversation_id')},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.text)!="undefined"&&response.text){$('#body').summernote('editor.restoreRange');context.invoke('editor.pasteHTML',response.text);$('.form-reply:visible:first :input[name="saved_reply_id"]:first').val(saved_reply_id);if(response.attachments.length){showAttachments(response);}}else{showAjaxError(response);}
loaderHide();});}}else{showModal({'remote':laroute.route('mailboxes.saved_replies.ajax_html',{'action':'create'}),'size':'lg','title':Lang.get("messages.new_saved_reply"),'no_footer':true,'on_show':'showSaveThisReply'});}
e.preventDefault();}})]);var obj=button.render();obj.children().find('.sr-li-search:first input:first').on("keyup",function(){srSearch($(this)[0]);});return obj;}
var SrEditorAttachmentButton=function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-paperclip"></i>',tooltip:Lang.get("messages.upload_attachments"),className:'note-btn-attachment',container:'body',click:function(e){var att_container=$(e.target).parents('.form-group:first').next().children().find('.sr-attachments-upload:first');var element=document.createElement('div');element.innerHTML='<input type="file" multiple>';var fileInput=element.firstChild;fileInput.addEventListener('change',function(){if(fileInput.files){for(var i=0;i<fileInput.files.length;i++){editorSendFile(fileInput.files[i],true,true,'',att_container);}}});fileInput.click();}});return button.render();}
fs_conv_editor_buttons['savedreplies']=EditorSavedRepliesButton;fs_conv_editor_toolbar[0][1].push('savedreplies');function initSavedReplies(){$(document).ready(function(){$('.saved-reply-save').click(function(e){var saved_reply_id=$(this).attr('data-saved_reply_id');var name=$('#saved-reply-'+saved_reply_id+' :input[name="name"]').val();var button=$(this);var attachments_all=srMapInputToArray($(this).parents('.panel-body:first').children().find(':input[name="attachments_all[]"]'));var attachments=srMapInputToArray($(this).parents('.panel-body:first').children().find(':input[name="attachments[]"]'));button.button('loading');fsAjax({action:'update',saved_reply_id:saved_reply_id,name:name,attachments_all:attachments_all,attachments:attachments,parent_saved_reply_id:$('#saved-reply-'+saved_reply_id+' :input[name="parent_saved_reply_id"]').val(),text:$('#saved-reply-'+saved_reply_id+' :input[name="text"]').val()},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.msg_success)!="undefined"){showFloatingAlert('success',response.msg_success);$('#saved-reply-'+saved_reply_id+' .panel-title a:first span:first span').text(name);if(typeof(response.refresh)!="undefined"&&response.refresh){window.location.href='';}}else{showAjaxError(response);}
button.button('reset');loaderHide();});});$(".sr-delete-trigger").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.confirm_delete_saved_reply"),'sr-delete-ok',{on_show:function(modal){var saved_reply_id=button.attr('data-saved_reply_id');modal.children().find('.sr-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',saved_reply_id:saved_reply_id},laroute.route('mailboxes.saved_replies.ajax'),function(response){showAjaxResult(response);button.button('reset');if($('#saved-reply-'+saved_reply_id+' .panel-sortable:first').length){window.location.href='';}else{$('#saved-reply-'+saved_reply_id).remove();}});});}},Lang.get("messages.delete"));e.preventDefault();});if($('.saved-replies-tree').length){var elements=sortable('.saved-replies-tree',{handle:'.handle',});for(var i in elements){elements[i].addEventListener('sortupdate',function(e){var saved_replies=[];$(e.target).children('.panel').each(function(idx,el){saved_replies.push($(this).attr('data-saved-reply-id'));});fsAjax({action:'update_sort_order',saved_replies:saved_replies,},laroute.route('mailboxes.saved_replies.ajax'),function(response){showAjaxResult(response);});});}}
$('.panel.panel-sortable').on('show.bs.collapse',function(e){summernoteInit('#'+e.currentTarget.id+' .saved-reply-text',{minHeight:250,insertVar:true,toolbar:srGetEditorToolbar(),buttons:{insertvar:EditorInsertVarButton,attachment:SrEditorAttachmentButton,removeformat:EditorRemoveFormatButton,lists:EditorListsButton}});})
$('li.attachment-loaded .glyphicon-remove').click(function(e){removeAttachment($(this).parents('li.attachment-loaded:first').attr('data-attachment-id'));});});}
function srGetEditorToolbar(){var toolbar=JSON.parse(JSON.stringify(fs_conv_editor_toolbar));toolbar.push(['actions-select',['insertvar']]);return fsApplyFilter('conversation.editor_toolbar',toolbar);}
function initNewSavedReply(jmodal){$(document).ready(function(){var toolbar=fs_conv_editor_toolbar;summernoteInit('.modal-dialog .new-saved-reply-editor:visible:first textarea:first',{minHeight:250,insertVar:true,toolbar:srGetEditorToolbar(),buttons:{insertvar:EditorInsertVarButton,attachment:SrEditorAttachmentButton,removeformat:EditorRemoveFormatButton,lists:EditorListsButton}});$('.modal-content .new-saved-reply-save:first').click(function(e){var button=$(this);button.button('loading');var name=$(this).parents('.modal-content:first').children().find(':input[name="name"]').val();var text=$(this).parents('.modal-content:first').children().find(':input[name="text"]').val();var attachments_all=srMapInputToArray($(this).parents('.modal-content:first').children().find(':input[name="attachments_all[]"]'));var attachments=srMapInputToArray($(this).parents('.modal-content:first').children().find(':input[name="attachments[]"]'));fsAjax({action:'create',mailbox_id:getGlobalAttr('mailbox_id'),from_reply:getGlobalAttr('conversation_id'),name:name,text:text,attachments_all:attachments_all,attachments:attachments,parent_saved_reply_id:$(this).parents('.modal-content:first').children().find(':input[name="parent_saved_reply_id"]').val(),},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.id)!="undefined"&&response.id){if(typeof(response.msg_success)!="undefined"&&response.msg_success){jmodal.modal('hide');showFloatingAlert('success',response.msg_success);loaderHide();var li_html='<li><a href="#" data-value="'+response.id+'">'+htmlEscape(name)+'</a></li>';$('.form-reply:first:visible .dropdown-saved-replies:first').children('li:last').prev().before(li_html);}else{window.location.href='';}}else{showAjaxError(response);loaderHide();button.button('reset');}});});});}
function srMapInputToArray(inputs){return inputs.map(function(){return $(this).val();}).get();}
function showSaveThisReply(jmodal){$('.modal-dialog .new-saved-reply-editor:visible:first textarea[name="text"]:first').val(getReplyBody());initNewSavedReply(jmodal);}
function srSearch(el){var expand_parents=[];var input=$(el);var q=input.val().toLowerCase();var lis=input.parents('.dropdown-saved-replies:first').children('li:gt(0)');var items=lis.find('a[data-value!=""]:not(.sr-cat)');if(q.length<1){lis.filter(':not([data-parents])').removeClass('hidden');lis.filter('[data-parents]').addClass('hidden');}else{$(items).each(function(i,el){var item=$(el);if(item.text().toLowerCase().indexOf(q)!=-1){item.parent().removeClass('hidden');var data_parents=$(el).parent().attr('data-parents');if(data_parents){var parents=data_parents.split(',');expand_parents=expand_parents.concat(parents);}}else{item.parent().addClass('hidden');}});if(expand_parents.length){var values='';for(var i in expand_parents){lis.find('a.sr-cat[data-value="'+expand_parents[i]+'"]').parent().removeClass('hidden');}
$(lis.find('a.sr-cat')).each(function(i,el){var cat=$(el);if(expand_parents.indexOf(cat.attr('data-value'))==-1&&!cat.hasClass('hidden')){cat.parent().addClass('hidden');}});}else{lis.find('a.sr-cat').parent().addClass('hidden');}}}
function scInit(){$(document).ready(function(){$('.sc-reply-submit:first').click(function(e){$('.note-statusbar:visible:first select[name="status"]:first').val(3);$(".btn-reply-submit:first").click();});});}
(function(){var module_routes=[{"uri":"conversation\/snooze\/ajax","name":"snooze.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function snoozeInitModal(jmodal){$(document).ready(function(){var datepicker=$('.snooze-datetime:visible').flatpickr({enableTime:true,minDate:"today",static:true,onChange:function(selectedDates,dateStr,instance){$('.snooze-btn:visible:first').removeAttr('disabled');}});$('.snooze-datetime-trigger:visible').click(function(e){datepicker.toggle();});$('.snooze-btn:visible:first').click(function(e){var snooze_date=$('.snooze-datetime:visible').val();if(!snooze_date){return;}
var button=$(this);button.button('loading');fsAjax({'action':'snooze','conversation_id':getGlobalAttr('conversation_id'),'snooze_date':snooze_date},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){if(convGetStatus()!=FS_STATUS_CLOSED){$('.conv-status:first a[data-status="'+FS_STATUS_CLOSED+'"]').click();}else{reloadPage();}}else{showAjaxError(response);button.button('reset');}
loaderHide();},true);e.preventDefault();});$('.snooze-cancel:visible:first').click(function(e){jmodal.modal('hide');});$('.snooze-apply:visible:first').click(function(e){var button=$(e.target);if(button.hasClass('glyphicon')){button=button.parent();}
button.button('loading');fsAjax({'action':'calc','number':$('.snooze-number:visible:first').val(),'period':$('.snooze-period:visible:first').val()},laroute.route('snooze.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){$('.snooze-datetime:visible').val(response.datetime);$('.snooze-btn:visible:first').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});});}
function snoozeSnooze(thread_id){var button=$('#thread-'+thread_id+' .snooze-send-now:first').button('loading');fsAjax({'action':'send_now','thread_id':thread_id},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{button.button('reset');showAjaxError(response);}
loaderHide();},false,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();button.button('reset');});return false;}
function snoozeUnsnooze(){var button=$('.snooze-unsnooze:first').button('loading');fsAjax({'action':'unsnooze','conversation_id':getGlobalAttr('conversation_id')},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{button.button('reset');showAjaxError(response);}
loaderHide();});return false;}
function snoozeInit(){$(document).ready(function(){$('a.snooze-unsnooze').click(function(e){snoozeUnsnooze();e.preventDefault();});});}
(function(){var module_routes=[{"uri":"app-settings\/spamfilter\/ajax","name":"spam_filter.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initSpamFilterSettings(){$(document).ready(function(){$('#spam-filter-reset').click(function(e){var button=$(this);var data={action:'reset',mailbox_id:$('#stat-memory').val()};button.button('loading');fsAjax(data,laroute.route('spam_filter.ajax'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){location.reload();}});e.preventDefault();});});}
(function(){var module_routes=[{"uri":"tags\/ajax","name":"tags.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initConvTags(remove_title){$(document).ready(function(){initTagSelector('.conv-add-tags:first',remove_title);initRemoveTags();});}
function initTagSelector(selector,remove_title){$(selector).click(function(e){$("#add-tag-wrap .tag-input:not(.select2-hidden-accessible)").select2({dropdownCssClass:"select2-multi-dropdown",containerCssClass:"select2-tag-input",multiple:true,width:'100%',minimumInputLength:1,tags:true,tokenSeparators:[",",", "],ajax:{url:laroute.route('tags.ajax'),dataType:'json',delay:250,cache:true,data:function(params){var page=1;if(typeof(params.page)!="undefined"){page=params.page;}
return{q:params.term,action:'autocomplete',page:page};}},createTag:function(params){return{id:params.term,text:params.term,newOption:true}},templateResult:function(data){var $result=$("<span></span>");$result.text(data.text);if(data.newOption){$result.append(" <em>("+Lang.get("messages.add_lower")+")</em>");}
return $result;},}).on('select2:closing',function(e){var params=e.params;var select=$(e.target);var value=select.next('.select2:first').children().find('.select2-search__field:first').val();value=value.trim();if(!value){return;}
if(params&&params.args&&params.args.originalSelect2Event!=null){var event=params.args.originalSelect2Event;if(event._type==='select'||event._type==='unselect'){return;}}
var data=select.select2('data');for(i in data){if(data[i].id==value){return;}}
addSelect2Option(select,{id:value,text:value,selected:true});});$("#add-tag-wrap .select2-selection").on("click",function(){return false;});if($('#form-create').length){fs_reply_changed=true;saveDraft(false,true);}
setTimeout(function(){$("#add-tag-wrap .tag-input").select2('open');$('.select2-search__field').focus();},100);});$('#add-tag-wrap .btn').click(function(e){addTag(remove_title);e.preventDefault();e.stopPropagation();$('.conv-add-tags:visible:first').dropdown('toggle');});}
function initRemoveTags(){$('#conv_tags .tag-remove').click(function(e){var tag_name=$(this).parent().children('.tag-name:first').text();$(this).parent().remove();fsAjax({action:'remove',tag_name:tag_name,conversation_id:getGlobalAttr('conversation_id')},laroute.route('tags.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){}else{showAjaxError(response);}},true);e.preventDefault();});}
function addTag(remove_title){var input=$('#add-tag-wrap .tag-input:first');var button=$('#add-tag-wrap .btn:first');var tag_names=input.val();if(!tag_names.length){return;}
for(i in tag_names){tag_names[i]=tag_names[i].trim();}
$('#conv_tags .tag-name').each(function(i,el){if($(el).text()==tag_names[i]){delete tag_names[i];}});if(!tag_names.length){return;}
input.attr('disabled','disabled');button.attr('disabled','disabled');var conversation_id=getGlobalAttr('conversation_id');var is_bulk=false;if(!conversation_id){conversation_id=getSelectedConversations();is_bulk=true;}
fsAjax({action:'add',tag_names:tag_names,conversation_id:conversation_id},laroute.route('tags.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.tags)!="undefined"&&response.tags){var html='';for(i in response.tags){tag=response.tags[i];if(!is_bulk){html+='<span class="tag"><a class="tag-name" href="'+tag.url+'" target="_blank">'+htmlEscape(tag.name)+'</a> <a class="tag-remove" href="#" title="'+remove_title+'">×</a></span>';}else{html+='<span class="tag">'+htmlEscape(tag.name)+'</span>';}}
if(!is_bulk){$('#conv_tags').append(html);}else if($.isArray(conversation_id)){for(i in conversation_id){var tags_container=$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-tags');if(tags_container.length){$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-tags').append(html);}else{$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-subject p:first').prepend('<span class="conv-tags">'+html+'</span>');}}}
initRemoveTags();}else{showAjaxError(response);}
input.removeAttr('disabled');input.children().prop("selected",false);input.trigger("change");button.removeAttr('disabled');},true,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));input.removeAttr('disabled').val('');button.removeAttr('disabled');});}
function initTagsBulk(){$(document).ready(function(){initTagSelector('#conversations-bulk-actions .conv-add-tags:first','');$('.table-conversations .tag').click(function(e){var url=$(this).attr('data-tag-url');if(url){window.open(url,'_blank').focus();e.preventDefault();}});});}
function initEditTag(jmodal){$(document).ready(function(){$('.tag-update-form').on('submit',function(e){var tag_id=$(this).attr('data-tag-id');var data=$(this).serialize();data+='&tag_id='+tag_id;data+='&action=update';var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('tags.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();});$('.tag-update-form .tag-delete-forever:first').click(function(e){var form=$(this).parents('.tag-update-form:first');var tag_id=form.attr('data-tag-id');var button=$(this);showModalConfirm(form.attr('data-confirm-delete'),'tag-confirm-delete',{on_show:function(modal){modal.children().find('.tag-confirm-delete:first').click(function(e){button.button('loading');modal.modal('hide');var data={action:'delete_forever',tag_id:tag_id};fsAjax(data,laroute.route('tags.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}
loaderHide();},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('.tag-update-form:visible .tag-colors a').click(function(e){$('.tag-update-form:visible .tag-colors a').removeClass('active');$(this).addClass('active');$('.tag-update-form:visible [name="color"]:first').val($(this).attr('data-color'));e.preventDefault();});});}
(function(){var module_routes=[{"uri":"teams","name":"teams.teams"},{"uri":"teams\/ajax","name":"teams.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function teamUpdateInit(){$(document).ready(function(){$("#team-delete").click(function(e){var confirm_html=$('#team_delete_modal').html();showModalDialog(confirm_html,{width_auto:false,on_show:function(modal){modal.children().find('.input-delete-user:first').on('keyup keypress',function(e){if($(this).val()=='DELETE'){modal.children().find('.button-delete-team:first').removeAttr('disabled');}else{modal.children().find('.button-delete-team:first').attr('disabled','disabled');}});modal.children().find('.button-delete-team:first').click(function(e){var data=$('.team-assign-form:visible:first').serialize();if(data){data+='&';}
data+='action=delete_team';data+='&team_id='+getGlobalAttr('team_id');modal.modal('hide');fsAjax(data,laroute.route('teams.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=laroute.route('teams.teams');return;}else{showAjaxError(response);}
loaderHide();});e.preventDefault();});}});});});}
(function(){var module_routes=[{"uri":"ticket-translator\/ajax","name":"ticket_translator.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();$(document).ready(function(){$('#conv-layout-main .ttr-toggle').click(function(e){toggleTranslation($(this).attr('data-thread-id'),$(this).attr('data-locale'));e.preventDefault();});});function translateThread(el){var button=$(el);button.button('loading');var thread_id=button.parents('.modal-content:first').children().find('.input-translate-thread-id:first').val();var from=button.parents('.modal-content:first').children().find('.input-translate-from:first').val();var into=button.parents('.modal-content:first').children().find('.input-translate-into:first').val();fsAjax({action:'translate',thread_id:thread_id,from:from,into:into},laroute.route('ticket_translator.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);ajaxFinish();}},true);}
function toggleTranslation(thread_id,locale){var trigger=$('#thread-'+thread_id+' .translation-trigger-'+locale+':first');var text=$('#thread-'+thread_id+' .translation-'+locale+':first');if(text.is(':visible')){text.addClass('hidden');trigger.removeClass('selected');trigger.children('.caret:first').addClass('hidden');}else{$('#thread-'+thread_id+' .translation-text').addClass('hidden');$('#thread-'+thread_id+' .translation-triggers .caret').addClass('hidden');$('#thread-'+thread_id+' .translation-triggers a').removeClass('selected');text.removeClass('hidden');trigger.addClass('selected');trigger.children('.caret:first').removeClass('hidden');}}
function initTranslateModal(){$(document).ready(function(){$('.modal-body:visible .ttr-translate:first').click(function(e){translateThread($(this)[0]);});});}
(function(){var module_routes=[{"uri":"time-tracking\/ajax","name":"time_tracking.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var timetracking_time=-1;var timetracking_total_time=-1;var timetracking_interval=null;function initTimeTracking(timelog_dialog){$(document).ready(function(){$('#timelogs-trigger').click(function(e){$('#timelogs').toggleClass('hidden');e.preventDefault();});$('#timetr-pause').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
fsAjax({action:'pause',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetrStopTimer();$('#timetr-pause').addClass('disabled').attr('disabled','disabled');$('#timetr-start').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});$('#timetr-start').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
fsAjax({action:'start',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetrStartTimer();$('#timetr-start').addClass('disabled').attr('disabled','disabled');$('#timetr-pause').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});$('#timetr-add').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
button.button('loading');timetrShowDialog(function(){button.button('reset');reloadPage();},function(modal){button.button('reset');modal.modal('hide');});});$('#timetr-reset').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
button.button('loading');fsAjax({action:'reset',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetracking_time=0;timetracking_total_time=response.time_spent;timetrStopTimer();timetrStartTimer();$('#timetr-start').addClass('disabled').attr('disabled','disabled');$('#timetr-pause').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
button.button('reset');loaderHide();});});$('.timetr-log-value').click(function(e){var span=$(this);span.hide();var time_spent=span.attr('data-time-spent');var html='<div>';html+='<input type="number" value="'+timetrFormatTime(time_spent,'hours',true)+'" class="form-control timetr-edit-value timetr-edit-h" /> : ';html+='<input type="number" value="'+timetrFormatTime(time_spent,'minutes',true)+'" class="form-control timetr-edit-value timetr-edit-m" /> : ';html+='<input type="number" value="'+timetrFormatTime(time_spent,'seconds',true)+'" class="form-control timetr-edit-value timetr-edit-s" /> &nbsp;';html+='<button class="btn btn-sm btn-primary timetr-edit-value timetr-save-timelog" type="button" data-loading-text="…"><i class="glyphicon glyphicon-ok"></i></button>';html+='</div>';$(html).insertAfter(span);$('.timetr-save-timelog').click(function(e){timetrSaveTimelog($(this)[0]);});});if(timelog_dialog){fsAddFilter('conversation.can_change_user',function(value,params){if(!value){return value;}
if(getGlobalAttr('auth_user_id')==getConvData('user_id')&&getGlobalAttr('auth_user_id')!=params.trigger.attr('data-user_id')&&timetracking_time){timetrShowDialog(function(){params.trigger.trigger('fs-conv-user-change');});}else{params.trigger.trigger('fs-conv-user-change');}},999);fsAddFilter('conversation.can_change_status',function(value,params){if(!value){return value;}
var status=params.trigger.attr('data-status');if((status==3||status==4)&&getGlobalAttr('auth_user_id')==getConvData('user_id')&&timetracking_time){timetrShowDialog(function(){params.trigger.trigger('fs-conv-status-change');});}else{params.trigger.trigger('fs-conv-status-change');}},999);fsAddFilter('conversation.can_submit',function(value,params){if(!value||typeof(params)=="undefined"||typeof(params.trigger)=="undefined"){return value;}
var conv_status=convGetStatus();if(conv_status==3||conv_status==4){return value;}
var status=$('.note-statusbar:first select[name="status"]:first').val();if((status==3||status==4)&&getGlobalAttr('auth_user_id')==getConvData('user_id')&&timetracking_time&&!$(params.trigger).attr('data-timetr-submit')){fs_send_reply_allowed=false;timetrShowDialog(function(){fs_send_reply_allowed=true;$(params.trigger).attr('data-timetr-submit','1');params.trigger.click();});return false;}else{return true;}},999);}
var block=$('#time-tracking');if(block&&block.attr('data-paused')!='1'){timetrStartTimer();}else{if(timetracking_time==-1){timetracking_time=parseInt($('#time-tracking').attr('data-current-time'));}}});}
function timetrShowDialog(callback,cancel_callback){var modal_html='<div>'+'<div class="margin-top-10">'+Lang.get("messages.timetr_modal_text")+'</div>'+'<div class="timetr-edit-time">'+'<input type="number" class="hours input-lg" size="3" min="0" value="'+timetrFormatTime(timetracking_time,'hours')+'"/> : '+'<input type="number" class="minutes input-lg" min="0" max="60" value="'+timetrFormatTime(timetracking_time,'minutes')+'"/> : '+'<input type="number" class="seconds input-lg" min="0" max="60" value="'+timetrFormatTime(timetracking_time,'seconds')+'"/>'+'<div class="timetr-hhmmss">'+'(HH:mm:ss)'+'</div>'+'</div>'+'</div>';var footer_html='<button class="btn btn-link timetr-cancel" data-loading-text="'+Lang.get("messages.cancel")+'…">'+Lang.get("messages.cancel")+'</button>'+'<button class="btn btn-primary timetr-submit-time" data-loading-text="'+Lang.get("messages.submit_time")+'…">'+Lang.get("messages.submit_time")+'</button>';showModalDialog(modal_html,{title:Lang.get("messages.time_tracking"),no_close_btn:Lang.get("messages.time_tracking"),footer:footer_html,no_header:false,no_footer:false,width_auto:false,no_close_btn:true,on_show:function(modal){modal.children().find('.timetr-submit-time:first').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'submit_time',conversation_id:getGlobalAttr('conversation_id'),hours:modal.children().find('.hours:first').val(),minutes:modal.children().find('.minutes:first').val(),seconds:modal.children().find('.seconds:first').val()},laroute.route('time_tracking.ajax'),function(response){showAjaxResult(response);button.button('reset');modal.modal('hide');callback();},true,function(response){showAjaxResult(response);modal.modal('hide');callback();});});modal.children().find('.timetr-cancel:first').click(function(e){if(typeof(cancel_callback)!="undefined"){cancel_callback(modal);return;}
var button=$(this);button.button('loading');fsAjax({action:'cancel',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){showAjaxResult(response);button.button('reset');modal.modal('hide');callback();},true,function(response){showAjaxResult(response);modal.modal('hide');callback();});});}});}
function timetrStartTimer(){if(timetracking_time==-1){timetracking_time=parseInt($('#time-tracking').attr('data-current-time'));}
if(isNaN(timetracking_time)||timetracking_interval||!timetrIsActive()){return;}
if(timetracking_total_time==-1){timetracking_total_time=parseInt($('#time-tracking').attr('data-total-time'));if(isNaN(timetracking_total_time)){timetracking_total_time=0;}}
timetracking_interval=setInterval(function(){timetracking_time+=1;timetracking_total_time+=1;timetrRenderTimer();},1000);}
function timetrIsActive(){return $('#timetr-time').length;}
function timetrStopTimer(){clearInterval(timetracking_interval);timetracking_interval=null;}
function timetrRenderTimer(){if(timetracking_time==-1||isNaN(timetracking_time)){return;}
var time=timetrFormatTime(timetracking_time);$('#timetr-time').text(time);var time=timetrFormatTime(timetracking_total_time);$('#timetr-total').text(time);}
function timetrFormatTime(timestamp,hms,no_pad){var hours=Math.floor(timestamp / 3600);var minutes=Math.floor((timestamp / 60)%60);var seconds=timestamp%60;if(typeof(no_pad)=="undefined"){hours=timetrPadStart(hours,2,'0');minutes=timetrPadStart(minutes,2,'0');seconds=timetrPadStart(seconds,2,'0');}
if(typeof(hms)!="undefined"){if(hms=='hours'){return hours;}else if(hms=='minutes'){return minutes;}else if(hms=='seconds'){return seconds;}}
return hours+':'+minutes+':'+seconds;}
function timetrPadStart(str,targetLength,padString){targetLength=targetLength>>0;str=str+'';padString=String((typeof padString!=='undefined'?padString:' '));if(str.length>targetLength){return String(str);}else{targetLength=targetLength-str.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}
return padString.slice(0,targetLength)+String(str);}};function timetrSaveTimelog(el){var button=$(el);var h=Math.abs(parseInt(button.parent().children('.timetr-edit-h:first').val()));var m=Math.abs(parseInt(button.parent().children('.timetr-edit-m:first').val()));var s=Math.abs(parseInt(button.parent().children('.timetr-edit-s:first').val()));if(isNaN(h)){h=0;}
if(isNaN(m)){m=0;}
if(isNaN(s)){s=0;}
var time_spent=h*3600+m*60+s;button.button('loading');fsAjax({action:'edit',time_spent:time_spent,timelog_id:button.parents('tr:first').attr('data-timelog-id')},laroute.route('time_tracking.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){button.parent().prev().attr('data-time-spent',time_spent).text(timetrFormatTime(time_spent)).show();button.parent().remove();}else{showAjaxError(response);}},true);}
(function(){var module_routes=[{"uri":"users\/2fa\/ajax","name":"twofactorauth.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initUserAuthSettings(tfa_enabled,next_page){$(document).ready(function(){if(!tfa_enabled){$('#tfa_enabled').change(function(e){if($(this).is(':checked')){window.location.href=next_page;}});}});}
(function(){var module_routes=[{"uri":"users\/fields\/ajax-admin","name":"userfields.ajax_admin"},{"uri":"users\/fields\/ajax-search","name":"userfields.ajax_search"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function ufInitUserFieldsAdmin(){$(document).ready(function(){ufInitUserFieldsForm('.uf-user-field-form','user_field_update');$(".uf-user-field-delete").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.uf_confirm_delete_user_field"),'uf-delete-ok',{on_show:function(modal){var user_field_id=button.attr('data-user_field_id');modal.children().find('.uf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'user_field_delete',user_field_id:user_field_id},laroute.route('userfields.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#uf-user-field-'+user_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#uf-user-fields-index').length){sortable('#uf-user-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var user_fields=[];$('#uf-user-fields-index > .panel').each(function(idx,el){user_fields.push($(this).attr('data-user-field-id'));});fsAjax({action:'user_field_update_sort_order',user_fields:user_fields,},laroute.route('userfields.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function ufInitNewUserField(jmodal){$(document).ready(function(){ufInitUserFieldsForm('.uf-new-user-field-form','user_field_create');});}
function ufInitUserFieldsForm(selector,action){$(selector).on('submit',function(e){var user_field_id=$(this).attr('data-user_field_id');var data=$(this).serialize();data+='&action='+action;if(user_field_id){data+='&user_field_id='+user_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('userfields.ajax_admin'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html=' '+htmlEscape(response.name)+' <small>(ID: '+user_field_id+')</small>';if(response.required){html+=' <i class="required-asterisk"></i>';}
$('#uf-user-field-'+user_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});ufApplyOptionsListeners(selector);}
function ufApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.uf_confirm_delete_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function ufInitUserFields(){$(document).ready(function(){$('.uf-cf-type-date').flatpickr({allowInput:true});ufCfInitAutosuggest();});}
function ufCfInitAutosuggest(){$('.uf-cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('userfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,user_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function ufInit(user_vars){fsAddFilter('editor.vars',function(vars){vars.user={...vars.user,...user_vars};return vars;});}
(function(){var module_routes=[{"uri":"wallboards\/ajax","name":"wallboards.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var WB_FILTERS_SEPARATOR='|';var WB_REFRESH_INTERVAL=60;function wbInit(text_delete){$(document).ready(function(){$('#wb-wallboards-list').change(function(e){window.location.href=$(this).val();});wbApplyListeners();wbShowParams();$('.wb-param li a').click(function(e){var li=$(this).parent();var param=li.parents('.wb-param').attr('data-param');if(param!='filters'){li.parent().children('li').removeClass('active');li.addClass('active');}
wbShow();e.preventDefault();});$('#wb-delete-wallboard').click(function(e){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+text_delete+'</span>','wb-confirm-delete-wallboard',{on_show:function(modal){modal.children().find('.wb-confirm-delete-wallboard:first').click(function(e){var button=$(this);button.attr('data-loading-text',Lang.get("messages.delete")+'…');button.button('loading');fsAjax({action:'delete_wallboard',wallboard_id:getGlobalAttr('wallboard_id')},laroute.route('wallboards.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';modal.modal('hide');}else{showAjaxError(response);}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('#wb-btn-refresh').click(function(e){wbShow();e.preventDefault();});$('.wb-filter-date').flatpickr();$('#wb-toolbar .wb-filter-date').change(function(e){$('#wb-date-period').val('custom');wbShow();});$('#wb-date-period').change(function(e){var option=$(this).children('option:selected');var date_from=option.attr('data-date-from');var date_to=option.attr('data-date-to');if(option.val()=='all'){$('.wb-filter-date').attr('disabled','disabled').attr('data-force-disable','1');wbShow();}else{if(option.val()!='custom'){$('#wb-toolbar .wb-filter-date[name="from"]').val(date_from);if(date_to){$('#wb-toolbar .wb-filter-date[name="to"]').val(date_to);}
wbShow();}
$('.wb-filter-date').removeAttr('disabled').removeAttr('data-force-disable');}});setInterval(function(){wbShow(true);},WB_REFRESH_INTERVAL*1000);$('#wb-wallboard')[0].addEventListener('sortupdate',function(e){var widget_ids=[];$(e.target).children('.wb-widget').each(function(index,el){widget_ids.push($(this).attr('data-widget-id'));});fsAjax({action:'move_widget',wallboard_id:getGlobalAttr('wallboard_id'),widgets:widget_ids},laroute.route('wallboards.ajax'),function(response){showAjaxResult(response);},true);});});}
function wbApplyListeners(){$('.wb-more').off('click').click(function(e){knLoadRows($(this),false);});initModals('div');$('.wb-widget-footer a').off('click').click(function(e){e.stopPropagation();});sortable('#wb-wallboard',{handle:'.wb-widget-header',items:'.wb-widget',forcePlaceholderSize:true});}
function wbGetParams(){var params={};params.wallboard_id=getGlobalAttr('wallboard_id');params.filters={};params.filters.date={};params.filters.date.period=$('#wb-date-period').val();params.filters.date.from=$('#wb-toolbar .wb-filter-date[name="from"]').val();params.filters.date.to=$('#wb-toolbar .wb-filter-date[name="to"]').val();return params;}
function wbShowParams(){$('.wb-param-counter').each(function(i,el){var j_el=$(el);var count=j_el.parents('.wb-param:first').children('ul:first').children('li.active').length;if(!count){j_el.text('');}else{j_el.text(' ('+count+')');}});}
function wbShow(no_toolbar_disable){var btn_refresh=$('#wb-btn-refresh i:first');if(btn_refresh.hasClass('glyphicon-spin')){return;}
btn_refresh.addClass('glyphicon-spin');if(typeof(no_toolbar_disable)=="undefined"){toolbar=$('#wb-toolbar :input[data-force-disable!="1"]');}else{toolbar=$('#does_not_exist');}
toolbar.attr('disabled','disabled');fsAjax({action:'show',wb:wbGetParams()},laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)&&response.html){$('#wb-wallboard').html(response.html);wbApplyListeners();initModals();initTooltips();}else{showAjaxResult(response);}
loaderHide();btn_refresh.removeClass('glyphicon-spin');toolbar.removeAttr('disabled');},false,function(response){showAjaxResult(response);loaderHide();btn_refresh.removeClass('glyphicon-spin');toolbar.removeAttr('disabled');});}
function wbInitWallboardModal(){$(document).ready(function(){$('.wb-wallboard-name:visible:first').focus();$('.wb-wallboard-form:visible:first').on('submit',function(e){var wallboard_id=$(this).attr('data-wallboard-id');var data=$(this).serialize();if(wallboard_id){data+='&wallboard_id='+wallboard_id;data+='&action=update_wallboard';}else{data+='&action=new_wallboard';}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(wallboard_id){window.location.href='';}else{window.location.href=response.wallboard_url;}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});});}
function wbInitWidgetModal(){$(document).ready(function(){if(!$('.wb-widget-form:visible:first .wb-widget-submit:first').length){$('.wb-widget-form:visible:first :input').attr('disabled','disabled');}
$('.wb-widget-form-title:visible:first').focus();$('.wb-widget-form:visible:first').on('submit',function(e){var widget_id=$(this).attr('data-widget-id');var data=$(this).serialize();if(widget_id){data+='&action=update_widget';}else{data+='&action=new_widget';}
var button=$(this).children().find('.wb-widget-submit:first');button.button('loading');fsAjax(data,laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
wbShow();$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});$('#wb-delete-widget').click(function(e){var button=$(this);showModalConfirm(wb_text_delete_card,'wb-confirm-delete-widget',{on_show:function(modal){modal.children().find('.wb-confirm-delete-widget:first').click(function(e){button.button('loading');modal.modal('hide');var widget_id=button.parents('.wb-widget-form:first').attr('data-widget-id');fsAjax({action:'delete_widget',wallboard_id:getGlobalAttr('wallboard_id'),widget_id:widget_id},laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
$('.modal:visible').modal('hide');wbShow();}else{showAjaxError(response);button.button('reset');}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('.wb-filter-mailbox:visible:first').change(function(e){var mailbox_id=$(this).val();if(mailbox_id){$('.modal-body .wb-mailbox-filter').hide();$('.modal-body .wb-mailbox-filter[data-mailbox-id="'+mailbox_id+'"]').show();}else{$('.modal-body .wb-mailbox-filter').show();}
$('.modal-body .wb-mailbox-filter:hidden :input').val('');}).change();$('.wb-type-date').flatpickr();initTooltips();});}
function wbInitFilterModal(){$(document).ready(function(){$('.wb-type-date:visible').flatpickr({allowInput:true});$('.wb-filter-form:visible:first').on('submit',function(e){var fields=$(this).serializeArray();var filter=$(this).children(':input[name="filter"]').val();var selected=[];var cf_data={};for(var i in fields){if(filter=='custom_field'){matches=fields[i].name.match(/selected\[op\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['op']=fields[i].value;}
matches=fields[i].name.match(/selected\[value\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['value']=fields[i].value;}}else{if(fields[i].name=='selected[]'){selected.push(fields[i].value);}}}
if(filter=='custom_field'){for(var cf_id in cf_data){if(cf_data[cf_id].value!=''){selected.push(value=JSON.stringify({id:cf_id,value:cf_data[cf_id].value,op:cf_data[cf_id].op}));}}}
var li=$('.wb-param[data-param="filters"] li[data-param-name="'+filter+'"]');li.attr('data-param-value',selected.join(KN_FILTERS_SEPARATOR));var a=li.children('a:first');if(selected.length){li.addClass('active');a.children('.wb-filter-counter:first').text('('+selected.length+')');}else{li.removeClass('active');a.children('.wb-filter-counter:first').text('');}
var href=a.attr('href');href=href.replace(/&selected.*/,'');for(var i in selected){href+='&selected%5B'+i+'%5D='+encodeURIComponent(selected[i]);}
a.attr('href',href);$('.wb-reset-filter').removeClass('hidden');wbShow();wbShowParams();$('.modal:visible:first').modal('hide');e.preventDefault();return false;});});}
(function(){var module_routes=[{"uri":"mailbox/whapi/simulate","name":"mailboxes.whapi.simulate"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();$("#whapi_token_add").click(function(){var clone=$("#whapi_token_sample").clone();$(clone).find(".input_token").attr("name","settings[tokens][]").val("");$(clone).find(".input_channel_name").attr("name","settings[channels_names][]").val("");$(clone).find(".whapi_token_remove").css("display","block");$(clone).attr("id","whapi_token_sample_done");$(clone).appendTo("#whapi_token_samples");return false;});$(document).on("click",".whapi_token_remove",function(){if(confirm("Are you sure?"))$(this).closest(".whapi_token").remove();return false;});$(document).on("click",".whapiopenpopup",function(){window.open($(this).attr('href'),'popup','width=600,height=600');return false;});$("#whapi_simulate_metrics").click(function(){$.ajax({url:laroute.route('mailboxes.whapi.simulate'),}).done(function(msg){alert(msg);});return false;});(function(){var module_routes=[{"uri":"woocommerce\/ajax","name":"woocommerce.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var wc_customer_emails=[];function initWooCommerce(customer_emails,load){wc_customer_emails=customer_emails;if(!Array.isArray(wc_customer_emails)){wc_customer_emails=[];}
$(document).ready(function(){if(load){wcLoadOrders();}
$('.wc-refresh').click(function(e){wcLoadOrders();e.preventDefault();});});}
function wcLoadOrders(){$('#wc-orders').addClass('wc-loading');fsAjax({action:'orders',customer_emails:wc_customer_emails,mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('woocommerce.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.html)!="undefined"&&response.html){$('#wc-orders').html(response.html);$('#wc-orders').removeClass('wc-loading');$('.wc-refresh').click(function(e){wcLoadOrders();e.preventDefault();});}else{}},true);}
(function(){var module_routes=[{"uri":"mailbox\/workflows\/ajax","name":"mailboxes.workflows.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initUpdateWorkflow(type_automatic,msg_confirm_delete){$(document).ready(function(){$('#type').change(function(e){$('.wf-type').addClass('hidden');if($(this).val()==type_automatic){$('.wf-type-auto').removeClass('hidden');$('#wf-conditions-tab').removeClass('hidden');}else{$('.wf-type-manual').removeClass('hidden');$('#wf-conditions-tab').addClass('hidden');}
wfShowProperSaveButtons();});$('#apply_to_prev').change(function(e){if($(this).is(':checked')){$('#apply-to-prev-alert').removeClass('hidden');}else{$('#apply-to-prev-alert').addClass('hidden');}
wfShowProperSaveButtons();});$('#active').change(function(e){wfShowProperSaveButtons();});wfShowProperSaveButtons();$('.wf-block-and-trigger').click(function(e){var clone=$(this).parents('.wf-blocks:first').children().find('.wf-and-block:first').clone();clone.removeAttr('data-applied');var children=clone.children();children.find('.wf-or-block:gt(0)').remove();children.find('.wf-or-block').removeAttr('data-applied').removeClass('has-error');wfResetInputs(children);children.find('.wf-block-operator').addClass('hidden');children.find('.wf-block-value').addClass('hidden');children.find('.select2').remove();clone.appendTo($(this).parent().prev());wfChangeNames(children.find('.wf-or-block'),true);wfApplyBlockListeners();});wfApplyBlockListeners();$('.wf-or-block .wf-block-type').change();$("#wf-delete-trigger").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'wf-delete-ok',{on_show:function(modal){var workflow_id=button.attr('data-wf_id');if(!workflow_id){return;}
modal.children().find('.wf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',workflow_id:workflow_id},laroute.route('mailboxes.workflows.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=response.redirect_url;}else{showAjaxResult(response);button.button('reset');}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function wfApplyBlockListeners(){$('.wf-or-block[data-applied!="1"] .wf-block-type').change(function(e){var val=$(this).val();var block=$(this).parents('.wf-block').children();block.find('.wf-block-operator').addClass('hidden');block.find('.wf-block-operator :input').attr('disabled','disabled');block.find('.wf-block-operator-'+val).removeClass('hidden');block.find('.wf-block-operator-'+val+' :input').removeAttr('disabled');block.find('.wf-block-value').addClass('hidden');block.find('.wf-block-value :input').attr('disabled','disabled');block.find('.wf-block-value-'+val).removeClass('hidden');block.find('.wf-block-value-'+val+' :input').removeAttr('disabled');block.find('.wf-block-operator-'+val+' select').change();});$('.wf-or-block[data-applied!="1"] .wf-block-operator select').change(function(e){var block=$(this).parents('.wf-block').children();var type=block.find('.wf-block-type:first').val();var val_wrapper=block.find('.wf-block-value-'+type);var values_visible_if=val_wrapper.attr('data-values-visible-if');if(values_visible_if){var operators=values_visible_if.split(',');if($.inArray($(this).val(),operators)!==-1){block.find('.wf-block-value-'+type).removeClass('hidden');block.find('.wf-block-value-'+type+' :input').removeAttr('disabled');}else{block.find('.wf-block-value-'+type).addClass('hidden');block.find('.wf-block-value-'+type+' :input').attr('disabled');}}
var multi_values=block.find('.wf-multi-value');if(multi_values.length){multi_values.addClass('hidden').attr('disabled','disabled');block.find('.wf-multi-value-'+$(this).val()).removeClass('hidden').removeAttr('disabled');}}).change();$('.wf-or-block[data-applied!="1"] .wf-or-block-remove').click(function(e){if($(this).parents('.wf-and-block:first').children().find('.wf-block').length==1){if($(this).parents('.wf-and-blocks:first').children('.wf-and-block').length>1){$(this).parents('.wf-and-block:first').remove();}}else{$(this).parents('.wf-block:first').remove();}});$('.wf-or-block[data-applied!="1"] .wf-block-value :input').on('keyup keypress',function(e){if($(this).val()){$(this).parents('.wf-or-block:first').removeClass('has-error');}});$('.wf-or-block[data-applied!="1"] :input.input-date').flatpickr({allowInput:true});$('.wf-or-block').attr('data-applied','1');$('.wf-and-block[data-applied!="1"] .wf-block-or-trigger').click(function(e){var clone=$(this).parents('.wf-blocks:first').children().find('.wf-or-block:first:visible').clone();clone.removeAttr('data-applied').removeClass('has-error');wfResetInputs(clone.children());clone.children().find('.wf-block-operator').addClass('hidden');clone.children().find('.wf-block-value').addClass('hidden');clone.children().find('.select2').remove();clone.appendTo($(this).parent().prev());wfChangeNames(clone,false);wfApplyBlockListeners();});$('.wf-and-block').attr('data-applied','1');$('.wf-email-modal').off('click').on('click',function(e){triggerModal($(this));e.preventDefault();});$('.wf-multiselect').select2({multiple:true,tags:true});}
function wfResetInputs(parent){parent.find(':input').val('');parent.find('select').prop("selectedIndex",0);}
function wfChangeNames(block,adding_and){var and_index=0;if(typeof(adding_and)!="undefined"&&adding_and){and_index=parseInt(block.parents('.wf-and-blocks:first').attr('data-max-index'));and_index++;block.parents('.wf-or-blocks:first').attr('data-max-index','-1');}else{and_index=block.parents('.wf-and-block:first').index();}
if(isNaN(and_index)||and_index<0){and_index=0;}
var or_index=parseInt(block.parents('.wf-or-blocks:first').attr('data-max-index'))+1;block.find('input,select').each(function(index,el){var name=$(this).attr('name');if(!name){return;}
name=name.replace(/^([^\[]+)\[[^\]]+\]\[[^\]]+\]/,'$1['+and_index+']['+or_index+']');$(this).attr('name',name);});block.parents('.wf-and-blocks:first').attr('data-max-index',and_index);block.parents('.wf-or-blocks:first').attr('data-max-index',or_index);}
function initWorkflows(){$(document).ready(function(){if($('.wf-index').length){var sortables=sortable('.wf-index',{handle:'.handle',});for(var i in sortables){sortables[i].addEventListener('sortupdate',function(e){var workflows=[];$('.wf-index > .panel').each(function(idx,el){workflows.push($(this).attr('data-wf-id'));});fsAjax({action:'update_sort_order',workflows:workflows,},laroute.route('mailboxes.workflows.ajax'),function(response){showAjaxResult(response);});});}}});}
function initWfEmailForm(modal,trigger){var values=trigger.next().val();try{values=JSON.parse(values);modal.children().find('.wf-email-input').each(function(i,el){if(typeof(values[$(this).attr('name')])!="undefined"){if($(this).is(':checkbox')){if(values[$(this).attr('name')]=='1'){$(this).prop("checked",true);}else{$(this).prop("checked",false);}}else{$(this).val(values[$(this).attr('name')]);}}});}catch(e){}
summernoteInit('.wf-email-form-editor:first',{insertVar:true,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'.wf-email-form-editor:first');}},onInit:function(){editorProcessInsertVar($('.wf-email-form-editor:first'),$(this));},}});modal.children().find('.wf-email-form:first').submit(function(e){var button=$(this).children().find('.btn-primary:first');button.button('loading');var values={};modal.children().find('.wf-email-input').each(function(i,el){if($(this).is(':checkbox')){if($(this).is(':checked')){values[$(this).attr('name')]=$(this).val();}}else{values[$(this).attr('name')]=$(this).val();}});trigger.next().val(JSON.stringify(values));e.preventDefault();modal.modal('hide');});}
function initRunWorkflow(modal){$(document).ready(function(){modal.children().find('.btn').click(function(e){wfRunManualWorkflow($(this),[getGlobalAttr('conversation_id')]);e.preventDefault();});});}
function wfRunManualWorkflow(button,conversation_ids){button.button('loading');fsAjax({action:'run',workflow_id:button.attr('data-wf-id'),conversation_id:conversation_ids,folder_id:getQueryParam('folder_id')},laroute.route('mailboxes.workflows.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.redirect_url)!="undefined"&&response.redirect_url){window.location.href=response.redirect_url;}else{window.location.href='';}}else{showAjaxResult(response);button.button('reset');}},true);}
function initWorkflowsBulk(){$(document).ready(function(){$('#bulk-workflow-list a').click(function(e){var conversation_ids=getSelectedConversations();wfRunManualWorkflow($(this),conversation_ids)
e.preventDefault();});});}
function wfShowProperSaveButtons(){var execute=false;if($('#type').val()==1){if($('#active').is(':checked')&&$('#apply_to_prev').is(':checked')){execute=true;}}else{}
$('.wf-save').addClass('hidden');if(execute){$('.wf-save-execute').removeClass('hidden');}else{$('.wf-save-save').removeClass('hidden');}}