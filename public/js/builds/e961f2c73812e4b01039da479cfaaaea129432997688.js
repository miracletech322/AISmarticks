/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function e(t){return"function"==typeof t&&"number"!=typeof t.nodeType},y=function e(t){return null!=t&&t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement("script");if(o.text=e,n)for(i in v)n[i]&&(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[c.call(e)]||"object":typeof e}var b="3.3.1",w=function(e,t){return new w.fn.init(e,t)},T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.fn=w.prototype={jquery:"3.3.1",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||g(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&&(l&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&&Array.isArray(n)?n:[]):o=n&&w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},w.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==c.call(e))&&(!(t=i(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(C(Object(e))?w.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o<a;o++)(r=!t(e[o],o))!==s&&i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a.apply([],s)},guid:1,support:h}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function C(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!g(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&&(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",I="\\["+M+"*("+R+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+M+"*\\]",W=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+I+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),F=new RegExp("^"+M+"*,"+M+"*"),_=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),z=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),X=new RegExp(W),U=new RegExp("^"+R+"$"),V={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+W),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},G=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ee=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){p()},ie=me(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{L.apply(A=H.call(w.childNodes),w.childNodes),A[w.childNodes.length].nodeType}catch(e){L={apply:A.length?function(e,t){q.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function oe(e,t,r,i){var o,s,l,c,f,h,v,m=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&((t?t.ownerDocument||t:w)!==d&&p(t),t=t||d,g)){if(11!==T&&(f=J.exec(e)))if(o=f[1]){if(9===T){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(m&&(l=m.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return L.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return L.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!S[e+" "]&&(!y||!y.test(e))){if(1!==T)m=t,v=e;else if("object"!==t.nodeName.toLowerCase()){(c=t.getAttribute("id"))?c=c.replace(te,ne):t.setAttribute("id",c=b),s=(h=a(e)).length;while(s--)h[s]="#"+c+" "+ve(h[s]);v=h.join(","),m=K.test(e)&&ge(t.parentNode)||t}if(v)try{return L.apply(r,m.querySelectorAll(v)),r}catch(e){}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace(B,"$1"),t,r,i)}function ae(){var e=[];function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}return t}function se(e){return e[b]=!0,e}function ue(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t){var n=e.split("|"),i=n.length;while(i--)r.attrHandle[n[i]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function de(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ie(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function he(e){return se(function(t){return t=+t,se(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}n=oe.support={},o=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},p=oe.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!==d&&9===a.nodeType&&a.documentElement?(d=a,h=d.documentElement,g=!o(d),w!==d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",re,!1):i.attachEvent&&i.attachEvent("onunload",re)),n.attributes=ue(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ue(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(d.getElementsByClassName),n.getById=ue(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],y=[],(n.qsa=Q.test(d.querySelectorAll))&&(ue(function(e){h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+M+"*(?:value|"+P+")"),e.querySelectorAll("[id~="+b+"-]").length||y.push("~="),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||y.push(".#.+[+~]")}),ue(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")})),(n.matchesSelector=Q.test(m=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ue(function(e){n.disconnectedMatch=m.call(e,"*"),m.call(e,"[s!='']:x"),v.push("!=",W)}),y=y.length&&new RegExp(y.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),x=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===d||e.ownerDocument===w&&x(w,e)?-1:t===d||t.ownerDocument===w&&x(w,t)?1:c?O(c,e)-O(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===d?-1:t===d?1:i?-1:o?1:c?O(c,e)-O(c,t):0;if(i===o)return ce(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?ce(a[r],s[r]):a[r]===w?-1:s[r]===w?1:0},d):d},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==d&&p(e),t=t.replace(z,"='$1']"),n.matchesSelector&&g&&!S[t+" "]&&(!v||!v.test(t))&&(!y||!y.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return oe(t,d,null,[e]).length>0},oe.contains=function(e,t){return(e.ownerDocument||e)!==d&&p(e),x(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&N.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},oe.escape=function(e){return(e+"").replace(te,ne)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(D),f){while(t=e[o++])t===e[o]&&(i=r.push(o));while(i--)e.splice(r[i],1)}return c=null,e},i=oe.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},(r=oe.selectors={cacheLength:50,createPseudo:se,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Z,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Z,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return V.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Z,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=oe.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace($," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",y=t.parentNode,v=s&&t.nodeName.toLowerCase(),m=!u&&!s,x=!1;if(y){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?y.firstChild:y.lastChild],a&&m){x=(d=(l=(c=(f=(p=y)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&y.childNodes[d];while(p=++d&&p&&p[g]||(x=d=0)||h.pop())if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(m&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)while(p=++d&&p&&p[g]||(x=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===v:1===p.nodeType)&&++x&&(m&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p===t))break;return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,n){var r,o=i(e,t),a=o.length;while(a--)e[r=O(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:se(function(e){var t=[],n=[],r=s(e.replace(B,"$1"));return r[b]?se(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:se(function(e){return function(t){return oe(e,t).length>0}}),contains:se(function(e){return e=e.replace(Z,ee),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:se(function(e){return U.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(Z,ee).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:de(!1),disabled:de(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he(function(){return[0]}),last:he(function(e,t){return[t-1]}),eq:he(function(e,t,n){return[n<0?n+t:n]}),even:he(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:he(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:he(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:he(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ye(){}ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,a=oe.tokenize=function(e,t){var n,i,o,a,s,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=r.preFilter;while(s){n&&!(i=F.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=_.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace(B," ")}),s=s.slice(n.length));for(a in r.filter)!(i=V[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?oe.error(e):k(e,u).slice(0)};function ve(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function me(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){while(t=t[r])if((1===t.nodeType||a)&&e(t,n,u))return!0}else while(t=t[r])if(1===t.nodeType||a)if(f=t[b]||(t[b]={}),c=f[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function be(e,t,n){for(var r=0,i=t.length;r<i;r++)oe(e,t[r],n);return n}function we(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Te(e,t,n,r,i,o){return r&&!r[b]&&(r=Te(r)),i&&!i[b]&&(i=Te(i,o)),se(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||be(t||"*",s.nodeType?[s]:s,[]),y=!e||!o&&t?g:we(g,p,e,s,u),v=n?i||(o?e:h||r)?[]:a:y;if(n&&n(y,v,s,u),r){l=we(v,d),r(l,[],s,u),c=l.length;while(c--)(f=l[c])&&(v[d[c]]=!(y[d[c]]=f))}if(o){if(i||e){if(i){l=[],c=v.length;while(c--)(f=v[c])&&l.push(y[c]=f);i(null,v=[],l,u)}c=v.length;while(c--)(f=v[c])&&(l=i?O(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else v=we(v===a?v.splice(h,v.length):v),i?i(null,a,v,u):L.apply(a,v)})}function Ce(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=me(function(e){return e===t},s,!0),f=me(function(e){return O(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[me(xe(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o;i++)if(r.relative[e[i].type])break;return Te(u>1&&xe(p),u>1&&ve(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(B,"$1"),n,u<i&&Ce(e.slice(u,i)),i<o&&Ce(e=e.slice(i)),i<o&&ve(e))}p.push(n)}return xe(p)}function Ee(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,y,v=0,m="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,k=C.length;for(c&&(l=a===d||a||c);m!==k&&null!=(f=C[m]);m++){if(i&&f){h=0,a||f.ownerDocument===d||(p(f),s=!g);while(y=e[h++])if(y(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!y&&f)&&v--,o&&x.push(f))}if(v+=m,n&&m!==v){h=0;while(y=t[h++])y(x,b,a,s);if(o){if(v>0)while(m--)x[m]||b[m]||(b[m]=j.call(u));b=we(b)}L.apply(u,b),c&&!o&&b.length>0&&v+t.length>1&&oe.uniqueSort(u)}return c&&(T=E,l=w),x};return n?se(o):o}return s=oe.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=a(e)),n=t.length;while(n--)(o=Ce(t[n]))[b]?r.push(o):i.push(o);(o=S(e,Ee(i,r))).selector=e}return o},u=oe.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(Z,ee),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}o=V.needsContext.test(e)?0:u.length;while(o--){if(l=u[o],r.relative[c=l.type])break;if((f=r.find[c])&&(i=f(l.matches[0].replace(Z,ee),K.test(u[0].type)&&ge(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&ve(u)))return L.apply(n,i),n;break}}}return(p||s(e,d))(i,t,!g,n,!t||K.test(e)&&ge(t.parentNode)||t),n},n.sortStable=b.split("").sort(D).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ue(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ue(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ue(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||le("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ue(function(e){return null==e.getAttribute("disabled")})||le(P,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),oe}(e);w.find=E,w.expr=E.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=E.uniqueSort,w.text=E.getText,w.isXMLDoc=E.isXML,w.contains=E.contains,w.escapeSelector=E.escape;var k=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},D=w.expr.match.needsContext;function N(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,n){return g(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return u.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&D.test(e)?w(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:r,!0)),A.test(i[1])&&w.isPlainObject(t))for(i in t)g(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(o=r.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,q=w(r);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&w(e);if(!D.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?w.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function P(e,t){while((e=e[t])&&1!==e.nodeType);return e}w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return k(e,"parentNode")},parentsUntil:function(e,t,n){return k(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return k(e,"nextSibling")},prevAll:function(e){return k(e,"previousSibling")},nextUntil:function(e,t,n){return k(e,"nextSibling",n)},prevUntil:function(e,t,n){return k(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return N(e,"iframe")?e.contentDocument:(N(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(O[e]||w.uniqueSort(i),H.test(e)&&i.reverse()),this.pushStack(i)}});var M=/[^\x20\t\r\n\f]+/g;function R(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}w.Callbacks=function(e){e="string"==typeof e?R(e):w.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=i||e.once,r=t=!0;a.length;s=-1){n=a.shift();while(++s<o.length)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1)}e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){w.each(n,function(n,r){g(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==x(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return w.each(arguments,function(e,t){var n;while((n=w.inArray(t,o,n))>-1)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l};function I(e){return e}function W(e){throw e}function $(e,t,n,r){var i;try{e&&g(i=e.promise)?i.call(e).done(t).fail(n):e&&g(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.extend({Deferred:function(t){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},"catch":function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=g(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&g(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var o=0;function a(t,n,r,i){return function(){var s=this,u=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,g(l)?i?l.call(e,a(o,n,I,i),a(o,n,W,i)):(o++,l.call(e,a(o,n,I,i),a(o,n,W,i),a(o,n,I,n.notifyWith))):(r!==I&&(s=void 0,u=[e]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(r!==W&&(s=void 0,u=[e]),n.rejectWith(s,u))}};t?c():(w.Deferred.getStackHook&&(c.stackTrace=w.Deferred.getStackHook()),e.setTimeout(c))}}return w.Deferred(function(e){n[0][3].add(a(0,e,g(i)?i:I,e.notifyWith)),n[1][3].add(a(0,e,g(t)?t:I)),n[2][3].add(a(0,e,g(r)?r:W))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},o={};return w.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=o.call(arguments),a=w.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?o.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&($(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||g(i[n]&&i[n].then)))return a.then();while(n--)$(i[n],s(n),a.reject);return a.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&B.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var F=w.Deferred();w.fn.ready=function(e){return F.then(e)["catch"](function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(r,[w]))}}),w.ready.then=F.then;function _(){r.removeEventListener("DOMContentLoaded",_),e.removeEventListener("load",_),w.ready()}"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?e.setTimeout(w.ready):(r.addEventListener("DOMContentLoaded",_),e.addEventListener("load",_));var z=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n)){i=!0;for(s in n)z(e,t,s,n[s],!0,o,a)}else if(void 0!==r&&(i=!0,g(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(w(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},X=/^-ms-/,U=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function G(e){return e.replace(X,"ms-").replace(U,V)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Q(){this.expando=w.expando+Q.uid++}Q.uid=1,Q.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[G(t)]=n;else for(r in t)i[G(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][G(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(G):(t=G(t))in r?[t]:t.match(M)||[]).length;while(n--)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var J=new Q,K=new Q,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}function ne(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=te(n)}catch(e){}K.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return K.hasData(e)||J.hasData(e)},data:function(e,t,n){return K.access(e,t,n)},removeData:function(e,t){K.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=K.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){n=a.length;while(n--)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=G(r.slice(5)),ne(o,r,i[r]));J.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){K.set(this,e)}):z(this,function(t){var n;if(o&&void 0===t){if(void 0!==(n=K.get(o,e)))return n;if(void 0!==(n=ne(o,e)))return n}else this.each(function(){K.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){K.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=J.get(e,t),n&&(!r||Array.isArray(n)?r=J.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),o=w._queueHooks(e,t),a=function(){w.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return J.get(e,n)||J.access(e,n,{empty:w.Callbacks("once memory").add(function(){J.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=J.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+re+")([a-z%]*)$","i"),oe=["Top","Right","Bottom","Left"],ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&w.contains(e.ownerDocument,e)&&"none"===w.css(e,"display")},se=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i};function ue(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},u=s(),l=n&&n[3]||(w.cssNumber[t]?"":"px"),c=(w.cssNumber[t]||"px"!==l&&+u)&&ie.exec(w.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)w.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,w.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var le={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,i=le[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),le[r]=i,i)}function fe(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=J.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&ae(r)&&(i[o]=ce(r))):"none"!==n&&(i[o]="none",J.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}w.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;function ye(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&N(e,t)?w.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))w.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+w.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;w.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&w.inArray(o,r)>-1)i&&i.push(o);else if(l=w.contains(o.ownerDocument,o),a=ye(f.appendChild(o),"script"),l&&ve(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}!function(){var e=r.createDocumentFragment().appendChild(r.createElement("div")),t=r.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),h.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var be=r.documentElement,we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ce=/^([^.]*)(?:\.(.+)|)/;function Ee(){return!0}function ke(){return!1}function Se(){try{return r.activeElement}catch(e){}}function De(e,t,n,r,i,o){var a,s;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(s in t)De(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ke;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return w().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}w.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.get(e);if(y){n.handler&&(n=(o=n).handler,i=o.selector),i&&w.find.matchesSelector(be,i),n.guid||(n.guid=w.guid++),(u=y.events)||(u=y.events={}),(a=y.handle)||(a=y.handle=function(t){return"undefined"!=typeof w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(M)||[""]).length;while(l--)d=g=(s=Ce.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=w.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=w.event.special[d]||{},c=w.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),w.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.hasData(e)&&J.get(e);if(y&&(u=y.events)){l=(t=(t||"").match(M)||[""]).length;while(l--)if(s=Ce.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){f=w.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,y.handle)||w.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)w.event.remove(e,d+t[l],n,r,!0);w.isEmptyObject(u)&&J.remove(e,"handle events")}},dispatch:function(e){var t=w.event.fix(e),n,r,i,o,a,s,u=new Array(arguments.length),l=(J.get(this,"events")||{})[t.type]||[],c=w.event.special[t.type]||{};for(u[0]=t,n=1;n<arguments.length;n++)u[n]=arguments[n];if(t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){s=w.event.handlers.call(this,t,l),n=0;while((o=s[n++])&&!t.isPropagationStopped()){t.currentTarget=o.elem,r=0;while((a=o.handlers[r++])&&!t.isImmediatePropagationStopped())t.rnamespace&&!t.rnamespace.test(a.namespace)||(t.handleObj=a,t.data=a.data,void 0!==(i=((w.event.special[a.origType]||{}).handle||a.handler).apply(o.elem,u))&&!1===(t.result=i)&&(t.preventDefault(),t.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?w(i,this).index(l)>-1:w.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Se()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Se()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&N(this,"input"))return this.click(),!1},_default:function(e){return N(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ee:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ee,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ee,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ee,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||w.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return De(this,e,t,n,r)},one:function(e,t,n,r){return De(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ne=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ae=/<script|<style|<link/i,je=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Le(e,t){return N(e,"table")&&N(11!==t.nodeType?t:t.firstChild,"tr")?w(e).children("tbody")[0]||e:e}function He(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Oe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Pe(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(J.hasData(e)&&(o=J.access(e),a=J.set(t,o),l=o.events)){delete a.handle,a.events={};for(i in l)for(n=0,r=l[i].length;n<r;n++)w.event.add(t,i,l[i][n])}K.hasData(e)&&(s=K.access(e),u=w.extend({},s),K.set(t,u))}}function Me(e,t){var n=t.nodeName.toLowerCase();"input"===n&&pe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Re(e,t,n,r){t=a.apply([],t);var i,o,s,u,l,c,f=0,p=e.length,d=p-1,y=t[0],v=g(y);if(v||p>1&&"string"==typeof y&&!h.checkClone&&je.test(y))return e.each(function(i){var o=e.eq(i);v&&(t[0]=y.call(this,i,o.html())),Re(o,t,n,r)});if(p&&(i=xe(t,e[0].ownerDocument,!1,e,r),o=i.firstChild,1===i.childNodes.length&&(i=o),o||r)){for(u=(s=w.map(ye(i,"script"),He)).length;f<p;f++)l=i,f!==d&&(l=w.clone(l,!0,!0),u&&w.merge(s,ye(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,w.map(s,Oe),f=0;f<u;f++)l=s[f],he.test(l.type||"")&&!J.access(l,"globalEval")&&w.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?w._evalUrl&&w._evalUrl(l.src):m(l.textContent.replace(qe,""),c,l))}return e}function Ie(e,t,n){for(var r,i=t?w.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||w.cleanData(ye(r)),r.parentNode&&(n&&w.contains(r.ownerDocument,r)&&ve(ye(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e.replace(Ne,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=w.contains(e.ownerDocument,e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(a=ye(s),r=0,i=(o=ye(e)).length;r<i;r++)Me(o[r],a[r]);if(t)if(n)for(o=o||ye(e),a=a||ye(s),r=0,i=o.length;r<i;r++)Pe(o[r],a[r]);else Pe(e,s);return(a=ye(s,"script")).length>0&&ve(a,!u&&ye(e,"script")),s},cleanData:function(e){for(var t,n,r,i=w.event.special,o=0;void 0!==(n=e[o]);o++)if(Y(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[K.expando]&&(n[K.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Ie(this,e,!0)},remove:function(e){return Ie(this,e)},text:function(e){return z(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Re(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Le(this,e).appendChild(e)})},prepend:function(){return Re(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Le(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ae.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Re(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(ye(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),w(i[a])[t](n),s.apply(r,n.get());return this.pushStack(r)}});var We=new RegExp("^("+re+")(?!px)[a-z%]+$","i"),$e=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Be=new RegExp(oe.join("|"),"i");!function(){function t(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",be.appendChild(l).appendChild(c);var t=e.getComputedStyle(c);i="1%"!==t.top,u=12===n(t.marginLeft),c.style.right="60%",s=36===n(t.right),o=36===n(t.width),c.style.position="absolute",a=36===c.offsetWidth||"absolute",be.removeChild(l),c=null}}function n(e){return Math.round(parseFloat(e))}var i,o,a,s,u,l=r.createElement("div"),c=r.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===c.style.backgroundClip,w.extend(h,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),a}}))}();function Fe(e,t,n){var r,i,o,a,s=e.style;return(n=n||$e(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||w.contains(e.ownerDocument,e)||(a=w.style(e,t)),!h.pixelBoxStyles()&&We.test(a)&&Be.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}var ze=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ue={position:"absolute",visibility:"hidden",display:"block"},Ve={letterSpacing:"0",fontWeight:"400"},Ge=["Webkit","Moz","ms"],Ye=r.createElement("div").style;function Qe(e){if(e in Ye)return e;var t=e[0].toUpperCase()+e.slice(1),n=Ge.length;while(n--)if((e=Ge[n]+t)in Ye)return e}function Je(e){var t=w.cssProps[e];return t||(t=w.cssProps[e]=Qe(e)||e),t}function Ke(e,t,n){var r=ie.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ze(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=w.css(e,n+oe[a],!0,i)),r?("content"===n&&(u-=w.css(e,"padding"+oe[a],!0,i)),"margin"!==n&&(u-=w.css(e,"border"+oe[a]+"Width",!0,i))):(u+=w.css(e,"padding"+oe[a],!0,i),"padding"!==n?u+=w.css(e,"border"+oe[a]+"Width",!0,i):s+=w.css(e,"border"+oe[a]+"Width",!0,i));return!r&&o>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))),u}function et(e,t,n){var r=$e(e),i=Fe(e,t,r),o="border-box"===w.css(e,"boxSizing",!1,r),a=o;if(We.test(i)){if(!n)return i;i="auto"}return a=a&&(h.boxSizingReliable()||i===e.style[t]),("auto"===i||!parseFloat(i)&&"inline"===w.css(e,"display",!1,r))&&(i=e["offset"+t[0].toUpperCase()+t.slice(1)],a=!0),(i=parseFloat(i)||0)+Ze(e,t,n||(o?"border":"content"),a,r,i)+"px"}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Fe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=G(t),u=Xe.test(t),l=e.style;if(u||(t=Je(s)),a=w.cssHooks[t]||w.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"==(o=typeof n)&&(i=ie.exec(n))&&i[1]&&(n=ue(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=G(t);return Xe.test(t)||(t=Je(s)),(a=w.cssHooks[t]||w.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Fe(e,t,r)),"normal"===i&&t in Ve&&(i=Ve[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!ze.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?et(e,t,r):se(e,Ue,function(){return et(e,t,r)})},set:function(e,n,r){var i,o=$e(e),a="border-box"===w.css(e,"boxSizing",!1,o),s=r&&Ze(e,t,r,a,o);return a&&h.scrollboxSize()===o.position&&(s-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Ze(e,t,"border",!1,o)-.5)),s&&(i=ie.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Ke(e,n,s)}}}),w.cssHooks.marginLeft=_e(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Fe(e,"marginLeft"))||e.getBoundingClientRect().left-se(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+oe[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return z(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=$e(e),i=t.length;a<i;a++)o[t[a]]=w.css(e,t[a],!1,r);return o}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}});function tt(e,t,n,r,i){return new tt.prototype.init(e,t,n,r,i)}w.Tween=tt,tt.prototype={constructor:tt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(w.cssNumber[n]?"":"px")},cur:function(){var e=tt.propHooks[this.prop];return e&&e.get?e.get(this):tt.propHooks._default.get(this)},run:function(e){var t,n=tt.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[w.cssProps[e.prop]]&&!w.cssHooks[e.prop]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=tt.prototype.init,w.fx.step={};var nt,rt,it=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;function at(){rt&&(!1===r.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,w.fx.interval),w.fx.tick())}function st(){return e.setTimeout(function(){nt=void 0}),nt=Date.now()}function ut(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=oe[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function lt(e,t,n){for(var r,i=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function ct(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),y=J.get(e,"fxshow");n.queue||(null==(a=w._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,w.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(i=t[r],it.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!y||void 0===y[r])continue;g=!0}d[r]=y&&y[r]||w.style(e,r)}if((u=!w.isEmptyObject(t))||!w.isEmptyObject(d)){f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=y&&y.display)&&(l=J.get(e,"display")),"none"===(c=w.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=w.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===w.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in d)u||(y?"hidden"in y&&(g=y.hidden):y=J.access(e,"fxshow",{display:l}),o&&(y.hidden=!g),g&&fe([e],!0),p.done(function(){g||fe([e]),J.remove(e,"fxshow");for(r in d)w.style(e,r,d[r])})),u=lt(g?y[r]:0,r,p),r in y||(y[r]=u.start,g&&(u.end=u.start,u.start=0))}}function ft(e,t){var n,r,i,o,a;for(n in e)if(r=G(n),i=t[r],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=w.cssHooks[r])&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function pt(e,t,n){var r,i,o=0,a=pt.prefilters.length,s=w.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=nt||st(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(a||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:nt||st(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(ft(c,l.opts.specialEasing);o<a;o++)if(r=pt.prefilters[o].call(l,e,c,l.opts))return g(r.stop)&&(w._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return w.map(c,lt,l),g(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),w.fx.timer(w.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}w.Animation=w.extend(pt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ue(n.elem,e,ie.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(M);for(var n,r=0,i=e.length;r<i;r++)n=e[r],pt.tweeners[n]=pt.tweeners[n]||[],pt.tweeners[n].unshift(t)},prefilters:[ct],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),o=w.speed(t,n,r),a=function(){var t=pt(this,w.extend({},e),o);(i||J.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=w.timers,a=J.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&ot.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=J.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=w.timers,a=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ut(t,!0),e,r,i)}}),w.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(nt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),nt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){rt||(rt=!0,at())},w.fx.stop=function(){rt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx?w.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=r.createElement("input"),t=r.createElement("select").appendChild(r.createElement("option"));e.type="checkbox",h.checkOn=""!==e.value,h.optSelected=t.selected,(e=r.createElement("input")).value="t",e.type="radio",h.radioValue="t"===e.value}();var dt,ht=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return z(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?w.prop(e,t,n):(1===o&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?dt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&N(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(M);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),dt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ht[t]||w.find.attr;ht[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=ht[a],ht[a]=i,i=null!=n(e,t,r)?a:null,ht[a]=o),i}});var gt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;w.fn.extend({prop:function(e,t){return z(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):gt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),h.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this});function vt(e){return(e.match(M)||[]).join(" ")}function mt(e){return e.getAttribute&&e.getAttribute("class")||""}function xt(e){return Array.isArray(e)?e:"string"==typeof e?e.match(M)||[]:[]}w.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).addClass(e.call(this,t,mt(this)))});if((t=xt(e)).length)while(n=this[u++])if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=t[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).removeClass(e.call(this,t,mt(this)))});if(!arguments.length)return this.attr("class","");if((t=xt(e)).length)while(n=this[u++])if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=t[a++])while(r.indexOf(" "+o+" ")>-1)r=r.replace(" "+o+" "," ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):g(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,mt(this),t),t)}):this.each(function(){var t,i,o,a;if(r){i=0,o=w(this),a=xt(e);while(t=a[i++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else void 0!==e&&"boolean"!==n||((t=mt(this))&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":J.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&(" "+vt(mt(n))+" ").indexOf(t)>-1)return!0;return!1}});var bt=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=g(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(bt,""):null==n?"":n}}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:vt(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!N(n.parentNode,"optgroup"))){if(t=w(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=w.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=w.inArray(w.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},h.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),h.focusin="onfocusin"in e;var wt=/^(?:focusinfocus|focusoutblur)$/,Tt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,i,o){var a,s,u,l,c,p,d,h,v=[i||r],m=f.call(t,"type")?t.type:t,x=f.call(t,"namespace")?t.namespace.split("."):[];if(s=h=u=i=i||r,3!==i.nodeType&&8!==i.nodeType&&!wt.test(m+w.event.triggered)&&(m.indexOf(".")>-1&&(m=(x=m.split(".")).shift(),x.sort()),c=m.indexOf(":")<0&&"on"+m,t=t[w.expando]?t:new w.Event(m,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=x.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:w.makeArray(n,[t]),d=w.event.special[m]||{},o||!d.trigger||!1!==d.trigger.apply(i,n))){if(!o&&!d.noBubble&&!y(i)){for(l=d.delegateType||m,wt.test(l+m)||(s=s.parentNode);s;s=s.parentNode)v.push(s),u=s;u===(i.ownerDocument||r)&&v.push(u.defaultView||u.parentWindow||e)}a=0;while((s=v[a++])&&!t.isPropagationStopped())h=s,t.type=a>1?l:d.bindType||m,(p=(J.get(s,"events")||{})[t.type]&&J.get(s,"handle"))&&p.apply(s,n),(p=c&&s[c])&&p.apply&&Y(s)&&(t.result=p.apply(s,n),!1===t.result&&t.preventDefault());return t.type=m,o||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(v.pop(),n)||!Y(i)||c&&g(i[m])&&!y(i)&&((u=i[c])&&(i[c]=null),w.event.triggered=m,t.isPropagationStopped()&&h.addEventListener(m,Tt),i[m](),t.isPropagationStopped()&&h.removeEventListener(m,Tt),w.event.triggered=void 0,u&&(i[c]=u)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),h.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=J.access(r,t);i||r.addEventListener(e,n,!0),J.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=J.access(r,t)-1;i?J.access(r,t,i):(r.removeEventListener(e,n,!0),J.remove(r,t))}}});var Ct=e.location,Et=Date.now(),kt=/\?/;w.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+t),n};var St=/\[\]$/,Dt=/\r?\n/g,Nt=/^(?:submit|button|image|reset|file)$/i,At=/^(?:input|select|textarea|keygen)/i;function jt(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||St.test(e)?r(e,i):jt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==x(t))r(e,t);else for(i in t)jt(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)jt(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&At.test(this.nodeName)&&!Nt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:n.replace(Dt,"\r\n")}}).get()}});var qt=/%20/g,Lt=/#.*$/,Ht=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mt=/^(?:GET|HEAD)$/,Rt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Bt=r.createElement("a");Bt.href=Ct.href;function Ft(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(M)||[];if(g(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function _t(e,t,n,r){var i={},o=e===Wt;function a(s){var u;return i[s]=!0,w.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function zt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}function Xt(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}function Ut(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:Pt.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,w.ajaxSettings),t):zt(w.ajaxSettings,e)},ajaxPrefilter:Ft(It),ajaxTransport:Ft(Wt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=w.ajaxSetup({},n),g=h.context||h,y=h.context&&(g.nodeType||g.jquery)?w(g):w.event,v=w.Deferred(),m=w.Callbacks("once memory"),x=h.statusCode||{},b={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s){s={};while(t=Ot.exec(a))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)E.always(e[E.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return i&&i.abort(t),k(0,t),this}};if(v.promise(E),h.url=((t||h.url||Ct.href)+"").replace(Rt,Ct.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(M)||[""],null==h.crossDomain){l=r.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Bt.protocol+"//"+Bt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=w.param(h.data,h.traditional)),_t(It,h,n,E),c)return E;(f=w.event&&h.global)&&0==w.active++&&w.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Mt.test(h.type),o=h.url.replace(Lt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(qt,"+")):(d=h.url.slice(o.length),h.data&&(h.processData||"string"==typeof h.data)&&(o+=(kt.test(o)?"&":"?")+h.data,delete h.data),!1===h.cache&&(o=o.replace(Ht,"$1"),d=(kt.test(o)?"&":"?")+"_="+Et+++d),h.url=o+d),h.ifModified&&(w.lastModified[o]&&E.setRequestHeader("If-Modified-Since",w.lastModified[o]),w.etag[o]&&E.setRequestHeader("If-None-Match",w.etag[o])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&E.setRequestHeader("Content-Type",h.contentType),E.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+$t+"; q=0.01":""):h.accepts["*"]);for(p in h.headers)E.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(!1===h.beforeSend.call(g,E,h)||c))return E.abort();if(C="abort",m.add(h.complete),E.done(h.success),E.fail(h.error),i=_t(Wt,h,n,E)){if(E.readyState=1,f&&y.trigger("ajaxSend",[E,h]),c)return E;h.async&&h.timeout>0&&(u=e.setTimeout(function(){E.abort("timeout")},h.timeout));try{c=!1,i.send(b,k)}catch(e){if(c)throw e;k(-1,e)}}else k(-1,"No Transport");function k(t,n,r,s){var l,p,d,b,T,C=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",E.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(b=Xt(h,E,r)),b=Ut(h,b,E,l),l?(h.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(w.lastModified[o]=T),(T=E.getResponseHeader("etag"))&&(w.etag[o]=T)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=b.state,p=b.data,l=!(d=b.error))):(d=C,!t&&C||(C="error",t<0&&(t=0))),E.status=t,E.statusText=(n||C)+"",l?v.resolveWith(g,[p,C,E]):v.rejectWith(g,[E,C,d]),E.statusCode(x),x=void 0,f&&y.trigger(l?"ajaxSuccess":"ajaxError",[E,h,l?p:d]),m.fireWith(g,[E,C]),f&&(y.trigger("ajaxComplete",[E,h]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,i){return g(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w._evalUrl=function(e){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return g(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=g(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Vt={0:200,1223:204},Gt=w.ajaxSettings.xhr();h.cors=!!Gt&&"withCredentials"in Gt,h.ajax=Gt=!!Gt,w.ajaxTransport(function(t){var n,r;if(h.cors||Gt&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(a in i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Vt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,o){t=w("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),r.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Yt=[],Qt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||w.expando+"_"+Et++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=!1!==t.jsonp&&(Qt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=g(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Qt,"$1"+i):!1!==t.jsonp&&(t.url+=(kt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||w.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?w(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,Yt.push(i)),a&&g(o)&&o(a[0]),a=o=void 0}),"script"}),h.createHTMLDocument=function(){var e=r.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),w.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var i,o,a;return t||(h.createHTMLDocument?((i=(t=r.implementation.createHTMLDocument("")).createElement("base")).href=r.location.href,t.head.appendChild(i)):t=r),o=A.exec(e),a=!n&&[],o?[t.createElement(o[1])]:(o=xe([e],t,a),a&&a.length&&w(a).remove(),w.merge([],o.childNodes))},w.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=vt(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l,c=w.css(e,"position"),f=w(e),p={};"static"===c&&(e.style.position="relative"),s=f.offset(),o=w.css(e,"top"),u=w.css(e,"left"),(l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1)?(a=(r=f.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),g(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):f.css(p)}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];if(r)return r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===w.css(e,"position"))e=e.offsetParent;return e||be})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return z(this,function(e,r,i){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=_e(h.pixelPosition,function(e,n){if(n)return n=Fe(e,t),We.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return z(this,function(t,n,i){var o;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function(){return e.apply(t||this,r.concat(o.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Kt),t&&e.jQuery===w&&(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});
/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under the MIT license
 */
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.7",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a("#"===f?[]:f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.7",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c).prop(c,!0)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c).prop(c,!1))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target).closest(".btn");b.call(d,"toggle"),a(c.target).is('input[type="radio"], input[type="checkbox"]')||(c.preventDefault(),d.is("input,button")?d.trigger("focus"):d.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(a>this.$items.length-1||a<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.7",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.7",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){document===a.target||this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.7",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.7",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return e<c&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(e+g<=a-d)&&"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&e<=c?"top":null!=d&&i+j>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);
/*!
 *  Lang.js for Laravel localization in JavaScript.
 *
 *  @version 1.1.12
 *  @license MIT https://github.com/rmariuzzo/Lang.js/blob/master/LICENSE
 *  @site    https://github.com/rmariuzzo/Lang.js
 *  @author  Rubens Mariuzzo <rubens@mariuzzo.com>
 */
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.Lang=factory()}})(this,function(){"use strict";function inferLocale(){if(typeof document!=="undefined"&&document.documentElement){return document.documentElement.lang}}function convertNumber(str){if(str==="-Inf"){return-Infinity}else if(str==="+Inf"||str==="Inf"||str==="*"){return Infinity}return parseInt(str,10)}var intervalRegexp=/^({\s*(\-?\d+(\.\d+)?[\s*,\s*\-?\d+(\.\d+)?]*)\s*})|([\[\]])\s*(-Inf|\*|\-?\d+(\.\d+)?)\s*,\s*(\+?Inf|\*|\-?\d+(\.\d+)?)\s*([\[\]])$/;var anyIntervalRegexp=/({\s*(\-?\d+(\.\d+)?[\s*,\s*\-?\d+(\.\d+)?]*)\s*})|([\[\]])\s*(-Inf|\*|\-?\d+(\.\d+)?)\s*,\s*(\+?Inf|\*|\-?\d+(\.\d+)?)\s*([\[\]])/;var defaults={locale:"en"};var Lang=function(options){options=options||{};this.locale=options.locale||inferLocale()||defaults.locale;this.fallback=options.fallback;this.messages=options.messages};Lang.prototype.setMessages=function(messages){this.messages=messages};Lang.prototype.getLocale=function(){return this.locale||this.fallback};Lang.prototype.setLocale=function(locale){this.locale=locale};Lang.prototype.getFallback=function(){return this.fallback};Lang.prototype.setFallback=function(fallback){this.fallback=fallback};Lang.prototype.has=function(key,locale){if(typeof key!=="string"||!this.messages){return false}return this._getMessage(key,locale)!==null};Lang.prototype.get=function(key,replacements,locale){if(!this.has(key,locale)){return key}var message=this._getMessage(key,locale);if(message===null){return key}if(replacements){message=this._applyReplacements(message,replacements)}return message};Lang.prototype.trans=function(key,replacements){return this.get(key,replacements)};Lang.prototype.choice=function(key,number,replacements,locale){replacements=typeof replacements!=="undefined"?replacements:{};replacements.count=number;var message=this.get(key,replacements,locale);if(message===null||message===undefined){return message}var messageParts=message.split("|");var explicitRules=[];for(var i=0;i<messageParts.length;i++){messageParts[i]=messageParts[i].trim();if(anyIntervalRegexp.test(messageParts[i])){var messageSpaceSplit=messageParts[i].split(/\s/);explicitRules.push(messageSpaceSplit.shift());messageParts[i]=messageSpaceSplit.join(" ")}}if(messageParts.length===1){return message}for(var j=0;j<explicitRules.length;j++){if(this._testInterval(number,explicitRules[j])){return messageParts[j]}}locale=locale||this._getLocale(key);var pluralForm=this._getPluralForm(number,locale);return messageParts[pluralForm]};Lang.prototype.transChoice=function(key,count,replacements){return this.choice(key,count,replacements)};Lang.prototype._parseKey=function(key,locale){if(typeof key!=="string"||typeof locale!=="string"){return null}var segments=key.split(".");var source=segments[0].replace(/\//g,".");return{source:locale+"."+source,sourceFallback:this.getFallback()+"."+source,entries:segments.slice(1)}};Lang.prototype._getMessage=function(key,locale){locale=locale||this.getLocale();key=this._parseKey(key,locale);if(this.messages[key.source]===undefined&&this.messages[key.sourceFallback]===undefined){return null}var message=this.messages[key.source];var entries=key.entries.slice();var subKey="";while(entries.length&&message!==undefined){var subKey=!subKey?entries.shift():subKey.concat(".",entries.shift());if(message[subKey]!==undefined){message=message[subKey];subKey=""}}if(typeof message!=="string"&&this.messages[key.sourceFallback]){message=this.messages[key.sourceFallback];entries=key.entries.slice();subKey="";while(entries.length&&message!==undefined){var subKey=!subKey?entries.shift():subKey.concat(".",entries.shift());if(message[subKey]){message=message[subKey];subKey=""}}}if(typeof message!=="string"){return null}return message};Lang.prototype._getLocale=function(key){key=this._parseKey(key,this.locale);if(this.messages[key.source]){return this.locale}if(this.messages[key.sourceFallback]){return this.fallback}return null};Lang.prototype._findMessageInTree=function(pathSegments,tree){while(pathSegments.length&&tree!==undefined){var dottedKey=pathSegments.join(".");if(tree[dottedKey]){tree=tree[dottedKey];break}tree=tree[pathSegments.shift()]}return tree};Lang.prototype._sortReplacementKeys=function(a,b){return b.length-a.length};Lang.prototype._applyReplacements=function(message,replacements){var keys=Object.keys(replacements).sort(this._sortReplacementKeys);keys.forEach(function(replace){message=message.replace(new RegExp(":"+replace,"gi"),function(match){var value=replacements[replace];var allCaps=match===match.toUpperCase();if(allCaps){return value.toUpperCase()}var firstCap=match===match.replace(/\w/i,function(letter){return letter.toUpperCase()});if(firstCap){return value.charAt(0).toUpperCase()+value.slice(1)}return value})});return message};Lang.prototype._testInterval=function(count,interval){if(typeof interval!=="string"){throw"Invalid interval: should be a string."}interval=interval.trim();var matches=interval.match(intervalRegexp);if(!matches){throw"Invalid interval: "+interval}if(matches[2]){var items=matches[2].split(",");for(var i=0;i<items.length;i++){if(parseInt(items[i],10)===count){return true}}}else{matches=matches.filter(function(match){return!!match});var leftDelimiter=matches[1];var leftNumber=convertNumber(matches[2]);if(leftNumber===Infinity){leftNumber=-Infinity}var rightNumber=convertNumber(matches[3]);var rightDelimiter=matches[4];return(leftDelimiter==="["?count>=leftNumber:count>leftNumber)&&(rightDelimiter==="]"?count<=rightNumber:count<rightNumber)}return false};Lang.prototype._getPluralForm=function(count,locale){switch(locale){case"az":case"bo":case"dz":case"id":case"ja":case"jv":case"ka":case"km":case"kn":case"ko":case"ms":case"th":case"tr":case"vi":case"zh":return 0;case"af":case"bn":case"bg":case"ca":case"da":case"de":case"el":case"en":case"eo":case"es":case"et":case"eu":case"fa":case"fi":case"fo":case"fur":case"fy":case"gl":case"gu":case"ha":case"he":case"hu":case"is":case"it":case"ku":case"lb":case"ml":case"mn":case"mr":case"nah":case"nb":case"ne":case"nl":case"nn":case"no":case"om":case"or":case"pa":case"pap":case"ps":case"pt":case"so":case"sq":case"sv":case"sw":case"ta":case"te":case"tk":case"ur":case"zu":return count==1?0:1;case"am":case"bh":case"fil":case"fr":case"gun":case"hi":case"hy":case"ln":case"mg":case"nso":case"xbr":case"ti":case"wa":return count===0||count===1?0:1;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return count%10==1&&count%100!=11?0:count%10>=2&&count%10<=4&&(count%100<10||count%100>=20)?1:2;case"cs":case"sk":return count==1?0:count>=2&&count<=4?1:2;case"ga":return count==1?0:count==2?1:2;case"lt":return count%10==1&&count%100!=11?0:count%10>=2&&(count%100<10||count%100>=20)?1:2;case"sl":return count%100==1?0:count%100==2?1:count%100==3||count%100==4?2:3;case"mk":return count%10==1?0:1;case"mt":return count==1?0:count===0||count%100>1&&count%100<11?1:count%100>10&&count%100<20?2:3;case"lv":return count===0?0:count%10==1&&count%100!=11?1:2;case"pl":return count==1?0:count%10>=2&&count%10<=4&&(count%100<12||count%100>14)?1:2;case"cy":return count==1?0:count==2?1:count==8||count==11?2:3;case"ro":return count==1?0:count===0||count%100>0&&count%100<20?1:2;case"ar":return count===0?0:count==1?1:count==2?2:count%100>=3&&count%100<=10?3:count%100>=11&&count%100<=99?4:5;default:return 0}};return Lang});var Vars={public_url:'https://dev.smarticks.com',subtype_forward:'1',conv_type_phone:'2'};var LangMessages={"en.messages":{"ajax_error":"Error occurred. Please check your internet connection and try again.","error_occurred":"Error occurred. Please try again later.","error_occurred_updating":"Error occurred. Please try again or try another &lt;a href=&quot;https://freescout.net/docs/update/&quot; target=&quot;_blank&quot;&gt;update method&lt;/a&gt;","upload_attachments":"Upload Attachments","saved_replies":"Saved Replies","save_draft":"Save Draft","discard":"Discard","close":"Close","cancel":"Cancel","settings_saved":"Settings saved","insert_var":"Insert variable","mailbox":"Mailbox","email":"Email","name":"Name","conversation":"Conversation","number":"Number","customer":"Customer","full_name":"Full Name","first_name":"First Name","last_name":"Last Name","email_addr":"Email Address","company":"Company","job_title":"Job Title","phone":"Phone Number","photo_url":"Profile Photo (URL)","from_name":"From name","user":"User","confirm_change_customer":"Change the customer to :customer_email?","invite_sent":"Invite email has been sent","invite_resent":"Invite email has been resent","confirm_reset_password":"Reset this User&#039;s password?","push_protocol_alert":"HTTPS protocol is required for the browser push notifications to work.","lost_connection":"Lost internet connection","connection_restored":"Connection restored","saved":"Saved","confirm_discard_draft":"Discard this draft?","yes":"Yes","confirm_delete_photo":"Delete this photo?","delete":"Delete","email_sent":"Email passed for delivery. If you don&#039;t receive a test email, check your mail server logs.","connection_established":"Connection established!","confirm_delete_conversation":"Delete this conversation?","drag_image_file":"Drag image or file here","confirm_delete_module":"Delete this module?","confirm_update":"Please backup application files and database before you continue.","remove_format":"Remove Formatting","list":"List","add_lower":"add","user_viewing":":user is viewing","user_replying":":user is replying","new_message":"New message","view_new_message":"View new message","view_new_messages":"View new messages (:count)","crm_confirm_delete_customer_field":"Deleting this Customer Field will remove all historical data. Delete this custom field?","crm_confirm_delete_option":"Deleting this dropdown option will remove all historical data. Delete this dropdown option?","confirm_delete_custom_field":"Deleting this custom field will remove all historical data and deactivate related workflows. Delete this custom field?","confirm_delete_cf_option":"Deleting this dropdown option will remove all historical data and deactivate related workflows. Delete this dropdown option?","kb_reference_title":"Insert Knowledge Base Reference","new_saved_reply":"New Saved Reply","confirm_delete_saved_reply":"Delete this Saved Reply?","time_tracking":"Time Tracking","timetr_modal_text":"This is the amount of time you spent on this ticket. Edit the time, if needed, and then click Submit Time. Click Cancel if you don't want to save the time spent.","submit_time":"Submit Time","uf_confirm_delete_user_field":"Deleting this User Field will remove all historical data. Delete this custom field?","uf_confirm_delete_option":"Deleting this dropdown option will remove all historical data. Delete this dropdown option?","update":"Update"},"he.messages":{"ajax_error":" .        .","error_occurred":" .     .","error_occurred_updating":" .      &lt;a href=&quot;https://freescout.net/docs/update/&quot; target=&quot;_blank&quot;&gt;  &lt;/a&gt;","upload_attachments":"  ","saved_replies":" ","save_draft":" ","discard":"","close":"","cancel":"","settings_saved":" ","insert_var":" ","mailbox":"","email":"&quot;","name":"","conversation":"","number":"","customer":"","full_name":" ","first_name":" ","last_name":" ","email_addr":" &quot;","company":"","job_title":"","phone":" ","photo_url":"  (URL)","from_name":"","user":"","confirm_change_customer":"   :customer_email?","invite_sent":" ","invite_resent":"  ","confirm_reset_password":"     ?","push_protocol_alert":"  HTTPS      .","lost_connection":"  ","connection_restored":" ","saved":"","confirm_discard_draft":"   ?","yes":"","confirm_delete_photo":"   ?","delete":"","email_sent":"&quot;  .     &quot; ,     .","connection_established":" !","confirm_delete_conversation":"   ?","drag_image_file":"    ","confirm_delete_module":"   ?","confirm_update":"         .","remove_format":" ","list":"","add_lower":"","user_viewing":":user ","user_replying":":user ","new_message":" ","view_new_message":"  ","view_new_messages":"   (:count)","crm_confirm_delete_customer_field":"        .      ?","crm_confirm_delete_option":"        .     ?","confirm_delete_custom_field":"             .      ?","confirm_delete_cf_option":"            .     ?","kb_reference_title":"Insert Knowledge Base Reference","new_saved_reply":"  ","confirm_delete_saved_reply":"   ?","time_tracking":"Time Tracking","timetr_modal_text":"This is the amount of time you spent on this ticket. Edit the time, if needed, and then click Submit Time. Click Cancel if you don't want to save the time spent.","submit_time":"Submit Time","uf_confirm_delete_user_field":"Deleting this User Field will remove all historical data. Delete this custom field?","uf_confirm_delete_option":"        .     ?","update":""},"ru.messages":{"ajax_error":" . ,   -   .","error_occurred":" . ,  .","error_occurred_updating":" .      &lt;a href=&quot;https://freescout.net/docs/update/&quot; target=&quot;_blank&quot;&gt; &lt;/a&gt;","upload_attachments":" ","saved_replies":" ","save_draft":" ","discard":"","close":"","cancel":"","settings_saved":" ","insert_var":" ","mailbox":"","email":". ","name":"","conversation":"","number":"","customer":"","full_name":" ","first_name":"","last_name":"","email_addr":" . ","company":"","job_title":"","phone":"","photo_url":"  (URL)","from_name":" ","user":"","confirm_change_customer":"    :customer_email?","invite_sent":"     ","invite_resent":"      ","confirm_reset_password":"   ?","push_protocol_alert":" HTTPS    push-  .","lost_connection":"- ","connection_restored":" ","saved":"","confirm_discard_draft":"  ","yes":"","confirm_delete_photo":"  ?","delete":"","email_sent":"  .      ,     .","connection_established":" ","confirm_delete_conversation":" ?","drag_image_file":"   ","confirm_delete_module":"  ?","confirm_update":",   ,       .","remove_format":" ","list":"","add_lower":"","user_viewing":":user ","user_replying":":user ","new_message":" ","view_new_message":"  ","view_new_messages":"   (:count)","crm_confirm_delete_customer_field":"           .   ?","crm_confirm_delete_option":"         .     ?","confirm_delete_custom_field":"               .   ?","confirm_delete_cf_option":"                .   ?","kb_reference_title":"Insert Knowledge Base Reference","new_saved_reply":"  ","confirm_delete_saved_reply":"   ?","time_tracking":" ","timetr_modal_text":"  ,      .  ,   ,     .  ,      .","submit_time":" ","uf_confirm_delete_user_field":"Deleting this User Field will remove all historical data. Delete this custom field?","uf_confirm_delete_option":"         .     ?","update":""}};(function(){Lang=new Lang();Lang.setMessages(LangMessages);})();(function(){var laroute=(function(){var routes={absolute:true,rootUrl:Vars.public_url,routes:[{"uri":"app-settings\/ajax","name":"settings.ajax"},{"uri":"users","name":"users"},{"uri":"users\/ajax","name":"users.ajax"},{"uri":"conversation\/{id}","name":"conversations.view"},{"uri":"conversation\/ajax","name":"conversations.ajax"},{"uri":"conversation\/upload","name":"conversations.upload"},{"uri":"conversation\/ajax-html\/{action}","name":"conversations.ajax_html"},{"uri":"mailboxes","name":"mailboxes"},{"uri":"mailbox\/ajax","name":"mailboxes.ajax"},{"uri":"customers\/ajax-search","name":"customers.ajax_search"},{"uri":"customers\/ajax","name":"customers.ajax"},{"uri":"modules\/ajax","name":"modules.ajax"},{"uri":"system\/ajax","name":"system.ajax"},{"uri":"uploads\/upload","name":"uploads.upload"}],prefix:'',route:function(name,parameters,route){route=route||this.getByName(name);if(!route){return undefined;}
return this.toRoute(route,parameters);},url:function(url,parameters){parameters=parameters||[];var uri=url+'/'+parameters.join('/');return this.getCorrectUrl(uri);},toRoute:function(route,parameters){var uri=this.replaceNamedParameters(route.uri,parameters);var qs=this.getRouteQueryString(parameters);if(this.absolute&&this.isOtherHost(route)){return"//"+route.host+"/"+uri+qs;}
return this.getCorrectUrl(uri+qs);},isOtherHost:function(route){return route.host&&route.host!=window.location.hostname;},replaceNamedParameters:function(uri,parameters){uri=uri.replace(/\{(.*?)\??\}/g,function(match,key){if(parameters.hasOwnProperty(key)){var value=parameters[key];delete parameters[key];return value;}else{return match;}});uri=uri.replace(/\/\{.*?\?\}/g,'');return uri;},getRouteQueryString:function(parameters){var qs=[];for(var key in parameters){if(parameters.hasOwnProperty(key)){qs.push(key+'='+parameters[key]);}}
if(qs.length<1){return'';}
return'?'+qs.join('&');},getByName:function(name){for(var key in this.routes){if(this.routes.hasOwnProperty(key)&&this.routes[key].name===name){return this.routes[key];}}},getByAction:function(action){for(var key in this.routes){if(this.routes.hasOwnProperty(key)&&this.routes[key].action===action){return this.routes[key];}}},getCorrectUrl:function(uri){var url=this.prefix+'/'+uri.replace(/^\/?/,'');if(!this.absolute){return url;}
return this.rootUrl.replace('/\/?$/','')+url;}};var getLinkAttributes=function(attributes){if(!attributes){return'';}
var attrs=[];for(var key in attributes){if(attributes.hasOwnProperty(key)){attrs.push(key+'="'+attributes[key]+'"');}}
return attrs.join(' ');};var getHtmlLink=function(url,title,attributes){title=title||url;attributes=getLinkAttributes(attributes);return'<a href="'+url+'" '+attributes+'>'+title+'</a>';};return{action:function(name,parameters){parameters=parameters||{};return routes.route(name,parameters,routes.getByAction(name));},route:function(route,parameters){parameters=parameters||{};return routes.route(route,parameters);},add_routes:function(new_routes){new_routes=new_routes||[];routes.routes=routes.routes.concat(new_routes);},url:function(route,parameters){parameters=parameters||{};return routes.url(route,parameters);},link_to:function(url,title,attributes){url=this.url(url);return getHtmlLink(url,title,attributes);},link_to_route:function(route,title,parameters,attributes){var url=this.route(route,parameters);return getHtmlLink(url,title,attributes);},link_to_action:function(action,title,parameters,attributes){var url=this.action(action,parameters);return getHtmlLink(url,title,attributes);}};}).call(this);if(typeof define==='function'&&define.amd){define(function(){return laroute;});}
else if(typeof module==='object'&&module.exports){module.exports=laroute;}
else{window.laroute=laroute;}}).call(this);
/*!
* Parsley.js
* Version 2.8.1 - built Sat, Feb 3rd 2018, 2:27 pm
* http://parsleyjs.org
* Guillaume Potier - <guillaume@wisembly.com>
* Marc-Andre Lafortune - <petroselinum@marc-andre.ca>
* MIT Licensed
*/
function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var _slice=Array.prototype.slice,_slicedToArray=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(l){r=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.parsley=t(e.jQuery)}(this,function(e){"use strict";function t(e,t){return e.parsleyAdaptedCallback||(e.parsleyAdaptedCallback=function(){var i=Array.prototype.slice.call(arguments,0);i.unshift(this),e.apply(t||M,i)}),e.parsleyAdaptedCallback}function i(e){return 0===e.lastIndexOf(D,0)?e.substr(D.length):e}
function n(){var t=this,i=window||global;_extends(this,{isNativeEvent:function(e){return e.originalEvent&&e.originalEvent.isTrusted!==!1},fakeInputEvent:function(i){t.isNativeEvent(i)&&e(i.target).trigger("input")},misbehaves:function(i){t.isNativeEvent(i)&&(t.behavesOk(i),e(document).on("change.inputevent",i.data.selector,t.fakeInputEvent),t.fakeInputEvent(i))},behavesOk:function(i){t.isNativeEvent(i)&&e(document).off("input.inputevent",i.data.selector,t.behavesOk).off("change.inputevent",i.data.selector,t.misbehaves)},install:function(){if(!i.inputEventPatched){i.inputEventPatched="0.0.3";for(var n=["select",'input[type="checkbox"]','input[type="radio"]','input[type="file"]'],r=0;r<n.length;r++){var s=n[r];e(document).on("input.inputevent",s,{selector:s},t.behavesOk).on("change.inputevent",s,{selector:s},t.misbehaves)}}},uninstall:function(){delete i.inputEventPatched,e(document).off(".inputevent")}})}var r=1,s={},a={attr:function(e,t,i){var n,r,s,a=new RegExp("^"+t,"i");if("undefined"==typeof i)i={};else for(n in i)i.hasOwnProperty(n)&&delete i[n];if(!e)return i;for(s=e.attributes,n=s.length;n--;)r=s[n],r&&r.specified&&a.test(r.name)&&(i[this.camelize(r.name.slice(t.length))]=this.deserializeValue(r.value));return i},checkAttr:function(e,t,i){return e.hasAttribute(t+i)},setAttr:function(e,t,i,n){e.setAttribute(this.dasherize(t+i),String(n))},getType:function(e){return e.getAttribute("type")||"text"},generateID:function(){return""+r++},deserializeValue:function(e){var t;try{return e?"true"==e||"false"!=e&&("null"==e?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?JSON.parse(e):e:t):e}catch(i){return e}},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},dasherize:function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},warn:function(){var e;window.console&&"function"==typeof window.console.warn&&(e=window.console).warn.apply(e,arguments)},warnOnce:function(e){s[e]||(s[e]=!0,this.warn.apply(this,arguments))},_resetWarnings:function(){s={}},trimString:function(e){return e.replace(/^\s+|\s+$/g,"")},parse:{date:function S(e){var t=e.match(/^(\d{4,})-(\d\d)-(\d\d)$/);if(!t)return null;var i=t.map(function(e){return parseInt(e,10)}),n=_slicedToArray(i,4),r=(n[0],n[1]),s=n[2],a=n[3],S=new Date(r,s-1,a);return S.getFullYear()!==r||S.getMonth()+1!==s||S.getDate()!==a?null:S},string:function(e){return e},integer:function(e){return isNaN(e)?null:parseInt(e,10)},number:function(e){if(isNaN(e))throw null;return parseFloat(e)},"boolean":function(e){return!/^\s*false\s*$/i.test(e)},object:function(e){return a.deserializeValue(e)},regexp:function(e){var t="";return/^\/.*\/(?:[gimy]*)$/.test(e)?(t=e.replace(/.*\/([gimy]*)$/,"$1"),e=e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1")):e="^"+e+"$",new RegExp(e,t)}},parseRequirement:function(e,t){var i=this.parse[e||"string"];if(!i)throw'Unknown requirement specification: "'+e+'"';var n=i(t);if(null===n)throw"Requirement is not a "+e+': "'+t+'"';return n},namespaceEvents:function(t,i){return t=this.trimString(t||"").split(/\s+/),t[0]?e.map(t,function(e){return e+"."+i}).join(" "):""},difference:function(t,i){var n=[];return e.each(t,function(e,t){i.indexOf(t)==-1&&n.push(t)}),n},all:function(t){return e.when.apply(e,_toConsumableArray(t).concat([42,42]))},objectCreate:Object.create||function(){var e=function(){};return function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var i=new e;return e.prototype=null,i}}(),_SubmitSelector:'input[type="submit"], button:submit'},o={namespace:"data-parsley-",inputs:"input, textarea, select",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden]",priorityEnabled:!0,multiple:null,group:null,uiEnabled:!0,validationThreshold:3,focus:"first",trigger:!1,triggerAfterFailure:"input",errorClass:"parsley-error",successClass:"parsley-success",classHandler:function(e){},errorsContainer:function(e){},errorsWrapper:'<ul class="parsley-errors-list"></ul>',errorTemplate:"<li></li>"},l=function(){this.__id__=a.generateID()};l.prototype={asyncSupport:!0,_pipeAccordingToValidationResult:function(){var t=this,i=function(){var i=e.Deferred();return!0!==t.validationResult&&i.reject(),i.resolve().promise()};return[i,i]},actualizeOptions:function(){return a.attr(this.element,this.options.namespace,this.domOptions),this.parent&&this.parent.actualizeOptions&&this.parent.actualizeOptions(),this},_resetOptions:function(e){this.domOptions=a.objectCreate(this.parent.options),this.options=a.objectCreate(this.domOptions);for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.actualizeOptions()},_listeners:null,on:function(e,t){this._listeners=this._listeners||{};var i=this._listeners[e]=this._listeners[e]||[];return i.push(t),this},subscribe:function(t,i){e.listenTo(this,t.toLowerCase(),i)},off:function(e,t){var i=this._listeners&&this._listeners[e];if(i)if(t)for(var n=i.length;n--;)i[n]===t&&i.splice(n,1);else delete this._listeners[e];return this},unsubscribe:function(t,i){e.unsubscribeTo(this,t.toLowerCase())},trigger:function(e,t,i){t=t||this;var n,r=this._listeners&&this._listeners[e];if(r)for(var s=r.length;s--;)if(n=r[s].call(t,t,i),n===!1)return n;return!this.parent||this.parent.trigger(e,t,i)},asyncIsValid:function(e,t){return a.warnOnce("asyncIsValid is deprecated; please use whenValid instead"),this.whenValid({group:e,force:t})},_findRelated:function(){return this.options.multiple?e(this.parent.element.querySelectorAll("["+this.options.namespace+'multiple="'+this.options.multiple+'"]')):this.$element}};var u=function(e,t){var i=e.match(/^\s*\[(.*)\]\s*$/);if(!i)throw'Requirement is not an array: "'+e+'"';var n=i[1].split(",").map(a.trimString);if(n.length!==t)throw"Requirement has "+n.length+" values when "+t+" are needed";return n},d=function(e,t,i){var n=null,r={};for(var s in e)if(s){var o=i(s);"string"==typeof o&&(o=a.parseRequirement(e[s],o)),r[s]=o}else n=a.parseRequirement(e[s],t);return[n,r]},h=function(t){e.extend(!0,this,t)};h.prototype={validate:function(e,t){if(this.fn)return arguments.length>3&&(t=[].slice.call(arguments,1,-1)),this.fn(e,t);if(Array.isArray(e)){if(!this.validateMultiple)throw"Validator `"+this.name+"` does not handle multiple values";return this.validateMultiple.apply(this,arguments)}var i=arguments[arguments.length-1];if(this.validateDate&&i._isDateInput())return arguments[0]=a.parse.date(arguments[0]),null!==arguments[0]&&this.validateDate.apply(this,arguments);if(this.validateNumber)return!isNaN(e)&&(arguments[0]=parseFloat(arguments[0]),this.validateNumber.apply(this,arguments));if(this.validateString)return this.validateString.apply(this,arguments);throw"Validator `"+this.name+"` only handles multiple values"},parseRequirements:function(t,i){if("string"!=typeof t)return Array.isArray(t)?t:[t];var n=this.requirementType;if(Array.isArray(n)){for(var r=u(t,n.length),s=0;s<r.length;s++)r[s]=a.parseRequirement(n[s],r[s]);return r}return e.isPlainObject(n)?d(n,t,i):[a.parseRequirement(n,t)]},requirementType:"string",priority:2};var p=function(e,t){this.__class__="ValidatorRegistry",this.locale="en",this.init(e||{},t||{})},c={email:/^((([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/,number:/^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,integer:/^-?\d+$/,digits:/^\d+$/,alphanum:/^\w+$/i,date:{test:function(e){return null!==a.parse.date(e)}},url:new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-zA-Z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$")};c.range=c.number;var f=function(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},m=function(e,t){return t.map(a.parse[e])},g=function(e,t){return function(i){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.pop(),t.apply(void 0,[i].concat(_toConsumableArray(m(e,r))))}},v=function(e){return{validateDate:g("date",e),validateNumber:g("number",e),requirementType:e.length<=2?"string":["string","string"],priority:30}};p.prototype={init:function(e,t){this.catalog=t,this.validators=_extends({},this.validators);for(var i in e)this.addValidator(i,e[i].fn,e[i].priority);window.Parsley.trigger("parsley:validator:init")},setLocale:function(e){if("undefined"==typeof this.catalog[e])throw new Error(e+" is not available in the catalog");return this.locale=e,this},addCatalog:function(e,t,i){return"object"==typeof t&&(this.catalog[e]=t),!0===i?this.setLocale(e):this},addMessage:function(e,t,i){return"undefined"==typeof this.catalog[e]&&(this.catalog[e]={}),this.catalog[e][t]=i,this},addMessages:function(e,t){for(var i in t)this.addMessage(e,i,t[i]);return this},addValidator:function(e,t,i){if(this.validators[e])a.warn('Validator "'+e+'" is already defined.');else if(o.hasOwnProperty(e))return void a.warn('"'+e+'" is a restricted keyword and is not a valid validator name.');return this._setValidator.apply(this,arguments)},hasValidator:function(e){return!!this.validators[e]},updateValidator:function(e,t,i){return this.validators[e]?this._setValidator.apply(this,arguments):(a.warn('Validator "'+e+'" is not already defined.'),this.addValidator.apply(this,arguments))},removeValidator:function(e){return this.validators[e]||a.warn('Validator "'+e+'" is not defined.'),delete this.validators[e],this},_setValidator:function(e,t,i){"object"!=typeof t&&(t={fn:t,priority:i}),t.validate||(t=new h(t)),this.validators[e]=t;for(var n in t.messages||{})this.addMessage(n,e,t.messages[n]);return this},getErrorMessage:function(e){var t;if("type"===e.name){var i=this.catalog[this.locale][e.name]||{};t=i[e.requirements]}else t=this.formatMessage(this.catalog[this.locale][e.name],e.requirements);return t||this.catalog[this.locale].defaultMessage||this.catalog.en.defaultMessage},formatMessage:function(e,t){if("object"==typeof t){for(var i in t)e=this.formatMessage(e,t[i]);return e}return"string"==typeof e?e.replace(/%s/i,t):""},validators:{notblank:{validateString:function(e){return/\S/.test(e)},priority:2},required:{validateMultiple:function(e){return e.length>0},validateString:function(e){return/\S/.test(e)},priority:512},type:{validateString:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=i.step,r=void 0===n?"any":n,s=i.base,a=void 0===s?0:s,o=c[t];if(!o)throw new Error("validator type `"+t+"` is not supported");if(!o.test(e))return!1;if("number"===t&&!/^any$/i.test(r||"")){var l=Number(e),u=Math.max(f(r),f(a));if(f(l)>u)return!1;var d=function(e){return Math.round(e*Math.pow(10,u))};if((d(l)-d(a))%d(r)!=0)return!1}return!0},requirementType:{"":"string",step:"string",base:"number"},priority:256},pattern:{validateString:function(e,t){return t.test(e)},requirementType:"regexp",priority:64},minlength:{validateString:function(e,t){return e.length>=t},requirementType:"integer",priority:30},maxlength:{validateString:function(e,t){return e.length<=t},requirementType:"integer",priority:30},length:{validateString:function(e,t,i){return e.length>=t&&e.length<=i},requirementType:["integer","integer"],priority:30},mincheck:{validateMultiple:function(e,t){return e.length>=t},requirementType:"integer",priority:30},maxcheck:{validateMultiple:function(e,t){return e.length<=t},requirementType:"integer",priority:30},check:{validateMultiple:function(e,t,i){return e.length>=t&&e.length<=i},requirementType:["integer","integer"],priority:30},min:v(function(e,t){return e>=t}),max:v(function(e,t){return e<=t}),range:v(function(e,t,i){return e>=t&&e<=i}),equalto:{validateString:function(t,i){var n=e(i);return n.length?t===n.val():t===i},priority:256}}};var y={},_=function k(e,t,i){for(var n=[],r=[],s=0;s<e.length;s++){for(var a=!1,o=0;o<t.length;o++)if(e[s].assert.name===t[o].assert.name){a=!0;break}a?r.push(e[s]):n.push(e[s])}return{kept:r,added:n,removed:i?[]:k(t,e,!0).added}};y.Form={_actualizeTriggers:function(){var e=this;this.$element.on("submit.Parsley",function(t){e.onSubmitValidate(t)}),this.$element.on("click.Parsley",a._SubmitSelector,function(t){e.onSubmitButton(t)}),!1!==this.options.uiEnabled&&this.element.setAttribute("novalidate","")},focus:function(){if(this._focusedField=null,!0===this.validationResult||"none"===this.options.focus)return null;for(var e=0;e<this.fields.length;e++){var t=this.fields[e];if(!0!==t.validationResult&&t.validationResult.length>0&&"undefined"==typeof t.options.noFocus&&(this._focusedField=t.$element,"first"===this.options.focus))break}return null===this._focusedField?null:this._focusedField.focus()},_destroyUI:function(){this.$element.off(".Parsley")}},y.Field={_reflowUI:function(){if(this._buildUI(),this._ui){var e=_(this.validationResult,this._ui.lastValidationResult);this._ui.lastValidationResult=this.validationResult,this._manageStatusClass(),this._manageErrorsMessages(e),this._actualizeTriggers(),!e.kept.length&&!e.added.length||this._failedOnce||(this._failedOnce=!0,this._actualizeTriggers())}},getErrorsMessages:function(){if(!0===this.validationResult)return[];for(var e=[],t=0;t<this.validationResult.length;t++)e.push(this.validationResult[t].errorMessage||this._getErrorMessage(this.validationResult[t].assert));return e},addError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.message,n=t.assert,r=t.updateClass,s=void 0===r||r;this._buildUI(),this._addError(e,{message:i,assert:n}),s&&this._errorClass()},updateError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.message,n=t.assert,r=t.updateClass,s=void 0===r||r;this._buildUI(),this._updateError(e,{message:i,assert:n}),s&&this._errorClass()},removeError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.updateClass,n=void 0===i||i;this._buildUI(),this._removeError(e),n&&this._manageStatusClass()},_manageStatusClass:function(){this.hasConstraints()&&this.needsValidation()&&!0===this.validationResult?this._successClass():this.validationResult.length>0?this._errorClass():this._resetClass()},_manageErrorsMessages:function(t){if("undefined"==typeof this.options.errorsMessagesDisabled){if("undefined"!=typeof this.options.errorMessage)return t.added.length||t.kept.length?(this._insertErrorWrapper(),0===this._ui.$errorsWrapper.find(".parsley-custom-error-message").length&&this._ui.$errorsWrapper.append(e(this.options.errorTemplate).addClass("parsley-custom-error-message")),this._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(this.options.errorMessage)):this._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove();for(var i=0;i<t.removed.length;i++)this._removeError(t.removed[i].assert.name);for(i=0;i<t.added.length;i++)this._addError(t.added[i].assert.name,{message:t.added[i].errorMessage,assert:t.added[i].assert});for(i=0;i<t.kept.length;i++)this._updateError(t.kept[i].assert.name,{message:t.kept[i].errorMessage,assert:t.kept[i].assert})}},_addError:function(t,i){var n=i.message,r=i.assert;this._insertErrorWrapper(),this._ui.$errorClassHandler.attr("aria-describedby",this._ui.errorsWrapperId),this._ui.$errorsWrapper.addClass("filled").append(e(this.options.errorTemplate).addClass("parsley-"+t).html(n||this._getErrorMessage(r)))},_updateError:function(e,t){var i=t.message,n=t.assert;this._ui.$errorsWrapper.addClass("filled").find(".parsley-"+e).html(i||this._getErrorMessage(n))},_removeError:function(e){this._ui.$errorClassHandler.removeAttr("aria-describedby"),this._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+e).remove()},_getErrorMessage:function(e){var t=e.name+"Message";return"undefined"!=typeof this.options[t]?window.Parsley.formatMessage(this.options[t],e.requirements):window.Parsley.getErrorMessage(e)},_buildUI:function(){if(!this._ui&&!1!==this.options.uiEnabled){var t={};this.element.setAttribute(this.options.namespace+"id",this.__id__),t.$errorClassHandler=this._manageClassHandler(),t.errorsWrapperId="parsley-id-"+(this.options.multiple?"multiple-"+this.options.multiple:this.__id__),t.$errorsWrapper=e(this.options.errorsWrapper).attr("id",t.errorsWrapperId),t.lastValidationResult=[],t.validationInformationVisible=!1,this._ui=t}},_manageClassHandler:function(){if("string"==typeof this.options.classHandler&&e(this.options.classHandler).length)return e(this.options.classHandler);var t=this.options.classHandler;if("string"==typeof this.options.classHandler&&"function"==typeof window[this.options.classHandler]&&(t=window[this.options.classHandler]),"function"==typeof t){var i=t.call(this,this);if("undefined"!=typeof i&&i.length)return i}else{if("object"==typeof t&&t instanceof jQuery&&t.length)return t;t&&a.warn("The class handler `"+t+"` does not exist in DOM nor as a global JS function")}return this._inputHolder()},_inputHolder:function(){return this.options.multiple&&"SELECT"!==this.element.nodeName?this.$element.parent():this.$element},_insertErrorWrapper:function(){var t=this.options.errorsContainer;if(0!==this._ui.$errorsWrapper.parent().length)return this._ui.$errorsWrapper.parent();if("string"==typeof t){if(e(t).length)return e(t).append(this._ui.$errorsWrapper);"function"==typeof window[t]?t=window[t]:a.warn("The errors container `"+t+"` does not exist in DOM nor as a global JS function")}return"function"==typeof t&&(t=t.call(this,this)),"object"==typeof t&&t.length?t.append(this._ui.$errorsWrapper):this._inputHolder().after(this._ui.$errorsWrapper)},_actualizeTriggers:function(){var e,t=this,i=this._findRelated();i.off(".Parsley"),this._failedOnce?i.on(a.namespaceEvents(this.options.triggerAfterFailure,"Parsley"),function(){t._validateIfNeeded()}):(e=a.namespaceEvents(this.options.trigger,"Parsley"))&&i.on(e,function(e){t._validateIfNeeded(e)})},_validateIfNeeded:function(e){var t=this;e&&/key|input/.test(e.type)&&(!this._ui||!this._ui.validationInformationVisible)&&this.getValue().length<=this.options.validationThreshold||(this.options.debounce?(window.clearTimeout(this._debounced),this._debounced=window.setTimeout(function(){return t.validate()},this.options.debounce)):this.validate())},_resetUI:function(){this._failedOnce=!1,this._actualizeTriggers(),"undefined"!=typeof this._ui&&(this._ui.$errorsWrapper.removeClass("filled").children().remove(),this._resetClass(),this._ui.lastValidationResult=[],this._ui.validationInformationVisible=!1)},_destroyUI:function(){this._resetUI(),"undefined"!=typeof this._ui&&this._ui.$errorsWrapper.remove(),delete this._ui},_successClass:function(){this._ui.validationInformationVisible=!0,this._ui.$errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass)},_errorClass:function(){this._ui.validationInformationVisible=!0,this._ui.$errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass)},_resetClass:function(){this._ui.$errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass)}};var w=function(t,i,n){this.__class__="Form",this.element=t,this.$element=e(t),this.domOptions=i,this.options=n,this.parent=window.Parsley,this.fields=[],this.validationResult=null},b={pending:null,resolved:!0,rejected:!1};w.prototype={onSubmitValidate:function(e){var t=this;if(!0!==e.parsley){var i=this._submitSource||this.$element.find(a._SubmitSelector)[0];if(this._submitSource=null,this.$element.find(".parsley-synthetic-submit-button").prop("disabled",!0),!i||null===i.getAttribute("formnovalidate")){window.Parsley._remoteCache={};var n=this.whenValidate({event:e});"resolved"===n.state()&&!1!==this._trigger("submit")||(e.stopImmediatePropagation(),e.preventDefault(),"pending"===n.state()&&n.done(function(){t._submit(i)}))}}},onSubmitButton:function(e){this._submitSource=e.currentTarget},_submit:function(t){if(!1!==this._trigger("submit")){if(t){var i=this.$element.find(".parsley-synthetic-submit-button").prop("disabled",!1);0===i.length&&(i=e('<input class="parsley-synthetic-submit-button" type="hidden">').appendTo(this.$element)),i.attr({name:t.getAttribute("name"),value:t.getAttribute("value")})}this.$element.trigger(_extends(e.Event("submit"),{parsley:!0}))}},validate:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling validate on a parsley form without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1],s=i[2];t={group:n,force:r,event:s}}return b[this.whenValidate(t).state()]},whenValidate:function(){var t,i=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=n.group,s=n.force,o=n.event;this.submitEvent=o,o&&(this.submitEvent=_extends({},o,{preventDefault:function(){a.warnOnce("Using `this.submitEvent.preventDefault()` is deprecated; instead, call `this.validationResult = false`"),i.validationResult=!1}})),this.validationResult=!0,this._trigger("validate"),this._refreshFields();var l=this._withoutReactualizingFormOptions(function(){return e.map(i.fields,function(e){return e.whenValidate({force:s,group:r})})});return(t=a.all(l).done(function(){i._trigger("success")}).fail(function(){i.validationResult=!1,i.focus(),i._trigger("error")}).always(function(){i._trigger("validated")})).pipe.apply(t,_toConsumableArray(this._pipeAccordingToValidationResult()))},isValid:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling isValid on a parsley form without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1];t={group:n,force:r}}return b[this.whenValid(t).state()]},whenValid:function(){var t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.group,r=i.force;this._refreshFields();var s=this._withoutReactualizingFormOptions(function(){return e.map(t.fields,function(e){return e.whenValid({group:n,force:r})})});return a.all(s)},refresh:function(){return this._refreshFields(),this},reset:function(){for(var e=0;e<this.fields.length;e++)this.fields[e].reset();this._trigger("reset")},destroy:function(){this._destroyUI();for(var e=0;e<this.fields.length;e++)this.fields[e].destroy();this.$element.removeData("Parsley"),this._trigger("destroy")},_refreshFields:function(){return this.actualizeOptions()._bindFields()},_bindFields:function(){var t=this,i=this.fields;return this.fields=[],this.fieldsMappedById={},this._withoutReactualizingFormOptions(function(){t.$element.find(t.options.inputs).not(t.options.excluded).each(function(e,i){var n=new window.Parsley.Factory(i,{},t);if(("Field"===n.__class__||"FieldMultiple"===n.__class__)&&!0!==n.options.excluded){var r=n.__class__+"-"+n.__id__;"undefined"==typeof t.fieldsMappedById[r]&&(t.fieldsMappedById[r]=n,t.fields.push(n))}}),e.each(a.difference(i,t.fields),function(e,t){t.reset()})}),this},_withoutReactualizingFormOptions:function(e){var t=this.actualizeOptions;this.actualizeOptions=function(){return this};var i=e();return this.actualizeOptions=t,i},_trigger:function(e){return this.trigger("form:"+e)}};var F=function(e,t,i,n,r){var s=window.Parsley._validatorRegistry.validators[t],a=new h(s);n=n||e.options[t+"Priority"]||a.priority,r=!0===r,_extends(this,{validator:a,name:t,requirements:i,priority:n,isDomConstraint:r}),this._parseRequirements(e.options)},C=function(e){var t=e[0].toUpperCase();return t+e.slice(1)};F.prototype={validate:function(e,t){var i;return(i=this.validator).validate.apply(i,[e].concat(_toConsumableArray(this.requirementList),[t]))},_parseRequirements:function(e){var t=this;this.requirementList=this.validator.parseRequirements(this.requirements,function(i){return e[t.name+C(i)]})}};var A=function(t,i,n,r){this.__class__="Field",this.element=t,this.$element=e(t),"undefined"!=typeof r&&(this.parent=r),this.options=n,this.domOptions=i,this.constraints=[],this.constraintsByName={},this.validationResult=!0,this._bindConstraints()},E={pending:null,resolved:!0,rejected:!1};A.prototype={validate:function(t){arguments.length>=1&&!e.isPlainObject(t)&&(a.warnOnce("Calling validate on a parsley field without passing arguments as an object is deprecated."),t={options:t});var i=this.whenValidate(t);if(!i)return!0;switch(i.state()){case"pending":return null;case"resolved":return!0;case"rejected":return this.validationResult}},whenValidate:function(){var e,t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.force,r=i.group;if(this.refresh(),!r||this._isInGroup(r))return this.value=this.getValue(),this._trigger("validate"),(e=this.whenValid({force:n,value:this.value,_refreshed:!0}).always(function(){t._reflowUI()}).done(function(){t._trigger("success")}).fail(function(){t._trigger("error")}).always(function(){t._trigger("validated")})).pipe.apply(e,_toConsumableArray(this._pipeAccordingToValidationResult()))},hasConstraints:function(){return 0!==this.constraints.length},needsValidation:function(e){return"undefined"==typeof e&&(e=this.getValue()),!(!e.length&&!this._isRequired()&&"undefined"==typeof this.options.validateIfEmpty)},_isInGroup:function(t){return Array.isArray(this.options.group)?-1!==e.inArray(t,this.options.group):this.options.group===t},isValid:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling isValid on a parsley field without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1];t={force:n,value:r}}var s=this.whenValid(t);return!s||E[s.state()]},whenValid:function(){var t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.force,r=void 0!==n&&n,s=i.value,o=i.group,l=i._refreshed;if(l||this.refresh(),!o||this._isInGroup(o)){if(this.validationResult=!0,!this.hasConstraints())return e.when();if("undefined"!=typeof s&&null!==s||(s=this.getValue()),!this.needsValidation(s)&&!0!==r)return e.when();var u=this._getGroupedConstraints(),d=[];return e.each(u,function(i,n){var r=a.all(e.map(n,function(e){return t._validateConstraint(s,e)}));if(d.push(r),"rejected"===r.state())return!1}),a.all(d)}},_validateConstraint:function(t,i){var n=this,r=i.validate(t,this);return!1===r&&(r=e.Deferred().reject()),a.all([r]).fail(function(e){n.validationResult instanceof Array||(n.validationResult=[]),n.validationResult.push({assert:i,errorMessage:"string"==typeof e&&e})})},getValue:function(){var e;return e="function"==typeof this.options.value?this.options.value(this):"undefined"!=typeof this.options.value?this.options.value:this.$element.val(),"undefined"==typeof e||null===e?"":this._handleWhitespace(e)},reset:function(){return this._resetUI(),this._trigger("reset")},destroy:function(){this._destroyUI(),this.$element.removeData("Parsley"),this.$element.removeData("FieldMultiple"),this._trigger("destroy")},refresh:function(){return this._refreshConstraints(),this},_refreshConstraints:function(){return this.actualizeOptions()._bindConstraints()},refreshConstraints:function(){return a.warnOnce("Parsley's refreshConstraints is deprecated. Please use refresh"),this.refresh()},addConstraint:function(e,t,i,n){if(window.Parsley._validatorRegistry.validators[e]){var r=new F(this,e,t,i,n);"undefined"!==this.constraintsByName[r.name]&&this.removeConstraint(r.name),this.constraints.push(r),this.constraintsByName[r.name]=r}return this},removeConstraint:function(e){for(var t=0;t<this.constraints.length;t++)if(e===this.constraints[t].name){this.constraints.splice(t,1);break}return delete this.constraintsByName[e],this},updateConstraint:function(e,t,i){return this.removeConstraint(e).addConstraint(e,t,i)},_bindConstraints:function(){for(var e=[],t={},i=0;i<this.constraints.length;i++)!1===this.constraints[i].isDomConstraint&&(e.push(this.constraints[i]),t[this.constraints[i].name]=this.constraints[i]);this.constraints=e,this.constraintsByName=t;for(var n in this.options)this.addConstraint(n,this.options[n],void 0,!0);return this._bindHtml5Constraints()},_bindHtml5Constraints:function(){null!==this.element.getAttribute("required")&&this.addConstraint("required",!0,void 0,!0),null!==this.element.getAttribute("pattern")&&this.addConstraint("pattern",this.element.getAttribute("pattern"),void 0,!0);var e=this.element.getAttribute("min"),t=this.element.getAttribute("max");null!==e&&null!==t?this.addConstraint("range",[e,t],void 0,!0):null!==e?this.addConstraint("min",e,void 0,!0):null!==t&&this.addConstraint("max",t,void 0,!0),null!==this.element.getAttribute("minlength")&&null!==this.element.getAttribute("maxlength")?this.addConstraint("length",[this.element.getAttribute("minlength"),this.element.getAttribute("maxlength")],void 0,!0):null!==this.element.getAttribute("minlength")?this.addConstraint("minlength",this.element.getAttribute("minlength"),void 0,!0):null!==this.element.getAttribute("maxlength")&&this.addConstraint("maxlength",this.element.getAttribute("maxlength"),void 0,!0);var i=a.getType(this.element);return"number"===i?this.addConstraint("type",["number",{step:this.element.getAttribute("step")||"1",base:e||this.element.getAttribute("value")}],void 0,!0):/^(email|url|range|date)$/i.test(i)?this.addConstraint("type",i,void 0,!0):this},_isRequired:function(){return"undefined"!=typeof this.constraintsByName.required&&!1!==this.constraintsByName.required.requirements},_trigger:function(e){return this.trigger("field:"+e)},_handleWhitespace:function(e){return!0===this.options.trimValue&&a.warnOnce('data-parsley-trim-value="true" is deprecated, please use data-parsley-whitespace="trim"'),"squish"===this.options.whitespace&&(e=e.replace(/\s{2,}/g," ")),"trim"!==this.options.whitespace&&"squish"!==this.options.whitespace&&!0!==this.options.trimValue||(e=a.trimString(e)),e},_isDateInput:function(){var e=this.constraintsByName.type;return e&&"date"===e.requirements},_getGroupedConstraints:function(){if(!1===this.options.priorityEnabled)return[this.constraints];for(var e=[],t={},i=0;i<this.constraints.length;i++){var n=this.constraints[i].priority;t[n]||e.push(t[n]=[]),t[n].push(this.constraints[i])}return e.sort(function(e,t){return t[0].priority-e[0].priority}),e}};var x=A,$=function(){this.__class__="FieldMultiple"};$.prototype={addElement:function(e){return this.$elements.push(e),this},_refreshConstraints:function(){var t;if(this.constraints=[],"SELECT"===this.element.nodeName)return this.actualizeOptions()._bindConstraints(),this;for(var i=0;i<this.$elements.length;i++)if(e("html").has(this.$elements[i]).length){t=this.$elements[i].data("FieldMultiple")._refreshConstraints().constraints;for(var n=0;n<t.length;n++)this.addConstraint(t[n].name,t[n].requirements,t[n].priority,t[n].isDomConstraint)}else this.$elements.splice(i,1);return this},getValue:function(){if("function"==typeof this.options.value)return this.options.value(this);if("undefined"!=typeof this.options.value)return this.options.value;if("INPUT"===this.element.nodeName){var t=a.getType(this.element);if("radio"===t)return this._findRelated().filter(":checked").val()||"";if("checkbox"===t){var i=[];return this._findRelated().filter(":checked").each(function(){i.push(e(this).val())}),i}}return"SELECT"===this.element.nodeName&&null===this.$element.val()?[]:this.$element.val()},_init:function(){return this.$elements=[this.$element],this}};var P=function(t,i,n){this.element=t,this.$element=e(t);var r=this.$element.data("Parsley");if(r)return"undefined"!=typeof n&&r.parent===window.Parsley&&(r.parent=n,r._resetOptions(r.options)),"object"==typeof i&&_extends(r.options,i),r;if(!this.$element.length)throw new Error("You must bind Parsley on an existing element.");if("undefined"!=typeof n&&"Form"!==n.__class__)throw new Error("Parent instance must be a Form instance");return this.parent=n||window.Parsley,this.init(i)};P.prototype={init:function(e){return this.__class__="Parsley",this.__version__="2.8.1",this.__id__=a.generateID(),this._resetOptions(e),"FORM"===this.element.nodeName||a.checkAttr(this.element,this.options.namespace,"validate")&&!this.$element.is(this.options.inputs)?this.bind("parsleyForm"):this.isMultiple()?this.handleMultiple():this.bind("parsleyField")},isMultiple:function(){var e=a.getType(this.element);return"radio"===e||"checkbox"===e||"SELECT"===this.element.nodeName&&null!==this.element.getAttribute("multiple")},handleMultiple:function(){var t,i,n=this;if(this.options.multiple=this.options.multiple||(t=this.element.getAttribute("name"))||this.element.getAttribute("id"),"SELECT"===this.element.nodeName&&null!==this.element.getAttribute("multiple"))return this.options.multiple=this.options.multiple||this.__id__,this.bind("parsleyFieldMultiple");if(!this.options.multiple)return a.warn("To be bound by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.",this.$element),this;this.options.multiple=this.options.multiple.replace(/(:|\.|\[|\]|\{|\}|\$)/g,""),t&&e('input[name="'+t+'"]').each(function(e,t){var i=a.getType(t);"radio"!==i&&"checkbox"!==i||t.setAttribute(n.options.namespace+"multiple",n.options.multiple)});for(var r=this._findRelated(),s=0;s<r.length;s++)if(i=e(r.get(s)).data("Parsley"),"undefined"!=typeof i){this.$element.data("FieldMultiple")||i.addElement(this.$element);break}return this.bind("parsleyField",!0),i||this.bind("parsleyFieldMultiple")},bind:function(t,i){var n;switch(t){case"parsleyForm":n=e.extend(new w(this.element,this.domOptions,this.options),new l,window.ParsleyExtend)._bindFields();break;case"parsleyField":n=e.extend(new x(this.element,this.domOptions,this.options,this.parent),new l,window.ParsleyExtend);break;case"parsleyFieldMultiple":n=e.extend(new x(this.element,this.domOptions,this.options,this.parent),new $,new l,window.ParsleyExtend)._init();break;default:throw new Error(t+"is not a supported Parsley type")}return this.options.multiple&&a.setAttr(this.element,this.options.namespace,"multiple",this.options.multiple),"undefined"!=typeof i?(this.$element.data("FieldMultiple",n),n):(this.$element.data("Parsley",n),n._actualizeTriggers(),n._trigger("init"),n)}};var V=e.fn.jquery.split(".");if(parseInt(V[0])<=1&&parseInt(V[1])<8)throw"The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.";V.forEach||a.warn("Parsley requires ES5 to run properly. Please include https://github.com/es-shims/es5-shim");var T=_extends(new l,{element:document,$element:e(document),actualizeOptions:null,_resetOptions:null,Factory:P,version:"2.8.1"});_extends(x.prototype,y.Field,l.prototype),_extends(w.prototype,y.Form,l.prototype),_extends(P.prototype,l.prototype),e.fn.parsley=e.fn.psly=function(t){if(this.length>1){var i=[];return this.each(function(){i.push(e(this).parsley(t))}),i}if(0!=this.length)return new P(this[0],t)},"undefined"==typeof window.ParsleyExtend&&(window.ParsleyExtend={}),T.options=_extends(a.objectCreate(o),window.ParsleyConfig),window.ParsleyConfig=T.options,window.Parsley=window.psly=T,T.Utils=a,window.ParsleyUtils={},e.each(a,function(e,t){"function"==typeof t&&(window.ParsleyUtils[e]=function(){return a.warnOnce("Accessing `window.ParsleyUtils` is deprecated. Use `window.Parsley.Utils` instead."),a[e].apply(a,arguments)})});var O=window.Parsley._validatorRegistry=new p(window.ParsleyConfig.validators,window.ParsleyConfig.i18n);window.ParsleyValidator={},e.each("setLocale addCatalog addMessage addMessages getErrorMessage formatMessage addValidator updateValidator removeValidator hasValidator".split(" "),function(e,t){window.Parsley[t]=function(){return O[t].apply(O,arguments)},window.ParsleyValidator[t]=function(){var e;return a.warnOnce("Accessing the method '"+t+"' through Validator is deprecated. Simply call 'window.Parsley."+t+"(...)'"),(e=window.Parsley)[t].apply(e,arguments)}}),window.Parsley.UI=y,window.ParsleyUI={removeError:function(e,t,i){var n=!0!==i;return a.warnOnce("Accessing UI is deprecated. Call 'removeError' on the instance directly. Please comment in issue 1073 as to your need to call this method."),e.removeError(t,{updateClass:n})},getErrorsMessages:function(e){return a.warnOnce("Accessing UI is deprecated. Call 'getErrorsMessages' on the instance directly."),e.getErrorsMessages()}},e.each("addError updateError".split(" "),function(e,t){window.ParsleyUI[t]=function(e,i,n,r,s){var o=!0!==s;return a.warnOnce("Accessing UI is deprecated. Call '"+t+"' on the instance directly. Please comment in issue 1073 as to your need to call this method."),e[t](i,{message:n,assert:r,updateClass:o})}}),!1!==window.ParsleyConfig.autoBind&&e(function(){e("[data-parsley-validate]").length&&e("[data-parsley-validate]").parsley()});var M=e({}),R=function(){a.warnOnce("Parsley's pubsub module is deprecated; use the 'on' and 'off' methods on parsley instances or window.Parsley")},D="parsley:";e.listen=function(e,n){var r;if(R(),"object"==typeof arguments[1]&&"function"==typeof arguments[2]&&(r=arguments[1],n=arguments[2]),"function"!=typeof n)throw new Error("Wrong parameters");window.Parsley.on(i(e),t(n,r))},e.listenTo=function(e,n,r){if(R(),!(e instanceof x||e instanceof w))throw new Error("Must give Parsley instance");if("string"!=typeof n||"function"!=typeof r)throw new Error("Wrong parameters");e.on(i(n),t(r))},e.unsubscribe=function(e,t){if(R(),"string"!=typeof e||"function"!=typeof t)throw new Error("Wrong arguments");window.Parsley.off(i(e),t.parsleyAdaptedCallback)},e.unsubscribeTo=function(e,t){if(R(),!(e instanceof x||e instanceof w))throw new Error("Must give Parsley instance");e.off(i(t))},e.unsubscribeAll=function(t){R(),window.Parsley.off(i(t)),e("form,input,textarea,select").each(function(){var n=e(this).data("Parsley");n&&n.off(i(t))})},e.emit=function(e,t){var n;R();var r=t instanceof x||t instanceof w,s=Array.prototype.slice.call(arguments,r?2:1);s.unshift(i(e)),r||(t=window.Parsley),(n=t).trigger.apply(n,_toConsumableArray(s))};e.extend(!0,T,{asyncValidators:{"default":{fn:function(e){return e.status>=200&&e.status<300},url:!1},reverse:{fn:function(e){return e.status<200||e.status>=300},url:!1}},addAsyncValidator:function(e,t,i,n){return T.asyncValidators[e]={fn:t,url:i||!1,options:n||{}},this}}),T.addValidator("remote",{requirementType:{"":"string",validator:"string",reverse:"boolean",options:"object"},validateString:function(t,i,n,r){var s,a,o={},l=n.validator||(!0===n.reverse?"reverse":"default");if("undefined"==typeof T.asyncValidators[l])throw new Error("Calling an undefined async validator: `"+l+"`");i=T.asyncValidators[l].url||i,i.indexOf("{value}")>-1?i=i.replace("{value}",encodeURIComponent(t)):o[r.element.getAttribute("name")||r.element.getAttribute("id")]=t;var u=e.extend(!0,n.options||{},T.asyncValidators[l].options);s=e.extend(!0,{},{url:i,data:o,type:"GET"},u),r.trigger("field:ajaxoptions",r,s),a=e.param(s),"undefined"==typeof T._remoteCache&&(T._remoteCache={});var d=T._remoteCache[a]=T._remoteCache[a]||e.ajax(s),h=function(){var t=T.asyncValidators[l].fn.call(r,d,i,n);return t||(t=e.Deferred().reject()),e.when(t)};return d.then(h,h)},priority:-1}),T.on("form:submit",function(){T._remoteCache={}}),l.prototype.addAsyncValidator=function(){return a.warnOnce("Accessing the method `addAsyncValidator` through an instance is deprecated. Simply call `Parsley.addAsyncValidator(...)`"),T.addAsyncValidator.apply(T,arguments)},T.addMessages("en",{defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",number:"This value should be a valid number.",integer:"This value should be a valid integer.",digits:"This value should be digits.",alphanum:"This value should be alphanumeric."},notblank:"This value should not be blank.",required:"This value is required.",pattern:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or fewer.",length:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or fewer.",check:"You must select between %s and %s choices.",equalto:"This value should be the same."}),T.setLocale("en");var I=new n;I.install();var q=T;return q});Parsley.addMessages('en',{defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",number:"This value should be a valid number.",integer:"This value should be a valid integer.",digits:"This value should be digits.",alphanum:"This value should be alphanumeric."},notblank:"This value should not be blank.",required:"This value is required.",pattern:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or fewer.",length:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or fewer.",check:"You must select between %s and %s choices.",equalto:"This value should be the same."});Parsley.setLocale('en');
/*! Select2 4.0.5 | https://github.com/select2/select2/blob/master/LICENSE.md */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)var b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if("."===(m=a[k]))a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if((e=p[o.slice(0,l).join("/")])&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){var d=w.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),o.apply(b,d.concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){r[a]=b}}function j(a){if(e(s,a)){var c=s[a];delete s[a],u[a]=!0,n.apply(b,c)}if(!e(r,a)&&!e(u,a))throw new Error("No "+a);return r[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return void 0!==b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(a,c,d,f){var h,k,m,n,o,t,v,w=[],x=typeof d;if(f=f||a,t=l(f),"undefined"===x||"function"===x){for(c=!c.length&&d.length?["require","exports","module"]:c,o=0;o<c.length;o+=1)if(n=p(c[o],t),"require"===(k=n.f))w[o]=q.require(a);else if("exports"===k)w[o]=q.exports(a),v=!0;else if("module"===k)h=w[o]=q.module(a);else if(e(r,k)||e(s,k)||e(u,k))w[o]=j(k);else{if(!n.p)throw new Error(a+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=d?d.apply(r[a],w):void 0,a&&(h&&h.exports!==b&&h.exports!==r[a]?r[a]=h.exports:m===b&&v||(r[a]=m))}else a&&(r[a]=d)},a=c=o=function(a,c,d,e,f){if("string"==typeof a)return q[a]?q[a](c):j(p(a,l(c)).f);if(!a.splice){if(t=a,t.deps&&o(t.deps,t.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?n(b,a,c,d):setTimeout(function(){n(b,a,c,d)},4),o},o.config=function(a){return o(a)},a._defined=r,d=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(r,a)||e(s,a)||(s[a]=[a,b,c])},d.amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b){"function"==typeof b[d]&&("constructor"!==d&&c.push(d))}return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}function e(){this.constructor=d}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new e;for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=(function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){return Array.prototype.unshift.call(arguments,b),e.apply(this,arguments)}}),k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice,c=b.call(arguments,1);this.listeners=this.listeners||{},null==c&&(c=[]),0===c.length&&c.push({}),c[0]._type=a,a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;c<a;c++){b+=Math.floor(36*Math.random()).toString(36)}return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];f=f.substring(0,1).toLowerCase()+f.substring(1),f in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return(e!==f||"hidden"!==f&&"visible"!==f)&&("scroll"===e||"scroll"===f||(d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth))},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),d[0].className+=" select2-results__message",this.$results.append(d)},c.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},c.prototype.append=function(a){this.hideLoading();var b=[];if(null==a.results||0===a.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)},c.prototype.position=function(a,b){b.find(".select2-results").append(a)},c.prototype.sort=function(a){return this.options.get("sorter")(a)},c.prototype.highlightFirstItem=function(){var a=this.$results.find(".select2-results__option[aria-selected]"),b=a.filter("[aria-selected=true]");b.length>0?b.first().trigger("mouseenter"):a.first().trigger("mouseenter"),this.ensureHighlightVisible()},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()});b.$results.find(".select2-results__option[aria-selected]").each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")})})},c.prototype.showLoading=function(a){this.hideLoading();var b=this.options.get("translations").get("searching"),c={disabled:!0,loading:!0,text:b(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),d["aria-label"]=b.text,b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group";a(h);this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b,c){var d=this,e=b.id+"-results";this.$results.attr("id",e),b.on("results:all",function(a){d.clear(),d.append(a.data),b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("results:append",function(a){d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("query",function(a){d.hideMessages(),d.showLoading(a)}),b.on("select",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("unselect",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("open",function(){d.$results.attr("aria-expanded","true"),d.$results.attr("aria-hidden","false"),d.setClasses(),d.ensureHighlightVisible()}),b.on("close",function(){d.$results.attr("aria-expanded","false"),d.$results.attr("aria-hidden","true"),d.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=d.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=d.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?d.trigger("close",{}):d.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a);if(0!==c){var e=c-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top,h=f.offset().top,i=d.$results.scrollTop()+(h-g);0===e?d.$results.scrollTop(0):h-g<0&&d.$results.scrollTop(i)}}),b.on("results:next",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a),e=c+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top+d.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=d.$results.scrollTop()+h-g;0===e?d.$results.scrollTop(0):h>g&&d.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){d.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=d.$results.scrollTop(),c=d.$results.get(0).scrollHeight-b+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&c<=d.$results.height();e?(d.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(d.$results.scrollTop(d.$results.get(0).scrollHeight-d.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var c=a(this),e=c.data("data");if("true"===c.attr("aria-selected"))return void(d.options.get("multiple")?d.trigger("unselect",{originalEvent:b,data:e}):d.trigger("close",{}));d.trigger("select",{originalEvent:b,data:e})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(b){var c=a(this).data("data");d.getHighlightedResults().removeClass("select2-results__option--highlighted"),d.trigger("results:focus",{data:c,element:a(this)})})},c.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var b=this.$results.find("[aria-selected]"),c=b.index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),c<=2?this.$results.scrollTop(0):(g>this.$results.outerHeight()||g<0)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b,c);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a,b){var d=this,e=(a.id,a.id+"-results");this.container=a,this.$selection.on("focus",function(a){d.trigger("focus",a)}),this.$selection.on("blur",function(a){d._handleBlur(a)}),this.$selection.on("keydown",function(a){d.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){d.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){d.update(a.data)}),a.on("open",function(){d.$selection.attr("aria-expanded","true"),d.$selection.attr("aria-owns",e),d._attachCloseHandler(a)}),a.on("close",function(){d.$selection.attr("aria-expanded","false"),d.$selection.removeAttr("aria-activedescendant"),d.$selection.removeAttr("aria-owns"),d.$selection.focus(),d._detachCloseHandler(a)}),a.on("enable",function(){d.$selection.attr("tabindex",d._tabindex)}),a.on("disable",function(){d.$selection.attr("tabindex","-1")})},d.prototype._handleBlur=function(b){var c=this;window.setTimeout(function(){document.activeElement==c.$selection[0]||a.contains(c.$selection[0],document.activeElement)||c.trigger("blur",b)},1)},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var c=a(b.target),d=c.closest(".select2");a(".select2.select2-container--open").each(function(){var b=a(this);this!=d[0]&&b.data("element").select2("close")})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){b.find(".selection").append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(a){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c,d){function e(){e.__super__.constructor.apply(this,arguments)}return c.Extend(e,b),e.prototype.render=function(){var a=e.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},e.prototype.bind=function(a,b){var c=this;e.__super__.bind.apply(this,arguments);var d=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",d),this.$selection.attr("aria-labelledby",d),this.$selection.on("mousedown",function(a){1===a.which&&c.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(a){}),this.$selection.on("blur",function(a){}),a.on("focus",function(b){a.isOpen()||c.$selection.focus()}),a.on("selection:update",function(a){c.update(a.data)})},e.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},e.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},e.prototype.selectionContainer=function(){return a("<span></span>")},e.prototype.update=function(a){if(0===a.length)return void this.clear();var b=a[0],c=this.$selection.find(".select2-selection__rendered"),d=this.display(b,c);c.empty().append(d),c.prop("title",b.title||b.text)},e}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(a,b){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(b,c){var e=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){e.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(b){if(!e.options.get("disabled")){var c=a(this),d=c.parent(),f=d.data("data");e.trigger("unselect",{originalEvent:b,data:f})}})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},d.prototype.selectionContainer=function(){return a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.selectionContainer(),g=this.display(e,f);f.append(g),f.prop("title",e.title||e.text),f.data("data",e),b.push(f)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(a){function b(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return b.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},b.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},b.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id;if(b.length>1||c)return a.call(this,b);this.clear();var d=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(d)},b}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||c.which!=b.DELETE&&c.which!=b.BACKSPACE||this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return this._transferTabIndex(),d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.trigger("focus")}),b.on("close",function(){e.$search.val(""),e.$search.removeAttr("aria-activedescendant"),e.$search.trigger("focus")}),b.on("enable",function(){e.$search.prop("disabled",!1),e._transferTabIndex()}),b.on("disable",function(){e.$search.prop("disabled",!0)}),b.on("focus",function(a){e.$search.trigger("focus")}),b.on("results:focus",function(a){e.$search.attr("aria-activedescendant",a.id)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e._handleBlur(a)}),this.$selection.on("keydown",".select2-search--inline",function(a){if(a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented(),a.which===c.BACKSPACE&&""===e.$search.val()){var b=e.$searchContainer.prev(".select2-selection__choice");if(b.length>0){var d=b.data("data");e.searchRemoveChoice(d),a.preventDefault()}}});var f=document.documentMode,g=f&&f<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(a){if(g)return void e.$selection.off("input.search input.searchcheck");e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(a){if(g&&"input"===a.type)return void e.$selection.off("input.search input.searchcheck");var b=a.which;b!=c.SHIFT&&b!=c.CTRL&&b!=c.ALT&&b!=c.TAB&&e.handleSearch(a)})},d.prototype._transferTabIndex=function(a){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){var c=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),c&&this.$search.focus()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.$search.val(b.text),this.handleSearch()},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";if(""!==this.$search.attr("placeholder"))a=this.$selection.find(".select2-selection__rendered").innerWidth();else{a=.75*(this.$search.val().length+1)+"em"}this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){return{"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}}),b.define("select2/data/base",["../utils"],function(a){function b(a,c){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(a){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(a,b){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(a,b){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),null!=c.id?d+="-"+c.id.toString():d+="-"+a.generateChars(4),d},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(d){var e=[];a=[a],a.push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){var b=this;if(this.$element.prop("multiple")){if(a.selected=!1,c(a.element).is("option"))return a.element.selected=!1,void this.$element.trigger("change");this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})}},d.prototype.bind=function(a,b){var c=this;this.container=a,a.on("select",function(a){c.select(a.data)}),a.on("unselect",function(a){c.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this;this.$element.children().each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):(b=document.createElement("option"),void 0!==b.textContent?b.textContent=a.text:b.innerText=a.text),void 0!==a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};if(null!=(b=c.data(a[0],"data")))return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a}),a=c.extend({},{text:""},a);var b={selected:!1,disabled:!1};return null!=a.id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},b,a)},d.prototype.matches=function(a,b){return this.options.get("matcher")(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=c.extend(!0,{},j,l),n=this.option(m);k.replaceWith(n)}else{var o=this.option(j);if(j.children){var p=this.convertToOptions(j.children);b.appendMany(o,p)}h.push(o)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(a,b){this.ajaxOptions=this._applyDefaults(b.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),d.__super__.constructor.call(this,a,b)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return c.extend({},a,{q:a.term})},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){d.status&&"0"===d.status||e.trigger("results:message",{message:"errorLoading"})});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url.call(this.$element,a)),"function"==typeof f.data&&(f.data=f.data.call(this.$element,a)),this.ajaxOptions.delay&&null!=a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");void 0!==f&&(this.createTag=f);var g=d.get("insertTag");if(void 0!==g&&(this.insertTag=g),b.call(this,c,d),a.isArray(e))for(var h=0;h<e.length;h++){var i=e[h],j=this._normalizeItem(i),k=this.option(j);this.$element.append(k)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0);if((i.text||"").toUpperCase()===(b.term||"").toUpperCase()||j)return!f&&(a.data=g,void c(a))}if(f)return!0;var k=e.createTag(b);if(null!=k){var l=e.option(k);l.attr("data-select2-tag",!0),e.addOptions([l]),e.insertTag(g,k)}a.results=g,c(a)}var e=this;if(this._removeOldTags(),null==b.term||null!=b.page)return void a.call(this,b,c);a.call(this,b,d)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(b){this._lastTag;this.$element.find("option[data-select2-tag]").each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(b,c,d){function e(b){var c=g._normalizeItem(b);if(!g.$element.find("option").filter(function(){return a(this).val()===c.id}).length){var d=g.option(c);d.attr("data-select2-tag",!0),g._removeOldTags(),g.addOptions([d])}f(c)}function f(a){g.trigger("select",{data:a})}var g=this;c.term=c.term||"";var h=this.tokenizer(c,this.options,e);h.term!==c.term&&(this.$search.length&&(this.$search.val(h.term),this.$search.focus()),c.term=h.term),b.call(this,c,d)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),l=a.extend({},c,{term:k}),m=i(l);null!=m?(e(m),g=g.substr(h+1)||"",h=0):h++}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){if(b.term=b.term||"",b.term.length<this.minimumInputLength)return void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}});a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){if(b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength)return void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}});a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;if(d.maximumSelectionLength>0&&f>=d.maximumSelectionLength)return void d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}});a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.bind=function(){},c.prototype.position=function(a,b){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a,b){function c(){}return c.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},c.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(b){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("focus",function(){c.isOpen()||e.$search.focus()}),c.on("results:all",function(a){if(null==a.query.term||""===a.query.term){e.showSearch(a)?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide")}})},c.prototype.handleSearch=function(a){if(!this._keyUpPrevented){var b=this.$search.val();this.trigger("query",{term:b})}this._keyUpPrevented=!1},c.prototype.showSearch=function(a,b){return!0},c}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);if(!e.loading&&b){e.$results.offset().top+e.$results.outerHeight(!1)+50>=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1)&&e.loadMore()}})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(b,c,d){this.$dropdownParent=d.get("dropdownParent")||a(document.body),b.call(this,c,d)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.destroy=function(a){a.call(this),this.$dropdownContainer.remove()},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c,d){var e=this,f="scroll.select2."+d.id,g="resize.select2."+d.id,h="orientationchange.select2."+d.id,i=this.$container.parents().filter(b.hasScroll);i.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),i.on(f,function(b){var c=a(this).data("select2-scroll-position");a(this).scrollTop(c.y)}),a(window).on(f+" "+g+" "+h,function(a){e._positionDropdown(),e._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c,d){var e="scroll.select2."+d.id,f="resize.select2."+d.id,g="orientationchange.select2."+d.id;this.$container.parents().filter(b.hasScroll).off(e),a(window).off(e+" "+f+" "+g)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=this.$container.offset();f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h={height:this.$dropdown.outerHeight(!1)},i={top:b.scrollTop(),bottom:b.scrollTop()+b.height()},j=i.top<f.top-h.height,k=i.bottom>f.bottom+h.height,l={left:f.left,top:g.bottom},m=this.$dropdownParent;"static"===m.css("position")&&(m=m.offsetParent());var n=m.offset();l.top-=n.top,l.left-=n.left,c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-n.top-h.height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.position="relative",a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return!(a(c.data.results)<this.minimumResultsForSearch)&&b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(a){d._handleSelectOnClose(a)})},a.prototype._handleSelectOnClose=function(a,b){if(b&&null!=b.originalSelect2Event){var c=b.originalSelect2Event;if("select"===c._type||"unselect"===c._type)return}var d=this.getHighlightedResults();if(!(d.length<1)){var e=d.data("data");null!=e.element&&e.element.selected||null==e.element&&e.selected||this.trigger("select",{data:e})}},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close",{originalEvent:c,originalSelect2Event:b})},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){return"Please enter "+(a.minimum-a.input.length)+" or more characters"},loadingMore:function(){return"Loading more results"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}return D.prototype.apply=function(l){if(l=a.extend(!0,{},this.defaults,l),null==l.dataAdapter){if(null!=l.ajax?l.dataAdapter=o:null!=l.data?l.dataAdapter=n:l.dataAdapter=m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),null==l.tokenSeparators&&null==l.tokenizer||(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.multiple?l.selectionAdapter=e:l.selectionAdapter=d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var H=l.language.split("-"),I=H[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(a){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(a){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var O=k.loadPath(this.defaults.amdLanguageBase+"en"),P=new k(l.language);P.extend(O),l.translations=P}return l},D.prototype.reset=function(){function b(a){function b(a){return l[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--){null==c(d,e.children[g])&&f.children.splice(g,1)}return f.children.length>0?f:c(d,f)}var h=b(e.text).toUpperCase(),i=b(d.term).toUpperCase();return h.indexOf(i)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var d=a.camelCase(b),e={};e[d]=c;var f=j._convertData(e);a.extend(this.defaults,f)},new D}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(a.prop("dir")?this.options.dir=a.prop("dir"):a.closest("[dir]").prop("dir")?this.options.dir=a.closest("[dir]").prop("dir"):this.options.dir="ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b=b.replace(/(:|\.|\[|\]|,)/g,""),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return e<=0?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;h<i;h+=1){var j=g[h].replace(/\s/g,""),k=j.match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this.$element.on("focus.select2",function(a){b.trigger("focus",a)}),this._syncA=c.bind(this._syncAttributes,this),this._syncS=c.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._syncA),a.each(c,b._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",b._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",b._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",b._syncS,!1))},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle","focus"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("focus",function(a){b.focus(a)}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open",{}),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ESC||c===d.TAB||c===d.UP&&b.altKey?(a.close(),b.preventDefault()):c===d.ENTER?(a.trigger("results:select",{}),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle",{}),b.preventDefault()):c===d.UP?(a.trigger("results:previous",{}),b.preventDefault()):c===d.DOWN&&(a.trigger("results:next",{}),b.preventDefault()):(c===d.ENTER||c===d.SPACE||c===d.DOWN&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},e.prototype._syncSubtree=function(a,b){var c=!1,d=this;if(!a||!a.target||"OPTION"===a.target.nodeName||"OPTGROUP"===a.target.nodeName){if(b)if(b.addedNodes&&b.addedNodes.length>0)for(var e=0;e<b.addedNodes.length;e++){var f=b.addedNodes[e];f.selected&&(c=!0)}else b.removedNodes&&b.removedNodes.length>0&&(c=!0);else c=!0;c&&this.dataAdapter.current(function(a){d.trigger("selection:update",{data:a})})}},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===b&&(b={}),a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||this.trigger("query",{})},e.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},e.prototype.focus=function(a){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=a&&0!==a.length||(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("select2/compat/utils",["jquery"],function(a){function b(b,c,d){var e,f,g=[];e=a.trim(b.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each(function(){0===this.indexOf("select2-")&&g.push(this)})),e=a.trim(c.attr("class")),e&&(e=""+e,a(e.split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(f=d(this))&&g.push(f)})),b.attr("class",g.join(" "))}return{syncCssClasses:b}}),b.define("select2/compat/containerCss",["jquery","./utils"],function(a,b){function c(a){return null}function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("containerCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptContainerCssClass");if(g=g||c,-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("containerCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/dropdownCss",["jquery","./utils"],function(a,b){function c(a){return null}function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("dropdownCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptDropdownCssClass");if(g=g||c,-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("dropdownCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/initSelection",["jquery"],function(a){function b(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=c.get("initSelection"),this._isInitialized=!1,a.call(this,b,c)}return b.prototype.current=function(b,c){var d=this;if(this._isInitialized)return void b.call(this,c);this.initSelection.call(null,this.$element,function(b){d._isInitialized=!0,a.isArray(b)||(b=[b]),c(b)})},b}),b.define("select2/compat/inputData",["jquery"],function(a){function b(a,b,c){this._currentData=[],this._valueSeparator=c.get("valueSeparator")||",","hidden"===b.prop("type")&&c.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),a.call(this,b,c)}return b.prototype.current=function(b,c){function d(b,c){var e=[];return b.selected||-1!==a.inArray(b.id,c)?(b.selected=!0,e.push(b)):b.selected=!1,b.children&&e.push.apply(e,d(b.children,c)),e}for(var e=[],f=0;f<this._currentData.length;f++){var g=this._currentData[f];e.push.apply(e,d(g,this.$element.val().split(this._valueSeparator)))}c(e)},b.prototype.select=function(b,c){if(this.options.get("multiple")){var d=this.$element.val();d+=this._valueSeparator+c.id,this.$element.val(d),this.$element.trigger("change")}else this.current(function(b){a.map(b,function(a){a.selected=!1})}),this.$element.val(c.id),this.$element.trigger("change")},b.prototype.unselect=function(a,b){var c=this;b.selected=!1,this.current(function(a){for(var d=[],e=0;e<a.length;e++){var f=a[e];b.id!=f.id&&d.push(f.id)}c.$element.val(d.join(c._valueSeparator)),c.$element.trigger("change")})},b.prototype.query=function(a,b,c){for(var d=[],e=0;e<this._currentData.length;e++){var f=this._currentData[e],g=this.matches(b,f);null!==g&&d.push(g)}c({results:d})},b.prototype.addOptions=function(b,c){var d=a.map(c,function(b){return a.data(b[0],"data")});this._currentData.push.apply(this._currentData,d)},b}),b.define("select2/compat/matcher",["jquery"],function(a){function b(b){function c(c,d){var e=a.extend(!0,{},d);if(null==c.term||""===a.trim(c.term))return e;if(d.children){for(var f=d.children.length-1;f>=0;f--){var g=d.children[f];b(c.term,g.text,g)||e.children.splice(f,1)}if(e.children.length>0)return e}return b(c.term,d.text,d)?e:null}return c}return b}),b.define("select2/compat/query",[],function(){function a(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),a.call(this,b,c)}return a.prototype.query=function(a,b,c){b.callback=c,this.options.get("query").call(null,b)},a}),b.define("select2/dropdown/attachContainer",[],function(){function a(a,b,c){a.call(this,b,c)}return a.prototype.position=function(a,b,c){c.find(".dropdown-wrapper").append(b),b.addClass("select2-dropdown--below"),c.addClass("select2-container--below")},a}),b.define("select2/dropdown/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);var d=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$dropdown.on(d.join(" "),function(a){a.stopPropagation()})},a}),b.define("select2/selection/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);var d=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$selection.on(d.join(" "),function(a){a.stopPropagation()})},a}),function(c){"function"==typeof b.define&&b.define.amd?b.define("jquery-mousewheel",["jquery"],c):"object"==typeof exports?module.exports=c:c(a)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),b.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(a,b,c,d){if(null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if("object"==typeof(b=b||{}))return this.each(function(){var d=a.extend(!0,{},b);new c(a(this),d)}),this;if("string"==typeof b){var d,f=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=a(this).data("select2");null==c&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2."),d=c[b].apply(c,f)}),a.inArray(b,e)>-1?this:d}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports["Polycast"]=factory();else
root["Polycast"]=factory();})(this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports){(function(){this.Polycast=function(){this.options={};this.channels={};this.timeout=null;this.connected=false;this.events={};var defaults={url:null,polling:5,token:null,data:''};if(arguments[0]&&typeof arguments[0]==="object"){this.options=this.extend(defaults,arguments[0]);}else if(arguments[0]&&typeof arguments[0]==="string"){if(arguments[1]&&typeof arguments[1]==="object"){var opts=this.extend({url:arguments[0]},arguments[1]);this.options=this.extend(defaults,opts);}else{this.options=this.extend(defaults,{url:arguments[0]});}}else{throw"Polycast url must be defined!";}
this.init();return this;};this.Polycast.prototype={init:function(){var PolycastObject=this;var params=this.serialize({polling:this.options.polling,'_token':this.options.token});var xhr=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");xhr.open('POST',this.options.url+'/connect');xhr.onreadystatechange=function(){if(xhr.readyState>3){if(xhr.status===200){maybeShowConnectionRestored();response=JSON.parse(xhr.responseText);if(response.status=='success'){PolycastObject.connected=true;PolycastObject.setTime(response.time);PolycastObject.setTimeout();console.log('Polycast connection established!');PolycastObject.fire('connect',PolycastObject);}}else{console.log(xhr);maybeShowConnectionError();setTimeout(function(){PolycastObject.init();},(PolycastObject.options.polling*1000));}}};xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(params);return this;},reconnect:function(){if(this.connected){return;}
this.init();return this;},on:function(event,callback){if(this.events[event]===undefined){this.events[event]=[];}
this.events[event].push(callback);return this;},fire:function(event,data){if(this.events[event]===undefined){this.events[event]=[];}
for(var callback in this.events[event]){if(this.events[event].hasOwnProperty(callback)){var func=this.events[event][callback];func(data);}}},disconnect:function(){this.connected=false;clearTimeout(this.timeout);this.timeout=null;this.fire('disconnect',this);return this;},extend:function(source,properties){var property;for(property in properties){if(properties.hasOwnProperty(property)){source[property]=properties[property];}}
return source;},setTime:function(time){this.options.time=time;},setTimeout:function(){var PolycastObject=this;this.timeout=setTimeout(function(){PolycastObject.fetch();},(this.options.polling*1000));},fetch:function(){this.request();},request:function(){var PolycastObject=this;var channelData={};for(var channel in this.channels){if(this.channels.hasOwnProperty(channel)){if(channelData[channel]===undefined){channelData[channel]=[];}
for(var i=0;i<this.channels[channel].length;i++){var obj=this.channels[channel][i];var events=obj.events;for(var key in events){channelData[channel].push(key);}}}}
var data={time:this.options.time,channels:channelData,'_token':this.options.token,};if(typeof(this.options.data)!="undefined"){if(typeof(this.options.data)=="function"){data.data=this.options.data();}else if(Array.isArray(this.options.data)){for(var i in this.options.data){if(typeof(this.options.data[i])=="function"){if(typeof(data.data)!="undefined"){data.data=this.options.data[i](data.data);}else{data.data=this.options.data[i]({});}}}}else{data.data=this.options.data;}}
var params=this.serialize(data);var xhr=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");xhr.open('POST',this.options.url+'/receive');xhr.onreadystatechange=function(){if(xhr.readyState>3){if(xhr.status!==200){maybeShowConnectionError();}else{maybeShowConnectionRestored();}
PolycastObject.parseResponse(xhr.responseText);}else{}};xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(params);return xhr;},serialize:function(obj,prefix){var str=[];for(var p in obj){if(obj.hasOwnProperty(p)){var k=prefix?prefix+"["+p+"]":p,v=obj[p];str.push(typeof v=="object"?this.serialize(v,k):encodeURIComponent(k)+"="+encodeURIComponent(v));}}
return str.join("&");},parseResponse:function(response){try{response=JSON.parse(response);}catch(e){this.setTimeout();return;}
if(response.status=='success'){this.setTime(response.time);for(var payload in response.payloads){if(response.payloads.hasOwnProperty(payload)){for(i=0;i<response.payloads[payload]['channels'].length;++i){var channel=response.payloads[payload]['channels'][i].name;for(index=0;index<this.channels[channel].length;++index){this.channels[channel][index].fire(response.payloads[payload]);}}}}}
this.setTimeout();},subscribe:function(channel){var $channel=new PolycastChannel({channel:channel});if(this.channels[channel]===undefined){this.channels[channel]=[];}
this.channels[channel].push($channel);return $channel;}};this.PolycastChannel=function(){this.options={};this.events={};var defaults={channel:null};if(arguments[0]&&typeof arguments[0]==="object"){this.options=this.extend(defaults,arguments[0]);}else{throw"Polycast channel options must be defined!";}};this.PolycastChannel.prototype={init:function(){return this;},extend:function(source,properties){var property;for(property in properties){if(properties.hasOwnProperty(property)){source[property]=properties[property];}}
return source;},on:function(event,callback){if(this.events[event]===undefined){this.events[event]=[];}
this.events[event].push(callback);return this;},fire:function(event){for(var e in this.events){if(this.events.hasOwnProperty(e)){if(e==event.event){var func=this.events[e];if(event.delay!=0){setTimeout(function(){func[0](event.payload,event);},(event.delay*1000));}else{func[0](event.payload,event);}}}}}};this.Polycast.version='1.0.0';this.PolycastChannel.version='1.0.0';module.exports=this.Polycast;}());}])});;!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):i.Push=t()}(this,function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(t)}function t(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function n(i,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}function e(i,t,e){return t&&n(i.prototype,t),e&&n(i,e),i}function o(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}function r(i,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}var s="PushError:",c={errors:{incompatible:"".concat(s," Push.js is incompatible with browser."),invalid_plugin:"".concat(s," plugin class missing from plugin manifest (invalid plugin). Please check the documentation."),invalid_title:"".concat(s," title of notification must be a string"),permission_denied:"".concat(s," permission request declined"),sw_notification_error:"".concat(s," could not show a ServiceWorker notification due to the following reason: "),sw_registration_error:"".concat(s," could not register the ServiceWorker due to the following reason: "),unknown_interface:"".concat(s," unable to create notification: unknown interface")}},a=function(){function i(n){t(this,i),this._win=n,this.GRANTED="granted",this.DEFAULT="default",this.DENIED="denied",this._permissions=[this.GRANTED,this.DEFAULT,this.DENIED]}return e(i,[{key:"request",value:function(i,t){return arguments.length>0?this._requestWithCallback.apply(this,arguments):this._requestAsPromise()}},{key:"_requestWithCallback",value:function(i,t){var n=this,e=this.get(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n._win.Notification.permission;void 0===e&&n._win.webkitNotifications&&(e=n._win.webkitNotifications.checkPermission()),e===n.GRANTED||0===e?i&&i():t&&t()};e!==this.DEFAULT?o(e):this._win.webkitNotifications&&this._win.webkitNotifications.checkPermission?this._win.webkitNotifications.requestPermission(o):this._win.Notification&&this._win.Notification.requestPermission?this._win.Notification.requestPermission().then(o).catch(function(){t&&t()}):i&&i()}},{key:"_requestAsPromise",value:function(){var i=this,t=this.get(),n=t!==this.DEFAULT,e=this._win.Notification&&this._win.Notification.requestPermission,o=this._win.webkitNotifications&&this._win.webkitNotifications.checkPermission;return new Promise(function(r,s){var c=function(t){return function(t){return t===i.GRANTED||0===t}(t)?r():s()};n?c(t):o?i._win.webkitNotifications.requestPermission(function(i){c(i)}):e?i._win.Notification.requestPermission().then(function(i){c(i)}).catch(s):r()})}},{key:"has",value:function(){return this.get()===this.GRANTED}},{key:"get",value:function(){return this._win.Notification&&this._win.Notification.permission?this._win.Notification.permission:this._win.webkitNotifications&&this._win.webkitNotifications.checkPermission?this._permissions[this._win.webkitNotifications.checkPermission()]:navigator.mozNotification?this.GRANTED:this._win.external&&this._win.external.msIsSiteMode?this._win.external.msIsSiteMode()?this.GRANTED:this.DEFAULT:this.GRANTED}}]),i}(),u=function(){function n(){t(this,n)}return e(n,null,[{key:"isUndefined",value:function(i){return void 0===i}},{key:"isNull",value:function(i){return null===obj}},{key:"isString",value:function(i){return"string"==typeof i}},{key:"isFunction",value:function(i){return i&&"[object Function]"==={}.toString.call(i)}},{key:"isObject",value:function(t){return"object"===i(t)}},{key:"objectMerge",value:function(i,t){for(var n in t)i.hasOwnProperty(n)&&this.isObject(i[n])&&this.isObject(t[n])?this.objectMerge(i[n],t[n]):i[n]=t[n]}}]),n}(),f=function i(n){t(this,i),this._win=n},l=function(i){function n(){return t(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,f),e(n,[{key:"isSupported",value:function(){return void 0!==this._win.Notification}},{key:"create",value:function(i,t){return new this._win.Notification(i,{icon:u.isString(t.icon)||u.isUndefined(t.icon)||u.isNull(t.icon)?t.icon:t.icon.x32,body:t.body,tag:t.tag,requireInteraction:t.requireInteraction})}},{key:"close",value:function(i){i.close()}}]),n}(),h=function(i){function n(){return t(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,f),e(n,[{key:"isSupported",value:function(){return void 0!==this._win.navigator&&void 0!==this._win.navigator.serviceWorker}},{key:"getFunctionBody",value:function(i){var t=i.toString().match(/function[^{]+{([\s\S]*)}$/);return void 0!==t&&null!==t&&t.length>1?t[1]:null}},{key:"create",value:function(i,t,n,e,o){var r=this;this._win.navigator.serviceWorker.register(e),this._win.navigator.serviceWorker.ready.then(function(e){var s={id:i,link:n.link,origin:document.location.href,onClick:u.isFunction(n.onClick)?r.getFunctionBody(n.onClick):"",onClose:u.isFunction(n.onClose)?r.getFunctionBody(n.onClose):""};void 0!==n.data&&null!==n.data&&(s=Object.assign(s,n.data)),e.showNotification(t,{icon:n.icon,body:n.body,vibrate:n.vibrate,tag:n.tag,data:s,requireInteraction:n.requireInteraction,silent:n.silent}).then(function(){e.getNotifications().then(function(i){e.active.postMessage(""),o(i)})}).catch(function(i){throw new Error(c.errors.sw_notification_error+i.message)})}).catch(function(i){throw new Error(c.errors.sw_registration_error+i.message)})}},{key:"close",value:function(){}}]),n}(),_=function(i){function n(){return t(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,f),e(n,[{key:"isSupported",value:function(){return void 0!==this._win.navigator.mozNotification}},{key:"create",value:function(i,t){var n=this._win.navigator.mozNotification.createNotification(i,t.body,t.icon);return n.show(),n}}]),n}(),v=function(i){function n(){return t(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,f),e(n,[{key:"isSupported",value:function(){return void 0!==this._win.external&&void 0!==this._win.external.msIsSiteMode}},{key:"create",value:function(i,t){return this._win.external.msSiteModeClearIconOverlay(),this._win.external.msSiteModeSetIconOverlay(u.isString(t.icon)||u.isUndefined(t.icon)?t.icon:t.icon.x16,i),this._win.external.msSiteModeActivate(),null}},{key:"close",value:function(){this._win.external.msSiteModeClearIconOverlay()}}]),n}(),d=function(i){function n(){return t(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return o(n,f),e(n,[{key:"isSupported",value:function(){return void 0!==this._win.webkitNotifications}},{key:"create",value:function(i,t){var n=this._win.webkitNotifications.createNotification(t.icon,i,t.body);return n.show(),n}},{key:"close",value:function(i){i.cancel()}}]),n}();return new(function(){function i(n){t(this,i),this._currentId=0,this._notifications={},this._win=n,this.Permission=new a(n),this._agents={desktop:new l(n),chrome:new h(n),firefox:new _(n),ms:new v(n),webkit:new d(n)},this._configuration={serviceWorker:"/serviceWorker.min.js",fallback:function(i){}}}return e(i,[{key:"_closeNotification",value:function(i){var t=!0,n=this._notifications[i];if(void 0!==n){if(t=this._removeNotification(i),this._agents.desktop.isSupported())this._agents.desktop.close(n);else if(this._agents.webkit.isSupported())this._agents.webkit.close(n);else{if(!this._agents.ms.isSupported())throw t=!1,new Error(c.errors.unknown_interface);this._agents.ms.close()}return t}return!1}},{key:"_addNotification",value:function(i){var t=this._currentId;return this._notifications[t]=i,this._currentId++,t}},{key:"_removeNotification",value:function(i){var t=!1;return this._notifications.hasOwnProperty(i)&&(delete this._notifications[i],t=!0),t}},{key:"_prepareNotification",value:function(i,t){var n,e=this;return n={get:function(){return e._notifications[i]},close:function(){e._closeNotification(i)}},t.timeout&&setTimeout(function(){n.close()},t.timeout),n}},{key:"_serviceWorkerCallback",value:function(i,t,n){var e=this,o=this._addNotification(i[i.length-1]);navigator&&navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("message",function(i){var t=JSON.parse(i.data);"close"===t.action&&Number.isInteger(t.id)&&e._removeNotification(t.id)}),n(this._prepareNotification(o,t))),n(null)}},{key:"_createCallback",value:function(i,t,n){var e,o=this,r=null;if(t=t||{},e=function(i){o._removeNotification(i),u.isFunction(t.onClose)&&t.onClose.call(o,r)},this._agents.desktop.isSupported())try{r=this._agents.desktop.create(i,t)}catch(e){var s=this._currentId,c=this.config().serviceWorker,a=function(i){return o._serviceWorkerCallback(i,t,n)};this._agents.chrome.isSupported()&&this._agents.chrome.create(s,i,t,c,a)}else this._agents.webkit.isSupported()?r=this._agents.webkit.create(i,t):this._agents.firefox.isSupported()?this._agents.firefox.create(i,t):this._agents.ms.isSupported()?r=this._agents.ms.create(i,t):(t.title=i,this.config().fallback(t));if(null!==r){var f=this._addNotification(r),l=this._prepareNotification(f,t);u.isFunction(t.onShow)&&r.addEventListener("show",t.onShow),u.isFunction(t.onError)&&r.addEventListener("error",t.onError),u.isFunction(t.onClick)&&r.addEventListener("click",t.onClick),r.addEventListener("close",function(){e(f)}),r.addEventListener("cancel",function(){e(f)}),n(l)}n(null)}},{key:"create",value:function(i,t){var n,e=this;if(!u.isString(i))throw new Error(c.errors.invalid_title);return n=this.Permission.has()?function(n,o){try{e._createCallback(i,t,n)}catch(i){o(i)}}:function(n,o){e.Permission.request().then(function(){e._createCallback(i,t,n)}).catch(function(){o(c.errors.permission_denied)})},new Promise(n)}},{key:"count",value:function(){var i,t=0;for(i in this._notifications)this._notifications.hasOwnProperty(i)&&t++;return t}},{key:"close",value:function(i){var t;for(t in this._notifications)if(this._notifications.hasOwnProperty(t)&&this._notifications[t].tag===i)return this._closeNotification(t)}},{key:"clear",value:function(){var i,t=!0;for(i in this._notifications)this._notifications.hasOwnProperty(i)&&(t=t&&this._closeNotification(i));return t}},{key:"supported",value:function(){var i=!1;for(var t in this._agents)this._agents.hasOwnProperty(t)&&(i=i||this._agents[t].isSupported());return i}},{key:"config",value:function(i){return(void 0!==i||null!==i&&u.isObject(i))&&u.objectMerge(this._configuration,i),this._configuration}},{key:"extend",value:function(i){var t,n={}.hasOwnProperty;if(!n.call(i,"plugin"))throw new Error(c.errors.invalid_plugin);n.call(i,"config")&&u.isObject(i.config)&&null!==i.config&&this.config(i.config),t=new(0,i.plugin)(this.config());for(var e in t)n.call(t,e)&&u.isFunction(t[e])&&(this[e]=t[e])}}]),i}())("undefined"!=typeof window?window:global)});!function(a){"use strict";function b(a,c){if(!(this instanceof b)){var d=new b(a,c);return d.open(),d}this.id=b.id++,this.setup(a,c),this.chainCallbacks(b._callbackChain)}function c(a,b){var c={};for(var d in a)d in b&&(c[d]=a[d],delete a[d]);return c}function d(a,b){var c={},d=new RegExp("^"+b+"([A-Z])(.*)");for(var e in a){var f=e.match(d);if(f){var g=(f[1]+f[2].replace(/([A-Z])/g,"-$1")).toLowerCase();c[g]=a[e]}}return c}if("undefined"==typeof a)return void("console"in window&&window.console.info("Too much lightness, Featherlight needs jQuery."));if(a.fn.jquery.match(/-ajax/))return void("console"in window&&window.console.info("Featherlight needs regular jQuery, not the slim version."));var e=[],f=function(b){return e=a.grep(e,function(a){return a!==b&&a.$instance.closest("body").length>0})},g={allow:1,allowfullscreen:1,frameborder:1,height:1,longdesc:1,marginheight:1,marginwidth:1,mozallowfullscreen:1,name:1,referrerpolicy:1,sandbox:1,scrolling:1,src:1,srcdoc:1,style:1,webkitallowfullscreen:1,width:1},h={keyup:"onKeyUp",resize:"onResize"},i=function(c){a.each(b.opened().reverse(),function(){return c.isDefaultPrevented()||!1!==this[h[c.type]](c)?void 0:(c.preventDefault(),c.stopPropagation(),!1)})},j=function(c){if(c!==b._globalHandlerInstalled){b._globalHandlerInstalled=c;var d=a.map(h,function(a,c){return c+"."+b.prototype.namespace}).join(" ");a(window)[c?"on":"off"](d,i)}};b.prototype={constructor:b,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:a.noop,beforeContent:a.noop,beforeClose:a.noop,afterOpen:a.noop,afterContent:a.noop,afterClose:a.noop,onKeyUp:a.noop,onResize:a.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(b,c){"object"!=typeof b||b instanceof a!=!1||c||(c=b,b=void 0);var d=a.extend(this,c,{target:b}),e=d.resetCss?d.namespace+"-reset":d.namespace,f=a(d.background||['<div class="'+e+"-loading "+e+'">','<div class="'+e+'-content">','<button class="'+e+"-close-icon "+d.namespace+'-close" aria-label="Close">',d.closeIcon,"</button>",'<div class="'+d.namespace+'-inner">'+d.loading+"</div>","</div>","</div>"].join("")),g="."+d.namespace+"-close"+(d.otherClose?","+d.otherClose:"");return d.$instance=f.clone().addClass(d.variant),d.$instance.on(d.closeTrigger+"."+d.namespace,function(b){if(!b.isDefaultPrevented()){var c=a(b.target);("background"===d.closeOnClick&&c.is("."+d.namespace)||"anywhere"===d.closeOnClick||c.closest(g).length)&&(d.close(b),b.preventDefault())}}),this},getContent:function(){if(this.persist!==!1&&this.$content)return this.$content;var b=this,c=this.constructor.contentFilters,d=function(a){return b.$currentTarget&&b.$currentTarget.attr(a)},e=d(b.targetAttr),f=b.target||e||"",g=c[b.type];if(!g&&f in c&&(g=c[f],f=b.target&&e),f=f||d("href")||"",!g)for(var h in c)b[h]&&(g=c[h],f=b[h]);if(!g){var i=f;if(f=null,a.each(b.contentFilters,function(){return g=c[this],g.test&&(f=g.test(i)),!f&&g.regex&&i.match&&i.match(g.regex)&&(f=i),!f}),!f)return"console"in window&&window.console.error("Featherlight: no content filter found "+(i?' for "'+i+'"':" (no target specified)")),!1}return g.process.call(b,f)},setContent:function(b){return this.$instance.removeClass(this.namespace+"-loading"),this.$instance.toggleClass(this.namespace+"-iframe",b.is("iframe")),this.$instance.find("."+this.namespace+"-inner").not(b).slice(1).remove().end().replaceWith(a.contains(this.$instance[0],b[0])?"":b),this.$content=b.addClass(this.namespace+"-inner"),this},open:function(b){var c=this;if(c.$instance.hide().appendTo(c.root),!(b&&b.isDefaultPrevented()||c.beforeOpen(b)===!1)){b&&b.preventDefault();var d=c.getContent();if(d)return e.push(c),j(!0),c.$instance.fadeIn(c.openSpeed),c.beforeContent(b),a.when(d).always(function(a){c.setContent(a),c.afterContent(b)}).then(c.$instance.promise()).done(function(){c.afterOpen(b)})}return c.$instance.detach(),a.Deferred().reject().promise()},close:function(b){var c=this,d=a.Deferred();return c.beforeClose(b)===!1?d.reject():(0===f(c).length&&j(!1),c.$instance.fadeOut(c.closeSpeed,function(){c.$instance.detach(),c.afterClose(b),d.resolve()})),d.promise()},resize:function(a,b){if(a&&b){this.$content.css("width","").css("height","");var c=Math.max(a/(this.$content.parent().width()-1),b/(this.$content.parent().height()-1));c>1&&(c=b/Math.floor(b/c),this.$content.css("width",""+a/c+"px").css("height",""+b/c+"px"))}},chainCallbacks:function(b){for(var c in b)this[c]=a.proxy(b[c],this,a.proxy(this[c],this))}},a.extend(b,{id:0,autoBind:"[data-featherlight]",defaults:b.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(b){return b instanceof a&&b},process:function(b){return this.persist!==!1?a(b):a(b).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff?|bmp|svg)(\?\S*)?$/i,process:function(b){var c=this,d=a.Deferred(),e=new Image,f=a('<img src="'+b+'" alt="" class="'+c.namespace+'-image" />');return e.onload=function(){f.naturalWidth=e.width,f.naturalHeight=e.height,d.resolve(f)},e.onerror=function(){d.reject(f)},e.src=b,d.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(b){return a(b)}},ajax:{regex:/./,process:function(b){var c=a.Deferred(),d=a("<div></div>").load(b,function(a,b){"error"!==b&&c.resolve(d.contents()),c.fail()});return c.promise()}},iframe:{process:function(b){var e=new a.Deferred,f=a("<iframe/>"),h=d(this,"iframe"),i=c(h,g);return f.hide().attr("src",b).attr(i).css(h).on("load",function(){e.resolve(f.show())}).appendTo(this.$instance.find("."+this.namespace+"-content")),e.promise()}},text:{process:function(b){return a("<div>",{text:b})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(b,c){var d=this,e=new RegExp("^data-"+c+"-(.*)"),f={};return b&&b.attributes&&a.each(b.attributes,function(){var b=this.name.match(e);if(b){var c=this.value,g=a.camelCase(b[1]);if(a.inArray(g,d.functionAttributes)>=0)c=new Function(c);else try{c=JSON.parse(c)}catch(h){}f[g]=c}}),f},extend:function(b,c){var d=function(){this.constructor=b};return d.prototype=this.prototype,b.prototype=new d,b.__super__=this.prototype,a.extend(b,this,c),b.defaults=b.prototype,b},attach:function(b,c,d){var e=this;"object"!=typeof c||c instanceof a!=!1||d||(d=c,c=void 0),d=a.extend({},d);var f,g=d.namespace||e.defaults.namespace,h=a.extend({},e.defaults,e.readElementConfig(b[0],g),d),i=function(g){var i=a(g.currentTarget),j=a.extend({$source:b,$currentTarget:i},e.readElementConfig(b[0],h.namespace),e.readElementConfig(g.currentTarget,h.namespace),d),k=f||i.data("featherlight-persisted")||new e(c,j);"shared"===k.persist?f=k:k.persist!==!1&&i.data("featherlight-persisted",k),j.$currentTarget.blur&&j.$currentTarget.blur(),k.open(g)};return b.on(h.openTrigger+"."+h.namespace,h.filter,i),{filter:h.filter,handler:i}},current:function(){var a=this.opened();return a[a.length-1]||null},opened:function(){var b=this;return f(),a.grep(e,function(a){return a instanceof b})},close:function(a){var b=this.current();return b?b.close(a):void 0},_onReady:function(){var b=this;if(b.autoBind){var c=a(b.autoBind);c.each(function(){b.attach(a(this))}),a(document).on("click",b.autoBind,function(d){if(!d.isDefaultPrevented()){var e=a(d.currentTarget),f=c.length;if(c=c.add(e),f!==c.length){var g=b.attach(e);(!g.filter||a(d.target).parentsUntil(e,g.filter).length>0)&&g.handler(d)}}})}},_callbackChain:{onKeyUp:function(b,c){return 27===c.keyCode?(this.closeOnEsc&&a.featherlight.close(c),!1):b(c)},beforeOpen:function(b,c){return a(document.documentElement).addClass("with-featherlight"),this._previouslyActive=document.activeElement,this._$previouslyTabbable=a("a, input, select, textarea, iframe, button, iframe, [contentEditable=true]").not("[tabindex]").not(this.$instance.find("button")),this._$previouslyWithTabIndex=a("[tabindex]").not('[tabindex="-1"]'),this._previousWithTabIndices=this._$previouslyWithTabIndex.map(function(b,c){return a(c).attr("tabindex")}),this._$previouslyWithTabIndex.add(this._$previouslyTabbable).attr("tabindex",-1),document.activeElement.blur&&document.activeElement.blur(),b(c)},afterClose:function(c,d){var e=c(d),f=this;return this._$previouslyTabbable.removeAttr("tabindex"),this._$previouslyWithTabIndex.each(function(b,c){a(c).attr("tabindex",f._previousWithTabIndices[b])}),this._previouslyActive.focus(),0===b.opened().length&&a(document.documentElement).removeClass("with-featherlight"),e},onResize:function(a,b){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),a(b)},afterContent:function(a,b){var c=a(b);return this.$instance.find("[autofocus]:not([disabled])").focus(),this.onResize(b),c}}}),a.featherlight=b,a.fn.featherlight=function(a,c){return b.attach(this,a,c),this},a(document).ready(function(){b._onReady()})}(jQuery);!function(a){"use strict";function b(c,d){if(!(this instanceof b)){var e=new b(a.extend({$source:c,$currentTarget:c.first()},d));return e.open(),e}a.featherlight.apply(this,arguments),this.chainCallbacks(h)}var c=function(a){window.console&&window.console.warn&&window.console.warn("FeatherlightGallery: "+a)};if("undefined"==typeof a)return c("Too much lightness, Featherlight needs jQuery.");if(!a.featherlight)return c("Load the featherlight plugin before the gallery plugin");var d="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,e=a.event&&a.event.special.swipeleft&&a,f=window.Hammer&&function(a){var b=new window.Hammer.Manager(a[0]);return b.add(new window.Hammer.Swipe),b},g=d&&(e||f);d&&!g&&c("No compatible swipe library detected; one must be included before featherlightGallery for swipe motions to navigate the galleries.");var h={afterClose:function(a,b){var c=this;return c.$instance.off("next."+c.namespace+" previous."+c.namespace),c._swiper&&(c._swiper.off("swipeleft",c._swipeleft).off("swiperight",c._swiperight),c._swiper=null),a(b)},beforeOpen:function(a,b){var c=this;return c.$instance.on("next."+c.namespace+" previous."+c.namespace,function(a){var b="next"===a.type?1:-1;c.navigateTo(c.currentNavigation()+b)}),g&&(c._swiper=g(c.$instance).on("swipeleft",c._swipeleft=function(){c.$instance.trigger("next")}).on("swiperight",c._swiperight=function(){c.$instance.trigger("previous")}),c.$instance.addClass(this.namespace+"-swipe-aware",g)),c.$instance.find("."+c.namespace+"-content").append(c.createNavigation("previous")).append(c.createNavigation("next")),a(b)},beforeContent:function(a,b){var c=this.currentNavigation(),d=this.slides().length;return this.$instance.toggleClass(this.namespace+"-first-slide",0===c).toggleClass(this.namespace+"-last-slide",c===d-1),a(b)},onKeyUp:function(a,b){var c={37:"previous",39:"next"}[b.keyCode];return c?(this.$instance.trigger(c),!1):a(b)}};a.featherlight.extend(b,{autoBind:"[data-featherlight-gallery]"}),a.extend(b.prototype,{previousIcon:"&#9664;",nextIcon:"&#9654;",galleryFadeIn:100,galleryFadeOut:300,slides:function(){return this.filter?this.$source.find(this.filter):this.$source},images:function(){return c("images is deprecated, please use slides instead"),this.slides()},currentNavigation:function(){return this.slides().index(this.$currentTarget)},navigateTo:function(b){var c=this,d=c.slides(),e=d.length,f=c.$instance.find("."+c.namespace+"-inner");return b=(b%e+e)%e,c.$currentTarget=d.eq(b),c.beforeContent(),a.when(c.getContent(),f.fadeTo(c.galleryFadeOut,.2)).always(function(a){c.setContent(a),c.afterContent(),a.fadeTo(c.galleryFadeIn,1)})},createNavigation:function(b){var c=this;return a('<span title="'+b+'" class="'+this.namespace+"-"+b+'"><span>'+this[b+"Icon"]+"</span></span>").click(function(d){a(this).trigger(b+"."+c.namespace),d.preventDefault()})}}),a.featherlightGallery=b,a.fn.featherlightGallery=function(a){return b.attach(this,a),this},a(document).ready(function(){b._onReady()})}(jQuery);;(function($){var defaults={duration:1000,clickHandler:null}
function startHandler(event){var $elem=jQuery(this);settings=jQuery.extend({},defaults,event.data);if(typeof $elem.data("events")!="undefined"&&typeof $elem.data("events").click!="undefined"){for(var c in $elem.data("events").click){if($elem.data("events").click[c].namespace==""){var handler=$elem.data("events").click[c].handler
$elem.data("taphold_click_handler",handler);$elem.unbind("click",handler);break;}}}
else if(typeof settings.clickHandler=="function"){$elem.data("taphold_click_handler",settings.clickHandler);}
$elem.data("taphold_triggered",false);$elem.data("taphold_clicked",false);$elem.data("taphold_cancelled",false);$elem.data("taphold_timer",setTimeout(function(){if(!$elem.data("taphold_cancelled")&&!$elem.data("taphold_clicked")){$elem.trigger(jQuery.extend(event,jQuery.Event("taphold")));$elem.data("taphold_triggered",true);}},settings.duration));}
function stopHandler(event){var $elem=jQuery(this);if($elem.data("taphold_cancelled")){return;}
clearTimeout($elem.data("taphold_timer"));if(!$elem.data("taphold_triggered")&&!$elem.data("taphold_clicked")){if(typeof $elem.data("taphold_click_handler")=="function"){$elem.data("taphold_click_handler")(jQuery.extend(event,jQuery.Event("click")));}
$elem.data("taphold_clicked",true);}}
function leaveHandler(event){$(this).data("taphold_cancelled",true);}
var touchSupported=("ontouchstart"in window)||("onmsgesturechange"in window);var taphold=$.event.special.taphold={setup:function(data){$(this).bind((touchSupported?"touchstart":"mousedown"),data,startHandler).bind((touchSupported?"touchend":"mouseup"),stopHandler).bind((touchSupported?"touchmove touchcancel":"mouseleave"),leaveHandler);},teardown:function(namespaces){$(this).unbind((touchSupported?"touchstart":"mousedown"),startHandler).unbind((touchSupported?"touchend":"mouseup"),stopHandler).unbind((touchSupported?"touchmove touchcancel":"mouseleave"),leaveHandler);}};})(jQuery);
/*!
 * Title Alert 0.7
 * 
 * Copyright (c) 2009 ESN | http://esn.me
 * Jonatan Heyman | http://heyman.info
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
(function(a){a.titleAlert=function(e,c){if(a.titleAlert._running){a.titleAlert.stop()}a.titleAlert._settings=c=a.extend({},a.titleAlert.defaults,c);if(c.requireBlur&&a.titleAlert.hasFocus){return}c.originalTitleInterval=c.originalTitleInterval||c.interval;a.titleAlert._running=true;a.titleAlert._initialText=document.title;document.title=e;var b=true;var d=function(){if(!a.titleAlert._running){return}b=!b;document.title=(b?e:a.titleAlert._initialText);a.titleAlert._intervalToken=setTimeout(d,(b?c.interval:c.originalTitleInterval))};a.titleAlert._intervalToken=setTimeout(d,c.interval);if(c.stopOnMouseMove){a(document).mousemove(function(f){a(this).unbind(f);a.titleAlert.stop()})}if(c.duration>0){a.titleAlert._timeoutToken=setTimeout(function(){a.titleAlert.stop()},c.duration)}};a.titleAlert.defaults={interval:500,originalTitleInterval:null,duration:0,stopOnFocus:true,requireBlur:false,stopOnMouseMove:false};a.titleAlert.stop=function(){clearTimeout(a.titleAlert._intervalToken);clearTimeout(a.titleAlert._timeoutToken);document.title=a.titleAlert._initialText;a.titleAlert._timeoutToken=null;a.titleAlert._intervalToken=null;a.titleAlert._initialText=null;a.titleAlert._running=false;a.titleAlert._settings=null};a.titleAlert.hasFocus=true;a.titleAlert._running=false;a.titleAlert._intervalToken=null;a.titleAlert._timeoutToken=null;a.titleAlert._initialText=null;a.titleAlert._settings=null;a.titleAlert._focus=function(){a.titleAlert.hasFocus=true;if(a.titleAlert._running&&a.titleAlert._settings.stopOnFocus){var b=a.titleAlert._initialText;a.titleAlert.stop();setTimeout(function(){if(a.titleAlert._running){return}document.title=".";document.title=b},1000)}};a.titleAlert._blur=function(){a.titleAlert.hasFocus=false};a(window).bind("focus",a.titleAlert._focus);a(window).bind("blur",a.titleAlert._blur)})(jQuery);var fs_sidebar_menu_applied=false;var fs_loader_timeout;var fs_processing_send_reply=false;var fs_processing_save_draft=false;var fs_send_reply_allowed=true;var fs_send_reply_after_draft=false;var fs_autosave_note=true;var fs_connection_errors=0;var fs_editor_change_timeout=-1;var fs_keep_conversation_notes=30;var fs_draft_autosave_period=12;var fs_reply_changed=false;var fs_conv_editor_buttons={};var fs_conv_editor_toolbar=[['style',['attachment','bold','italic','underline','lists','removeformat','link','picture','codeview']],['actions',['savedraft','discard']],];var fs_in_app_data={};var fs_actions={};var fs_filters={};var fs_body_default='<div><br></div>';var fs_prev_focus=true;var fs_checkbox_shift_last_checked=null;var FS_STATUS_CLOSED=3;var FS_STATUS_CLOSED=3;var poly;var poly_data_closures=[];var fs_select2_config={dropdownCssClass:"select2-multi-dropdown",multiple:true,minimumInputLength:1,tags:true,createTag:function(params){return{id:params.term,text:params.term,newOption:true}},templateResult:function(data){var $result=$("<span></span>");$result.text(data.text);if(data.newOption){$result.append(" <em>("+Lang.get("messages.add_lower")+")</em>");}
return $result;}};window.ParsleyConfig=window.ParsleyConfig||{};$.extend(window.ParsleyConfig,{excluded:'.note-codable, .parsley-exclude, .select2-search__field',errorClass:'has-error',classHandler:function(ParsleyField){return ParsleyField.$element.parents('.form-group:first');},errorsContainer:function(ParsleyField){var element=ParsleyField.$element;var help_block=element.parent().children('.help-block:first');if(!help_block.length){if(element.hasClass('select2-hidden-accessible')){return element.parent();}}
return help_block;},errorsWrapper:'<div class="help-block"></div>',errorTemplate:'<div></div>'});var EditorAttachmentButton=function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-paperclip"></i>',tooltip:Lang.get("messages.upload_attachments"),className:'note-btn-attachment',container:'body',click:function(){var element=document.createElement('div');element.innerHTML='<input type="file" multiple>';var fileInput=element.firstChild;fileInput.addEventListener('change',function(){if(fileInput.files){for(var i=0;i<fileInput.files.length;i++){editorSendFile(fileInput.files[i],true,true);}}});fileInput.click();}});return button.render();}
var EditorSaveDraftButton=function(context){var ui=$.summernote.ui;var button=ui.button({className:'note-btn-save-draft',contents:'<i class="glyphicon glyphicon-ok"></i>',tooltip:Lang.get("messages.save_draft"),container:'body',click:function(){saveDraft(true);}});return button.render();}
var EditorDiscardButton=function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-trash"></i>',tooltip:Lang.get("messages.discard"),container:'body',click:function(){discardDraft();}});return button.render();}
var EditorInsertVarButton=function(context){var ui=$.summernote.ui;var vars={mailbox:{'mailbox.email':Lang.get("messages.email"),'mailbox.name':Lang.get("messages.name"),'mailbox.fromName':Lang.get("messages.from_name")},conversation:{'conversation.number':Lang.get("messages.number")},customer:{'customer.fullName':Lang.get("messages.full_name"),'customer.firstName':Lang.get("messages.first_name"),'customer.lastName':Lang.get("messages.last_name"),'customer.email':Lang.get("messages.email_addr"),'customer.company':Lang.get("messages.company"),},user:{'user.fullName':Lang.get("messages.full_name"),'user.firstName':Lang.get("messages.first_name"),'user.lastName':Lang.get("messages.last_name"),'user.jobTitle':Lang.get("messages.job_title"),'user.phone':Lang.get("messages.phone"),'user.email':Lang.get("messages.email_addr"),'user.photoUrl':Lang.get("messages.photo_url"),},};vars=fsApplyFilter('editor.vars',vars);var contents='<select class="form-control summernote-inservar" tabindex="-1">'+'<option value="">'+Lang.get("messages.insert_var")+' ...</option>';for(var entity_name in vars){contents+='<optgroup label="'+Lang.get("messages."+entity_name)+'">';for(var var_name in vars[entity_name]){contents+='<option value="{%'+var_name+'%}">'+vars[entity_name][var_name]+'</option>';}
contents+='</optgroup>';}
contents+='</select>';var button=ui.button({contents:contents,tooltip:Lang.get("messages.insert_var"),container:'body'});return button.render();}
var EditorRemoveFormatButton=function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="note-icon-close"></i>',tooltip:Lang.get("messages.remove_format"),container:'body',click:function(){context.invoke('removeFormat');}});return button.render();}
var EditorListsButton=function(context){var ui=$.summernote.ui;var button=ui.buttonGroup([ui.button({className:'dropdown-toggle',contents:ui.dropdownButtonContents(ui.icon('note-icon-unorderedlist'),{icons:{'caret':'note-icon-caret1'}}),tooltip:Lang.get("messages.list"),data:{toggle:'dropdown'}}),ui.dropdown([ui.button({contents:ui.icon($.summernote.options.icons.unorderedlist),tooltip:$.summernote.lang[$.summernote.options.lang].lists.unordered,click:context.createInvokeHandler('editor.insertUnorderedList')}),ui.button({contents:ui.icon($.summernote.options.icons.orderedlist),tooltip:$.summernote.lang[$.summernote.options.lang].lists.ordered,click:context.createInvokeHandler('editor.insertOrderedList')})])]);return button.render();}
$(document).ready(function(){triggersInit();$('.sidebar-menu-toggle').click(function(event){event.stopPropagation();$(this).parent().children('.sidebar-menu:first').toggleClass('active');$(this).toggleClass('active');if(!fs_sidebar_menu_applied){$('body').click(function(){$('.sidebar-menu, .sidebar-menu-toggle').removeClass('active');});}});fsFloatingAlertsInit();(function($){if(typeof($.summernote)!="undefined"){$.summernote.lang['en-US'].image.dragImageHere=Lang.get("messages.drag_image_file");$.summernote.lang['en-US'].image.dropImage=Lang.get("messages.drag_image_file");}})(jQuery);polycastInit();webNotificationsInit();initAccordionHeading();initMuteMailbox();$('#search-dt').click(function(){var dt=$(this);setTimeout(function(){dt.next().children().find('.form-control:first').focus();},100);});$('#logout-link').click(function(e){$('#logout-form').submit();e.preventDefault();});$('ul.customer-contacts a.contact-main').click(function(e){copyToClipboard($(this).text());e.preventDefault();});if($('#conv-layout-customer').length&&$(window).outerWidth()>=1100&&$('.conv-sidebar-block').length>2){adjustCustomerSidebarHeight();setTimeout(adjustCustomerSidebarHeight,2000);}});function initMuteMailbox(){$('.mailbox-mute-trigger, .mailbox-mute-trigger span').click(function(e){var button=$(this);if(!button.hasClass('mailbox-mute-trigger')){button=button.parent();e.stopPropagation();}
button.button('loading');var mute=parseInt(button.attr('data-mute'));fsAjax({action:'mute',mailbox_id:button.attr('data-mailbox-id'),mute:mute},laroute.route('mailboxes.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){setTimeout(function(){button.children('span').addClass('hidden');var new_mute;if(mute==1){new_mute=0;button.children('.glyphicon').removeClass('glyphicon-volume-off').addClass('glyphicon-volume-up');button.parents('.dash-card:first, .sidebar-2col:first').children().find('.mailbox-name').prepend('<i class="glyphicon glyphicon-volume-off"></i> ');}else{new_mute=1;button.children('.glyphicon').removeClass('glyphicon-volume-up').addClass('glyphicon-volume-off');button.parents('.dash-card:first, .sidebar-2col:first').children().find('.mailbox-name').children('.glyphicon:first').remove();}
button.attr('data-mute',new_mute);button.children('.mute-text-'+new_mute).removeClass('hidden');},100);}else{showAjaxError(response);}},true);e.preventDefault();})}
function initTooltip(selector){$(selector).tooltip({container:'body'});}
function initTooltips(){initTooltip('[data-toggle="tooltip"]');}
function triggersInit(){initTooltips();var handler=function(){return $('body [data-toggle="tooltip"]').tooltip('hide');};$(document).on('mouseenter','.dropdown-menu',handler);$(document).on('hidden.bs.dropdown',handler);$(document).on('shown.bs.dropdown',handler);$('[data-toggle="popover"]').popover({container:'body'});initModals();}
function initModals(html_tag){if(typeof(html_tag)=="undefined"){html_tag='a';}
$(html_tag+'[data-trigger="modal"][data-modal-applied!="1"],.fs-trigger-modal[data-modal-applied!="1"]').attr('data-modal-applied','1').click(function(e){triggerModal($(this));e.preventDefault();});}
function editorProcessInsertVar(editor){editor.parent().children().find('.summernote-inservar:first').on('change',function(event){editor.summernote('insertText',$(this).val());$(this).val('');});}
function mailboxUpdateInit(from_name_custom){var selector='#signature';$(document).ready(function(){summernoteInit(selector,{insertVar:true,disableDragAndDrop:false,callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();editorProcessInsertVar($(selector));},onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,false);}}}});$('#from_name').change(function(event){if($(this).val()==from_name_custom){$('#from_name_custom_container').removeClass('hidden');}else{$('#from_name_custom_container').addClass('hidden');}});$('#before-reply-toggle').change(function(event){if($(this).is(':checked')){$('#before_reply').removeAttr('readonly').val($('#before_reply').attr('data-default'));}else{$('#before_reply').attr('readonly','readonly');var val=$('#before_reply').val();if(val){$('#before_reply').attr('data-default',val).attr('placeholder',val);$('#before_reply').val('');}}});fsDoAction('mailbox.update_init');});}
function deleteMailboxModal(modal){modal.children().find('.button-delete-mailbox:first').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'delete_mailbox',mailbox_id:getGlobalAttr('mailbox_id'),password:$('.delete-mailbox-pass:visible:first').val()},laroute.route('mailboxes.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=laroute.route('mailboxes');return;}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});}
function deactivateLicenseModal(modal){modal.children().find('.button-deactivate-license:first').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'deactivate_license',alias:$('.deactivate-license-module:visible:first').val(),license:$('.deactivate-license-key:visible:first').val(),any_url:1,},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});}
function summernoteInit(selector,new_options){if(typeof(new_options)=="undefined"){new_options={};}
var buttons={removeformat:EditorRemoveFormatButton,lists:EditorListsButton};if(typeof(new_options.insertVar)=="undefined"||new_options.insertVar){buttons.insertvar=EditorInsertVarButton;}
options={minHeight:120,dialogsInBody:true,disableResizeEditor:true,followingToolbar:false,disableDragAndDrop:true,toolbar:[['style',['attachment','bold','italic','underline','color','lists','removeformat','link','picture','codeview']],['actions-select',['insertvar']]],buttons:buttons,callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();if(typeof(new_options.insertVar)!="undefined"||new_options.insertVar){$(selector).parent().children().find('.summernote-inservar:first').on('change',function(event){$(selector).summernote('insertText',$(this).val());$(this).val('');});}
if(typeof(new_options.excludeVars)!="undefined"||new_options.excludeVars){$(selector).parent().children().find('.summernote-inservar:first option').each(function(i,el){for(var var_i=0;var_i<new_options.excludeVars.length;var_i++){if($(el).val().indexOf(new_options.excludeVars[var_i])!=-1){$(el).parent().hide();break;}}});}}}};$.extend(options,new_options);var $el=$(selector);$el.summernote(options);fsFixEditorCodeSaving($el)}
function fsFixEditorCodeSaving($el){$el.next().children().find('.note-codable').on('blur',function(){if($el.summernote('codeview.isActivated')){$el.val($el.summernote('code'));}});}
function permissionsInit(){$(document).ready(function(){$('.sel-all').click(function(e){$("#permissions-fields input").prop('checked',true);e.preventDefault();});$('.sel-none').click(function(e){$("#permissions-fields input").prop('checked',false);e.preventDefault();});});}
function mailboxConnectionInit(out_method_smtp){$(document).ready(function(){$(':input[name="out_method"]').on('change',function(event){var method=$(':input[name="out_method"]:checked').val();$('.out_method_options').addClass('hidden');$('#out_method_'+method+'_options').removeClass('hidden');if(parseInt(method)==parseInt(out_method_smtp)){$('#out_method_'+out_method_smtp+'_options :input[data-smtp-required="true"]').attr('required','required');}else{$('#out_method_'+out_method_smtp+'_options :input').removeAttr('required');}});$('#send-test-trigger').click(function(event){var button=$(this);button.button('loading');fsAjax({action:'send_test',mailbox_id:getGlobalAttr('mailbox_id'),to:$('#send_test').val()},laroute.route('mailboxes.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){showFloatingAlert('success',Lang.get("messages.email_sent"));}else{showAjaxError(response,true);}
button.button('reset');},true);});});}
function mailboxConnectionIncomingInit(){$(document).ready(function(){let changeProtocol=function(){let in_protocol=$('[name="in_protocol"]').val();$('[data-in-protocol]').hide();let specific=$('[data-in-protocol="'+in_protocol+'"]');if(specific.length>=1){specific.show();}else{$('[data-in-protocol="default"]').show();}};$('[name="in_protocol"]').on('change',function(event){changeProtocol();});changeProtocol();$('#check-connection').click(function(event){var button=$(this);button.button('loading');fsAjax({action:'fetch_test',mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('mailboxes.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){showFloatingAlert('success',Lang.get("messages.connection_established"),true);}else{showAjaxError(response,true);}
button.button('reset');},true);});$('#retrieve-imap-folders').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'imap_folders',mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('mailboxes.ajax'),function(response){var select=$('#in_imap_folders');var options_html='';if(typeof(response.folders)!="undefined"&&response.folders.length){for(i in response.folders){var imap_folder=response.folders[i];if(select.find("option[value='"+imap_folder+"']").length){continue;}
options_html+='<option value="'+imap_folder+'" selected="selected">'+imap_folder+'</option>'};}
if(options_html){select.append(options_html).select2().trigger('change');}
showAjaxResult(response);button.button('reset');},true);e.preventDefault();});$("#in_imap_folders").select2(fs_select2_config);});}
function mailSettingsInit(){$(document).ready(function(){$(':input[name="settings[mail_driver]"]').on('change',function(event){var method=$(':input[name="settings[mail_driver]"]').val();$('.mail_driver_options').addClass('hidden');$('#mail_driver_options_'+method).removeClass('hidden');if(parseInt(method)=='smtp'){$('#mail_driver_options_smtp :input').attr('required','required');}else{$('#mail_driver_options_smtp :input').removeAttr('required');}});$('#send-test-trigger').click(function(event){var button=$(this);button.button('loading');fsAjax({action:'send_test',to:$('#send_test').val()},laroute.route('settings.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){showFloatingAlert('success',Lang.get("messages.email_sent"));}else{showAjaxError(response);}
button.button('reset');},true);});});}
function userCreateInit(){$(document).ready(function(){$('#send_invite').on('change',function(event){if($(this).is(':checked')){$('.no-send-invite').addClass('hidden');$('#password').removeAttr('required');}else{$('.no-send-invite').removeClass('hidden');$('#password').attr('required','required');}});});}
function logsInit(){$(document).ready(function(){$('#table-logs').DataTable({"ordering":false,"paging":false,"info":false,"searching":false});});}
function multiInputInit(){$(document).ready(function(){$('.multi-add').click(function(e){var clone=$(this).parents('.multi-container:first').children('.multi-item:first').clone(true,true);var index=parseInt($(this).parents('.multi-container:first').children('.block-help:last').attr('data-max-i'));if(isNaN(index)){index=0;}
index++;clone.find(':input').each(function(i,el){var name=$(el).attr('name');name=name.replace(/^([^\[]+\[)([0-9]+)(\])/,"$1"+index+"$3");$(el).attr('name',name.replace(/^([\[]+\[)([0-9]+)(\])/,"$1"+index+"$3"));});clone.find(':input').val('');clone.find('.help-block').remove();clone.removeClass('has-error');clone.insertAfter($(this).parents('.multi-container:first').children('.multi-item:last'));$(this).parents('.multi-container:first').children('.block-help:last').attr('data-max-i',index);e.preventDefault();});$('.multi-remove').click(function(e){if($(this).parents('.multi-container:first').children('.multi-item').length>1){$(this).parents('.multi-item:first').remove();}else{$(this).parents('.multi-item:first').children(':input').val('');}
e.preventDefault();});});}
function fsAjax(data,url,success_callback,no_loader,error_callback,custom_options){if(!url){console.log('Empty URL');return false;}
ajaxSetup();if(typeof(no_loader)=="undefined"||!no_loader){loaderShow(true);}
if(typeof(error_callback)=="undefined"||!error_callback){error_callback=function(){showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();};}
if(url.indexOf('/conversation/')!=-1){var folder_id=getQueryParam('folder_id');if(folder_id){url=addQueryParam('folder_id',folder_id,url);}}
var preserve_xembed=false;if(window.location.href.indexOf('x_embed=1')!=-1){url=addQueryParam('x_embed',1,url);preserve_xembed=true;}
var override_success_callback=function(response){if(typeof(response.redirect_url)!="undefined"){if(preserve_xembed&&response.redirect_url.indexOf('x_embed=1')==-1){response.redirect_url=addQueryParam('x_embed',1,response.redirect_url);}}
return success_callback(response);};var options={url:url,method:'post',dataType:'json',data:data,success:override_success_callback,error:error_callback};if(typeof(custom_options)=="object"){options={...options,...custom_options};}
$.ajax(options);}
function loaderShow(delay){if(typeof(delay)!="undefined"&&delay){fs_loader_timeout=setTimeout(function(){$("#loader-main").fadeIn();},1000);}else{$("#loader-main").fadeIn();}}
function loaderHide(){$("#loader-main").hide();clearTimeout(fs_loader_timeout);}
function fsFloatingAlertsInit(){var alerts=$(".alert-floating:hidden");alerts.each(function(i,el){var top=0;$(".alert-floating:visible").each(function(sub_i,sub_el){top=top+$(sub_el).position().top+$(sub_el).outerHeight(true);});if(top){$(el).css('top',top+'px');}
$(el).css('display','flex');if(!$(el).hasClass('alert-noautohide')){var close_after=7000;if(!$(el).hasClass('alert-danger')){close_after=10000;}
setTimeout(function(){el.remove();},close_after);}});if(alerts.length){setTimeout(function(){$('body').click(function(){alerts.remove();});},2000);}}
function showFloatingAlert(type,msg,no_autohide){var icon='ok';var alert_class='success';if(type=='error'){icon='exclamation-sign';alert_class='danger';}
if(typeof(no_autohide)!="undefined"){alert_class+=' alert-noautohide ';}
var html='<div class="alert alert-'+alert_class+' alert-floating">'+'<div><i class="glyphicon glyphicon-'+icon+'"></i>'+msg+'</div>'+'</div>';$('body:first').append(html);fsFloatingAlertsInit();}
function initConversation(){$(document).ready(function(){jQuery(".conv-user li > a").click(function(e){if(!$(this).hasClass('active')&&!$(this).hasClass('disabled')){if(fsApplyFilter('conversation.can_change_user',true,{trigger:$(this)})){$(this).trigger('fs-conv-user-change');}}
e.preventDefault();});jQuery(".conv-user li > a").bind('fs-conv-user-change',function(e){fsAjax({action:'conversation_change_user',user_id:$(this).attr('data-user_id'),conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.redirect_url)!="undefined"){window.location.href=response.redirect_url;}else{window.location.href='';}}else if(typeof(response.msg)!="undefined"){showFloatingAlert('error',response.msg);loaderHide();}else{showFloatingAlert('error',Lang.get("messages.error_occurred"));loaderHide();}});});jQuery(".conv-status li > a").click(function(e){if(!$(this).hasClass('active')){if(fsApplyFilter('conversation.can_change_status',true,{trigger:$(this)})){$(this).trigger('fs-conv-status-change');}}
e.preventDefault();});jQuery(".conv-status li > a").bind('fs-conv-status-change',function(e){var status=$(this).attr('data-status');if(!status){return;}
fsAjax({action:'conversation_change_status',status:status,conversation_id:getGlobalAttr('conversation_id'),folder_id:getQueryParam('folder_id')},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.redirect_url)!="undefined"){window.location.href=response.redirect_url;}else{window.location.href='';}}else if(typeof(response.msg)!="undefined"){showFloatingAlert('error',response.msg);}else{showFloatingAlert('error',Lang.get("messages.error_occurred"));}
loaderHide();});});jQuery(".conv-status li > a.conv-restore-trigger").click(function(e){if(!$(this).hasClass('active')){fsAjax({action:'restore_conversation',conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.redirect_url)!="undefined"){window.location.href=response.redirect_url;}else{window.location.href='';}}else{showAjaxError(response);}
loaderHide();});}
e.preventDefault();});jQuery(".conv-reply").click(function(e){if($(".conv-reply-block").hasClass('hidden')){prepareReplyForm();showReplyForm();}
e.preventDefault();});jQuery(".conv-add-note").click(function(e){var reply_block=$(".conv-reply-block");if(reply_block.hasClass('hidden')){setReplyBody('<div><br></div>');showNoteForm();}
e.preventDefault();});jQuery(".conv-forward").click(function(e){forwardConversation(e);e.preventDefault();});jQuery(".conv-follow").click(function(e){followConversation($(this).attr('data-follow-action'));e.preventDefault();});jQuery(".edit-draft-trigger").click(function(e){editDraft($(this));e.preventDefault();});jQuery(".discard-draft-trigger").click(function(e){discardDraft($(this).parents('.thread:first').attr('data-thread_id'));e.preventDefault();});var conv_top_blocks=$('#conv-top-blocks');var is_chat_mode=false;if(conv_top_blocks.length){if(!conv_top_blocks.children('.conv-top-block:first').length){conv_top_blocks.prev().hide();}
is_chat_mode=true;}
jQuery(".conv-delete,.conv-delete-forever").click(function(e){var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.confirm_delete_conversation")+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary delete-conversation-ok">'+Lang.get("messages.delete")+'</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';var action='delete_conversation';if($(this).hasClass('conv-delete-forever')){action='delete_conversation_forever';}
showModalDialog(confirm_html,{on_show:function(modal){modal.children().find('.delete-conversation-ok:first').click(function(e){modal.modal('hide');fsAjax({action:action,conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)&&typeof(response.redirect_url)!="undefined"){window.location.href=response.redirect_url;return;}else{showAjaxError(response);}
loaderHide();});e.preventDefault();});}});});jQuery(".thread-edit-trigger").click(function(e){editThread($(this));e.preventDefault();});jQuery(".thread-delete-trigger").click(function(e){deleteThread($(this));e.preventDefault();});jQuery(".thread-original-show").click(function(e){threadShowOriginal($(this));e.preventDefault();});jQuery(".thread-original-hide").click(function(e){threadHideOriginal($(this));e.preventDefault();});jQuery(".conv-subjtext").click(function(e){$(this).addClass('conv-subj-editing');});jQuery(".conv-subj-editor button:first").click(function(e){var button=$(this);button.button('loading');var value=$('#conv-subj-value').val();fsAjax({action:'update_subject',conversation_id:getGlobalAttr('conversation_id'),value:value},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){$('.conv-subjtext > span:first').text(value);}else{showAjaxError(response);}
button.parents('.conv-subj-editing:first').removeClass('conv-subj-editing');button.button('reset');},true);});jQuery("#conv-layout-main .btn-thread-retry").click(function(e){var button=$(this);button.button('loading');fsAjax({action:'retry_send',thread_id:button.parents('.thread:first').attr('data-thread_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){reloadPage();}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});if(getQueryParam('print')){window.print();}
starConversationInit();maybeShowStoredNote();maybeShowDraft();processLinks();initConvSettings();if(is_chat_mode&&!$('.conv-action.inactive:first').length){$(".conv-reply").click();}
if(is_chat_mode){$('button.chat-accept:visible').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'conversation_change_user',user_id:getGlobalAttr('auth_user_id'),conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxResult(response);button.button('reset');}},true);e.preventDefault();});$('button.chat-end:visible').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'conversation_change_status',status:FS_STATUS_CLOSED,conversation_id:getGlobalAttr('conversation_id'),folder_id:getQueryParam('folder_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxResult(response);button.button('reset');}},true);e.preventDefault();});$(document).on('keydown',function(e){if(!e.target||e.which!=13||$(e.target).is(':input')||e.altKey||e.shiftKey||e.metaKey||$('.modal:visible').length){return;}
if(e.which==13&&!e.shiftKey&&$(e.target).attr('contentEditable')=='true'){if(!$(':focus').hasClass('note-editable')){return;}
var body=$('#body').val();if(!body||body=='<div><br></div>'){return;}
var button=$('div.conv-block:not(.conv-note-block) div.conv-reply-body:visible .btn-reply-submit:first');if(button.length){button.click();e.preventDefault();e.stopPropagation();}}});}});}
function switchToNewEmailConversation(){$('#email-conv-switch').addClass('active');$('#phone-conv-switch').removeClass('active');$('.email-conv-fields').show();$('.phone-conv-fields').hide();$('#field-to').show();$('#name').addClass('parsley-exclude');$('#to').removeClass('parsley-exclude');$('.conv-block:first').removeClass('conv-note-block').removeClass('conv-phone-block');$('#form-create :input[name="is_note"]:first').val(0);$('#form-create :input[name="is_phone"]:first').val(0);$('#form-create :input[name="type"]:first').val(1);}
function switchToNewPhoneConversation(){$('#email-conv-switch').removeClass('active');$('#phone-conv-switch').addClass('active');$('.email-conv-fields').hide();$('.phone-conv-fields').show();if($('#to_email').val().length){$('#field-to_email').show();$('#toggle-email').hide();$('#field-to').hide();}else{$('#field-to_email').hide();$('#toggle-email').show();$('#field-to').show();}
$('#field-to').hide();$('#name').removeClass('parsley-exclude');$('#to').addClass('parsley-exclude');$('.conv-block:first').addClass('conv-note-block').addClass('conv-phone-block');$('#form-create :input[name="is_note"]:first').val(1);$('#form-create :input[name="is_phone"]:first').val(1);$('#form-create :input[name="type"]:first').val(Vars.conv_type_phone);initRecipientSelector({maximumSelectionLength:1,allow_non_emails:true,use_id:true},$('#name:not(.select2-hidden-accessible)')).on('select2:select select2:unselect',function(e){var data=e.params.data;if(typeof(data.newOption)=="undefined"&&data.selected){$('#conv-to-email-group').hide();}else{$('#conv-to-email-group').show();if(!data.selected){$('#form-create :input[name="customer_id"]:first').val('');}}});initRecipientSelector({maximumSelectionLength:1,search_by:'email'},$('#to_email:not(.select2-hidden-accessible)'));initRecipientSelector({maximumSelectionLength:1,allow_non_emails:true,search_by:'phone',show_fields:'phone',},$('#phone:not(.select2-hidden-accessible)'));}
function processLinks(){$('.thread-content a').attr('target','_blank');}
function getConvData(field){if(field=='user_id'){return $('.conv-user:first li.active a:first').attr('data-user_id');}
return null;}
function showNoteForm(){var reply_block=$(".conv-reply-block");if(reply_block.hasClass('hidden')){hideActionBlocks();reply_block.removeClass('hidden').addClass('conv-note-block').removeClass('conv-forward-block').children().find(":input[name='is_note']:first").val(1);$('#conv-subject').addClass('action-visible');reply_block.children().find(":input[name='thread_id']:first").val('');reply_block.children().find(":input[name='subtype']:first").val('');reply_block.children().find(":input[name='user_id']:first").val(getConvData('user_id'));var input_status=reply_block.children().find(":input[name='status']:first");input_status.val(input_status.attr('data-note-status'));$(".attachments-upload:first :input, .attachments-upload:first li").remove();$(".conv-action").addClass('inactive');$(this).removeClass('inactive');$('#body').summernote('focus');maybeScrollToReplyBlock();}}
function prepareReplyForm(){if(!$('.conv-action.inactive:first').length){setReplyBody('<div><br></div>');}
var default_assignee=$(".conv-reply-block").children().find(":input[name='user_id']:first option[data-default='true']").attr('value');if(default_assignee){$(".conv-reply-block").children().find(":input[name='user_id']:first").val(default_assignee);}
var input_status=$(".conv-reply-block").children().find(":input[name='status']:first");input_status.val(input_status.attr('data-reply-status'));$(".attachments-upload:first :input, .attachments-upload:first li").remove();}
function showReplyForm(data,scroll_offset){hideActionBlocks();$(".conv-reply-block").removeClass('hidden').removeClass('conv-note-block').removeClass('conv-forward-block').children().find(":input[name='is_note']:first").val('');$('#conv-subject').addClass('action-visible');$(".conv-reply-block :input[name='thread_id']:first").val('');$(".conv-reply-block :input[name='subtype']:first").val('');$(".conv-action").addClass('inactive');$(".conv-reply:first").removeClass('inactive');if(typeof(data)!="undefined"&&data){for(field in data){$(".conv-reply-block form:first :input[name='"+field+"']").val(data[field]);if(field=='body'){$('#body').summernote("code",data[field]);}
if(field=='to_email'||field=='cc'||field=='bcc'){if(data&&typeof(data.to)!="undefined"){cleanSelect2($("#"+field));for(var i in data[field]){var email=data[field][i];addSelect2Option($("#"+field),{id:email,text:email});}}else{$("#"+field).children('option:first').removeAttr('selected');}}}
showAttachments(data);if(data.cc||data.bcc){$('#toggle-cc').click();}}
$("#to").removeClass('hidden');$("#to_email").addClass('hidden').addClass('parsley-exclude').next('.select2:first').hide();if(!$('#to').length){$('#body').summernote('focus');}
initRecipientSelector();if(typeof(scroll_offset)=="undefined"){scroll_offset=0;}
maybeScrollToReplyBlock(scroll_offset);}
function cleanSelect2(select){select.children('option').remove();select.val('').trigger('change');}
function addSelect2Option(select,data){if(!data.id||!data.text){return;}
var new_option=new Option(data.text,data.id,true,true);select.append(new_option).trigger('change');}
function showAttachments(data){if(data&&data.attachments&&data.attachments.length){var attachments_container=$(".attachments-upload:first");for(var i=0;i<data.attachments.length;i++){var attachment=data.attachments[i];var input_html='<input type="hidden" name="attachments_all[]" value="'+attachment.id+'" />';input_html+='<input type="hidden" name="attachments[]" value="'+attachment.id+'" class="atachment-upload-'+attachment.id+'" />';attachments_container.prepend(input_html);var attachment_html='<li class="atachment-upload-'+attachment.id+' attachment-loaded"><a href="'+attachment.url+'" class="break-words" target="_blank">'+attachment.name+'<span class="ellipsis"></span> </a> <span class="text-help">('+formatBytes(attachment.size)+')</span> <i class="glyphicon glyphicon-remove" data-attachment-id="'+attachment.id+'"></i></li>';attachments_container.find('ul:first').append(attachment_html);$('li.attachment-loaded .glyphicon-remove').click(function(e){removeAttachment($(this).attr('data-attachment-id'));});attachments_container.show();}}}
function getGlobalAttr(attr){return $("body:first").attr('data-'+attr);}
function setGlobalAttr(attr,value){return $("body:first").attr('data-'+attr,value);}
function convEditorInit(){$.extend(fs_conv_editor_buttons,{attachment:EditorAttachmentButton,savedraft:EditorSaveDraftButton,discard:EditorDiscardButton,removeformat:EditorRemoveFormatButton,lists:EditorListsButton});var options={placeholder:$('#body').attr('placeholder'),minHeight:120,dialogsInBody:true,dialogsFade:true,disableResizeEditor:true,followingToolbar:false,toolbar:fsApplyFilter('conversation.editor_toolbar',fs_conv_editor_toolbar),buttons:fs_conv_editor_buttons,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,true);}},onBlur:function(){onReplyBlur();},onChange:function(contents,$editable){if(!contents&&!fs_reply_changed){return;}
onReplyChange();}}};if(convIsChat()){options.callbacks.onPaste=function(e){var bufferText=((e.originalEvent||e).clipboardData||window.clipboardData).getData('Text');e.preventDefault();document.execCommand('insertText',false,bufferText);};}
options=fsApplyFilter('editor.options',options);$('#body').summernote(options);fsFixEditorCodeSaving($('#body'));$('#editor_bottom_toolbar a[data-modal-applied="1"]').removeAttr('data-modal-applied');var html=$('#editor_bottom_toolbar').html();$('.note-statusbar').addClass('note-statusbar-toolbar form-inline').html(html);initModals();$("#to, #to_email, #cc, #bcc, #subject, #name, #phone").on('keyup keypress',function(event){onReplyChange();}).blur(function(event){onReplyBlur();});$("#to").on('change',function(event){autosaveDraft();var to=$('#to').val();$('#conv-layout-customer').html('');if(Array.isArray(to)&&to.length==1&&typeof(to[0])!="undefined"){fsAjax({action:'load_customer_info',customer_email:to[0],mailbox_id:getGlobalAttr('mailbox_id'),conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)&&typeof(response.html)!="undefined"){$('#conv-layout-customer').html(response.html);}},true,function(){});}});$(".recipient-select, .draft-changer").on('change',function(event){onReplyChange();onReplyBlur();});fsDoAction('conv_editor_init');autosaveDraft();}
function autosaveDraft(){if(!isNote()||isPhone()){saveDraft(false,true,true);}
setTimeout(function(){autosaveDraft()},fs_draft_autosave_period*1000);}
function ajaxSetup(){$.ajaxSetup({headers:{'X-CSRF-TOKEN':getCsrfToken()}});}
function onReplyChange(){if(fs_editor_change_timeout&&fs_editor_change_timeout!=-1){return;}
fs_editor_change_timeout=setTimeout(function(){$('.form-reply:first .note-actions .note-btn:first').removeClass('text-success');fs_editor_change_timeout=null;fs_reply_changed=true;},100);}
function onReplyBlur(){$('#body').summernote('editor.saveRange');setTimeout(function(){if(fs_processing_send_reply){return;}
if(isNote()){rememberNote();}else{saveDraft(false,true,true);}},500);}
function isNote(){return $(".form-reply:first :input[name='is_note']:first").val();}
function isPhone(){return $("#form-create :input[name='is_phone']:first").val();}
function generateDummyId(){return'_'+Math.random().toString(36).substr(2,9);}
function editorSendFile(file,attach,is_conv,editor_id,container){if(!file||typeof(file.type)=="undefined"){return false;}
if(typeof(container)=="undefined"){container=$(".attachments-upload:first");}
var attachments_container=container;var attachment_dummy_id=generateDummyId();var route='';if(is_conv){route='conversations.upload';editor_id='#body';}else{route='uploads.upload';if(typeof(editor_id)=="undefined"||!editor_id){editor_id='#signature';}}
ajaxSetup();if(typeof(attach)=="undefined"){attach=false;}
if(file.type.indexOf('image/')==-1){attach=true;}
if(attach){var attachment_html='<li class="atachment-upload-'+attachment_dummy_id+'"><img src="'+Vars.public_url+'/img/loader-tiny.gif" width="16" height="16"/> <a href="#" class="break-words disabled" target="_blank">'+file.name+'<span class="ellipsis"></span> </a> <span class="text-help">('+formatBytes(file.size)+')</span> <i class="glyphicon glyphicon-remove" data-attachment-id="'+attachment_dummy_id+'"></i></li>';attachments_container.children('ul:first').append(attachment_html);$('li.atachment-upload-'+attachment_dummy_id+' .glyphicon-remove:first').click(function(e){removeAttachment($(this).attr('data-attachment-id'));});attachments_container.show();}else{loaderShow();}
data=new FormData();data.append("file",file);if(attach){data.append("attach",1);}else{data.append("attach",0);}
$.ajax({url:laroute.route(route),data:data,cache:false,contentType:false,processData:false,type:'POST',success:function(response){if(typeof(response.url)=="undefined"||!response.url){showFloatingAlert('error',Lang.get("messages.error_occurred"));loaderHide();removeAttachment(attachment_dummy_id);return;}
if(attach){$('li.atachment-upload-'+attachment_dummy_id+':first').addClass('attachment-loaded');$('li.atachment-upload-'+attachment_dummy_id+':first a').removeClass('disabled').attr('href',response.url);}else{loaderHide();}
if(typeof(response.status)=="undefined"||response.status!="success"){showAjaxError(response);removeAttachment(attachment_dummy_id);return;}
if(attach){fs_reply_changed=true;if(typeof(response.attachment_id)=="undefined"&&typeof(response.url)!="undefined"&&response.url){$(editor_id).summernote('pasteHTML','<a href="'+response.url+'">'+file.name+'</a>');}}else{$(editor_id).summernote('insertImage',response.url,function(image){var editor_width=$('.note-editable:first:visible').width();if(image.width()>editor_width-85){image.css('width',editor_width-85);}
image.attr('width',image.css('width').replace('px',''));});}
if(typeof(response.attachment_id)!="undefined"||response.attachment_id){var input_html='<input type="hidden" name="attachments_all[]" value="'+response.attachment_id+'" />';input_html+='<input type="hidden" name="attachments[]" value="'+response.attachment_id+'" class="atachment-upload-'+attachment_dummy_id+'" />';if(!attach){input_html+='<input type="hidden" name="embeds[]" value="'+response.attachment_id+'" class="atachment-upload-'+attachment_dummy_id+'" />';}
attachments_container.prepend(input_html);}},error:function(jqXHR,textStatus,errorThrown){if(attach){removeAttachment(attachment_dummy_id);}else{loaderHide();}
console.log(textStatus+": "+errorThrown);showFloatingAlert('error',Lang.get("messages.error_occurred"));}});}
function removeAttachment(attachment_id){$('.atachment-upload-'+attachment_id).remove();}
function formatBytes(size){precision=2;size=parseInt(size);if(!isNaN(size)&&size>0){base=Math.log(size)/ Math.log(1024);suffixes=[' b',' KB',' MB',' GB',' TB'];return Math.round(Math.pow(1024,base-Math.floor(base)),precision)+''+suffixes[Math.floor(base)];}else{return size;}}
function initNewConversation(is_phone){$(document).ready(function(){if(typeof(is_phone)!="undefined"){switchToNewPhoneConversation();}
$('#toggle-email').click(function(e){$('#field-to_email').show();$(this).hide();e.preventDefault();});$('#email-conv-switch').click(function(){switchToNewEmailConversation();});$('#phone-conv-switch').click(function(){switchToNewPhoneConversation();});});}
function initRecipientSelector(custom_options,selector){var options={editable:true,use_id:false,containerCssClass:'select2-recipient',width:'100%'};if(typeof(custom_options)=="undefined"){custom_options={};}
$.extend(options,custom_options);if(typeof(selector)=="undefined"){selector=$('.recipient-select:visible:not(.select2-hidden-accessible)');}
var result=initCustomerSelector(selector,options);result=fsApplyFilter('conversation.recipient_selector',result,{selector:selector});if(options.editable){result.on('select2:closing',function(e){var params=e.params;var select=$(e.target);var value=select.next('.select2:first').children().find('.select2-search__field:first').val();value=value.trim();if(!value){return;}
if(typeof(custom_options.allow_non_emails)=="undefined"){if(!/^.+@.+$/.test(value)){return null;}}
if(params&&params.args&&params.args.originalSelect2Event!=null){var event=params.args.originalSelect2Event;if(event._type==='select'||event._type==='unselect'){return;}}
var data=select.select2('data');for(i in data){if(data[i].id==value){return;}}
addSelect2Option(select,{id:value,text:value,selected:true});});}
fsDoAction('conversation.recipient_selector_initialized',{selector:selector});return result;}
function initReplyForm(load_attachments,init_customer_selector,is_new_conv){$(document).ready(function(){convEditorInit();if(typeof(load_attachments)!="undefined"){loadAttachments();}
if(typeof(init_customer_selector)!="undefined"){initRecipientSelector();}
if(typeof(is_new_conv)!="undefined"){$('#to').on('select2:closing',function(e){var select=$(e.target);if(select.val().length>1){$('#multiple-conversations-wrap').removeClass('hidden');}else{$('#multiple-conversations-wrap').addClass('hidden');}});}
$('#toggle-cc').click(function(e){$('.field-cc').removeClass('hidden');$(this).parent().remove();initRecipientSelector();e.preventDefault();});$('.dropdown-after-send a:lt(3)').click(function(e){if(!$(this).parent().hasClass('active')){$("#after_send").val($(this).attr('data-after-send'));$('.dropdown-after-send li').removeClass('active');$(this).parent().addClass('active');}
e.preventDefault();});$('.after-send-change').click(function(e){triggerModal($(this));});$(".btn-reply-submit").click(function(e){if(fs_processing_send_reply){return;}
fs_processing_send_reply=true;var button=$(this);form=$(".form-reply:first");if(!form.parsley().validate()){fs_processing_send_reply=false;return;}
if(fs_processing_save_draft){fs_send_reply_after_draft=true;return;}
if(!fsApplyFilter('conversation.can_submit',true,{trigger:button,form:form})){fs_processing_send_reply=false;return;}
if(!fs_send_reply_allowed){fs_processing_send_reply=false;return;}
data=form.serialize();data+='&action=send_reply';button.button('loading');var is_note=isNote();var is_chat=isChatMode();var disable_editor=isChatMode()&&!is_note;if(disable_editor){$('#body').summernote('disable');}
fsAjax(data,laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(is_note){fs_autosave_note=false;forgetNote(getGlobalAttr('conversation_id'));}
if(typeof(response.redirect_url)!="undefined"&&!is_chat){window.location.href=response.redirect_url;}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');if(disable_editor){$('#body').summernote('enable');}}
loaderHide();fs_processing_send_reply=false;},true,function(){showFloatingAlert('error',Lang.get("messages.ajax_error"));loaderHide();button.button('reset');if(disable_editor){$('#body').summernote('enable');}
fs_processing_send_reply=false;});e.preventDefault();});$('#conv-subject .switch-to-note').click(function(e){switchToNote();e.preventDefault();});});}
function notificationsInit(){$(document).ready(function(){$('.sel-all').click(function(event){if($(this).is(':checked')){if($(this).val()=='browser'&&!Push.Permission.has()){return;}
$(".subscriptions-"+$(this).val()+" input").attr('checked','checked');}else{$(".subscriptions-"+$(this).val()+" input").removeAttr('checked');}});if(getGlobalAttr('own_profile')){$('.sel-all[value="browser"], .subscriptions-browser input').click(function(event){var checkbox=$(this);if($(this).is(':checked')){if(location.protocol!='https:'){var alert_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.push_protocol_alert")+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary reset-password-ok" data-dismiss="modal">OK</button>'+'</div>'+'</div>'+'</div>';showModalDialog(alert_html);checkbox.prop('checked',false);return;}
if(!Push.Permission.has()){Push.Permission.request(function(){},function(){$.featherlight($('<img src="'+Vars.public_url+'/img/enable-push.png" />'),{});checkbox.prop('checked',false);});}}});}});}
function getQueryParam(name,qs){var arrays_without_indexes={};if(typeof(qs)=="undefined"){qs=document.location.search;}
qs=qs.split('+').join(' ');var params={},tokens,re=/[?&]?([^=]+)=([^&]*)/g;while(tokens=re.exec(qs)){key=decodeURIComponent(tokens[1]);if(/\[\]$/.test(key)){if(typeof(arrays_without_indexes[key])=="undefined"){arrays_without_indexes[key]=0;}else{arrays_without_indexes[key]++;}
parsed_key=/(.*)\[\]$/.exec(key);if(typeof(parsed_key[1])!="undefined"){key=parsed_key[1]+'['+arrays_without_indexes[key]+']';}}
params[key]=decodeURIComponent(tokens[2]);}
for(var param in params){var m=param.match(/^([^\[]+)\[([^\[]+)\]$/i);if(m&&m.length){if(typeof(params[m[1]])=="undefined"){params[m[1]]={};}
if(typeof(params[m[1]])=="object"){params[m[1]][m[2]]=params[param];}}
var m=param.match(/^([^\[]+)\[([^\[]+)\]\[([^\[]+)\]$/i);if(m&&m.length){if(typeof(params[m[1]])=="undefined"){params[m[1]]={};}
if(typeof(params[m[1]])=="object"){if(typeof(params[m[1]][m[2]])=="undefined"){params[m[1]][m[2]]={};}
params[m[1]][m[2]][m[3]]=params[param];}}}
if(typeof(params[name])!="undefined"){return params[name];}else{return'';}}
function addQueryParam(name,value,url){var search=url.substring(url.indexOf('?')+1);if(search!=url){return url+'&'+encodeURIComponent(name)+'='+encodeURIComponent(value);}else{return url+'?'+encodeURIComponent(name)+'='+encodeURIComponent(value);}}
function showModal(params){triggerModal(null,params);}
function triggerModal(a,params){if(typeof(params)=="undefined"){params={};}
if(typeof(params.options)=="undefined"){params.options={};}
if(typeof(a)=="undefined"||!a){a=$(document.createElement('a'));}
var title=a.attr('data-modal-title');if(typeof(params.title)!="undefined"){title=params.title;}
if(title&&title.charAt(0)=='#'){title=$(title).html();}
if(!title){title=a.text();}
var remote=a.attr('data-remote');if(!remote){remote=a.attr('href');}
if(typeof(params.remote)!="undefined"){remote=params.remote;}
var body=a.attr('data-modal-body');if(typeof(params.body)!="undefined"){body=params.body;}
var footer=a.attr('data-modal-footer');if(typeof(params.footer)!="undefined"){footer=params.footer;}
if(typeof(params.no_close_btn)=="undefined"){params.no_close_btn=a.attr('data-no-close-btn');}
if(typeof(params.no_footer)=="undefined"){params.no_footer=a.attr('data-modal-no-footer');}
if(typeof(params.no_header)=="undefined"){params.no_header=a.attr('data-modal-no-header');}
if(typeof(params.no_fade)=="undefined"){params.no_fade=a.attr('data-modal-no-fade');}
var modal_class=a.attr('data-modal-class');if(typeof(modal_class)=="undefined"){modal_class='';}
var on_show=a.attr('data-modal-on-show');if(typeof(params.on_show)!="undefined"){on_show=params.on_show;}
if(typeof(params.size)=="undefined"){params.size=a.attr('data-modal-size');}
if(typeof(params.width_auto)=="undefined"){params.width_auto=a.attr('data-modal-width-auto');}
var fit=a.attr('data-modal-fit');var modal;if(params.size){modal_class+=' modal-'+params.size;}
if(params.width_auto){modal_class+=' modal-width-auto';}
if(typeof(modal_class)=="undefined"){modal_class='';}
for(param in params){if(params[param]===true){params[param]='true';}else if(params[param]===false){params[param]='false';}}
var html=['<div class="modal '+(params.no_fade=='true'?'':'fade')+'" tabindex="-1" role="dialog" aria-labelledby="jsmodal-label" aria-modal="true">','<div class="modal-dialog '+modal_class+'">','<div class="modal-content">','<div class="modal-header '+(params.no_header=='true'?'hidden':'')+'">','<button type="button" class="close" data-dismiss="modal" aria-label="'+Lang.get("messages.close")+'"><span>&times;</span></button>','<h3 class="modal-title" id="jsmodal-label">'+htmlEscape(title)+'</h3>','</div>','<div class="modal-body '+(fit=='true'?'modal-body-fit':'')+'"><div class="text-center modal-loader"><img src="'+Vars.public_url+'/img/loader-grey.gif" width="31" height="31"/></div></div>','<div class="modal-footer '+(params.no_footer=='true'?'hidden':'')+'">',(params.no_close_btn=='true'?'':'<button type="button" class="btn btn-default" data-dismiss="modal">'+Lang.get("messages.close")+'</button>'),footer,'</div>','</div>','</div>','</div>'].join('');modal=$(html);modal.modal(params.options);modal.on('hidden.bs.modal',function(){$(this).remove();});if(body){var body_html=$(body).html();if(!body_html){body_html=$('<div>'+body+'</div>').html()}
modal.children().find(".modal-body").html(body_html);if(on_show){if(typeof(window[on_show])=="function"){window[on_show](modal);}else if(typeof(on_show)=="function"){on_show(modal,a);}}}else{setTimeout(function(){$.ajax({url:remote,success:function(html){modal.children().find(".modal-body").html(html);if(on_show){if(typeof(window[on_show])=="function"){window[on_show](modal,a);}else if(typeof(on_show)=="function"){on_show(modal,a);}}},error:function(data){modal.children().find(".modal-body").html('<p class="alert alert-danger">'+Lang.get("messages.error_occurred")+'</p>');}});},500);}}
function showAjaxError(response,no_autohide){var msg='';if(typeof(response.msg)!="undefined"){msg=response.msg;}else if(typeof(response.message)!="undefined"){msg=response.message;}
if(msg){showFloatingAlert('error',response.msg,no_autohide);}else{showFloatingAlert('error',Lang.get("messages.error_occurred"),no_autohide);}}
function initAfterSendModal(modal){$(document).ready(function(){modal.children().find(".after-send-save:first").click(function(e){saveAfterSend(e.target);});});}
function saveAfterSend(el){var button=$(el);button.button('loading');var value=$(el).parents('.modal-body:first').children().find('[name="after_send_default"]:first').val();var mailbox_id=getGlobalAttr('mailbox_id');if(!mailbox_id){mailbox_id=$(el).parents('.modal-body:first').children().find('[name="default_redirect_mailbox_id"]:first').val()}
data={value:value,mailbox_id:mailbox_id,action:'save_after_send'};fsAjax(data,laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){$('.dropdown-after-send [data-after-send='+value+']:first').click();showFloatingAlert('success',Lang.get("messages.settings_saved"));$('.modal').modal('hide');}else{showAjaxError(response);}
button.button('reset');},true);}
function viewMailboxInit(){conversationPagination();starConversationInit();initMailboxToolbar();}
function initMailboxToolbar(){$(document).ready(function(){$(".mailbox-empty-folder").click(function(e){showModalDialog('#conversations-bulk-actions-delete-modal',{on_show:function(modal){modal.children().find('.delete-conversation-ok:first').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'empty_folder',folder_id:getGlobalAttr('folder_id'),mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){location.reload();}else{modal.modal('hide');showAjaxError(response);}},true);e.preventDefault();});}});e.preventDefault();});});}
function searchInit(){$(document).ready(function(){conversationPagination();starConversationInit();customersPagination();$(".sidebar-menu .menu-link a").filter('[data-filter]').click(function(e){var trigger=$(this);var filter=trigger.attr('data-filter');if(!trigger.parent().hasClass('active')){$('#search-filters div[data-filter="'+filter+'"]:first').addClass('active').find(':input:first').removeAttr('disabled');trigger.parent().addClass('active');}else{$('#search-filters div[data-filter="'+filter+'"]:first').removeClass('active').find(':input:first').attr('disabled','disabled');trigger.parent().removeClass('active');}
$('html, body').animate({scrollTop:0},600,'swing');e.preventDefault();});$("#search-filters .remove").click(function(e){var container=$(this).parents('.form-group:first');var filter=container.attr('data-filter');$('#search-filters div[data-filter="'+filter+'"]:first').removeClass('active').find(':input:first').attr('disabled','disabled');$('.sidebar-menu a[data-filter="'+filter+'"]:first').parent().removeClass('active');e.preventDefault();});initCustomerSelector($('#search-filter-customer'),{width:'100%'});$('#search-filters .input-date').flatpickr({allowInput:true});$('#search-filters .filter-multiple').select2({multiple:true,tags:true});});}
function loadConversations(page,table,no_loader){var filter=null;var params={};var sorting={};if($('body:first').hasClass('body-search')){filter={q:getQueryParam('q'),f:getQueryParam('f')};}
if(typeof(table)=="undefined"||table===''){table=$(".table-conversations:first");}
if(typeof(page)=="undefined"||page===''){page=table.attr('data-page');}
if(typeof(no_loader)=="undefined"){no_loader=false;}
var datas=table.data();for(data_name in datas){if(/^filter_/.test(data_name)){if(filter==null){filter={};}
filter[data_name.replace(/^filter_/,'')]=datas[data_name];}}
for(data_name in datas){if(/^param_/.test(data_name)){params[data_name.replace(/^param_/,'')]=datas[data_name];}}
for(data_name in datas){if(/^sorting_/.test(data_name)){sorting[data_name.replace(/^sorting_/,'')]=datas[data_name];}}
if(typeof(URL)!="undefined"){const url=new URL(window.location);url.searchParams.set('page',page);window.history.replaceState({},'',url);}
fsAjax({action:'conversations_pagination',mailbox_id:getGlobalAttr('mailbox_id'),folder_id:getGlobalAttr('folder_id'),filter:filter,params:params,page:page,sorting:sorting},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.html)!="undefined"){$(".table-conversations:first").replaceWith(response.html);conversationPagination();starConversationInit();converstationBulkActionsInit();convListSortingInit();triggersInit();}}else{showAjaxError(response);}
loaderHide();},no_loader);}
function loadCustomers(page,table){var filter=null;if($('body:first').hasClass('body-search')){filter={q:getQueryParam('q'),f:getQueryParam('f')};}
if(typeof(table)=="undefined"||table===''){table=$(".table-customers:first");}
if(typeof(page)=="undefined"||page===''){page=table.attr('data-page');}
fsAjax({action:'customers_pagination',filter:filter,page:page},laroute.route('customers.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.html)!="undefined"){table.replaceWith(response.html);customersPagination();initModals();}}else{showAjaxError(response);}
loaderHide();});}
function conversationPagination(){$(".table-conversations .pager-nav").click(function(e){loadConversations($(this).attr('data-page'),$(this).parents('.table-conversations:first'));e.preventDefault();});}
function customersPagination(){$(".table-customers .pager-nav").click(function(e){loadCustomers($(this).attr('data-page'),$(this).parents('.table-customers:first'));e.preventDefault();});}
function changeCustomerInit(){$(document).ready(function(){var input=$(".change-customer-input");initCustomerSelector(input,{dropdownParent:$('.modal-dialog:visible:first'),multiple:true,placeholder:input.attr('placeholder'),maximumSelectionLength:1,ajax:{url:laroute.route('customers.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,exclude_email:input.attr('data-customer_email'),search_by:'all',page:params.page};}}});input.on('select2:selecting',function(e){if(typeof(e.params)=="undefined"||typeof(e.params.args.data)=="undefined"){console.log(e);return;}
var data=e.params.args.data;var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.confirm_change_customer",{customer_email:data.id})+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary change-customer-ok" data-customer_email='+data.id+'>OK</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';triggerModal(null,{body:confirm_html,width_auto:'true',no_header:'true',no_footer:'true',no_fade:'true',size:'sm',on_show:function(modal){modal.children().find('.change-customer-ok:first').click(function(e){conversationChangeCustomer($(this).attr('data-customer_email'));});}});e.preventDefault();});$("#change-customer-create-trigger a:first").click(function(e){$('#change-customer-create').removeClass('hidden');$(this).hide();e.preventDefault();});$("#change-customer-create form:first").submit(function(e){e.preventDefault();});$("#change-customer-create button:first").click(function(e){var button=$(this);button.button('loading');var data=button.parents('form:first').serialize();data+='&action=create';fsAjax(data,laroute.route('customers.ajax'),function(response){showAjaxResult(response);if(typeof(response.status)!="undefined"&&response.status=='success'){conversationChangeCustomer(response.email);}
ajaxFinish();});});});}
function conversationChangeCustomer(email){fsAjax({action:'conversation_change_customer',customer_email:email,conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.redirect_url)!="undefined"){window.location.href=response.redirect_url;}else{window.location.href='';}}else{showAjaxError(response);loaderHide();}});}
function initMoveConv(){$(document).ready(function(){$(".btn-move-conv:visible:first").click(function(e){var button=$(this);button.button('loading');fsAjax({action:'conversation_move',mailbox_id:$('.move-conv-mailbox-id:visible:first').val(),mailbox_email:$('.move-conv-mailbox-email:visible:first').val(),conversation_id:getGlobalAttr('conversation_id'),folder_id:getQueryParam('folder_id')},laroute.route('conversations.ajax'),function(response){showAjaxResult(response);if(isAjaxSuccess(response)){if(typeof(response.redirect_url)!="undefined"&&response.redirect_url){window.location.href=response.redirect_url;}else{window.location.href='';}}
ajaxFinish();});});$(".move-conv-mailbox-email:first").on('keyup keypress',function(e){if($(this).val()){$(".move-conv-mailbox-id:first").attr('disabled','disabled');}else{$(".move-conv-mailbox-id:first").removeAttr('disabled');}});});}
function initMergeConv(){$(document).ready(function(){initTooltips();initMergeConvSelect();$(".btn-merge-conv:visible:first").click(function(e){var button=$(this);button.button('loading');var conv_ids=[];$('.conv-merge-selected:visible:first .conv-merge-id:checked').each(function(){conv_ids.push($(this).val());});if(!conv_ids.length){return;}
fsAjax({action:'conversation_merge',merge_conversation_id:conv_ids,conversation_id:getGlobalAttr('conversation_id')},laroute.route('conversations.ajax'),function(response){showAjaxResult(response);if(isAjaxSuccess(response)){window.location.href='';}
ajaxFinish();});e.preventDefault();});$(".btn-merge-search:visible:first").click(function(e){var button=$(this);button.button('loading');fsAjax({action:'merge_search',number:$('.merge-conv-number:visible:first').val(),},laroute.route('conversations.ajax'),function(response){showAjaxResult(response);if(isAjaxSuccess(response)&&response.html){$('.conv-merge-search-result:first td:first').html(response.html);$('.conv-merge-search-result:first').removeClass('hidden');initTooltips();initMergeConvSelect();}else{if($('.conv-merge-search-result:first .conv-merge-id').is(':checked')){$('.btn-merge-conv:visible:first').attr('disabled','disabled');}
$('.conv-merge-search-result:first td:first').html(response.html);$('.conv-merge-search-result:first').addClass('hidden');}
ajaxFinish();});});});}
function initMergeConvSelect(){$('.conv-merge-id').click(function(){$('.btn-merge-conv:visible:first').removeAttr('disabled');var checkbox_container=$(this).parent();var selected_list=$('.conv-merge-selected:visible:first');var clicked_conv_id=parseInt($(this).val());if(!isNaN(clicked_conv_id)&&!selected_list.children().find('.conv-merge-id[value="'+parseInt($(this).val())+'"]').length){var html='<div class="alert alert-narrow alert-info">'
+checkbox_container[0].outerHTML
+'</div>';selected_list.append(html);selected_list.children().find('.conv-merge-id:last').attr('checked','checked').click(function(e){$('.conv-merge-list:visible:first').children().find('.conv-merge-id[value="'+parseInt($(this).val())+'"]:first').parents('tr:first').show();$(this).parent().parent().remove();if(!selected_list.children().find('.conv-merge-id').length){$('.btn-merge-conv:visible:first').attr('disabled','disabled');}});}
if($(this).hasClass('conv-merge-searched')){$('.conv-merge-search-result:first').addClass('hidden');}else{checkbox_container.parents('tr:first').hide();}
$(this).prop("checked",false);});}
function isAjaxSuccess(response){if(typeof(response.status)!="undefined"&&response.status=='success'){return true;}else{return false;}}
function initCustomerSelector(input,custom_options){var use_id=true;if(typeof(custom_options.use_id)!="undefined"){use_id=custom_options.use_id;if(!use_id){use_id=null;}}
var search_by='all';if(typeof(custom_options.search_by)!="undefined"){search_by=custom_options.search_by;}
var show_fields='all';if(typeof(custom_options.show_fields)!="undefined"){show_fields=custom_options.show_fields;}
var allow_non_emails=null;if(typeof(custom_options.allow_non_emails)!="undefined"){allow_non_emails=true;}
var options={ajax:{url:laroute.route('customers.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,exclude_email:input.attr('data-customer_email'),use_id:use_id,search_by:search_by,show_fields:show_fields,allow_non_emails:allow_non_emails,page:params.page};}},containerCssClass:"select2-multi-container",dropdownCssClass:"select2-multi-dropdown",minimumInputLength:2};if(input.length==1&&input.is(':visible')){options.placeholder=input.attr('placeholder');}
if(typeof(custom_options.editable)!="undefined"&&custom_options.editable){var token_separators=[",",", "," "];if(typeof(custom_options.maximumSelectionLength)!="undefined"&&custom_options.maximumSelectionLength==1){token_separators=[];}
$.extend(options,{multiple:true,tags:true,tokenSeparators:token_separators,createTag:function(params){if(typeof(custom_options.allow_non_emails)=="undefined"){if(!/^.+@.+$/.test(params.term)){return null;}}
var data=this.select2('data');for(i in data){if(data[i].id==params.term){return null;}}
return{id:params.term,text:params.term,newOption:true}}.bind(input),templateResult:function(data){var $result=$("<span></span>");$result.text(data.text);if(data.newOption){$result.append(" <em>("+Lang.get("messages.add_lower")+")</em>");}
return $result;}});}
if(typeof(custom_options)!='undefined'){$.extend(options,custom_options);}
return input.select2(options);}
function showModalConfirm(text,ok_class,options,ok_text){if(typeof(ok_text)=="undefined"){ok_text='OK';}
var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+text+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary '+ok_class+'">'+ok_text+'</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';showModalDialog(confirm_html,options);}
function showModalDialog(body,options){var standard_options={body:body,width_auto:'true',no_header:'true',no_footer:'true',no_fade:'true'};if(typeof(options)=="undefined"){options={};}
options=Object.assign(standard_options,options);triggerModal(null,options);}
function userProfileInit(){$(".send-invite-trigger, .resend-invite-trigger").click(function(e){var button=$(this);var is_resend=false;button.button('loading');if(button.hasClass('resend-invite-trigger')){is_resend=true;}
fsAjax({action:'send_invite',user_id:getGlobalAttr('user_id')},laroute.route('users.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(is_resend){showFloatingAlert('success',Lang.get("messages.invite_resent"));}else{showFloatingAlert('success',Lang.get("messages.invite_sent"));}}else{showAjaxError(response,true);}
button.button('reset');},true);e.preventDefault();});$(".reset-password-trigger").click(function(e){var button=$(this);var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.confirm_reset_password")+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary reset-password-ok">OK</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';showModalDialog(confirm_html,{on_show:function(modal){modal.children().find('.reset-password-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'reset_password',user_id:getGlobalAttr('user_id')},laroute.route('users.ajax'),function(response){showAjaxResult(response);button.button('reset');});});}});e.preventDefault();});$("#user-photo-delete").click(function(e){var button=$(this);var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.confirm_delete_photo")+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary reset-password-ok">'+Lang.get("messages.delete")+'</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';showModalDialog(confirm_html,{on_show:function(modal){modal.children().find('.reset-password-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete_photo',user_id:getGlobalAttr('user_id')},laroute.route('users.ajax'),function(response){$('#user-profile-photo').remove();button.button('reset');},true);});}});e.preventDefault();});jQuery("#delete-user-trigger").click(function(e){var confirm_html=$('#delete_user_modal').html();showModalDialog(confirm_html,{width_auto:false,on_show:function(modal){modal.children().find('.input-delete-user:first').on('keyup keypress',function(e){if($(this).val()=='DELETE'){modal.children().find('.button-delete-user:first').removeAttr('disabled');}else{modal.children().find('.button-delete-user:first').attr('disabled','disabled');}});modal.children().find('.button-delete-user:first').click(function(e){var data=$('.assign_form:visible:first').serialize();if(data){data+='&';}
data+='action=delete_user';data+='&user_id='+getGlobalAttr('user_id');modal.modal('hide');fsAjax(data,laroute.route('users.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=laroute.route('users');return;}else{showAjaxError(response);}
loaderHide();});e.preventDefault();});}});});}
function showAjaxResult(response){loaderHide();if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response['msg_success'])!="undefined"){showFloatingAlert('success',response['msg_success']);}}else{showAjaxError(response);}}
function getCsrfToken(){return $('meta[name="csrf-token"]:first').attr('content');}
function polycastInit(){var auth_user_id=getGlobalAttr('auth_user_id');if(!auth_user_id){return;}
if(getGlobalAttr('conversation_id')){poly_data_closures.push(function(data){if(getReplyFormMode()=='reply'){data.replying=1;}else{data.replying=0;}
if(!fs_prev_focus&&document.hasFocus()){data.conversation_view_focus=1;}
fs_prev_focus=document.hasFocus();if(document.hasFocus()||data.replying){data.conversation_id=getGlobalAttr('conversation_id');}
return data;});}
poly=new Polycast(Vars.public_url+'/polycast',{token:getCsrfToken(),data:poly_data_closures});var channel=poly.subscribe('private-App.User.'+auth_user_id);channel.on('App\\Events\\RealtimeBroadcastNotificationCreated',function(data,event){if(typeof(event.data)!="undefined"){if(typeof(event.data.web)!="undefined"&&typeof(event.data.web.html)!="undefined"&&event.data.web.html){showMenuNotification(event.data.web.html);}
if(typeof(event.data.browser)!="undefined"&&typeof(event.data.browser.text)!="undefined"&&event.data.browser.text){showBrowserNotification(event.data.browser.text,event.data.browser.url);}}});var channel=poly.subscribe('conv');channel.on('App\\Events\\RealtimeConvView',function(data,event){if(!data||data.conversation_id!=getGlobalAttr('conversation_id')||data.user_id==getGlobalAttr('auth_user_id')){return;}
if(data.replying){title=Lang.get("messages.user_replying",{'user':data.user_name});}else{title=Lang.get("messages.user_viewing",{'user':data.user_name});}
var item=$('#conv-viewers .viewer-'+data.user_id+':first');var sorting_required=false;var change_title=false;var is_new=false;if(item.length){if(!item.is(':visible')){item.fadeIn();}
if(data.replying&&!item.hasClass('viewer-replying')){item.addClass('viewer-replying');change_title=true;sorting_required=true;}
if(!data.replying&&item.hasClass('viewer-replying')){item.removeClass('viewer-replying');change_title=true;sorting_required=true;}}else{var item_class='viewer-'+data.user_id;if(data.replying){item_class+=' viewer-replying';sorting_required=true;}
var html=personPhotoHtml(data.user_initials,data.user_photo_url,'data-toggle="tooltip" title="'+title+'" style="display:none"',item_class,'xs');$('#conv-viewers').prepend(html);is_new=true;}
if(change_title){item.attr('data-original-title',title);}
if(sorting_required){var html_replying='';var html_other='';$('#conv-viewers > span').each(function(i,el){if($(el).hasClass('viewer-replying')){html_replying+=el.outerHTML;}else{html_other+=el.outerHTML;}});$('#conv-viewers').html(html_replying+html_other);initTooltip('#conv-viewers > span');}
if(is_new){$('#conv-viewers > span').fadeIn();initTooltip('#conv-viewers .viewer-'+data.user_id+':first');}});channel.on('App\\Events\\RealtimeConvViewFinish',function(data,event){if(!data||data.conversation_id!=getGlobalAttr('conversation_id')||data.user_id==getGlobalAttr('auth_user_id')){return;}
$('#conv-viewers .viewer-'+data.user_id+':first').fadeOut();});var conversation_id=getGlobalAttr('conversation_id');if(conversation_id){var channel=poly.subscribe('conv.'+conversation_id);channel.on('App\\Events\\RealtimeConvNewThread',function(data,event){if(!data||typeof(data.conversation_id)=="undefined"||data.conversation_id!=getGlobalAttr('conversation_id')||data.user_id==getGlobalAttr('auth_user_id')){return;}
if(typeof(data.thread_html)!="undefined"&&data.thread_html&&!$('#thread-'+data.thread_id).length){var container=$('#conv-layout-main .thread-type-new');if(container.length){container.prepend(data.thread_html);$('#conv-layout-main .thread-type-new:first .view-new-trigger').text(Lang.get("messages.view_new_messages",{'count':$('#conv-layout-main .thread-type-new .thread').length}));}else{$('#conv-layout-main').prepend('<div class="thread thread-type-new">'+data.thread_html+'<a href="" class="view-new-trigger">'+Lang.get("messages.view_new_message")+'</a></div>');$('#conv-layout-main .thread-type-new:first .view-new-trigger').click(function(e){var container=$(this).parent();$(this).remove();$('#conv-layout-main').prepend(container.html());container.remove();e.preventDefault();});flashElement($('#conv-layout-main .thread-type-new:first'));$.titleAlert(' '+Lang.get("messages.new_message"),{requireBlur:true,stopOnFocus:true,interval:600});if(convIsChat()){setTimeout(function(){$('#conv-layout-main .thread-type-new:first .view-new-trigger').click();},3000);}}}
if(typeof(data.conversation_user_id)!="undefined"&&data.conversation_user_id&&parseInt(data.conversation_user_id)!=convGetUserId()){$('#conv-assignee .conv-user li.active').removeClass('active');var a=$("#conv-assignee .conv-user li a[data-user_id='"+data.conversation_user_id+"']");a.parent().addClass('active');$('#conv-assignee .conv-info-val span:first').text(a.text());flashElement($('#conv-assignee'));}
if(typeof(data.conversation_status)!="undefined"&&data.conversation_status&&parseInt(data.conversation_status)!=convGetStatus()){$('#conv-status .conv-status li.active').removeClass('active');var a=$("#conv-status .conv-status li a[data-status='"+data.conversation_status+"']");a.parent().addClass('active');$('#conv-status .conv-info-val span:first').text(a.text());if(data.conversation_status_class){$.each($('#conv-status .btn'),function(index,btn){var classes=$(btn).attr('class').split(/\s+/);$.each(classes,function(index,item_class){if(item_class.indexOf('btn-')!=-1&&item_class!='btn-light'){$(btn).removeClass(item_class);}});});$('#conv-status .btn').addClass('btn-'+data.conversation_status_class);}
if(data.conversation_status_icon){$('#conv-status .btn:first .glyphicon').attr('class','glyphicon').addClass('glyphicon-'+data.conversation_status_icon);}
flashElement($('#conv-status'));}});}
var mailbox_id=getGlobalAttr('mailbox_id');var el_folders=$('#folders');if(mailbox_id&&el_folders.length&&!isChatMode()){var channel=poly.subscribe('mailbox.'+mailbox_id);channel.on('App\\Events\\RealtimeMailboxNewThread',function(data,event){if(!data||typeof(data.mailbox_id)=="undefined"||data.mailbox_id!=mailbox_id){return;}
if(typeof(data.folders_html)!="undefined"&&data.folders_html){var folder_id=el_folders.children('li.active:first').attr('data-folder_id');el_folders.html(data.folders_html);var active_folder=el_folders.children('li[data-folder_id="'+folder_id+'"]');active_folder.addClass('active');if(!getGlobalAttr('conversation_id')){var new_count=parseInt(active_folder.attr('data-active-count'));if(!isNaN(new_count)&&new_count>0){new_count='('+new_count+') ';}else{new_count='';}
document.title=new_count+document.title.replace(/^\(\d+\) /,"");}}
if($(".table-conversations:first").length&&!getSelectedConversations().length){loadConversations('','',true);}});}
var chats=$('#folders.chats:first');if(mailbox_id&&chats.length){var channel=poly.subscribe('chat.'+mailbox_id);channel.on('App\\Events\\RealtimeChat',function(data,event){if(!data||typeof(data.mailbox_id)=="undefined"||data.mailbox_id!=mailbox_id){return;}
if(typeof(data.chats_html)!="undefined"&&data.chats_html){var chat_id=chats.children('li.active:first').attr('data-chat_id');var header_html=chats.children('li:first').prop('outerHTML');chats.html(header_html+data.chats_html);var active_chat=chats.children('li[data-chat_id="'+chat_id+'"]');active_chat.addClass('active');initChats();}});initChats();}}
function initChats(){$('.chats-load-more').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'chats_load_more',mailbox_id:getGlobalAttr('mailbox_id'),offset:$('#folders .chat-item').length-1,},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){button.parent().before(response.html);button.parent().remove();initChats();}else{showAjaxResult(response);}
button.button('reset');},true);e.preventDefault();e.stopPropagation();});}
function convIsChat(){return $('#conv-layout').hasClass('conv-type-chat');}
function convGetUserId(){return parseInt($('#conv-assignee .conv-user li.active a:first').attr('data-user_id'));}
function convGetStatus(){return parseInt($('#conv-status .conv-status li.active a:first').attr('data-status'));}
function flashElement(el){el.fadeOut(0).fadeIn(2000);}
function showMenuNotification(html){$(html).prependTo($(".web-notifications-list:first"));var counter=$('.web-notifications-count:first');if(counter){var count=parseInt($('.web-notifications-count:first').text());if(isNaN(count)){count=0;}
count++;counter.text(count).removeClass('hidden');}
$('.web-notifications-mark-read:first').removeClass('hidden');var first_date=$('.web-notification-date:first');$('.web-notification-date[data-date="'+first_date.attr('data-date')+'"]:gt(0)').remove();$('.web-notifications .dropdown-toggle:first').addClass('has-unread');}
function showBrowserNotification(text,url){Push.create(text,{body:"",icon:Vars.public_url+'/img/logo-icon-white-300.png',tag:url,timeout:5000,onClick:function(){if(url){var win=window.open(url,'_blank');win.focus();this.close();}}});}
function takeNotificationsOut(){if($(window).width()>=768){var container=$('.navbar-header .web-notifications:first');if(container){container.prependTo(".navbar-right:first");}}else{var container=$('.navbar-right .web-notifications:first');if(container){container.prependTo(".navbar-header:first");}}}
function webNotificationsInit(){takeNotificationsOut();$(window).on('resize',function(){takeNotificationsOut();});var button=$('.web-notification-more:first .btn:first');button.click(function(e){button.button('loading');var wn_page=parseInt(button.attr('data-wn_page'));if(isNaN(wn_page)){wn_page=2;}
fsAjax({action:'web_notifications',wn_page:wn_page},laroute.route('users.ajax'),function(response){if(isAjaxSuccess(response)){$(response.html).insertBefore(button.parent());}else{showAjaxError(response);}
if(typeof(response.has_more_pages)=="undefined"||!response.has_more_pages){button.parent().hide();}
button.button('reset');button.attr('data-wn_page',wn_page+1);},true);e.preventDefault();e.stopPropagation();});$('.web-notifications-mark-read:first').click(function(e){var mark_button=$(this);if(mark_button.hasClass('disabled')){return;}
mark_button.button('loading');fsAjax({action:'mark_notifications_as_read'},laroute.route('users.ajax'),function(response){if(isAjaxSuccess(response)){mark_button.remove();$('.web-notifications-count:first').addClass('hidden');$('.web-notification.is-unread').removeClass('is-unread');$('.web-notifications .dropdown-toggle.has-unread:first').removeClass('has-unread');}else{showAjaxError(response);}
mark_button.button('reset');},true);e.preventDefault();e.stopPropagation();});}
function initSystemStatus(){if(location.protocol=='https:'){$('#system-app-protocol').text('HTTPS');}else{var html='HTTP'+'<div class="alert alert-danger margin-top">'+Lang.get("messages.push_protocol_alert")+'</div>';$('#system-app-protocol').html(html);}
$('.update-trigger').click(function(e){var button=$(this);showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+Lang.get("messages.confirm_update")+'</span>','confirm-update',{on_show:function(modal){modal.children().find('.confirm-update:first').click(function(e){button.button('loading');modal.modal('hide');poly.disconnect();fsAjax({action:'update'},laroute.route('system.ajax'),function(response){if(isAjaxSuccess(response)){showAjaxResult(response);window.location.href='';}else if(response.msg){showAjaxError({msg:response.msg},true);button.button('reset');}else{showAjaxError({msg:htmlDecode(Lang.get("messages.error_occurred_updating"))},true);button.button('reset');}},true,function(){showFloatingAlert('error',htmlDecode(Lang.get("messages.error_occurred_updating")),true);ajaxFinish();});});}},Lang.get("messages.update"));});$('.check-updates-trigger').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'check_updates'},laroute.route('system.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.new_version_available)!="undefined"&&response.new_version_available){window.location.href='';}else{showAjaxResult(response);button.button('reset');}}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});}
function ajaxFinish(){loaderHide();$(".btn[data-loading-text!='']:disabled").button('reset');$(".btn.disabled[data-loading-text!='']").button('reset');}
function maybeShowConnectionError(){fs_connection_errors++;if(fs_connection_errors==3){showFloatingAlert('error',Lang.get("messages.lost_connection"));}}
function maybeShowConnectionRestored(){if(fs_connection_errors>=3){showFloatingAlert('success',Lang.get("messages.connection_restored"));}
fs_connection_errors=0;}
function isNewConversation(){if($('#conv-layout-main .thread:first').length==0){return true;}else{return false;}}
function saveDraft(reload_page,no_loader,do_not_save_empty){if(!reload_page&&fs_processing_save_draft){return;}
if(fs_processing_send_reply){return;}
fs_processing_save_draft=true;var form=$(".form-reply:visible:first");if(!form||!form.length){finishSaveDraft();return;}
if(typeof(do_not_save_empty)!="undefined"){if(!$('.form-reply:visible:first :input[name="thread_id"]:first').val()&&!$('#body').val()&&!$('.form-reply:visible:first .thread-attachments li.attachment-loaded:first').length&&!$('#to').val()){fs_processing_save_draft=false;return;}}
var button=form.children().find('.note-actions .note-btn:first');var new_conversation=isNewConversation();if(typeof(no_loader)=="undefined"){no_loader=false;}
if((new_conversation||!reload_page)&&!fs_reply_changed){fs_processing_save_draft=false;return;}
if(reload_page){button.addClass('text-success');}
data=form.serialize();data+='&action=save_draft';fsAjax(data,laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(reload_page&&!new_conversation){window.location.href='';}else{button.addClass('text-success');fs_reply_changed=false;var saved_text=form.children().find('.draft-saved:first');if(!saved_text.length||!saved_text.is(':visible')){if(!saved_text.length){saved_text=$('<span class="draft-saved">'+Lang.get("messages.saved")+'</span>');saved_text.insertBefore(button);}else{saved_text.show();}
setTimeout(function(){saved_text.fadeOut(1000);},4000);}
if(typeof(response.conversation_id)!="undefined"&&response.conversation_id){form.children(':input[name="conversation_id"][value=""]').val(response.conversation_id);form.children(':input[name="thread_id"]').val(response.thread_id);form.children(':input[name="customer_id"]').val(response.customer_id);$('.conv-new-number:first').text(response.number);$('body:first').attr('data-conversation_id',response.conversation_id);if(new_conversation){setUrl(laroute.route('conversations.view',{id:response.conversation_id}));}}}}else{showAjaxError(response);}
loaderHide();finishSaveDraft();},no_loader,function(){showFloatingAlert('error',Lang.get("messages.ajax_error"));loaderHide();finishSaveDraft();});}
function finishSaveDraft(){fs_processing_save_draft=false;if(fs_send_reply_after_draft){fs_processing_send_reply=false;$(".btn-reply-submit:first").button('reset').click();}}
function setUrl(url){if(window.history&&typeof(window.history.replaceState)!="undefined"){try{window.history.replaceState({isMine:true},'title',url);}catch(e){}}}
function goBack(){window.history.go(-1);}
function forwardConversation(e){var reply_block=$(".conv-reply-block");if(!reply_block.hasClass('hidden')){return false;}
prepareReplyForm();showReplyForm();showForwardForm({},reply_block);loadAttachments(true);}
function followConversation(action){var conversation_id=getGlobalAttr('conversation_id');fsAjax({action:action,conversation_id:conversation_id,},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){var opposite='';if(action=='follow'){opposite='unfollow';$('#conv-layout').addClass('conv-following');}else{opposite='follow';$('#conv-layout').removeClass('conv-following');}
$('.conv-follow[data-follow-action="'+action+'"]').addClass('hidden');$('.conv-follow[data-follow-action="'+opposite+'"]').removeClass('hidden');fsDoAction('conversation.'+action,{user_id:getGlobalAttr('auth_user_id'),conversation_id:conversation_id});}
showAjaxResult(response);},true);}
function loadAttachments(is_forwarding){var attachments_container=$(".attachments-upload:first");var conversation_id=getGlobalAttr('conversation_id');if(typeof(is_forwarding)=="undefined"){is_forwarding=false;}
if(!attachments_container.hasClass('forward-attachments-loaded')&&conversation_id){fsAjax({action:'load_attachments',conversation_id:conversation_id,is_forwarding:is_forwarding},laroute.route('conversations.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.data)!="undefined"){attachments_container.addClass('forward-attachments-loaded');showAttachments(response.data);if(is_forwarding){saveDraft(false,true);}}else{}},true);}}
function showForwardForm(data,reply_block){if(typeof(reply_block)=="undefined"||!reply_block){reply_block=$(".conv-reply-block:first");}
reply_block.children().find(":input[name='subtype']:first").val(Vars.subtype_forward);reply_block.children().find(":input[name='to']:first").addClass('hidden');reply_block.children().find("#cc").val('').trigger('change');reply_block.children().find("#bcc").val('').trigger('change');reply_block.children().find(":input[name='to_email']:first").removeClass('hidden').removeClass('parsley-exclude').next('.select2:first').show();reply_block.addClass('inactive');reply_block.addClass('conv-forward-block');$(".conv-actions .conv-reply:first").addClass('inactive');if(data&&typeof(data.to)!="undefined"){addSelect2Option($("#to_email"),{id:data.to,text:data.to});}else{$("#to_email").children('option:first').removeAttr('selected');}
initRecipientSelector({},$('#to_email:not(.select2-hidden-accessible)'));}
function editDraft(button){var thread_container=button.parents('.thread:first');fsAjax({action:'load_draft',thread_id:thread_container.attr('data-thread_id')},laroute.route('conversations.ajax'),function(response){loaderHide();if(typeof(response.status)!="undefined"&&response.status=='success'){showReplyForm(response.data,-50);if(response.data.is_forward=='1'){showForwardForm(response.data);}
$('.thread.thread-type-draft').show();thread_container.hide();}else{showAjaxError(response);}});}
function discardDraft(thread_id){var confirm_html='<div>'+'<div class="text-center">'+'<div class="text-larger margin-top-10">'+Lang.get("messages.confirm_discard_draft")+'</div>'+'<div class="form-group margin-top">'+'<button class="btn btn-primary discard-draft-confirm">'+Lang.get("messages.yes")+'</button>'+'<button class="btn btn-link" data-dismiss="modal">'+Lang.get("messages.cancel")+'</button>'+'</div>'+'</div>'+'</div>';if(typeof(thread_id)=="undefined"&&isNote()&&!isNewConversation()){showModalDialog(confirm_html,{on_show:function(modal){modal.children().find('.discard-draft-confirm:first').click(function(e){hideReplyEditor();setReplyBody('');forgetNote();modal.modal('hide');$('#conv-subject').removeClass('action-visible');});}});return;}
if(typeof(thread_id)=="undefined"||!thread_id){thread_id=$('.form-reply :input[name="thread_id"]').val();}
var from_thread_id='';if(!thread_id&&getQueryParam('from_thread_id')){from_thread_id=getQueryParam('from_thread_id');}
showModalDialog(confirm_html,{on_show:function(modal){modal.children().find('.discard-draft-confirm:first').click(function(e){fsAjax({action:'discard_draft',thread_id:thread_id,from_thread_id:from_thread_id},laroute.route('conversations.ajax'),function(response){modal.modal('hide');if(isAjaxSuccess(response)){if(typeof(response.redirect_url)!="undefined"&&response.redirect_url){window.location.href=response.redirect_url;return;}
var thread_container=$('#thread-'+thread_id+':visible');if(thread_container.length){thread_container.remove();}else{hideReplyEditor();$("#to").val($("#to option:first").val());$(".conv-reply-block :input[name='cc']:first").val('');$(".conv-reply-block :input[name='bcc']:first").val('');setReplyBody('');$('#conv-subject').removeClass('action-visible');}}else{showAjaxError(response);}
loaderHide();});});}});}
function editThread(button){var thread_container=button.parents('.thread:first');fsAjax({action:'load_edit_thread',thread_id:thread_container.attr('data-thread_id')},laroute.route('conversations.ajax'),function(response){loaderHide();if(typeof(response.status)!="undefined"&&response.status=='success'){thread_container.children().hide();thread_container.prepend(response.html);summernoteInit(thread_container.find('.thread-editor:first'));thread_container.children().find('.thread-editor-cancel:first').click(function(e){cancelThreadEdit(e.target);e.preventDefault();});thread_container.children().find('.thread-editor-save:first').click(function(e){saveThreadEdit(e.target);e.preventDefault();});}else{showAjaxError(response);}});}
function deleteThread(button){var thread_container=button.parents('.thread:first');button.button('loading');fsAjax({action:'delete_thread',thread_id:thread_container.attr('data-thread_id')},laroute.route('conversations.ajax'),function(response){loaderHide();button.button('reset');if(isAjaxSuccess(response)){thread_container.remove();}else{showAjaxError(response);}});}
function cancelThreadEdit(trigger,thread_container){if(typeof(thread_container)=="undefined"||!thread_container){thread_container=$(trigger).parents('.thread:first');}
thread_container.find('.thread-editor-container').remove();thread_container.children().show();}
function saveThreadEdit(trigger){var button=$(trigger);var thread_container=$(trigger).parents('.thread:first');button.button('loading');fsAjax({action:'save_edit_thread',thread_id:thread_container.attr('data-thread_id'),body:thread_container.find('.thread-editor:first').val()},laroute.route('conversations.ajax'),function(response){loaderHide();button.button('reset');if(typeof(response.status)!="undefined"&&response.status=='success'){thread_container.find('.thread-body:first').html(response.body);cancelThreadEdit(trigger,thread_container);}else{showAjaxError(response);}});}
function threadShowOriginal(trigger){var container=trigger.parent();var original=container.find('.thread-original:first');original.removeClass('hidden');container.find('.thread-original-hide:first').removeClass('hidden');trigger.addClass('hidden');}
function threadHideOriginal(trigger){var container=trigger.parent();var original=container.find('.thread-original:first');original.addClass('hidden');container.find('.thread-original-show:first').removeClass('hidden');trigger.addClass('hidden');}
function hideReplyEditor(){$(".conv-action-block").addClass('hidden');$(".conv-action").removeClass('inactive');}
function hideActionBlocks(){$(".conv-action-block").addClass('hidden');$("#conv-subject").removeClass('action-visible');}
function getReplyBody(){return $("#body").val();}
function setReplyBody(text){$('#body').summernote("code",text);if(text==fs_body_default){text='';}
$(".conv-reply-block :input[name='body']:first").val(text);}
function setSummernoteText(jtextarea,text){jtextarea.summernote("code",text);}
function convListSortingInit(){$('.conv-col-sort').click(function(event){var table=$(this).parents('.table-conversations:first');table.attr('data-sorting_sort_by',$(this).attr('data-sort-by'));var order=$(this).attr('data-order');if(order=='asc'){order='desc';}else{order='asc';}
table.attr('data-sorting_order',order);loadConversations('','',true);});}
function starConversationInit(){$('.conv-star').click(function(event){var trigger=$(this);var conversation_id=getGlobalAttr('conversation_id');if(!conversation_id){conversation_id=trigger.parents('.conv-row:first').attr('data-conversation_id');}
if(!conversation_id){return false;}
var sub_action='star';if(trigger.hasClass('glyphicon-star')){sub_action='unstar';}
fsAjax({action:'star_conversation',conversation_id:conversation_id,sub_action:sub_action},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){if(trigger.parents('.conv-row:first').length){trigger=trigger.parents('.conv-row:first').children().find('.conv-star');}
if(sub_action=='star'){trigger.addClass('glyphicon-star');trigger.removeClass('glyphicon-star-empty');}else{trigger.addClass('glyphicon-star-empty');trigger.removeClass('glyphicon-star');}}else{showAjaxError(response);}},true);});}
function conversationsTableInit(){converstationBulkActionsInit();convListSortingInit();$(document).ready(function(){$('.conv-row').on('contextmenu',function(event){event.preventDefault();event.stopPropagation();});$('.conv-row').on('taphold',{duration:700},function(event){var row=$(event.target).parents('.conv-row');var checkbox=$(row).find('input.conv-checkbox');$(checkbox).prop('checked',!checkbox.prop('checked'));$(checkbox).trigger('change');$(row).toggleClass('selected');});});}
function getSelectedConversations(checkboxes){if(typeof(checkboxes)=="undefined"){checkboxes=$('.conv-checkbox');}
var conv_ids=[];checkboxes.each(function(){if($(this).prop('checked')){conv_ids.push($(this).val());}});return conv_ids;}
function converstationBulkActionsInit(){$(document).ready(function(){var checkboxes=$('.conv-checkbox');var bulk_buttons=$('#conversations-bulk-actions');$(bulk_buttons).show();if($(bulk_buttons).offset()){$(bulk_buttons).affix({offset:{top:$(bulk_buttons).offset().top,}});}
$(bulk_buttons).hide();$(bulk_buttons).on('affix.bs.affix',function(){if(!$(window).scrollTop())return false;});var resizeFn=function(){$(bulk_buttons).css('width',$('.content-2col').width());};resizeFn();$(window).resize(resizeFn);checkboxes.change(function(event){if(checkboxes.is(':checked')){$(bulk_buttons).fadeIn();}
else{$(bulk_buttons).fadeOut();}});$(".conv-user li > a",bulk_buttons).click(function(e){if($(this).hasClass('disabled')){return;}
var user_id=$(this).data('user_id');var conv_ids=getSelectedConversations(checkboxes);fsAjax({action:'bulk_conversation_change_user',conversation_id:conv_ids,user_id:user_id},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){location.reload();}else{showAjaxError(response);}},true);e.preventDefault();});$(".conv-status li > a",bulk_buttons).click(function(e){var status=$(this).data('status');var conv_ids=getSelectedConversations(checkboxes);fsAjax({action:'bulk_conversation_change_status',conversation_id:conv_ids,status:status},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){location.reload();}else{showAjaxError(response);}},true);e.preventDefault();});$(".conv-delete",bulk_buttons).click(function(e){showModalDialog('#conversations-bulk-actions-delete-modal',{on_show:function(modal){modal.children().find('.delete-conversation-ok:first').click(function(e){modal.modal('hide');var conv_ids=getSelectedConversations(checkboxes);fsAjax({action:'bulk_delete_conversation',conversation_id:conv_ids,},laroute.route('conversations.ajax'),function(response){if(isAjaxSuccess(response)){location.reload();}else{showAjaxError(response);}},true);e.preventDefault();});}});e.preventDefault();});$('.conv-checkbox-clear',bulk_buttons).click(function(e){$(checkboxes).trigger('change');$(checkboxes).prop('checked',false);$(checkboxes).trigger('change');$('table.table-conversations tr').removeClass('selected');});$('.toggle-all:checkbox').on('click',function(){$('.conv-checkbox:checkbox').prop('checked',this.checked).trigger('change');});$('.conv-cb label').on('click',function(e){var all_checkboxes=$('input.conv-checkbox');var this_input=$(this).parent('td').find('input.conv-checkbox')[0];document.getSelection().removeAllRanges();if(!fs_checkbox_shift_last_checked){fs_checkbox_shift_last_checked=this_input;return;}
if(e.shiftKey){var start=all_checkboxes.index(this_input);var end=all_checkboxes.index(fs_checkbox_shift_last_checked);all_checkboxes.slice(Math.min(start,end),Math.max(start,end)+1).prop('checked',fs_checkbox_shift_last_checked.checked);$(this_input).trigger('click');}
fs_checkbox_shift_last_checked=this_input;});});}
function switchToNote(){$(".conv-reply-block").addClass('hidden');$('.conv-add-note:first').click();}
function rememberNote(){if(!fs_autosave_note){return;}
var conversation_id=getGlobalAttr('conversation_id');if(!conversation_id){return;}
var note=$('#body').val();var note_plain=stripTags(note);var conversation_notes=loadNotesFromStorage(conversation_id);for(var i in conversation_notes){if(conversation_notes[i].time){if(conversation_notes[i].time<(new Date()).getTime()-fs_keep_conversation_notes*24*60*60*1000){delete conversation_notes[i];}}}
if(!note||!note_plain.trim()){delete conversation_notes[conversation_id];}else{conversation_notes[conversation_id]={note:note,time:(new Date()).getTime()};}
saveNoteToStorage(conversation_notes);}
function maybeShowStoredNote(){var conversation_id=getGlobalAttr('conversation_id');if(!conversation_id){return;}
var conversation_notes=loadNotesFromStorage(conversation_id);if(conversation_notes){if(typeof(conversation_notes[conversation_id])!='undefined'&&typeof(conversation_notes[conversation_id].note)!='undefined'&&conversation_notes[conversation_id].note.trim()){setReplyBody(conversation_notes[conversation_id].note);showNoteForm();}}}
function maybeShowDraft(){var thread_id=getQueryParam('show_draft');if(!thread_id){return;}
fsAjax({action:'load_draft',thread_id:thread_id},laroute.route('conversations.ajax'),function(response){loaderHide();if(typeof(response.status)!="undefined"&&response.status=='success'){showReplyForm(response.data);if(response.data.is_forward=='1'){showForwardForm(response.data);}
$('#thread-'+thread_id).hide();}else{showAjaxError(response);}});}
function forgetNote(conversation_id){var conversation_id=getGlobalAttr('conversation_id');var conversation_notes=loadNotesFromStorage(conversation_id);if(conversation_notes&&typeof(conversation_notes[conversation_id])!='undefined'){delete conversation_notes[conversation_id];saveNoteToStorage(conversation_notes);}}
function saveNoteToStorage(conversation_notes){localStorageSetObject('conversation_notes',conversation_notes);}
function localStorageSetObject(key,obj){localStorageSet(key,JSON.stringify(obj));}
function loadNotesFromStorage(conversation_id){return localStorageGetObject('conversation_notes');}
function localStorageGetObject(key){var json=localStorageGet(key);if(json){var obj={};try{obj=JSON.parse(json);}catch(e){}
if(obj&&typeof(obj)=='object'){return obj;}else{return{};}}else{return{};}}
function localStorageSet(key,value){if(typeof(localStorage)!="undefined"){localStorage.setItem(key,value);}else{return false;}}
function localStorageGet(key){if(typeof(localStorage)!="undefined"){return localStorage.getItem(key);}else{return false;}}
function localStorageRemove(key){if(typeof(localStorage)!="undefined"){localStorage.removeItem(key);}else{return false;}}
function stripTags(html){var div=document.createElement("div");div.innerHTML=html;var text=div.textContent||div.innerText||"";return text;}
function htmlEscape(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");}
function htmlDecode(input){var e=document.createElement('div');e.innerHTML=input;return e.childNodes.length===0?"":e.childNodes[0].nodeValue;}
function initAccordionHeading(){$(".panel-default .collapse").on('shown.bs.collapse',function(e){$(e.target).parent().children('.panel-heading:first').css('background-color','#f1f3f5');});$(".collapse").on('hidden.bs.collapse',function(e){$(e.target).parent().children('.panel-heading:first').css('background-color','');});}
function initModulesList(){$(document).ready(function(){$('.activate-trigger').click(function(e){var button=$(this);button.button('loading');var alias=button.parents('.module-card:first').attr('data-alias');fsAjax({action:'activate',alias:alias},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);});$('.deactivate-trigger').click(function(e){var button=$(this);button.button('loading');var alias=button.parents('.module-card:first').attr('data-alias');fsAjax({action:'deactivate',alias:alias},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);});$('.delete-module-trigger').click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.confirm_delete_module"),'confirm-delete-module',{on_show:function(modal){modal.children().find('.confirm-delete-module:first').click(function(e){button.button('loading');modal.modal('hide');var alias=button.parents('.module-card:first').attr('data-alias');fsAjax({action:'delete',alias:alias},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('.update-module-trigger').click(function(e){var button=$(this);button.button('loading');var alias=button.parents('.module-card:first').attr('data-alias');fsAjax({action:'update',alias:alias},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});$('.update-all-trigger').click(function(e){var button=$(this);button.button('loading');var aliases=$.map($("#new_versions_list a[data-module-alias]"),function(el){return $(el).attr("data-module-alias");});fsAjax({action:'update_all',aliases:aliases},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();});$('.deactivate-license-trigger').click(function(e){var button=$(this);var alias=button.parents('.module-card:first').attr('data-alias');loaderShow();fsAjax({action:'deactivate_license',alias:alias,license:$('#module-'+alias).children().find('.license-key-text:first').text()},laroute.route('modules.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);loaderHide();}},true);});$('.install-module-form').submit(function(e){installModule($(this).attr('data-module-alias'));e.preventDefault();return false;});});}
function installModule(alias){var button=$('#module-'+alias).children().find('.install-trigger:first');button.button('loading');fsAjax({action:button.attr('data-action'),alias:alias,license:$('#module-'+alias).children().find('.license-key:first').val()},laroute.route('modules.ajax'),function(response){if((isAjaxSuccess(response))||(typeof(response.reload)!="undefined"&&response.reload)){window.location.href='';}else{showAjaxError(response);button.button('reset');}},true);}
function scrollTo(el,selector,speed,offset){if(typeof(offset)=="undefined"){offset=0;}
if(typeof(speed)=="undefined"||!speed){speed=600;}
var eljq=null;if(el){eljq=$(el);}else{eljq=$(selector);}
$('html, body').animate({scrollTop:(eljq.offset().top+offset)},speed);}
function getReplyFormMode(){var block=$(".conv-reply-block");if(block.hasClass('hidden')){return'';}else if(block.hasClass('conv-forward-block')){return'forward';}else if(block.hasClass('conv-note-block')){return'note';}else{return'reply';}}
function personPhotoHtml(initials,photo_url,attrs,photo_class,size){if(typeof(size)=="undefined"){size='sm';}
if(typeof(photo_class)=="undefined"){photo_class='';}
var html='<span class="photo-'+size+' '+photo_class+'" '+attrs+'>';if(photo_url){html+='<img class="person-photo" src="'+photo_url+'" />';}else{html+='<i class="person-photo person-photo-auto" data-initial="'+initials+'"></i>';}
html+='</span>';return html;}
function switchHelpdeskUrl(){var url=window.location.href.replace(/#.*/,'');if(url.indexOf('?')==-1){url=url+'?';}else{url=url+'&';}
url=url+'nc='+Date.now()+"#in-app-close";window.location.href=url;}
function inAppPostMessage(data){if(typeof(webkit)!="undefined"&&typeof(webkit.messageHandlers)!="undefined"&&typeof(webkit.messageHandlers.cordova_iab)!="undefined"&&typeof(webkit.messageHandlers.cordova_iab.postMessage)!="undefined"){webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify(data));}else{setTimeout(function(){inAppPostMessage(data);},100);}}
function inApp(topic,token){$(document).ready(function(){$('.in-app-switcher').removeClass('hidden');if(!jQuery.isEmptyObject(fs_in_app_data)){fs_in_app_data['action']='data';inAppPostMessage(fs_in_app_data);}
if(!getCookie('in_app')){setCookie('in_app','1');}
$('#navbar-back').click(function(e){goBack();e.preventDefault();});$('a.in-app-switcher').click(function(e){switchHelpdeskUrl();e.preventDefault();});});}
function setCookie(name,value,props){props=props||{path:"/"};if(!props.expires){var exp_date=new Date();exp_date.setSeconds(2147483647);props.expires=exp_date;}
var exp=props.expires;if(typeof exp=="number"&&exp){var d=new Date();d.setTime(d.getTime()+exp*1000);exp=props.expires=d;}
if(exp&&exp.toUTCString){props.expires=exp.toUTCString();}
value=encodeURIComponent(value);var updatedCookie=name+"="+value
for(var propName in props){updatedCookie+="; "+propName;var propValue=props[propName];if(propValue!==true){updatedCookie+="="+propValue;}}
document.cookie=updatedCookie;}
function getCookie(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,'\\$1')+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):undefined}
function deleteCookie(name){document.cookie=name+'=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;';}
function fsAddAction(action,callback,priority){if(typeof(priority)=="undefined"){priority=20;}
if(typeof(fs_actions[action])=="undefined"){fs_actions[action]=[];}
fs_actions[action].push({callback:callback,priority:priority});}
function fsDoAction(action,params){if(typeof(fs_actions[action])!="undefined"){if(typeof(params)=="undefined"){params={};}
for(var i in fs_actions[action]){fs_actions[action][i].callback(params);}
return true;}else{return false;}}
function fsAddFilter(filter,callback,priority){if(typeof(priority)=="undefined"){priority=20;}
if(typeof(fs_filters[filter])=="undefined"){fs_filters[filter]=[];}
fs_filters[filter].push({callback:callback,priority:priority});}
function fsApplyFilter(filter,value,params){if(typeof(fs_filters[filter])!="undefined"){if(typeof(params)=="undefined"){params={};}
for(var i in fs_filters[filter]){value=fs_filters[filter][i].callback(value,params);}}
return value;}
function maybeScrollToReplyBlock(offset){var reply_block=$('.conv-reply-block:visible:first');var block_top=reply_block.position().top;if(block_top>$(window).height()/ 2||block_top<$(window).scrollTop()){if(typeof(offset)=="undefined"){offset=-20;}
scrollTo(reply_block,'',null,offset);}}
function initConvSettings(){var settings_modal=jQuery('#conv-settings-modal');var history_select=jQuery('#email_history',settings_modal);$('#conv-settings-modal').on('show.bs.modal',function(e){var is_forward=$(".conv-reply-block.conv-forward-block").length;if(is_forward){$('#email_history option[value="global"]').hide();$('#email_history option[value="none"]').hide();if($('#email_history').val()=='global'){$('#email_history').val('full');}}else{$('#email_history option[value="global"]').show();$('#email_history option[value="none"]').show();}})
$('.button-save-settings:first',settings_modal).on('click',function(e){e.preventDefault();settings_modal.modal('hide');$(".conv-reply-block").children().find(":input[name='conv_history']:first").val(history_select.val());});$('.button-cancel-settings:first',settings_modal).on('click',function(e){e.preventDefault();settings_modal.modal('hide');var value=$(".conv-reply-block").children().find(":input[name='conv_history']:first").val();if(!value){value='global';}
jQuery('#email_history',jQuery('#conv-settings-modal')).val(value);});}
function initUsers(){$('#search-users').on('keyup keypress',function(e){var q=$(this).val().trim().toLowerCase();var clear=$('#search-users-clear i:first');if(q){if(clear.hasClass('glyphicon-search')){clear.removeClass('glyphicon-search').addClass('glyphicon-remove');}
$('#users-list .card').each(function(i,el){var texts='';$(el).children('.user-q').each(function(i,el){texts+=$(el).text();});if(texts.toLowerCase().indexOf(q)!=-1){$(el).show();}else{$(el).hide();}});}else{if(!clear.hasClass('glyphicon-search')){clear.removeClass('glyphicon-remove').addClass('glyphicon-search');}
$('#users-list .card').show();}});$('#search-users-clear').click(function(e){$('#search-users').val('').keypress();});}
function copyToClipboard(text){var $temp=$("<input>");$("body").append($temp);$temp.val(text).select();document.execCommand("copy");$temp.remove();}
function adjustCustomerSidebarHeight(){var sidebar_h=$('#conv-layout-customer')[0].scrollHeight;if(sidebar_h>$('#conv-layout').height()){$('#conv-layout').css('min-height',(sidebar_h+20)+'px');}}
function closeAllModals(){$('.modal').modal('hide');}
function replaceAll(text,search,replacement){return text.split(search).join(replacement);}
function initLogsTable(){$(document).ready(function(){$('.table-container tr').on('click',function(){$('#'+$(this).data('display')).toggle();});$('#table-log').DataTable({"order":[$('#table-log').data('orderingIndex'),'desc'],"stateSave":true,"stateSaveCallback":function(settings,data){window.localStorage.setItem("datatable",JSON.stringify(data));},"stateLoadCallback":function(settings){var data=JSON.parse(window.localStorage.getItem("datatable"));if(data)data.start=0;return data;}});$('#delete-log, #clean-log, #delete-all-log').click(function(){return confirm('Are you sure?');});});}
function isChatMode(){return $("body:first").hasClass('chat-mode');}
function reloadPage(){window.location.href='';}
(function(){var module_routes=[{"uri":"api-webhooks\/ajax","name":"apiwebhooks.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initApiWebhooksSettings(msg_confirm_delete,msg_mailboxes_hint){$(document).ready(function(){$(".apiwh-delete").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'apiwh-delete-ok',{on_show:function(modal){var webhook_id=button.attr('data-webhook_id');if(!webhook_id){return;}
modal.children().find('.apiwh-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',webhook_id:webhook_id},laroute.route('apiwebhooks.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxResult(response);button.button('reset');}});});}},Lang.get("messages.delete"));e.preventDefault();});$(".apiwh-input-events").select2();$(".apiwh-input-mailboxes").select2({placeholder:msg_mailboxes_hint});});}!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});function chatInitSettings(){$(document).ready(function(){$('#chat-show-preview').click(function(e){FreeScoutW=JSON.parse($('#chat-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="freescout-w";a.src=$('#chat-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#chat-widget-form input:visible,#chat-widget-form select:visible').on('change keyup',function(e){$('#chat-widget-code-wrapper').addClass('hidden');$('#chat-widget-save-wrapper').removeClass('hidden');});$(".chat-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#chat-widget-code-wrapper').addClass('hidden');$('#chat-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");});}
(function(){var module_routes=[{"uri":"checklists\/ajax","name":"checklists.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function clInit(){$(document).ready(function(){clApplyListeners();$('#cl-add-toggler').click(function(e){$('#cl-add-group').removeClass('hidden');$(this).hide();$('#cl-add-text').focus();});$('#cl-add-form').submit(function(e){var button=$('#cl-add-trigger');var input=$('#cl-add-text');button.button('loading');fsAjax({action:'add',conversation_id:getGlobalAttr('conversation_id'),text:input.val()},laroute.route('checklists.ajax'),function(response){clRefreshItems(response.html);$('#cl-add-toggler').show();$('#cl-add-group').addClass('hidden');button.button('reset');input.val('');},true);return false;});});}
function clApplyListeners(){$('.cl-item input[type="checkbox"]').change(function(){var checkbox=$(this);var item_container=$(this).parents('.cl-item:first');fsAjax({action:'change_status',item_id:item_container.attr('data-cl-item-id'),completed:(this.checked?1:0)},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){if(checkbox.is(':checked')){item_container.addClass('cl-item-completed');}else{item_container.removeClass('cl-item-completed');}}else{showAjaxError(response);}},true,function(){checkbox.attr('checked',!checkbox.is(':checked'));showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();},);});$('.cl-conv-unlink').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'unlink_conversation',item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.button('reset');},true);return false;});$('.cl-conv-delete').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'delete',item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.button('reset');},true);return false;});$('.cl-item-text').click(function(e){$(this).parents('.cl-item:first').addClass('cl-item-editing');});$('.cl-edit-cancel').click(function(e){$(this).parents('.cl-item:first').removeClass('cl-item-editing');});$('.cl-edit-save').click(function(e){var button=$(this);button.attr('disabled','disabled');fsAjax({action:'save',text:button.parents('.cl-item:first').children().find('.cl-edit-text:first').val(),item_id:button.parents('.cl-item:first').attr('data-cl-item-id')},laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);}else{showAjaxError(response);}
button.removeAttr('disabled');},true);return false;});}
function clInitLinkConvModal(){$(document).ready(function(){$('#cl-link-conv-number:visible:first').focus();$('.cl-link-conv-form:visible:first').on('submit',function(e){var item_id=$(this).attr('data-item-id');var data=$(this).serialize();data+='&action=link_conversation';data+='&item_id='+item_id;var button=$(this).children().find('.cl-link-conv-submit:first');button.button('loading');fsAjax(data,laroute.route('checklists.ajax'),function(response){if(isAjaxSuccess(response)){clRefreshItems(response.html);$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){var number=event.data.replace('kn.pick_conversation:','');if(number){$('#cl-link-conv-number').val(number);$('.modal:visible:first').animate({scrollTop:0},600,'swing');}}});});}
function clInitPickConv(){$(document).ready(function(){$('.kn-btn-pick').click(function(e){clPickConv($(this).attr('data-conv-number'),$(this)[0]);e.preventDefault();e.stopPropagation();});});}
function clPickConv(number,btn){if(typeof(window.parent)!="undefined"){window.parent.postMessage('kn.pick_conversation:'+number);$('.kn-btn-pick.btn-primary').removeClass('btn-primary').addClass('btn-default');$(btn).addClass('btn-primary');}}
function clRefreshItems(html){$('#cl-conv-checklist').html(html);clApplyListeners();initModals();}
(function(){var module_routes=[{"uri":"customers\/fields\/ajax-search","name":"crm.ajax_search"},{"uri":"crm\/ajax","name":"crm.ajax"},{"uri":"crm\/ajax-admin","name":"crm.ajax_admin"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var sortable=(function(){'use strict';function addData(element,key,value){if(value===undefined){return element&&element.h5s&&element.h5s.data&&element.h5s.data[key];}
else{element.h5s=element.h5s||{};element.h5s.data=element.h5s.data||{};element.h5s.data[key]=value;}}
function removeData(element){if(element.h5s){delete element.h5s.data;}}
var _filter=(function(nodes,selector){if(!(nodes instanceof NodeList||nodes instanceof HTMLCollection||nodes instanceof Array)){throw new Error('You must provide a nodeList/HTMLCollection/Array of elements to be filtered.');}
if(typeof selector!=='string'){return Array.from(nodes);}
return Array.from(nodes).filter(function(item){return item.nodeType===1&&item.matches(selector);});});var stores=new Map();var Store=(function(){function Store(){this._config=new Map();this._placeholder=undefined;this._data=new Map();}
Object.defineProperty(Store.prototype,"config",{get:function(){var config={};this._config.forEach(function(value,key){config[key]=value;});return config;},set:function(config){if(typeof config!=='object'){throw new Error('You must provide a valid configuration object to the config setter.');}
var mergedConfig=Object.assign({},config);this._config=new Map(Object.entries(mergedConfig));},enumerable:true,configurable:true});Store.prototype.setConfig=function(key,value){if(!this._config.has(key)){throw new Error("Trying to set invalid configuration item: "+key);}
this._config.set(key,value);};Store.prototype.getConfig=function(key){if(!this._config.has(key)){throw new Error("Invalid configuration item requested: "+key);}
return this._config.get(key);};Object.defineProperty(Store.prototype,"placeholder",{get:function(){return this._placeholder;},set:function(placeholder){if(!(placeholder instanceof HTMLElement)&&placeholder!==null){throw new Error('A placeholder must be an html element or null.');}
this._placeholder=placeholder;},enumerable:true,configurable:true});Store.prototype.setData=function(key,value){if(typeof key!=='string'){throw new Error("The key must be a string.");}
this._data.set(key,value);};Store.prototype.getData=function(key){if(typeof key!=='string'){throw new Error("The key must be a string.");}
return this._data.get(key);};Store.prototype.deleteData=function(key){if(typeof key!=='string'){throw new Error("The key must be a string.");}
return this._data.delete(key);};return Store;}());var store=(function(sortableElement){if(!(sortableElement instanceof HTMLElement)){throw new Error('Please provide a sortable to the store function.');}
if(!stores.has(sortableElement)){stores.set(sortableElement,new Store());}
return stores.get(sortableElement);});function addEventListener(element,eventName,callback){if(element instanceof Array){for(var i=0;i<element.length;++i){addEventListener(element[i],eventName,callback);}
return;}
element.addEventListener(eventName,callback);store(element).setData("event"+eventName,callback);}
function removeEventListener(element,eventName){if(element instanceof Array){for(var i=0;i<element.length;++i){removeEventListener(element[i],eventName);}
return;}
element.removeEventListener(eventName,store(element).getData("event"+eventName));store(element).deleteData("event"+eventName);}
function addAttribute(element,attribute,value){if(element instanceof Array){for(var i=0;i<element.length;++i){addAttribute(element[i],attribute,value);}
return;}
element.setAttribute(attribute,value);}
function removeAttribute(element,attribute){if(element instanceof Array){for(var i=0;i<element.length;++i){removeAttribute(element[i],attribute);}
return;}
element.removeAttribute(attribute);}
var _offset=(function(element){if(!element.parentElement||element.getClientRects().length===0){throw new Error('target element must be part of the dom');}
var rect=element.getClientRects()[0];return{left:rect.left+window.pageXOffset,right:rect.right+window.pageXOffset,top:rect.top+window.pageYOffset,bottom:rect.bottom+window.pageYOffset};});var _debounce=(function(func,wait){if(wait===void 0){wait=0;}
var timeout;return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}
clearTimeout(timeout);timeout=setTimeout(function(){func.apply(void 0,args);},wait);};});var _index=(function(element,elementList){if(!(element instanceof HTMLElement)||!(elementList instanceof NodeList||elementList instanceof HTMLCollection||elementList instanceof Array)){throw new Error('You must provide an element and a list of elements.');}
return Array.from(elementList).indexOf(element);});var isInDom=(function(element){if(!(element instanceof HTMLElement)){throw new Error('Element is not a node element.');}
return element.parentNode!==null;});var insertNode=function(referenceNode,newElement,position){if(!(referenceNode instanceof HTMLElement)||!(referenceNode.parentElement instanceof HTMLElement)){throw new Error('target and element must be a node');}
referenceNode.parentElement.insertBefore(newElement,(position==='before'?referenceNode:referenceNode.nextElementSibling));};var insertBefore=function(target,element){return insertNode(target,element,'before');};var insertAfter=function(target,element){return insertNode(target,element,'after');};var _serialize=(function(sortableContainer,customItemSerializer,customContainerSerializer){if(customItemSerializer===void 0){customItemSerializer=function(serializedItem,sortableContainer){return serializedItem;};}
if(customContainerSerializer===void 0){customContainerSerializer=function(serializedContainer){return serializedContainer;};}
if(!(sortableContainer instanceof HTMLElement)||!sortableContainer.isSortable===true){throw new Error('You need to provide a sortableContainer to be serialized.');}
if(typeof customItemSerializer!=='function'||typeof customContainerSerializer!=='function'){throw new Error('You need to provide a valid serializer for items and the container.');}
var options=addData(sortableContainer,'opts');var item=options.items;var items=_filter(sortableContainer.children,item);var serializedItems=items.map(function(item){return{parent:sortableContainer,node:item,html:item.outerHTML,index:_index(item,items)};});var container={node:sortableContainer,itemCount:serializedItems.length};return{container:customContainerSerializer(container),items:serializedItems.map(function(item){return customItemSerializer(item,sortableContainer);})};});var _makePlaceholder=(function(sortableElement,placeholder,placeholderClass){var _a;if(placeholderClass===void 0){placeholderClass='sortable-placeholder';}
if(!(sortableElement instanceof HTMLElement)){throw new Error('You must provide a valid element as a sortable.');}
if(!(placeholder instanceof HTMLElement)&&placeholder!==undefined){throw new Error('You must provide a valid element as a placeholder or set ot to undefined.');}
if(placeholder===undefined){if(['UL','OL'].includes(sortableElement.tagName)){placeholder=document.createElement('li');}
else if(['TABLE','TBODY'].includes(sortableElement.tagName)){placeholder=document.createElement('tr');placeholder.innerHTML='<td colspan="100"></td>';}
else{placeholder=document.createElement('div');}}
if(typeof placeholderClass==='string'){(_a=placeholder.classList).add.apply(_a,placeholderClass.split(' '));}
return placeholder;});var _getElementHeight=(function(element){if(!(element instanceof HTMLElement)){throw new Error('You must provide a valid dom element');}
var style=window.getComputedStyle(element);return['height','padding-top','padding-bottom'].map(function(key){var int=parseInt(style.getPropertyValue(key),10);return isNaN(int)?0:int;}).reduce(function(sum,value){return sum+value;});});var _getHandles=(function(items,selector){if(!(items instanceof Array)){throw new Error('You must provide a Array of HTMLElements to be filtered.');}
if(typeof selector!=='string'){return items;}
return items.filter(function(item){return item.querySelector(selector)instanceof HTMLElement||(item.shadowRoot&&item.shadowRoot.querySelector(selector)instanceof HTMLElement);}).map(function(item){return item.querySelector(selector)||(item.shadowRoot&&item.shadowRoot.querySelector(selector));});});var getEventTarget=(function(event){return(event.composedPath&&event.composedPath()[0])||event.target;});var defaultDragImage=function(draggedElement,elementOffset,event){return{element:draggedElement,posX:event.pageX-elementOffset.left,posY:event.pageY-elementOffset.top};};var setDragImage=(function(event,draggedElement,customDragImage){if(!(event instanceof Event)){throw new Error('setDragImage requires a DragEvent as the first argument.');}
if(!(draggedElement instanceof HTMLElement)){throw new Error('setDragImage requires the dragged element as the second argument.');}
if(!customDragImage){customDragImage=defaultDragImage;}
if(event.dataTransfer&&event.dataTransfer.setDragImage){var elementOffset=_offset(draggedElement);var dragImage=customDragImage(draggedElement,elementOffset,event);if(!(dragImage.element instanceof HTMLElement)||typeof dragImage.posX!=='number'||typeof dragImage.posY!=='number'){throw new Error('The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].');}
event.dataTransfer.effectAllowed='copyMove';event.dataTransfer.setData('text/plain',getEventTarget(event).id);event.dataTransfer.setDragImage(dragImage.element,dragImage.posX,dragImage.posY);}});var _listsConnected=(function(destination,origin){if(destination.isSortable===true){var acceptFrom=store(destination).getConfig('acceptFrom');if(acceptFrom!==null&&acceptFrom!==false&&typeof acceptFrom!=='string'){throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');}
if(acceptFrom!==null){return acceptFrom!==false&&acceptFrom.split(',').filter(function(sel){return sel.length>0&&origin.matches(sel);}).length>0;}
if(destination===origin){return true;}
if(store(destination).getConfig('connectWith')!==undefined&&store(destination).getConfig('connectWith')!==null){return store(destination).getConfig('connectWith')===store(origin).getConfig('connectWith');}}
return false;});var defaultConfiguration={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:false,placeholder:null,placeholderClass:'sortable-placeholder',draggingClass:'sortable-dragging',hoverClass:false,debounce:0,throttleTime:100,maxItems:0,itemSerializer:undefined,containerSerializer:undefined,customDragImage:null};function _throttle(fn,threshold){var _this=this;if(threshold===void 0){threshold=250;}
if(typeof fn!=='function'){throw new Error('You must provide a function as the first argument for throttle.');}
if(typeof threshold!=='number'){throw new Error('You must provide a number as the second argument for throttle.');}
var lastEventTimestamp=null;return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}
var now=Date.now();if(lastEventTimestamp===null||now-lastEventTimestamp>=threshold){lastEventTimestamp=now;fn.apply(_this,args);}};}
var enableHoverClass=(function(sortableContainer,enable){if(typeof store(sortableContainer).getConfig('hoverClass')==='string'){var hoverClasses_1=store(sortableContainer).getConfig('hoverClass').split(' ');if(enable===true){addEventListener(sortableContainer,'mousemove',_throttle(function(event){if(event.buttons===0){_filter(sortableContainer.children,store(sortableContainer).getConfig('items')).forEach(function(item){var _a,_b;if(item!==event.target){(_a=item.classList).remove.apply(_a,hoverClasses_1);}
else{(_b=item.classList).add.apply(_b,hoverClasses_1);}});}},store(sortableContainer).getConfig('throttleTime')));addEventListener(sortableContainer,'mouseleave',function(){_filter(sortableContainer.children,store(sortableContainer).getConfig('items')).forEach(function(item){var _a;(_a=item.classList).remove.apply(_a,hoverClasses_1);});});}
else{removeEventListener(sortableContainer,'mousemove');removeEventListener(sortableContainer,'mouseleave');}}});var dragging;var draggingHeight;var originContainer;var originIndex;var originElementIndex;var originItemsBeforeUpdate;var previousContainer;var destinationItemsBeforeUpdate;var _removeItemEvents=function(items){removeEventListener(items,'dragstart');removeEventListener(items,'dragend');removeEventListener(items,'dragover');removeEventListener(items,'dragenter');removeEventListener(items,'drop');removeEventListener(items,'mouseenter');removeEventListener(items,'mouseleave');};var _getDragging=function(draggedItem,sortable){var ditem=draggedItem;if(store(sortable).getConfig('copy')===true){ditem=draggedItem.cloneNode(true);addAttribute(ditem,'aria-copied','true');draggedItem.parentElement.appendChild(ditem);ditem.style.display='none';ditem.oldDisplay=draggedItem.style.display;}
return ditem;};var _removeSortableData=function(sortable){removeData(sortable);removeAttribute(sortable,'aria-dropeffect');};var _removeItemData=function(items){removeAttribute(items,'aria-grabbed');removeAttribute(items,'aria-copied');removeAttribute(items,'draggable');removeAttribute(items,'role');};function findSortable(element,event){if(event.composedPath){return event.composedPath().find(function(el){return el.isSortable;});}
while(element.isSortable!==true){element=element.parentElement;}
return element;}
function findDragElement(sortableElement,element){var options=addData(sortableElement,'opts');var items=_filter(sortableElement.children,options.items);var itemlist=items.filter(function(ele){return ele.contains(element)||(ele.shadowRoot&&ele.shadowRoot.contains(element));});return itemlist.length>0?itemlist[0]:element;}
var _destroySortable=function(sortableElement){var opts=addData(sortableElement,'opts')||{};var items=_filter(sortableElement.children,opts.items);var handles=_getHandles(items,opts.handle);removeEventListener(sortableElement,'dragover');removeEventListener(sortableElement,'dragenter');removeEventListener(sortableElement,'drop');_removeSortableData(sortableElement);removeEventListener(handles,'mousedown');_removeItemEvents(items);_removeItemData(items);};var _enableSortable=function(sortableElement){var opts=addData(sortableElement,'opts');var items=_filter(sortableElement.children,opts.items);var handles=_getHandles(items,opts.handle);addAttribute(sortableElement,'aria-dropeffect','move');addData(sortableElement,'_disabled','false');addAttribute(handles,'draggable','true');if(opts.disableIEFix===false){var spanEl=(document||window.document).createElement('span');if(typeof spanEl.dragDrop==='function'){addEventListener(handles,'mousedown',function(){if(items.indexOf(this)!==-1){this.dragDrop();}
else{var parent=this.parentElement;while(items.indexOf(parent)===-1){parent=parent.parentElement;}
parent.dragDrop();}});}}};var _disableSortable=function(sortableElement){var opts=addData(sortableElement,'opts');var items=_filter(sortableElement.children,opts.items);var handles=_getHandles(items,opts.handle);addAttribute(sortableElement,'aria-dropeffect','none');addData(sortableElement,'_disabled','true');addAttribute(handles,'draggable','false');removeEventListener(handles,'mousedown');};var _reloadSortable=function(sortableElement){var opts=addData(sortableElement,'opts');var items=_filter(sortableElement.children,opts.items);var handles=_getHandles(items,opts.handle);addData(sortableElement,'_disabled','false');_removeItemEvents(items);removeEventListener(handles,'mousedown');removeEventListener(sortableElement,'dragover');removeEventListener(sortableElement,'dragenter');removeEventListener(sortableElement,'drop');};function sortable(sortableElements,options){var method=String(options);options=options||{};if(typeof sortableElements==='string'){sortableElements=document.querySelectorAll(sortableElements);}
if(sortableElements instanceof HTMLElement){sortableElements=[sortableElements];}
sortableElements=Array.prototype.slice.call(sortableElements);if(/serialize/.test(method)){return sortableElements.map(function(sortableContainer){var opts=addData(sortableContainer,'opts');return _serialize(sortableContainer,opts.itemSerializer,opts.containerSerializer);});}
sortableElements.forEach(function(sortableElement){if(/enable|disable|destroy/.test(method)){return sortable[method](sortableElement);}
['connectWith','disableIEFix'].forEach(function(configKey){if(options.hasOwnProperty(configKey)&&options[configKey]!==null){console.warn("HTML5Sortable: You are using the deprecated configuration \""+configKey+"\". This will be removed in an upcoming version, make sure to migrate to the new options when updating.");}});options=Object.assign({},defaultConfiguration,store(sortableElement).config,options);store(sortableElement).config=options;addData(sortableElement,'opts',options);sortableElement.isSortable=true;_reloadSortable(sortableElement);var listItems=_filter(sortableElement.children,options.items);var customPlaceholder;if(options.placeholder!==null&&options.placeholder!==undefined){var tempContainer=document.createElement(sortableElement.tagName);if(options.placeholder instanceof HTMLElement){tempContainer.appendChild(options.placeholder);}
else{tempContainer.innerHTML=options.placeholder;}
customPlaceholder=tempContainer.children[0];}
store(sortableElement).placeholder=_makePlaceholder(sortableElement,customPlaceholder,options.placeholderClass);addData(sortableElement,'items',options.items);if(options.acceptFrom){addData(sortableElement,'acceptFrom',options.acceptFrom);}
else if(options.connectWith){addData(sortableElement,'connectWith',options.connectWith);}
_enableSortable(sortableElement);addAttribute(listItems,'role','option');addAttribute(listItems,'aria-grabbed','false');enableHoverClass(sortableElement,true);addEventListener(sortableElement,'dragstart',function(e){var target=getEventTarget(e);if(target.isSortable===true){return;}
e.stopImmediatePropagation();if((options.handle&&!target.matches(options.handle))||target.getAttribute('draggable')==='false'){return;}
var sortableContainer=findSortable(target,e);var dragItem=findDragElement(sortableContainer,target);originItemsBeforeUpdate=_filter(sortableContainer.children,options.items);originIndex=originItemsBeforeUpdate.indexOf(dragItem);originElementIndex=_index(dragItem,sortableContainer.children);originContainer=sortableContainer;setDragImage(e,dragItem,options.customDragImage);draggingHeight=_getElementHeight(dragItem);dragItem.classList.add(options.draggingClass);dragging=_getDragging(dragItem,sortableContainer);addAttribute(dragging,'aria-grabbed','true');sortableContainer.dispatchEvent(new CustomEvent('sortstart',{detail:{origin:{elementIndex:originElementIndex,index:originIndex,container:originContainer},item:dragging,originalTarget:target}}));});addEventListener(sortableElement,'dragenter',function(e){var target=getEventTarget(e);var sortableContainer=findSortable(target,e);if(sortableContainer&&sortableContainer!==previousContainer){destinationItemsBeforeUpdate=_filter(sortableContainer.children,addData(sortableContainer,'items')).filter(function(item){return item!==store(sortableElement).placeholder;});sortableContainer.dispatchEvent(new CustomEvent('sortenter',{detail:{origin:{elementIndex:originElementIndex,index:originIndex,container:originContainer},destination:{container:sortableContainer,itemsBeforeUpdate:destinationItemsBeforeUpdate},item:dragging,originalTarget:target}}));}
previousContainer=sortableContainer;});addEventListener(sortableElement,'dragend',function(e){if(!dragging){return;}
dragging.classList.remove(options.draggingClass);addAttribute(dragging,'aria-grabbed','false');if(dragging.getAttribute('aria-copied')==='true'&&addData(dragging,'dropped')!=='true'){dragging.remove();}
dragging.style.display=dragging.oldDisplay;delete dragging.oldDisplay;var visiblePlaceholder=Array.from(stores.values()).map(function(data){return data.placeholder;}).filter(function(placeholder){return placeholder instanceof HTMLElement;}).filter(isInDom)[0];if(visiblePlaceholder){visiblePlaceholder.remove();}
sortableElement.dispatchEvent(new CustomEvent('sortstop',{detail:{origin:{elementIndex:originElementIndex,index:originIndex,container:originContainer},item:dragging}}));previousContainer=null;dragging=null;draggingHeight=null;});addEventListener(sortableElement,'drop',function(e){if(!_listsConnected(sortableElement,dragging.parentElement)){return;}
e.preventDefault();e.stopPropagation();addData(dragging,'dropped','true');var visiblePlaceholder=Array.from(stores.values()).map(function(data){return data.placeholder;}).filter(function(placeholder){return placeholder instanceof HTMLElement;}).filter(isInDom)[0];insertAfter(visiblePlaceholder,dragging);visiblePlaceholder.remove();sortableElement.dispatchEvent(new CustomEvent('sortstop',{detail:{origin:{elementIndex:originElementIndex,index:originIndex,container:originContainer},item:dragging}}));var placeholder=store(sortableElement).placeholder;var originItems=_filter(originContainer.children,options.items).filter(function(item){return item!==placeholder;});var destinationContainer=this.isSortable===true?this:this.parentElement;var destinationItems=_filter(destinationContainer.children,addData(destinationContainer,'items')).filter(function(item){return item!==placeholder;});var destinationElementIndex=_index(dragging,Array.from(dragging.parentElement.children).filter(function(item){return item!==placeholder;}));var destinationIndex=_index(dragging,destinationItems);if(originElementIndex!==destinationElementIndex||originContainer!==destinationContainer){sortableElement.dispatchEvent(new CustomEvent('sortupdate',{detail:{origin:{elementIndex:originElementIndex,index:originIndex,container:originContainer,itemsBeforeUpdate:originItemsBeforeUpdate,items:originItems},destination:{index:destinationIndex,elementIndex:destinationElementIndex,container:destinationContainer,itemsBeforeUpdate:destinationItemsBeforeUpdate,items:destinationItems},item:dragging}}));}});var debouncedDragOverEnter=_debounce(function(sortableElement,element,pageY){if(!dragging){return;}
if(options.forcePlaceholderSize){store(sortableElement).placeholder.style.height=draggingHeight+'px';}
if(Array.from(sortableElement.children).indexOf(element)>-1){var thisHeight=_getElementHeight(element);var placeholderIndex=_index(store(sortableElement).placeholder,element.parentElement.children);var thisIndex=_index(element,element.parentElement.children);if(thisHeight>draggingHeight){var deadZone=thisHeight-draggingHeight;var offsetTop=_offset(element).top;if(placeholderIndex<thisIndex&&pageY<offsetTop){return;}
if(placeholderIndex>thisIndex&&pageY>offsetTop+thisHeight-deadZone){return;}}
if(dragging.oldDisplay===undefined){dragging.oldDisplay=dragging.style.display;}
if(dragging.style.display!=='none'){dragging.style.display='none';}
var placeAfter=false;try{var elementMiddle=_offset(element).top+element.offsetHeight / 2;placeAfter=pageY>=elementMiddle;}
catch(e){placeAfter=placeholderIndex<thisIndex;}
if(placeAfter){insertAfter(element,store(sortableElement).placeholder);}
else{insertBefore(element,store(sortableElement).placeholder);}
Array.from(stores.values()).filter(function(data){return data.placeholder!==undefined;}).forEach(function(data){if(data.placeholder!==store(sortableElement).placeholder){data.placeholder.remove();}});}
else{var placeholders=Array.from(stores.values()).filter(function(data){return data.placeholder!==undefined;}).map(function(data){return data.placeholder;});if(placeholders.indexOf(element)===-1&&sortableElement===element&&!_filter(element.children,options.items).length){placeholders.forEach(function(element){return element.remove();});element.appendChild(store(sortableElement).placeholder);}}},options.debounce);var onDragOverEnter=function(e){var element=e.target;var sortableElement=element.isSortable===true?element:findSortable(element,e);element=findDragElement(sortableElement,element);if(!dragging||!_listsConnected(sortableElement,dragging.parentElement)||addData(sortableElement,'_disabled')==='true'){return;}
var options=addData(sortableElement,'opts');if(parseInt(options.maxItems)&&_filter(sortableElement.children,addData(sortableElement,'items')).length>=parseInt(options.maxItems)&&dragging.parentElement!==sortableElement){return;}
e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect=store(sortableElement).getConfig('copy')===true?'copy':'move';debouncedDragOverEnter(sortableElement,element,e.pageY);};addEventListener(listItems.concat(sortableElement),'dragover',onDragOverEnter);addEventListener(listItems.concat(sortableElement),'dragenter',onDragOverEnter);});return sortableElements;}
sortable.destroy=function(sortableElement){_destroySortable(sortableElement);};sortable.enable=function(sortableElement){_enableSortable(sortableElement);};sortable.disable=function(sortableElement){_disableSortable(sortableElement);};sortable.__testing={_data:addData,_removeItemEvents:_removeItemEvents,_removeItemData:_removeItemData,_removeSortableData:_removeSortableData};return sortable;}());function initCrm(){$(document).ready(function(){window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){if(event.data=='crm.refresh'){loadCustomers();}
if(event.data=='crm.close'){$('.modal').modal('hide');}}});});}
function crmTriggerRefresh(){if(typeof(window.parent)!="undefined"){window.parent.postMessage('crm.refresh');}}
function crmInitCustomerFieldsAdmin(){$(document).ready(function(){crmInitCustomerFieldsForm('.crm-customer-field-form','customer_field_update');$(".crm-customer-field-delete").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.crm_confirm_delete_customer_field"),'crm-delete-ok',{on_show:function(modal){var customer_field_id=button.attr('data-customer_field_id');modal.children().find('.crm-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'customer_field_delete',customer_field_id:customer_field_id},laroute.route('crm.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#crm-customer-field-'+customer_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#cmr-customer-fields-index').length){sortable('#cmr-customer-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var customer_fields=[];$('#cmr-customer-fields-index > .panel').each(function(idx,el){customer_fields.push($(this).attr('data-customer-field-id'));});fsAjax({action:'customer_field_update_sort_order',customer_fields:customer_fields,},laroute.route('crm.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function crmInitNewCustomerField(jmodal){$(document).ready(function(){crmInitCustomerFieldsForm('.crm-new-customer-field-form','customer_field_create');});}
function crmInitCustomerFieldsForm(selector,action){$(selector).on('submit',function(e){var customer_field_id=$(this).attr('data-customer_field_id');var data=$(this).serialize();data+='&action='+action;if(customer_field_id){data+='&customer_field_id='+customer_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('crm.ajax_admin'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html='';if(response.display){html+='<small class="glyphicon glyphicon-eye-open"></small>';}else{html+='<small class="glyphicon glyphicon-eye-close "></small>';}
html+=' '+htmlEscape(response.name)+' <small>(ID: '+customer_field_id+')</small>';if(response.required){html+=' <i class="required-asterisk"></i>';}
$('#crm-customer-field-'+customer_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});crmApplyOptionsListeners(selector);}
function crmApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.crm_confirm_delete_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function crmInitCustomerFields(){$(document).ready(function(){$('.crm-cf-type-date').flatpickr({allowInput:true});crmCfInitAutosuggest();crmCfInitMultiselect();});}
function crmCfInitAutosuggest(){$('.crm-cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('crm.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function crmCfInitMultiselect(){$('.crm-cf-multiselect:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.attr('placeholder');}
var options={ajax:{url:laroute.route('crm.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},placeholder:placeholder,tags:true,multiple:true,tokenSeparators:[",",", "],minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function crmInitDeleteCustomer(){var customer_id=getGlobalAttr('customer_id');var button=$('.crm-delete-customer-ok:visible');button.click(function(){button.button('loading');var data={action:'delete_customer',customer_id:customer_id};fsAjax(data,laroute.route('crm.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);window.parent.postMessage('crm.refresh');setTimeout(function(){window.parent.postMessage('crm.close');},300);}}else{showAjaxError(response);button.button('reset');}},true);});}
function crmInitDeleteWithoutConv(){var button=$('.crm-delete-customers-ok:visible');button.click(function(){button.button('loading');var data={action:'delete_without_conv'};fsAjax(data,laroute.route('crm.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){showFloatingAlert('success',response.msg_success);window.location.href="";}else{button.button('reset');}}else{showAjaxError(response);button.button('reset');}},true);});}
function crmImportModal(){$(document).ready(function(){$('.crm-import-back:first').click(function(e){$('.crm-import-step1').removeClass('hidden');$('.crm-import-step2').addClass('hidden');var button=$('.crm-import-form button:visible:first');button.addClass('hidden');button.prev().removeClass('hidden');e.preventDefault();});$('.crm-import-form:visible:first').on('submit',function(e){var file_input=$('.crm-import-file:first');ajaxSetup();var data=new FormData();data.append('file',file_input[0].files[0]);data.append("separator",$('.crm-import-form:visible:first :input[name="separator"]').val());data.append("enclosure",$('.crm-import-form:visible:first :input[name="enclosure"]').val());data.append("encoding",$('.crm-import-form:visible:first :input[name="encoding"]').val());data.append("skip_header",$('.crm-import-form:visible:first :input[name="skip_header"]:checked').length);var button=$(this).children().find('button:visible');button.button('loading');if($('.crm-import-step1:visible').length){data.append("action",'import_parse');$.ajax({url:laroute.route('crm.ajax_admin'),data:data,cache:false,contentType:false,processData:false,type:'POST',success:function(response){button.button('reset');if(isAjaxSuccess(response)){$('.crm-import-step1').addClass('hidden');$('.crm-import-step2').removeClass('hidden');button.addClass('hidden');button.next().removeClass('hidden');var options_html='<option value=""></option>';for(var i in response.cols){options_html+='<option value="'+i+'">'+response.cols[i]+'</option>';}
$('.crm-import-mapping').html(options_html);$('.crm-import-mapping').each(function(i,el){$(this).children('option:eq('+(i+1)+')').attr('selected','selected');});}else{showAjaxError(response);}},error:function(jqXHR,textStatus,errorThrown){showFloatingAlert('error',Lang.get("messages.error_occured"));button.button('reset');}});}else{data.append("action",'import_import');var mapping={};$('.crm-import-mapping').each(function(i,el){mapping[$(this).attr('data-field-name')]=$(this).val();});data.append("mapping",JSON.stringify(mapping));$.ajax({url:laroute.route('crm.ajax_admin'),data:data,cache:false,contentType:false,processData:false,type:'POST',success:function(response){button.button('reset');if(isAjaxSuccess(response)){$('.crm-import-result').html(response.result_html).removeClass('hidden');$('.crm-import-notice').addClass('hidden');$('.crm-import-step2').addClass('hidden');button.addClass('hidden');}else{showAjaxError(response);}},error:function(jqXHR,textStatus,errorThrown){showFloatingAlert('error',Lang.get("messages.error_occured"));button.button('reset');}});}
e.preventDefault();return false;});});}
function crmInitVars(customer_vars){fsAddFilter('editor.vars',function(vars){vars.customer={...vars.customer,...customer_vars};return vars;});}
(function(){var module_routes=[{"uri":"mailbox\/custom-fields\/ajax-html\/{action}","name":"mailboxes.custom_fields.ajax_html"},{"uri":"custom-fields\/ajax-admin","name":"mailboxes.custom_fields.ajax_admin"},{"uri":"custom-fields\/ajax","name":"mailboxes.custom_fields.ajax"},{"uri":"custom-fields\/ajax-search","name":"mailboxes.customfields.ajax_search"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var cf_save_period=5;var cf_save_fields=[];function initCustomFieldsAdmin(){$(document).ready(function(){initCustomFieldsForm('.custom-field-form','update');$(".cf-delete-trigger").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.confirm_delete_custom_field"),'cf-delete-ok',{on_show:function(modal){var custom_field_id=button.attr('data-custom_field_id');modal.children().find('.cf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',custom_field_id:custom_field_id},laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#custom-field-'+custom_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#custom-fields-index').length){sortable('#custom-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var custom_fields=[];$('#custom-fields-index > .panel').each(function(idx,el){custom_fields.push($(this).attr('data-custom-field-id'));});fsAjax({action:'update_sort_order',custom_fields:custom_fields,},laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function initNewCustomField(jmodal){$(document).ready(function(){initCustomFieldsForm('.new-custom-field-form','create');});}
function initCustomFieldsForm(selector,action){$(selector).on('submit',function(e){var custom_field_id=$(this).attr('data-custom_field_id');var data=$(this).serialize();data+='&mailbox_id='+getGlobalAttr('mailbox_id');data+='&action='+action;if(custom_field_id){data+='&custom_field_id='+custom_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('mailboxes.custom_fields.ajax_admin'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html=htmlEscape(response.name);if(response.required){html+='<i class="required-asterisk"></i>';}
$('#custom-field-'+custom_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});cfApplyOptionsListeners(selector);}
function cfApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.confirm_delete_cf_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function initCustomFields(){$(document).ready(function(){if(!$('#custom-fields-form').length){return;}
$('#custom-fields-form .cf-type-date').flatpickr({allowInput:true});$('#custom-fields-form').on('submit',function(e){e.preventDefault();});$('#custom-fields-form .custom-field :input').on('keyup keypress change',function(e){$(this).attr('data-dirty',1);cf_save_fields[$(this).attr('name')]=1;});$('#custom-fields-form .custom-field :input').on('focusout',function(e){if(!$(this).attr('data-dirty')){return;}
cf_save_fields[$(this).attr('name')]=1;saveCustomFields();});$('#custom-fields-form select').on('change',function(e){if($(this).attr('required')){return;}
if($(this).val()){$(this).removeClass('placeholdered');}else{$(this).addClass('placeholdered');}});setInterval(saveCustomFields,cf_save_period*1000);fsAddFilter('conversation.can_submit',function(value){return cfFilter(value);});fsAddFilter('conversation.can_change_user',function(value){return cfFilter(value);});fsAddFilter('conversation.can_change_status',function(value){return cfFilter(value);});cfInitAutosuggest();cfInitMultiselect();if(isNewConversation()){$('#custom-fields-form .cf-show-fields').click(function(e){$('#custom-fields-form .form-group.hidden').removeClass('hidden');cfInitAutosuggest();cfInitMultiselect();$(this).remove();e.preventDefault();});if(!getGlobalAttr('conversation_id')){fs_reply_changed=true;saveDraft(false);}
$('#custom-fields-form').addClass('cf-mode-create');}});}
function cfInitAutosuggest(){$('#custom-fields-form .cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('mailboxes.customfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);input.on('select2:selecting',function(e){cfSaveField(input);});});}
function cfInitMultiselect(){$('.cf-multiselect:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.attr('placeholder');}
var options={ajax:{url:laroute.route('mailboxes.customfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,custom_field_id:input.attr('name'),page:params.page};}},placeholder:placeholder,tags:true,multiple:true,tokenSeparators:[",",", "],minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);input.on('select2:selecting',function(e){cfSaveField(input);});});}
function cfSaveField(input){input.attr('data-dirty',1);cf_save_fields[input.attr('name')]=1;saveCustomFields();}
function cfFilter(value){if(!value){return value;}
var form=$('form#custom-fields-form');if(!form.length){return value;}
if(!form[0].checkValidity()){$('#custom-fields-form :submit:first').click();return false;}
return value;}
function saveCustomFields(){if(Object.keys(cf_save_fields).length===0){return;}
var fields=cf_save_fields;cf_save_fields=[];var data={fields:{},action:'save_fields',conversation_id:getGlobalAttr('conversation_id')};for(name in fields){if(name.indexOf('[]')!=-1){$('#custom-fields-form :input[name="'+name.replace('[]','\[\]')+'"]').each(function(i,el){var input=$(this);if(typeof(data['fields'][name])=='undefined'){data['fields'][name]='';}
if(typeof(input.val())=="string"){data['fields'][name]=input.val();}else{data['fields'][name]=input.val().join(',');}
input.removeAttr('data-dirty');});}else{var input=$('#custom-fields-form :input[name="'+name+'"]');data['fields'][name]=input.val();input.removeAttr('data-dirty');}}
fsAjax(data,laroute.route('mailboxes.custom_fields.ajax'),function(response){var html='';if(typeof(response.status)!="undefined"&&response.status=='success'){html='<span class="cf-result text-success"><i class="glyphicon glyphicon-ok"></i> '+Lang.get("messages.saved")+'</span>';for(name in fields){name=name.replace('[]','');el=$('#custom-field-'+name+' div:first .cf-result:first');if(el.length){el.show();}else{$('#custom-field-'+name+' div:first').append(html);el=$('#custom-field-'+name+' div:first .cf-result:first');}
el.fadeOut(3000);}}else{for(name in fields){cf_save_fields[name]=1;}}},true);}
function cfInitVars(cf_vars){fsAddFilter('editor.vars',function(vars){vars.conversation={...vars.conversation,...cf_vars};return vars;});}
(function(){var module_routes=[{"uri":"mailbox\/custom-folders\/ajax-html\/{action}","name":"mailboxes.custom_folders.ajax_html"},{"uri":"mailbox\/custom-folders\/ajax","name":"mailboxes.custom_folders.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initCustomFoldersAdmin(msg_confirm_delete){$(document).ready(function(){initCustomFoldersForm('.custom-folders-form','update');$(".folder-delete-trigger").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'folder-delete-ok',{on_show:function(modal){var folder_id=button.attr('data-folder_id');modal.children().find('.folder-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',folder_id:folder_id},laroute.route('mailboxes.custom_folders.ajax'),function(response){showAjaxResult(response);button.button('reset');if(typeof(response.msg_success)!="undefined"){$('#folder-'+folder_id).remove();}});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#custom-folders-index').length){sortable('#custom-folders-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var folders=[];$('#custom-folders-index > .panel').each(function(idx,el){folders.push($(this).attr('data-folder-id'));});fsAjax({action:'update_sort_order',folders:folders,},laroute.route('mailboxes.custom_folders.ajax'),function(response){showAjaxResult(response);});});}});}
function initNewFolder(jmodal){$(document).ready(function(){initCustomFoldersForm('.new-folder-form','create');});}
function initCustomFoldersForm(selector,action){$(selector).on('submit',function(e){var folder_id=$(this).attr('data-folder_id');var data=$(this).serialize();data+='&mailbox_id='+getGlobalAttr('mailbox_id');data+='&action='+action;if(folder_id){data+='&folder_id='+folder_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('mailboxes.custom_folders.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);$('#folder-'+folder_id+' .panel-title a:first span:first').html(response.name);$('#folder-'+folder_id+' .panel-title a:first span.tag').html(response.tag_name);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});var options={ajax:{url:laroute.route('tags.ajax'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,action:'autocomplete'};}},tags:true,allowClear:true,placeholder:' ',minimumInputLength:1,language:{inputTooShort:function(args){return"";}}};if(action=='create'){options.dropdownParent=$('.modal-dialog:visible:first');}
$(selector+' select[name="tag_name"]').select2(options);}
function chInit(){$(document).ready(function(){summernoteInit('#ch_homepage_html',{insertVar:false,disableDragAndDrop:false,height:275,toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['picture','video']],['view',['codeview']]],buttons:{removeformat:EditorRemoveFormatButton,lists:EditorListsButton},callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#ch_homepage_html');}}}});$('#ch-dashboard-path').on('keyup',function(event){var val=$(this).val().replace(/[^a-zA-Z0-9]/,'');$(this).val(val);if(val){$('#ch-options').removeClass('hidden');}else{$('#ch-options').addClass('hidden');}});$('#ch-login-path').on('keyup',function(event){var val=$(this).val().replace(/[^a-zA-Z0-9]/,'');$(this).val(val);});$('#ch-type').on('change',function(event){if($(this).val()=='page'){$('.ch-homepage-page').removeClass('hidden');$('.ch-homepage-redirect').addClass('hidden');$('#ch-homepage-redirect').val('');}else{$('.ch-homepage-redirect').removeClass('hidden');$('.ch-homepage-page').addClass('hidden');}});});}
(function(){var module_routes=[{"uri":"custom-signatures\/ajax","name":"custom_signatures.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function csInitMailboxSettings(){$(document).ready(function(){$('.cs-signature-text:visible').each(function(i,el){var selector='#'+$(el).attr('id');csInitSignatureBlock(selector);});});$("#cs-add-signature").click(function(e){var pattern_html=$('#cs-signature-pattern').html();var new_block=$(pattern_html).insertBefore($('#cs-signature-pattern'));new_block.removeClass('hidden');new_block.children().find('.cs-signature-name:first').attr('required','required');var selector='cs_signature_text_'+generateDummyId();new_block.children().find('.cs-signature-text:first').attr('id',selector);csInitSignatureBlock('#'+selector);});}
function csInitSignatureBlock(selector){summernoteInit(selector,{insertVar:true,disableDragAndDrop:false,callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();$(selector).parent().children().find('.summernote-inservar:first').on('change',function(event){$(selector).summernote('insertText',$(this).val());$(this).val('');});},onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,false,selector);}}}});$(selector).parents('.cs-signature-block:first').children().find('.cs-delete:first').click(function(e){$(this).parents('.cs-signature-block:first').remove();});}
function csInitSignatureSelect(){$(document).ready(function(){$('.cs-signature-select').change(function(e){var select=$(e.target);var signature_id=select.val();if(!signature_id){$('#editor_signature:visible').html($('#editor_signature:visible').parent().children('.cs_signature_default:first').html());return;}
select.attr('disabled','disabled');fsAjax({action:'load_signature',signature_id:signature_id,conversation_id:getGlobalAttr('conversation_id')},laroute.route('custom_signatures.ajax'),function(response){select.removeAttr('disabled');if(isAjaxSuccess(response)){var signature_container=$('#editor_signature:visible');if(!$('.cs_signature_default:first').length){$('<div class="cs_signature_default hidden">'+signature_container.html()+'</div>').insertAfter(signature_container);}
signature_container.html(response.html);}else{showAjaxError(response);}},true,function(){select.removeAttr('disabled');});});});}
function initCustomization(){$(document).ready(function(){$('.cust-img-remove').click(function(e){var wrapper=$(this).parents('.cust-img-wrapper:first');wrapper.children('.cust-img-remove-input:first').val(1);wrapper.children().find('.cust-img-custom').hide();wrapper.children().find('.cust-img-default').removeClass('hidden');$(this).remove();e.preventDefault();});$('#cust-header-input').keyup(function(e){$('#cust-header-color').val('#'+$(this).val());custSetHeaderColor($(this).val());});$('#cust-header-color').change(function(e){var color=$(this).val().replace('#','');$('#cust-header-input').val(color);custSetHeaderColor(color);});$('#cust-header-reset').click(function(e){custHeaderReset($(this).attr('data-default-color'));e.preventDefault();});summernoteInit('#customization_footer',{insertVar:false,disableDragAndDrop:true});});}
function custSetHeaderColor(color){$('.navbar-static-top:first').css({'background-color':'#'+color});$('.navbar-default .navbar-nav > .active > a:first').css({'background-color':'#'+color});}
function custHeaderReset(color){$('#cust-header-color').val('#'+color);$('#cust-header-input').val(color);custSetHeaderColor(color);}
(function(){var module_routes=[{"uri":"edd\/ajax","name":"edd.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var edd_customer_email='';function initEdd(customer_email,load){edd_customer_email=customer_email;$(document).ready(function(){if(load){eddLoadOrders();}
$('.edd-refresh').click(function(e){eddLoadOrders();e.preventDefault();});});}
function eddLoadOrders(){$('#edd-orders').addClass('edd-loading');fsAjax({action:'orders',customer_email:edd_customer_email,mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('edd.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.html)!="undefined"&&response.html){$('#edd-orders').html(response.html);$('#edd-orders').removeClass('edd-loading');$('.edd-refresh').click(function(e){eddLoadOrders();e.preventDefault();});}else{}},true);}!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});function eupInitSettings(){$(document).ready(function(){summernoteInit('#eup-settings-footer',{insertVar:false,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#eup-settings-footer');}}}});summernoteInit('#eup-privacy',{toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['picture']],['view',['codeview']]],insertVar:false,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#eup-privacy');}}}});$('#eup-show-preview').click(function(e){FreeScoutW=JSON.parse($('#eup-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="freescout-w";a.src=$('#eup-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#eup-widget-form input:visible,#eup-widget-form select:visible').on('change keyup',function(e){$('#eup-widget-code-wrapper').addClass('hidden');$('#eup-widget-save-wrapper').removeClass('hidden');});$(".eup-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#eup-widget-code-wrapper').addClass('hidden');$('#eup-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");$('#eup_consent').change(function(e){$('#eup-privacy-container').toggleClass('hidden');});});}
(function(){var module_routes=[{"uri":"export-conversations\/ajax-html\/{action}","name":"exportconversations.ajax_html"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();fsAddAction('reports.before_refresh',function(params){var filters=params.data.filters;var route_params={action:'export'};for(var param_name in filters){var value=filters[param_name];if(param_name=='tag'){value=$('#rpt-filters select[name="tag"] option[value="'+value+'"]').text();}
if(param_name=='from'){param_name='after';}
if(param_name=='to'){param_name='before';}
if(param_name=='custom_field'){for(var custom_field_id in value){if(value[custom_field_id]!==''){custom_field_name=$('#rpt-filters :input[name="custom_field['+custom_field_id+']"]:first').prev().text();route_params['f[%23'+custom_field_name+']']=value[custom_field_id];}}
continue;}
route_params['f['+param_name+']']=value;}
route_params['f[state][]']=2;route_params['f[status][0]']=1;route_params['f[status][1]']=2;route_params['f[status][2]']=3;var url=laroute.route('exportconversations.ajax_html',route_params);$('#rpt-btn-export').attr('data-remote',url);});(function(){var module_routes=[{"uri":"attachments\/ajax","name":"extendedattachments.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var av_i18n;var av_scroll;var av_att;var av_viewable_extensions=['txt','diff','patch','json'];var av_viewable_mime_types=['text/plain','text/x-diff','application/json'];function eaInitDeleteModal(){$(document).ready(function(){$('.ea-confirm-delete:visible:first').click(function(e){var attachment_id=$(this).attr('data-attachment-id');var button=$(this);button.button('loading');fsAjax({action:'delete_attachment',attachment_id:attachment_id},laroute.route('extendedattachments.ajax'),function(response){if(isAjaxSuccess(response)){$('.thread-attachments li[data-attachment-id="'+attachment_id+'"').hide();$('.attachments-list li[data-attachment-id="'+attachment_id+'"').hide();button.parents('.modal:first').modal('hide');}else{showAjaxError(response);}
button.button('reset');},true);return false;});});}
function avInit(i18n){av_i18n=i18n;$(document).ready(function(){$('.attachment-link').click(function(e){var att=$(this);avOpenInViewer($(this));e.preventDefault();});});}
function avOpenInViewer(att){if(!att.length){return;}
av_att=att;var att_url=att.attr('href');var att_name=att.text();var container=$('#av-container');if(!container.length){var html='<div id="av-bg" class="av-close-trigger av-element">';html+='</div>';html+='<div id="av-container" class="av-element av-close-trigger">';html+='<div id="av-header">';html+='<span id="av-name"></span>';html+='<a href="" class="btn btn-primary" id="av-download" download>'+av_i18n.download+' &nbsp;<i class="glyphicon glyphicon-download-alt small"></i></a>';html+='<a href="#" id="av-close" class="pull-right av-close-trigger"></a>';html+='</div>';html+='<div id="av-content">';html+='</div>';html+='<div id="av-prev" class="av-nav">';html+='<i class="glyphicon glyphicon-menu-left"></i>';html+='</div>';html+='<div id="av-next" class="av-nav">';html+='<i class="glyphicon glyphicon-menu-right"></i>';html+='</div>';html+='</div>';$('body:first').prepend(html);$('.av-close-trigger').click(function(e){avCloseViewer();});$('#av-header').click(function(e){e.stopPropagation();});$('#av-next').click(function(e){if(!$(this).hasClass('av-inactive')){var next_li=av_att.parent().next();if(next_li.attr('data-attachment-id')){avOpenInViewer(next_li.children('.attachment-link:first'));}}
e.stopPropagation();});$('#av-prev').click(function(e){if(!$(this).hasClass('av-inactive')){var prev_li=av_att.parent().prev();if(prev_li.attr('data-attachment-id')){avOpenInViewer(prev_li.children('.attachment-link:first'));}}
e.stopPropagation();});}else{$('.av-element').show();}
$('#av-name').text(att_name);$('#av-download').attr('href',att_url);var mime_type=att.parent().attr('data-mime');var mime_category=mime_type.split('/')[0];var ext=att_url.replace(/.*\.([^\.]+)\?.*/,'$1');;var content='<span class="av-content-text">'+av_i18n.unsupported+'<br/><a href="'+att_url+'" download class="av-content-download"><i class="glyphicon glyphicon-download-alt"></i></a></span>';if(mime_type=='application/pdf'){content='<iframe src="'+att_url+'" frameborder="0" id="av-iframe"></iframe>';}else if(av_viewable_extensions.indexOf(ext)!=-1&&av_viewable_mime_types.indexOf(mime_type)!=-1){content='<iframe src="'+att_url+'" frameborder="0" id="av-iframe" class="av-iframe-white"></iframe>';}else if(mime_category=='audio'){content='<audio controls src="'+att_url+'" class="av-content-item">'+av_i18n.unsupported+'</audio>';}else if(mime_category=='video'){content='<video controls class="av-content-item"><source src="'+att_url+'" type="video/mp4">'+av_i18n.unsupported+'</video>';}else if(mime_category=='image'){content='<img src="'+att_url+'" class="av-content-item" />';}
$('#av-content').html(content);av_scroll=$(window).scrollTop();$('html:first').addClass('av-no-scroll');if(!att.parent().next().attr('data-attachment-id')){$('#av-next').addClass('av-inactive');}else{$('#av-next').removeClass('av-inactive');}
if(!att.parent().prev().attr('data-attachment-id')){$('#av-prev').addClass('av-inactive');}else{$('#av-prev').removeClass('av-inactive');}}
function avCloseViewer(){$('.av-element').hide();$('#av-content').html('');$('html:first').removeClass('av-no-scroll');$("html").scrollTop(av_scroll);setTimeout(function(){$("html").scrollTop(av_scroll);},10);setTimeout(function(){$("html").scrollTop(av_scroll);},100);}
function eaReminderInit(phrases,dialog_text,dialog_submit_text){fsAddFilter('conversation.can_submit',function(value,params){if(!value){return value;}
if($('body:first').attr('data-ea-send-anyway')=='1'){return true;}
if($('.attachments-upload .attachment-loaded').length){return value;}
var body=stripTags(getReplyBody());var phrase='';for(var i in phrases){if(body.indexOf(phrases[i])!=-1){phrase=phrases[i]
break;}}
if(!phrase){return value;}
dialog_text=dialog_text.replace(':phrase','<strong>"'+phrase+'"</strong>');showModalConfirm(dialog_text,'ea-send-anyway',{on_show:function(modal){modal.children().find('.ea-send-anyway:first').click(function(e){$('body:first').attr('data-ea-send-anyway','1');$(".btn-reply-submit:visible:first").click();modal.modal('hide');});}},dialog_submit_text);return false;},100);}
fsAddFilter('conversation.editor_toolbar',function(value){if(typeof(value[0][1])!='undefined'){value[0][1].splice(6,0,'style');value[0][1].splice(8,0,'table');value[0][1].splice(4,0,'color');}
return value;});(function(){var module_routes=[{"uri":"kanban\/ajax","name":"kanban.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var KN_STATUS_CLOSED=3;var KN_SORT_CLOSED_NEW='closed_new';var KN_FILTERS_SEPARATOR='|';var kn_redirect_on_card_create=0;function knInit(text_delete){$(document).ready(function(){$('#kn-boards-list').change(function(e){window.location.href=$(this).val();});$(window).on('resize',function(){knResizeBoard();}).resize();knApplyListeners();knShowParams();$('.kn-param li a').click(function(e){var li=$(this).parent();var param=li.parents('.kn-param').attr('data-param');if(param!='filters'){li.parent().children('li').removeClass('active');li.addClass('active');}
knShow();e.preventDefault();});$('#kn-btn-refresh').click(function(e){knShow();e.preventDefault();});$('#kn-delete-board').click(function(e){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+text_delete+'</span>','kn-confirm-delete-board',{on_show:function(modal){modal.children().find('.kn-confirm-delete-board:first').click(function(e){var button=$(this);button.attr('data-loading-text',Lang.get("messages.delete")+'');button.button('loading');fsAjax({action:'delete_board',board_id:getGlobalAttr('board_id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';modal.modal('hide');}else{showAjaxError(response);}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('#kn-copy-link').click(function(e){var url=window.location.origin+window.location.pathname+'?';var params=knGetParams();var kn=[];for(var param_name in params){var value=params[param_name];if(param_name=='filters'){for(var filter_name in value){var filter_values=value[filter_name].join(KN_FILTERS_SEPARATOR);if(!filter_values.length){continue;}
kn.push('kn%5B'+param_name+'%5D%5B'+filter_name+'%5D='+encodeURIComponent(filter_values));}}else{kn.push('kn%5B'+param_name+'%5D='+encodeURIComponent(value));}}
url+=kn.join('&');copyToClipboard(url);e.preventDefault();});$('#kn-reset-filter').click(function(e){window.location.href=$(this).attr('href');e.preventDefault();});});}
function knApplyListeners(){$('.kn-more').off('click').click(function(e){knLoadCards($(this),false);});$('.kn-show-closed').off('click').click(function(e){var button=$(this);if(button.next().length){if(button.next().is(':visible')){button.nextAll().hide();}else{button.nextAll().show();}}else{knLoadCards($(this),true);}});initModals('div');$('.kn-card-footer a').off('click').click(function(e){e.stopPropagation();});var cols=sortable('.kn-sortable',{connectWith:'kn-sortable',items:'.kn-card',forcePlaceholderSize:true});for(var i in cols){cols[i].addEventListener('sortupdate',function(e){var col=$(e.target);var card=$(e.detail.item);fsAjax({action:'move_card',group_by:knGetParams()['group_by'],column_id:col.attr('data-column-id'),swimlane_id:col.attr('data-swimlane-id'),card_id:card.attr('data-card-id'),conversation_id:card.attr('data-conversation-id'),prev_card_id:card.next().attr('data-card-id'),closed:card.prevAll('.kn-show-closed:first').length},laroute.route('kanban.ajax'),function(response){showAjaxResult(response);},true);});}}
function knLoadCards(button,closed){button.button('loading');var col_container=button.parents('.kn-col:first');var params=knGetParams();var offset=col_container.children('.kn-card').length;var more_in_closed=false;if(button.prevAll('.kn-show-closed:first').length){closed=true;more_in_closed=true;}
if(closed){params.sort=KN_SORT_CLOSED_NEW;params.filters.status=[KN_STATUS_CLOSED];if(more_in_closed){offset=button.prevAll('.kn-show-closed:first').nextAll('.kn-card').length;}else{offset=button.nextAll('.kn-card').length;}}
fsAjax({action:'more',column_id:col_container.attr('data-column-id'),swimlane_id:col_container.attr('data-swimlane-id'),offset:offset,kn:params},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)&&response.html){if(button.hasClass('kn-show-closed')){$(response.html).insertAfter(button);}else{$(response.html).insertBefore(button);button.remove();}
knApplyListeners();}else{showAjaxResult(response);}},true);}
function knGetParams(){var params={};$('.kn-param').each(function(i,el){var j_el=$(el);var param=j_el.attr('data-param');if(param=='filters'){}else{params[param]=j_el.children().find('li.active:first').attr('data-param-value');}});params.mailbox_id=getGlobalAttr('mailbox_id');params.board_id=getGlobalAttr('board_id');params.filters={};$('.kn-param[data-param="filters"] li').each(function(i,el){var li=$(el);var param_name=li.attr('data-param-name');var param_value=li.attr('data-param-value');params.filters[param_name]=[];if(param_value){params.filters[param_name]=param_value.split(KN_FILTERS_SEPARATOR);}
if(params.filters[param_name].length==1&&typeof(params.filters[param_name][0])!="undefined"&&params.filters[param_name][0]==''){params.filters[param_name]=[];}});return params;}
function knShowParams(){$('.kn-param-counter').each(function(i,el){var j_el=$(el);var count=j_el.parents('.kn-param:first').children('ul:first').children('li.active').length;if(!count){j_el.text('');}else{j_el.text(' ('+count+')');}});}
function knResizeBoard(){var padding=Math.ceil($('nav.navbar:first').outerHeight()+$('#kn-heading').outerHeight());$('#kn-board').css('height','calc(100vh - '+padding+'px)');}
function knShow(){$('#kn-btn-refresh i:first').addClass('glyphicon-spin');fsAjax({action:'show',kn:knGetParams()},laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)&&response.html){$('#kn-board').html(response.html);knApplyListeners();initModals();initTooltips();}else{showAjaxResult(response);}
loaderHide();$('#kn-btn-refresh i:first').removeClass('glyphicon-spin');},false,function(response){showAjaxResult(response);loaderHide();$('#kn-btn-refresh i:first').removeClass('glyphicon-spin');});}
function knInitBoardModal(){$(document).ready(function(){$('.kn-board-name:visible:first').focus();$('.kn-board-form:visible:first').on('submit',function(e){var board_id=$(this).attr('data-board-id');var data=$(this).serialize();if(board_id){data+='&board_id='+board_id;data+='&action=update_board';}else{data+='&action=new_board';}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(board_id){window.location.href='';}else{window.location.href=response.board_url;}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$('.kn-add-column:visible:first').click(function(e){var columns_container=$('.kn-board-columns:visible:first');var column_id=parseInt(columns_container.attr('data-max-id'))+1;var html=$('.kn-board-column-pattern:first').html();html=replaceAll(html,'-1',column_id);html=replaceAll(html,'required-x','required');columns_container.append(html);columns_container.attr('data-max-id',column_id);knColumnsListeners();e.preventDefault();});knColumnsListeners();$('.kn-add-swimlane:visible:first').click(function(e){var swimlanes_container=$('.kn-board-swimlanes:visible:first');var swimlane_id=parseInt(swimlanes_container.attr('data-max-id'))+1;var html=$('.kn-board-swimlane-pattern:first').html();html=replaceAll(html,'-1',swimlane_id);html=replaceAll(html,'required-x','required');swimlanes_container.append(html);swimlanes_container.attr('data-max-id',swimlane_id);knSwimlanesListeners();e.preventDefault();});knSwimlanesListeners();});}
function knInitCardModal(){$(document).ready(function(){$('.kn-card-form-name:visible:first').focus();$('#link_to_conversation').change(function(e){if(!$(this).is(':checked')){$('.kn-card-linked').addClass('hidden');$('.kn-card-standalone').removeClass('hidden');$('.kn-card-linked :input').removeAttr("required");}else{$('.kn-card-linked').removeClass('hidden');$('.kn-card-standalone').addClass('hidden');$('.kn-card-linked :input').attr("required","required");}});$('#link_to_conversation:visible').change();var editor_buttons=fs_conv_editor_buttons;$.extend(editor_buttons,{removeformat:EditorRemoveFormatButton,lists:EditorListsButton});var editor_toolbar=fs_conv_editor_toolbar;var remove_button=false;for(var i in editor_toolbar[0][1]){if(remove_button){editor_toolbar[0][1].splice(i,1);continue;}
if(editor_toolbar[0][1][i]=='codeview'){remove_button=true;}}
var options={minHeight:120,dialogsInBody:true,dialogsFade:true,disableResizeEditor:true,followingToolbar:false,toolbar:editor_toolbar,buttons:editor_buttons,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],undefined,false,'#kn-card-body');}}}};$('.kn-card-body:visible:first').summernote(options);$('.kn-card-submit:visible:first').click(function(e){kn_redirect_on_card_create=0;});$('.kn-card-submit-redirect:visible:first').click(function(e){kn_redirect_on_card_create=1;});$('.kn-card-form:visible:first').on('submit',function(e){var card_id=$(this).attr('data-card-id');var data=$(this).serialize();if(card_id){data+='&card_id='+card_id;data+='&action=update_card';}else{data+='&action=new_card';}
if(kn_redirect_on_card_create){var button=$(this).children().find('.kn-card-submit-redirect:first');}else{var button=$(this).children().find('.kn-card-submit:first');}
button.button('loading');fsAjax(data,laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(kn_redirect_on_card_create&&response.board_url){window.location.href=response.board_url;}else{if(response.msg_success){showFloatingAlert("success",response.msg_success);}
knShow();}
$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});$('#kn-delete-card').click(function(e){var button=$(this);showModalConfirm(kn_text_delete_card,'kn-confirm-delete-card',{on_show:function(modal){modal.children().find('.kn-confirm-delete-card:first').click(function(e){button.button('loading');modal.modal('hide');var card_id=button.parents('.kn-card-form:first').attr('data-card-id');fsAjax({action:'delete_card',card_id:card_id},laroute.route('kanban.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
$('.modal:visible').modal('hide');knShow();}else{showAjaxError(response);button.button('reset');}},true);});}},Lang.get("messages.delete"));e.preventDefault();});window.addEventListener("message",function(event){if(typeof(event.data)!="undefined"){var number=event.data.split('kn.pick_conversation:');if(typeof(number[1])){$('#kn-card-conv').val(number[1]);$('.modal:visible:first').animate({scrollTop:0},600,'swing');}}});$('#kn-board-input').change(function(e){var board_id=$(this).val();$('.kn-board-inputs').addClass('hidden').attr('disabled','disabled');$('#kn-board-columns-select-'+board_id).removeClass('hidden').removeAttr('disabled');$('#kn-board-swimlane-select-'+board_id).removeClass('hidden').removeAttr('disabled');});$('.modal button.close').click(function(e){knShow();});initTooltips();});}
function knColumnsListeners(){sortable('.kn-board-columns',{handle:'.handle',forcePlaceholderSize:true});$('.kn-delete-column').off('click').click(function(e){if($('.kn-delete-column:visible').length<2){return;}
var button=$(this);button.button('loading');var container=button.parents('.panel:first');fsAjax({action:'delete_column',board_id:$('.kn-board-form:visible:first').attr('data-board-id'),column_id:container.attr('data-column-id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){if(response.confirmation_text){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+response.confirmation_text+'</span>','kn-confirm-delete-column',{on_show:function(modal){modal.children().find('.kn-confirm-delete-column:first').click(function(e){button.parents('.panel:first').remove();modal.modal('hide');});}},Lang.get("messages.delete"));}else{container.remove();}}else{showAjaxError(response);}},true);e.preventDefault();});}
function knSwimlanesListeners(){sortable('.kn-board-swimlanes',{handle:'.handle',forcePlaceholderSize:true});$('.kn-delete-swimlane').off('click').click(function(e){if($('.kn-delete-swimlane:visible').length<2){return;}
var button=$(this);button.button('loading');var container=button.parents('.panel:first');fsAjax({action:'delete_swimlane',board_id:$('.kn-board-form:visible:first').attr('data-board-id'),swimlane_id:container.attr('data-swimlane-id')},laroute.route('kanban.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){if(response.confirmation_text){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+response.confirmation_text+'</span>','kn-confirm-delete-swimlane',{on_show:function(modal){modal.children().find('.kn-confirm-delete-swimlane:first').click(function(e){button.parents('.panel:first').remove();modal.modal('hide');});}},Lang.get("messages.delete"));}else{container.remove();}}else{showAjaxError(response);}},true);e.preventDefault();});}
function knInitFilterModal(){$(document).ready(function(){$('.kn-type-date:visible').flatpickr({allowInput:true});$('.kn-filter-form:visible:first').on('submit',function(e){var fields=$(this).serializeArray();var filter=$(this).children(':input[name="filter"]').val();var selected=[];var cf_data={};for(var i in fields){if(filter=='custom_field'){matches=fields[i].name.match(/selected\[op\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['op']=fields[i].value;}
matches=fields[i].name.match(/selected\[value\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['value']=fields[i].value;}}else{if(fields[i].name=='selected[]'){selected.push(fields[i].value);}}}
if(filter=='custom_field'){for(var cf_id in cf_data){if(cf_data[cf_id].value!=''){selected.push(value=JSON.stringify({id:cf_id,value:cf_data[cf_id].value,op:cf_data[cf_id].op}));}}}
var li=$('.kn-param[data-param="filters"] li[data-param-name="'+filter+'"]');li.attr('data-param-value',selected.join(KN_FILTERS_SEPARATOR));var a=li.children('a:first');if(selected.length){li.addClass('active');a.children('.kn-filter-counter:first').text('('+selected.length+')');}else{li.removeClass('active');a.children('.kn-filter-counter:first').text('');}
var href=a.attr('href');href=href.replace(/&selected.*/,'');for(var i in selected){href+='&selected%5B'+i+'%5D='+encodeURIComponent(selected[i]);}
a.attr('href',href);$('.kn-reset-filter').removeClass('hidden');knShow();knShowParams();$('.modal:visible:first').modal('hide');e.preventDefault();return false;});});}
function knInitPickConv(){$(document).ready(function(){$('.kn-btn-pick').click(function(e){knPickConv($(this).attr('data-conv-number'),$(this)[0]);e.preventDefault();e.stopPropagation();});});}
function knPickConv(number,btn){if(typeof(window.parent)!="undefined"){window.parent.postMessage('kn.pick_conversation:'+number);$('.kn-btn-pick.btn-primary').removeClass('btn-primary').addClass('btn-default');$(btn).addClass('btn-primary');}}
(function(){var module_routes=[{"uri":"knowledge-base\/ajax-admin","name":"mailboxes.knowledgebase.ajax_admin"},{"uri":"knowledge-base\/ajax_html\/{action}","name":"knowledgebase.ajax_html"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();!function(a){"use strict";"object"==typeof exports?module.exports=a(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.colorpicker&&a(window.jQuery)}(function(a){"use strict";var b=function(b,c){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,c&&a.extend(this.colors,c),b&&(void 0!==b.toLowerCase?(b+="",this.setColor(b)):void 0!==b.h&&(this.value=b))};b.prototype={constructor:b,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(a){return"number"==typeof a?a:isNaN(a)||null===a||""===a||void 0===a?1:void 0!==a.toLowerCase?parseFloat(a):1},isTransparent:function(a){return a?(a=a.toLowerCase().trim(),"transparent"===a||a.match(/#?00000000/)||a.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(a){return 0===a.r&&0===a.g&&0===a.b&&0===a.a},setColor:function(a){a=a.toLowerCase().trim(),a&&(this.isTransparent(a)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(a)||{h:0,s:0,b:0,a:1})},stringToHSB:function(b){b=b.toLowerCase();var c;"undefined"!=typeof this.colors[b]&&(b=this.colors[b],c="alias");var d=this,e=!1;return a.each(this.stringParsers,function(a,f){var g=f.re.exec(b),h=g&&f.parse.apply(d,[g]),i=c||f.format||"rgba";return h?(e=i.match(/hsla?/)?d.RGBtoHSB.apply(d,d.HSLtoRGB.apply(d,h)):d.RGBtoHSB.apply(d,h),d.origFormat=i,!1):!0}),e},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setBrightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return this.rgbaIsTransparent(e)?"transparent":"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)},toHSL:function(a,b,c,d){a=a||this.value.h,b=b||this.value.s,c=c||this.value.b,d=d||this.value.a;var e=a,f=(2-b)*c,g=b*c;return g/=f>0&&1>=f?f:2-f,f/=2,g>1&&(g=1),{h:isNaN(e)?0:e,s:isNaN(g)?0:g,l:isNaN(f)?0:f,a:isNaN(d)?0:d}},toAlias:function(a,b,c,d){var e=this.toHex(a,b,c,d);for(var f in this.colors)if(this.colors[f]===e)return f;return!1},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g===a?(b-c)/h:g===b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:this._sanitizeNumber(e),s:f,b:g,a:this._sanitizeNumber(d)}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},HSLtoRGB:function(a,b,c,d){0>b&&(b=0);var e;e=.5>=c?c*(1+b):c+b-c*b;var f=2*c-e,g=a+1/3,h=a,i=a-1/3,j=Math.round(255*this.HueToRGB(f,e,g)),k=Math.round(255*this.HueToRGB(f,e,h)),l=Math.round(255*this.HueToRGB(f,e,i));return[j,k,l,this._sanitizeNumber(d)]},toString:function(a){a=a||"rgba";var b=!1;switch(a){case"rgb":return b=this.toRGB(),this.rgbaIsTransparent(b)?"transparent":"rgb("+b.r+","+b.g+","+b.b+")";case"rgba":return b=this.toRGB(),"rgba("+b.r+","+b.g+","+b.b+","+b.a+")";case"hsl":return b=this.toHSL(),"hsl("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%)";case"hsla":return b=this.toHSL(),"hsla("+Math.round(360*b.h)+","+Math.round(100*b.s)+"%,"+Math.round(100*b.l)+"%,"+b.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return b}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(a){return[a[1],a[2],a[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(a){return[a[1]/360,a[2]/100,a[3]/100,a[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],colorNameToHex:function(a){return"undefined"!=typeof this.colors[a.toLowerCase()]?this.colors[a.toLowerCase()]:!1}};var c={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},d=function(d,e){if(this.element=a(d).addClass("colorpicker-element"),this.options=a.extend(!0,{},c,this.element.data(),e),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new b(this.options.color!==!1?this.options.color:this.getValue(),this.options.colorSelectors),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=a(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.options.colorSelectors){var f=this;a.each(this.options.colorSelectors,function(b,c){var d=a("<i />").css("background-color",c).data("class",b);d.click(function(){f.setValue(a(this).css("background-color"))}),f.picker.find(".colorpicker-selectors").append(d)}),this.picker.find(".colorpicker-selectors").show()}this.picker.on("mousedown.colorpicker touchstart.colorpicker",a.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:a("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":a.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":a.proxy(this.change,this)}),this.component===!1&&this.element.on({"focus.colorpicker":a.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":a.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":a.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":a.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":a.proxy(this.show,this),"focus.colorpicker":a.proxy(this.show,this)}),this.update(),a(a.proxy(function(){this.element.trigger("create")},this))};d.Color=b,d.prototype={constructor:d,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var a=this.container&&this.container[0]!==document.body?"position":"offset",b=this.component||this.element,c=b[a]();"right"===this.options.align&&(c.left-=this.picker.outerWidth()-b.outerWidth()),this.picker.css({top:c.top+b.outerHeight(),left:c.left})},show:function(b){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),a(window).on("resize.colorpicker",a.proxy(this.reposition,this)),!b||this.hasInput()&&"color"!==this.input.attr("type")||b.stopPropagation&&b.preventDefault&&(b.stopPropagation(),b.preventDefault()),this.options.inline===!1&&a(window.document).on({"mousedown.colorpicker":a.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),a(window).off("resize.colorpicker",this.reposition),a(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){return a=a||this.color.toString(this.format),this.element.data("color",a),a},updateInput:function(a){if(a=a||this.color.toString(this.format),this.input!==!1){if(this.options.colorSelectors){var c=new b(a,this.options.colorSelectors),d=c.toAlias();"undefined"!=typeof this.options.colorSelectors[d]&&(a=d)}this.input.prop("value",a)}return a},updatePicker:function(a){void 0!==a&&(this.color=new b(a,this.options.colorSelectors));var c=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,d=this.picker.find("i");return 0!==d.length?(this.options.horizontal===!1?(c=this.options.sliders,d.eq(1).css("top",c.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",c.alpha.maxTop*(1-this.color.value.a))):(c=this.options.slidersHorz,d.eq(1).css("left",c.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",c.alpha.maxLeft*(1-this.color.value.a))),d.eq(0).css({top:c.saturation.maxTop-this.color.value.b*c.saturation.maxTop,left:this.color.value.s*c.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),a):void 0},updateComponent:function(a){if(a=a||this.color.toString(this.format),this.component!==!1){var b=this.component.find("i").eq(0);b.length>0?b.css({backgroundColor:a}):this.component.css({backgroundColor:a})}return a},update:function(a){var b;return(this.getValue(!1)!==!1||a===!0)&&(b=this.updateComponent(),this.updateInput(b),this.updateData(b),this.updatePicker()),b},setValue:function(a){this.color=new b(a,this.options.colorSelectors),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:a})},getValue:function(a){a=void 0===a?"#000000":a;var b;return b=this.hasInput()?this.input.val():this.element.data("color"),(void 0===b||""===b||null===b)&&(b=a),b},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(b){b.pageX||b.pageY||!b.originalEvent||(b.pageX=b.originalEvent.touches[0].pageX,b.pageY=b.originalEvent.touches[0].pageY),b.stopPropagation(),b.preventDefault();var c=a(b.target),d=c.closest("div"),e=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!d.is(".colorpicker")){if(d.is(".colorpicker-saturation"))this.currentSlider=a.extend({},e.saturation);else if(d.is(".colorpicker-hue"))this.currentSlider=a.extend({},e.hue);else{if(!d.is(".colorpicker-alpha"))return!1;this.currentSlider=a.extend({},e.alpha)}var f=d.offset();this.currentSlider.guide=d.find("i")[0].style,this.currentSlider.left=b.pageX-f.left,this.currentSlider.top=b.pageY-f.top,this.mousePointer={left:b.pageX,top:b.pageY},a(document).on({"mousemove.colorpicker":a.proxy(this.mousemove,this),"touchmove.colorpicker":a.proxy(this.mousemove,this),"mouseup.colorpicker":a.proxy(this.mouseup,this),"touchend.colorpicker":a.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(a){a.pageX||a.pageY||!a.originalEvent||(a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY),a.stopPropagation(),a.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((a.pageX||this.mousePointer.left)-this.mousePointer.left))),c=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((a.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=b+"px",this.currentSlider.guide.top=c+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,c/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(b){return b.stopPropagation(),b.preventDefault(),a(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(a){this.keyup(a)},keyup:function(a){38===a.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===a.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new b(this.input.val(),this.options.colorSelectors),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},a.colorpicker=d,a.fn.colorpicker=function(b){var c,e=arguments,f=this.each(function(){var f=a(this),g=f.data("colorpicker"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(c=g[b].apply(g,Array.prototype.slice.call(e,1))):f.data("colorpicker",new d(this,h))});return"getValue"===b?c:f},a.fn.colorpicker.constructor=d});var KbEditorButton=function(context){var ui=$.summernote.ui;var button=ui.buttonGroup([ui.button({className:'fs-trigger-modal',contents:'<i class="glyphicon glyphicon-education"></i>',tooltip:Lang.get("messages.kb_reference_title"),container:'body',data:{trigger:'modal',remote:laroute.route('knowledgebase.ajax_html',{action:'reference'}),'modal-no-footer':'true','modal-title':Lang.get("messages.kb_reference_title"),'modal-on-show':'kbInitReferenceModal'},click:function(e){$('#body').summernote('editor.saveRange');}})]);var obj=button.render();return obj;}
fs_conv_editor_buttons['kb']=KbEditorButton;fs_conv_editor_toolbar[0][1].push('kb');function kbInitCategories(msg_delete){$(document).ready(function(){if($('.kb-category-tree').length){var elements=sortable('.kb-category-tree',{handle:'.handle',});for(var i in elements){elements[i].addEventListener('sortupdate',function(e){var categories=[];$(e.target).children('.panel').each(function(idx,el){categories.push($(this).attr('data-category-id'));});fsAjax({action:'update_categories_sort_order',categories:categories,},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);});});}}
$(".kb-category-delete").click(function(e){var button=$(this);showModalConfirm(msg_delete,'kb-category-delete-ok',{on_show:function(modal){var category_id=button.attr('data-category_id');modal.children().find('.kb-category-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete_category',category_id:category_id},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){window.location.href='';}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function kbInitArticles(){$(document).ready(function(){if($('#kb-articles-list').length&&$("#kb-category-sorting").length){sortable('#kb-articles-list',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var articles=[];$(e.target).children('.panel').each(function(idx,el){articles.push($(this).attr('data-article-id'));});fsAjax({action:'update_articles_sort_order',articles:articles,},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){if(isAjaxSuccess(response)){$('#kb-category-sorting').val(3).attr('data-forced-change','1').change();}
showAjaxResult(response);},true);});}
$("#kb-categories-select").change(function(e){window.location.href=$(e.target).val();});$("#kb-category-sorting").change(function(e){var articles_order=$(e.target).val();var forced_change=$(e.target).attr('data-forced-change');$(e.target).removeAttr('data-forced-change');fsAjax({action:'update_category_articles_order',category_id:$('#kb-categories-select').attr('data-category-id'),articles_order:articles_order},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);if(isAjaxSuccess(response)&&!forced_change){window.location.href='';}});});});}
function kbInitArticle(category_placeholder,msg_delete,redirect_url){$(document).ready(function(){var selector='#kb-article-text';summernoteInit(selector,{insertVar:false,disableDragAndDrop:false,toolbar:[['style',['style','bold','italic','underline','color','lists','paragraph','removeformat','link','table']],['insert',['attachment','picture','video']],['view',['codeview']]],buttons:{attachment:function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-paperclip"></i>',tooltip:Lang.get("messages.upload_attachments"),container:'body',click:function(){var element=document.createElement('div');element.innerHTML='<input type="file" multiple>';var fileInput=element.firstChild;fileInput.addEventListener('change',function(){if(fileInput.files){for(var i=0;i<fileInput.files.length;i++){editorSendFile(fileInput.files[i],true,false,'#kb-article-text');}}});fileInput.click();}});return button.render();},removeformat:EditorRemoveFormatButton,lists:EditorListsButton},callbacks:{onInit:function(){$(selector).parent().children().find('.note-statusbar').remove();},onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'#kb-article-text');}}}});if($('#kb-article-text-primary').length){summernoteInit('#kb-article-text-primary',{insertVar:false,disableDragAndDrop:true,toolbar:[]});$('#kb-article-text-primary').summernote('disable')}
$('#kb-article-categories').select2({multiple:true,tags:true,placeholder:category_placeholder});$("#kb-article-delete").click(function(e){var button=$(this);showModalConfirm(msg_delete,'kb-article-delete-ok',{on_show:function(modal){var article_id=button.attr('data-article_id');modal.children().find('.kb-article-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete_article',article_id:article_id},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){window.location.href=redirect_url;}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function kbInitSettings(){$(document).ready(function(){summernoteInit('#kb-settings-footer',{insertVar:false,disableDragAndDrop:true});$('#kb-show-preview').click(function(e){FreeScoutW=JSON.parse($('#kb-widget-settings').val());var a=document.createElement('script');var m=document.getElementsByTagName('script')[0];a.async=1;a.id="freescout-w";a.src=$('#kb-widget-url').val();m.parentNode.insertBefore(a,m);e.preventDefault();$(this).fadeOut();});$('#kb-locales').select2({multiple:true}).on('select2:select',function(e){var element=e.params.data.element;var $element=$(element);$(this).append($element);$(this).trigger("change");});$('#kb-widget-form input:visible,#kb-widget-form select:visible').on('change keyup',function(e){$('#kb-widget-code-wrapper').addClass('hidden');$('#kb-widget-save-wrapper').removeClass('hidden');});$(".kb-colorpicker").colorpicker({customClass:'colorpicker-2x',sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on('changeColor.colorpicker',function(event){$('#kb-widget-code-wrapper').addClass('hidden');$('#kb-widget-save-wrapper').removeClass('hidden');return true;}).trigger("change");});}
function kbInitReferenceModal(){var text=$('#body').summernote('createRange').toString();$('.kb-ref-text:visible:first').val(text);$(".kb-ref-search-button:visible:first").click(function(e){var button=$(this);var q_input=$('.kb-ref-search-q:visible:first');var container=$('.kb-ref-table-container:visible:first');var empty_container=$('.kb-ref-search-empty:first');var submit_btn=$('.kb-ref-insert:visible:first');button.button('loading');q_input.attr('disabled','disabled');empty_container.addClass('hidden');submit_btn.attr('disabled','disabled');container.html('');fsAjax({action:'reference_search',q:q_input.val()},laroute.route('mailboxes.knowledgebase.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');button.attr('disabled','disabled');q_input.removeAttr('disabled');if(isAjaxSuccess(response)){if(!response.html){empty_container.removeClass('hidden');}else{container.html(response.html);$('.kb-ref-search-item').click(function(e){submit_btn.removeAttr('disabled');});}}},true,function(){showFloatingAlert('error',Lang.get("messages.ajax_error"));loaderHide();button.button('reset');q_input.removeAttr('disabled');});}).click();$(".kb-reference-form:visible:first").submit(function(e){var url=$('.kb-ref-table-container .kb-ref-search-item:checked:first').parents('tr:first').children().find('a:first').attr('href');var html='<a href="'+url+'">'+$('.kb-ref-text:visible:first').val()+'</a>';var body=$('#body');body.summernote('restoreRange');body.summernote('pasteHTML',html);closeAllModals();e.preventDefault();return false;});}
(function(){var module_routes=[{"uri":"oauth-login\/callback\/{provider_id}","name":"oauthlogin.callback"},{"uri":"oauth-login\/logout\/{provider_id}\/{logout_secret}","name":"oauthlogin.logout"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function olInit(){$(document).ready(function(){olRenderProviders(ol_providers);});}
function olApplyListeners(){$('.ol-add-provider').click(function(e){ol_providers.push({id:olGenerateProviderId(),active:1});olRenderProviders(ol_providers);return false;});$('.ol-delete-provider').click(function(e){var index=parseInt($(this).attr('data-ol-provider-index'));if(typeof(ol_providers[index])!="undefined"){var deleted_provider=ol_providers[index];ol_providers.splice(index,1);if(typeof(deleted_provider.default)!="undefined"&&deleted_provider.default){if(typeof(ol_providers[0])!="undefined"){ol_providers[0].default=1;}}
olRenderProviders(ol_providers);}
return false;});$('.ol-provider-field-default').click(function(e){$('.ol-provider-field-default[name!="'+$(this).attr('name')+'"]').prop('checked',false);});$('.ol-provider-field-provider').change(function(e){var provider_code=$(this).val();var provider_block=$(this).parents('.ol-provider:first');provider_block.children().find(':input[data-ol-no-clear!="1"]').val('');for(var field in ol_providers_config[provider_code]){var value=ol_providers_config[provider_code][field];provider_block.children().find('.ol-provider-field-'+field+':first').val(value);}});$('[data-toggle="popover"]').popover({container:'body'});}
function olRenderProviders(providers){if(!Array.isArray(providers)){providers=[];}
if(providers.length==0){providers.push({id:olGenerateProviderId(),active:1,default:1,provider:'oauth'});}
var pattern_html=$('#ol-provider-pattern').html();$('.ol-provider').remove();var index=0;for(var i in providers){var provider=providers[i];var html=replaceAll(pattern_html,'provider_index',index);var provider_block=$('<div class="ol-provider">'+html+'</div>');provider_block.children().find(':input').removeAttr('disabled');for(var field in provider){var input=provider_block.children().find('.ol-provider-field-'+field+':first');if(input.is(':checkbox')||input.is(':radio')){if(provider[field]==1){input.prop('checked',true);}else{input.prop('checked',false);}}else{input.val(provider[field]);}}
if(index!=providers.length-1){provider_block.children().find('.ol-add-provider:first').remove();}
if(providers.length==1){provider_block.children().find('.ol-delete-provider:first').remove();}
provider_block.children().find('.ol-provider-redirect-uri:first').val(laroute.route('oauthlogin.callback',{provider_id:provider.id}));var logout_input=provider_block.children().find('.ol-provider-logout-uri:first');logout_input.val(laroute.route('oauthlogin.logout',{provider_id:provider.id,logout_secret:logout_input.attr('data-ol-logout-secret')}));provider_block.insertBefore('#ol-provider-pattern');index++;}
olApplyListeners();}
function olGenerateProviderId(){return Math.random().toString(36).substr(2,9);}
(function(){var module_routes=[{"uri":"reports\/ajax","name":"reports.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initReports(){$(document).ready(function(){rptRefresh();$('#rpt-filters .input-date').flatpickr({allowInput:true});$('#rpt-btn-loader').click(function(e){rptRefresh();});$('.rpt-filter :input').change(function(e){rptRefresh();});$('.rpt-filter-date').flatpickr();$('.rpt-filter select[name="mailbox"]:first').change(function(e){$('.rpt-cf-mailbox').addClass('hidden');$('.rpt-cf-mailbox-'+$(this).val()).removeClass('hidden');});});}
function rptRefresh(){var data={};var loader=$('#rpt-btn-loader');data.action='report';data.report_name=$('#rpt-report').attr('data-report-name');data.filters={};var filters=$('#rpt-filters').serializeArray();for(var i in filters){var filter=filters[i];var m=filter.name.match(/^custom_field\[(\d+)\]$/);if(m&&typeof(m[1])!="undefined"){if(!$('.rpt-filter :input[name="'+filter.name+'"]').parent().is(":visible")){continue;}
if(typeof(data.filters['custom_field'])=="undefined"){data.filters['custom_field']={};}
data.filters['custom_field'][m[1]]=filter.value;}else{data.filters[filter.name]=filter.value;}}
data.chart={};data.chart.group_by=$('#rpt-group-by button.active').val();data.chart.type=$('#rpt-chart-type').val();fsDoAction('reports.before_refresh',{data:data});loader.attr('disabled','disabled').children('.glyphicon:first').addClass('glyphicon-spin');$('.rpt-filter :input').attr('disabled','disabled');$('#rpt-options :input').attr('disabled','disabled');fsAjax(data,laroute.route('reports.ajax'),function(response){if(isAjaxSuccess(response)&&response.report){$('#rpt-report').html(response.report);var chart_type=$('#rpt-report').attr('data-chart-type');if(chart_type=='pie'){rptShowChartPie(response.chart);}else if(chart_type=='column'){rptShowChartColumn(response.chart);}else{rptShowChart(response.chart);}
initTooltips();$('#rpt-group-by button').click(function(e){if($(this).hasClass('active')){return;}
$('#rpt-group-by button').removeClass('active');$(this).addClass('active');rptRefresh();});$('#rpt-chart-type').change(function(e){rptRefresh();});}else{showAjaxResult(response);}
loader.removeAttr('disabled').children('.glyphicon:first').removeClass('glyphicon-spin');$('.rpt-filter :input').removeAttr('disabled');$('#rpt-options :input').removeAttr('disabled');},true,function(response){showAjaxResult(response);loader.removeAttr('disabled').children('.glyphicon:first').removeClass('glyphicon-spin');$('.rpt-filter :input').removeAttr('disabled');$('#rpt-options :input').removeAttr('disabled');});}
function rptShowChart(data){Highcharts.chart('rpt-chart',{chart:{type:'area'},title:{text:''},legend:{verticalAlign:'top',floating:true},xAxis:{categories:data.categories,},yAxis:{title:{text:' '}},tooltip:{shared:true},plotOptions:{area:{marker:{enabled:false,symbol:'circle',radius:2,states:{hover:{enabled:true}}}}},series:data.series});}
function rptShowChartPie(data){Highcharts.chart('rpt-chart',{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,type:'pie'},title:{text:''},tooltip:{pointFormat:'<b>{point.y}%</b>'},accessibility:{point:{valueSuffix:'%'}},plotOptions:{series:{animation:false},pie:{allowPointSelect:true,cursor:'pointer',dataLabels:{enabled:true,format:'<b>{point.name}</b>: {point.y} %'}}},series:data.series});}
function rptShowChartColumn(data){Highcharts.chart('rpt-chart',{chart:{type:'column'},title:{text:''},tooltip:{pointFormat:'<b>{point.y}</b>'},plotOptions:{column:{pointPadding:0.2,borderWidth:0}},yAxis:{min:0,title:{text:data.y_title}},xAxis:{categories:data.categories,crosshair:true},series:data.series});}
function initSatRatingsSettings(confirm_reset_text){$(document).ready(function(){summernoteInit('#ratings_text',{buttons:{insertvar:function(context){var ui=$.summernote.ui;var contents='<select class="form-control summernote-inservar" tabindex="-1">'+'<option value="">'+Lang.get("messages.insert_var")+' ...</option>'+'<optgroup label="'+Lang.get("messages.mailbox")+'">'+'<option value="{%mailbox.email%}">'+Lang.get("messages.email")+'</option>'+'<option value="{%mailbox.name%}">'+Lang.get("messages.name")+'</option>'+'</optgroup>'+'</select>';var button=ui.button({contents:contents,tooltip:Lang.get("messages.insert_var"),container:'body'});return button.render();}}});$('.reset-trigger').click(function(e){showModalConfirm(confirm_reset_text,'confirm-reset',{on_show:function(modal){modal.children().find('.confirm-reset:first').click(function(e){$('#ratings_placement_1').prop("checked",true);var def_text=$('#default_ratings_text').val();$('#ratings_text').val(def_text);setSummernoteText($('#ratings_text'),def_text);modal.modal('hide');});}});e.preventDefault();});});}
function initSatRatingsTrans(confirm_reset_text){$(document).ready(function(){$('.reset-trigger').click(function(e){showModalConfirm(confirm_reset_text,'confirm-reset',{on_show:function(modal){modal.children().find('.confirm-reset:first').click(function(e){$('#form-trans :input').each(function(i,el){var jel=$(el);if(jel.attr('data-default')){jel.val(jel.attr('data-default'));}});modal.modal('hide');});}});e.preventDefault();});});}
function satrInitConv(){$(document).ready(function(){$('#conv-layout-main .satr-comment').click(function(e){e.preventDefault();});});}
(function(){var module_routes=[{"uri":"mailbox\/saved-replies\/ajax-html\/{action}","name":"mailboxes.saved_replies.ajax_html"},{"uri":"mailbox\/saved-replies\/ajax","name":"mailboxes.saved_replies.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var EditorSavedRepliesButton=function(context){var ui=$.summernote.ui;var button=ui.buttonGroup([ui.button({className:'dropdown-toggle',contents:'<i class="glyphicon glyphicon-comment"></i>',tooltip:Lang.get("messages.saved_replies"),container:'body',data:{toggle:'dropdown'},click:function(e){if(typeof(e.target)=="undefined"){return;}
var trigger=$(e.target);if(trigger.hasClass('glyphicon')){trigger=trigger.parent();}
setTimeout(function(){trigger.next().children().find('.sr-li-search:first .form-control:first').focus();},100);}}),ui.dropdown({className:'dropdown-menu-right dropdown-saved-replies',contents:$('#sr-dropdown-list').html(),click:function(e){if(typeof(e.target)=="undefined"){return;}
var target=$(e.target);if($(e.target).hasClass('caret')){target=target.parent();}
if($(e.target).hasClass('sr-li-search')||$(e.target).parent().hasClass('sr-li-search')){e.stopPropagation();return false;}
var saved_reply_id=target.attr('data-value');if(saved_reply_id){if(target.children('.caret:first').length){target.parent().parent().children('li[data-parent-id="'+saved_reply_id+'"]').toggleClass('hidden');if(target.parent().parent().children('li[data-parent-id="'+saved_reply_id+'"]:first').hasClass('hidden')){target.parent().parent().children('li[data-parents]:visible').each(function(index,el){var parents=$(el).attr('data-parents').split(',');for(var i in parents){if(parents[i]==saved_reply_id){$(el).addClass('hidden');return;}}});}
e.stopPropagation();}else{fsAjax({action:'get',saved_reply_id:saved_reply_id,conversation_id:getGlobalAttr('conversation_id')},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.text)!="undefined"&&response.text){$('#body').summernote('editor.restoreRange');context.invoke('editor.pasteHTML',response.text);$('.form-reply:visible:first :input[name="saved_reply_id"]:first').val(saved_reply_id);if(response.attachments.length){showAttachments(response);}}else{showAjaxError(response);}
loaderHide();});}}else{showModal({'remote':laroute.route('mailboxes.saved_replies.ajax_html',{'action':'create'}),'size':'lg','title':Lang.get("messages.new_saved_reply"),'no_footer':true,'on_show':'showSaveThisReply'});}
e.preventDefault();}})]);var obj=button.render();obj.children().find('.sr-li-search:first input:first').on("keyup",function(){srSearch($(this)[0]);});return obj;}
var SrEditorAttachmentButton=function(context){var ui=$.summernote.ui;var button=ui.button({contents:'<i class="glyphicon glyphicon-paperclip"></i>',tooltip:Lang.get("messages.upload_attachments"),className:'note-btn-attachment',container:'body',click:function(e){var att_container=$(e.target).parents('.form-group:first').next().children().find('.sr-attachments-upload:first');var element=document.createElement('div');element.innerHTML='<input type="file" multiple>';var fileInput=element.firstChild;fileInput.addEventListener('change',function(){if(fileInput.files){for(var i=0;i<fileInput.files.length;i++){editorSendFile(fileInput.files[i],true,true,'',att_container);}}});fileInput.click();}});return button.render();}
fs_conv_editor_buttons['savedreplies']=EditorSavedRepliesButton;fs_conv_editor_toolbar[0][1].push('savedreplies');function initSavedReplies(){$(document).ready(function(){$('.saved-reply-save').click(function(e){var saved_reply_id=$(this).attr('data-saved_reply_id');var name=$('#saved-reply-'+saved_reply_id+' :input[name="name"]').val();var button=$(this);var attachments_all=srMapInputToArray($(this).parents('.panel-body:first').children().find(':input[name="attachments_all[]"]'));var attachments=srMapInputToArray($(this).parents('.panel-body:first').children().find(':input[name="attachments[]"]'));button.button('loading');fsAjax({action:'update',saved_reply_id:saved_reply_id,name:name,attachments_all:attachments_all,attachments:attachments,parent_saved_reply_id:$('#saved-reply-'+saved_reply_id+' :input[name="parent_saved_reply_id"]').val(),text:$('#saved-reply-'+saved_reply_id+' :input[name="text"]').val()},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.msg_success)!="undefined"){showFloatingAlert('success',response.msg_success);$('#saved-reply-'+saved_reply_id+' .panel-title a:first span:first span').text(name);if(typeof(response.refresh)!="undefined"&&response.refresh){window.location.href='';}}else{showAjaxError(response);}
button.button('reset');loaderHide();});});$(".sr-delete-trigger").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.confirm_delete_saved_reply"),'sr-delete-ok',{on_show:function(modal){var saved_reply_id=button.attr('data-saved_reply_id');modal.children().find('.sr-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',saved_reply_id:saved_reply_id},laroute.route('mailboxes.saved_replies.ajax'),function(response){showAjaxResult(response);button.button('reset');if($('#saved-reply-'+saved_reply_id+' .panel-sortable:first').length){window.location.href='';}else{$('#saved-reply-'+saved_reply_id).remove();}});});}},Lang.get("messages.delete"));e.preventDefault();});if($('.saved-replies-tree').length){var elements=sortable('.saved-replies-tree',{handle:'.handle',});for(var i in elements){elements[i].addEventListener('sortupdate',function(e){var saved_replies=[];$(e.target).children('.panel').each(function(idx,el){saved_replies.push($(this).attr('data-saved-reply-id'));});fsAjax({action:'update_sort_order',saved_replies:saved_replies,},laroute.route('mailboxes.saved_replies.ajax'),function(response){showAjaxResult(response);});});}}
$('.panel.panel-sortable').on('show.bs.collapse',function(e){summernoteInit('#'+e.currentTarget.id+' .saved-reply-text',{minHeight:250,insertVar:true,buttons:{insertvar:EditorInsertVarButton,attachment:SrEditorAttachmentButton,removeformat:EditorRemoveFormatButton,lists:EditorListsButton}});})
$('li.attachment-loaded .glyphicon-remove:first').click(function(e){removeAttachment($(this).parents('li.attachment-loaded:first').attr('data-attachment-id'));});});}
function initNewSavedReply(jmodal){$(document).ready(function(){summernoteInit('.modal-dialog .new-saved-reply-editor:visible:first textarea:first',{minHeight:250,insertVar:true,buttons:{insertvar:EditorInsertVarButton,attachment:SrEditorAttachmentButton,removeformat:EditorRemoveFormatButton,lists:EditorListsButton}});$('.modal-content .new-saved-reply-save:first').click(function(e){var button=$(this);button.button('loading');var name=$(this).parents('.modal-content:first').children().find(':input[name="name"]').val();var text=$(this).parents('.modal-content:first').children().find(':input[name="text"]').val();var attachments_all=srMapInputToArray($(this).parents('.modal-content:first').children().find(':input[name="attachments_all[]"]'));var attachments=srMapInputToArray($(this).parents('.modal-content:first').children().find(':input[name="attachments[]"]'));fsAjax({action:'create',mailbox_id:getGlobalAttr('mailbox_id'),from_reply:getGlobalAttr('conversation_id'),name:name,text:text,attachments_all:attachments_all,attachments:attachments,parent_saved_reply_id:$(this).parents('.modal-content:first').children().find(':input[name="parent_saved_reply_id"]').val(),},laroute.route('mailboxes.saved_replies.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.id)!="undefined"&&response.id){if(typeof(response.msg_success)!="undefined"&&response.msg_success){jmodal.modal('hide');showFloatingAlert('success',response.msg_success);loaderHide();var li_html='<li><a href="#" data-value="'+response.id+'">'+htmlEscape(name)+'</a></li>';$('.form-reply:first:visible .dropdown-saved-replies:first').children('li:last').prev().before(li_html);}else{window.location.href='';}}else{showAjaxError(response);loaderHide();button.button('reset');}});});});}
function srMapInputToArray(inputs){return inputs.map(function(){return $(this).val();}).get();}
function showSaveThisReply(jmodal){$('.modal-dialog .new-saved-reply-editor:visible:first textarea[name="text"]:first').val(getReplyBody());initNewSavedReply(jmodal);}
function srSearch(el){var expand_parents=[];var input=$(el);var q=input.val().toLowerCase();var lis=input.parents('.dropdown-saved-replies:first').children('li:gt(0)');var items=lis.find('a[data-value!=""]:not(.sr-cat)');if(q.length<1){lis.filter(':not([data-parents])').removeClass('hidden');lis.filter('[data-parents]').addClass('hidden');}else{$(items).each(function(i,el){var item=$(el);if(item.text().toLowerCase().indexOf(q)!=-1){item.parent().removeClass('hidden');var data_parents=$(el).parent().attr('data-parents');if(data_parents){var parents=data_parents.split(',');expand_parents=expand_parents.concat(parents);}}else{item.parent().addClass('hidden');}});if(expand_parents.length){var values='';for(var i in expand_parents){lis.find('a.sr-cat[data-value="'+expand_parents[i]+'"]').parent().removeClass('hidden');}
$(lis.find('a.sr-cat')).each(function(i,el){var cat=$(el);if(expand_parents.indexOf(cat.attr('data-value'))==-1&&!cat.hasClass('hidden')){cat.parent().addClass('hidden');}});}else{lis.find('a.sr-cat').parent().addClass('hidden');}}}
function scInit(){$(document).ready(function(){$('.sc-reply-submit:first').click(function(e){$('.note-statusbar:visible:first select[name="status"]:first').val(3);$(".btn-reply-submit:first").click();});});}
(function(){var module_routes=[{"uri":"conversation\/snooze\/ajax","name":"snooze.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function snoozeInitModal(jmodal){$(document).ready(function(){var datepicker=$('.snooze-datetime:visible').flatpickr({enableTime:true,minDate:"today",static:true,onChange:function(selectedDates,dateStr,instance){$('.snooze-btn:visible:first').removeAttr('disabled');}});$('.snooze-datetime-trigger:visible').click(function(e){datepicker.toggle();});$('.snooze-btn:visible:first').click(function(e){var snooze_date=$('.snooze-datetime:visible').val();if(!snooze_date){return;}
var button=$(this);button.button('loading');fsAjax({'action':'snooze','conversation_id':getGlobalAttr('conversation_id'),'snooze_date':snooze_date},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){if(convGetStatus()!=FS_STATUS_CLOSED){$('.conv-status:first a[data-status="'+FS_STATUS_CLOSED+'"]').click();}else{reloadPage();}}else{showAjaxError(response);button.button('reset');}
loaderHide();},true);e.preventDefault();});$('.snooze-cancel:visible:first').click(function(e){jmodal.modal('hide');});$('.snooze-apply:visible:first').click(function(e){var button=$(e.target);if(button.hasClass('glyphicon')){button=button.parent();}
button.button('loading');fsAjax({'action':'calc','number':$('.snooze-number:visible:first').val(),'period':$('.snooze-period:visible:first').val()},laroute.route('snooze.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){$('.snooze-datetime:visible').val(response.datetime);$('.snooze-btn:visible:first').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});});}
function snoozeSnooze(thread_id){var button=$('#thread-'+thread_id+' .snooze-send-now:first').button('loading');fsAjax({'action':'send_now','thread_id':thread_id},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{button.button('reset');showAjaxError(response);}
loaderHide();},false,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));ajaxFinish();button.button('reset');});return false;}
function snoozeUnsnooze(){var button=$('.snooze-unsnooze:first').button('loading');fsAjax({'action':'unsnooze','conversation_id':getGlobalAttr('conversation_id')},laroute.route('snooze.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{button.button('reset');showAjaxError(response);}
loaderHide();});return false;}
function snoozeInit(){$(document).ready(function(){$('a.snooze-unsnooze').click(function(e){snoozeUnsnooze();e.preventDefault();});});}
(function(){var module_routes=[{"uri":"app-settings\/spamfilter\/ajax","name":"spam_filter.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initSpamFilterSettings(){$(document).ready(function(){$('#spam-filter-reset').click(function(e){var button=$(this);var data={action:'reset',mailbox_id:$('#stat-memory').val()};button.button('loading');fsAjax(data,laroute.route('spam_filter.ajax'),function(response){showAjaxResult(response);button.button('reset');if(isAjaxSuccess(response)){location.reload();}});e.preventDefault();});});}
(function(){var module_routes=[{"uri":"tags\/ajax","name":"tags.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initConvTags(remove_title){$(document).ready(function(){initTagSelector('.conv-add-tags:first',remove_title);initRemoveTags();});}
function initTagSelector(selector,remove_title){$(selector).click(function(e){$("#add-tag-wrap .tag-input:not(.select2-hidden-accessible)").select2({dropdownCssClass:"select2-multi-dropdown",containerCssClass:"select2-tag-input",multiple:true,width:'100%',minimumInputLength:1,tags:true,tokenSeparators:[",",", "],ajax:{url:laroute.route('tags.ajax'),dataType:'json',delay:250,cache:true,data:function(params){var page=1;if(typeof(params.page)!="undefined"){page=params.page;}
return{q:params.term,action:'autocomplete',page:page};}},createTag:function(params){return{id:params.term,text:params.term,newOption:true}},templateResult:function(data){var $result=$("<span></span>");$result.text(data.text);if(data.newOption){$result.append(" <em>("+Lang.get("messages.add_lower")+")</em>");}
return $result;},}).on('select2:closing',function(e){var params=e.params;var select=$(e.target);var value=select.next('.select2:first').children().find('.select2-search__field:first').val();value=value.trim();if(!value){return;}
if(params&&params.args&&params.args.originalSelect2Event!=null){var event=params.args.originalSelect2Event;if(event._type==='select'||event._type==='unselect'){return;}}
var data=select.select2('data');for(i in data){if(data[i].id==value){return;}}
addSelect2Option(select,{id:value,text:value,selected:true});});$("#add-tag-wrap .select2-selection").on("click",function(){return false;});if($('#form-create').length){fs_reply_changed=true;saveDraft(false,true);}
setTimeout(function(){$("#add-tag-wrap .tag-input").select2('open');$('.select2-search__field').focus();},100);});$('#add-tag-wrap .btn').click(function(e){addTag(remove_title);e.preventDefault();e.stopPropagation();$('.conv-add-tags:visible:first').dropdown('toggle');});}
function initRemoveTags(){$('#conv_tags .tag-remove').click(function(e){var tag_name=$(this).parent().children('.tag-name:first').text();$(this).parent().remove();fsAjax({action:'remove',tag_name:tag_name,conversation_id:getGlobalAttr('conversation_id')},laroute.route('tags.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){}else{showAjaxError(response);}},true);e.preventDefault();});}
function addTag(remove_title){var input=$('#add-tag-wrap .tag-input:first');var button=$('#add-tag-wrap .btn:first');var tag_names=input.val();if(!tag_names.length){return;}
for(i in tag_names){tag_names[i]=tag_names[i].trim();}
$('#conv_tags .tag-name').each(function(i,el){if($(el).text()==tag_names[i]){delete tag_names[i];}});if(!tag_names.length){return;}
input.attr('disabled','disabled');button.attr('disabled','disabled');var conversation_id=getGlobalAttr('conversation_id');var is_bulk=false;if(!conversation_id){conversation_id=getSelectedConversations();is_bulk=true;}
fsAjax({action:'add',tag_names:tag_names,conversation_id:conversation_id},laroute.route('tags.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.tags)!="undefined"&&response.tags){var html='';for(i in response.tags){tag=response.tags[i];if(!is_bulk){html+='<span class="tag"><a class="tag-name" href="'+tag.url+'" target="_blank">'+htmlEscape(tag.name)+'</a> <a class="tag-remove" href="#" title="'+remove_title+'"></a></span>';}else{html+='<span class="tag">'+htmlEscape(tag.name)+'</span>';}}
if(!is_bulk){$('#conv_tags').append(html);}else if($.isArray(conversation_id)){for(i in conversation_id){var tags_container=$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-tags');if(tags_container.length){$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-tags').append(html);}else{$('.conv-row[data-conversation_id="'+conversation_id[i]+'"] .conv-subject p:first').prepend('<span class="conv-tags">'+html+'</span>');}}}
initRemoveTags();}else{showAjaxError(response);}
input.removeAttr('disabled');input.children().prop("selected",false);input.trigger("change");button.removeAttr('disabled');},true,function(response){showFloatingAlert('error',Lang.get("messages.ajax_error"));input.removeAttr('disabled').val('');button.removeAttr('disabled');});}
function initTagsBulk(){$(document).ready(function(){initTagSelector('#conversations-bulk-actions .conv-add-tags:first','');$('.table-conversations .tag').click(function(e){var url=$(this).attr('data-tag-url');if(url){window.open(url,'_blank').focus();e.preventDefault();}});});}
function initEditTag(jmodal){$(document).ready(function(){$('.tag-update-form').on('submit',function(e){var tag_id=$(this).attr('data-tag-id');var data=$(this).serialize();data+='&tag_id='+tag_id;data+='&action=update';var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('tags.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();});$('.tag-update-form .tag-delete-forever:first').click(function(e){var form=$(this).parents('.tag-update-form:first');var tag_id=form.attr('data-tag-id');var button=$(this);showModalConfirm(form.attr('data-confirm-delete'),'tag-confirm-delete',{on_show:function(modal){modal.children().find('.tag-confirm-delete:first').click(function(e){button.button('loading');modal.modal('hide');var data={action:'delete_forever',tag_id:tag_id};fsAjax(data,laroute.route('tags.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);button.button('reset');}
loaderHide();},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('.tag-update-form:visible .tag-colors a').click(function(e){$('.tag-update-form:visible .tag-colors a').removeClass('active');$(this).addClass('active');$('.tag-update-form:visible [name="color"]:first').val($(this).attr('data-color'));e.preventDefault();});});}
(function(){var module_routes=[{"uri":"teams","name":"teams.teams"},{"uri":"teams\/ajax","name":"teams.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function teamUpdateInit(){$(document).ready(function(){$("#team-delete").click(function(e){var confirm_html=$('#team_delete_modal').html();showModalDialog(confirm_html,{width_auto:false,on_show:function(modal){modal.children().find('.input-delete-user:first').on('keyup keypress',function(e){if($(this).val()=='DELETE'){modal.children().find('.button-delete-team:first').removeAttr('disabled');}else{modal.children().find('.button-delete-team:first').attr('disabled','disabled');}});modal.children().find('.button-delete-team:first').click(function(e){var data=$('.team-assign-form:visible:first').serialize();if(data){data+='&';}
data+='action=delete_team';data+='&team_id='+getGlobalAttr('team_id');modal.modal('hide');fsAjax(data,laroute.route('teams.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=laroute.route('teams.teams');return;}else{showAjaxError(response);}
loaderHide();});e.preventDefault();});}});});});}
(function(){var module_routes=[{"uri":"ticket-translator\/ajax","name":"ticket_translator.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();$(document).ready(function(){$('#conv-layout-main .ttr-toggle').click(function(e){toggleTranslation($(this).attr('data-thread-id'),$(this).attr('data-locale'));e.preventDefault();});});function translateThread(el){var button=$(el);button.button('loading');var thread_id=button.parents('.modal-content:first').children().find('.input-translate-thread-id:first').val();var from=button.parents('.modal-content:first').children().find('.input-translate-from:first').val();var into=button.parents('.modal-content:first').children().find('.input-translate-into:first').val();fsAjax({action:'translate',thread_id:thread_id,from:from,into:into},laroute.route('ticket_translator.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href='';}else{showAjaxError(response);ajaxFinish();}},true);}
function toggleTranslation(thread_id,locale){var trigger=$('#thread-'+thread_id+' .translation-trigger-'+locale+':first');var text=$('#thread-'+thread_id+' .translation-'+locale+':first');if(text.is(':visible')){text.addClass('hidden');trigger.removeClass('selected');trigger.children('.caret:first').addClass('hidden');}else{$('#thread-'+thread_id+' .translation-text').addClass('hidden');$('#thread-'+thread_id+' .translation-triggers .caret').addClass('hidden');$('#thread-'+thread_id+' .translation-triggers a').removeClass('selected');text.removeClass('hidden');trigger.addClass('selected');trigger.children('.caret:first').removeClass('hidden');}}
function initTranslateModal(){$(document).ready(function(){$('.modal-body:visible .ttr-translate:first').click(function(e){translateThread($(this)[0]);});});}
(function(){var module_routes=[{"uri":"time-tracking\/ajax","name":"time_tracking.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var timetracking_time=-1;var timetracking_total_time=-1;var timetracking_interval=null;function initTimeTracking(timelog_dialog){$(document).ready(function(){$('#timelogs-trigger').click(function(e){$('#timelogs').toggleClass('hidden');e.preventDefault();});$('#timetr-pause').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
fsAjax({action:'pause',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetrStopTimer();$('#timetr-pause').addClass('disabled').attr('disabled','disabled');$('#timetr-start').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});$('#timetr-start').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
fsAjax({action:'start',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetrStartTimer();$('#timetr-start').addClass('disabled').attr('disabled','disabled');$('#timetr-pause').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
loaderHide();});});$('#timetr-add').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
button.button('loading');timetrShowDialog(function(){button.button('reset');reloadPage();},function(modal){button.button('reset');modal.modal('hide');});});$('#timetr-reset').click(function(e){var button=$(this);if(button.hasClass('disabled')){return;}
button.button('loading');fsAjax({action:'reset',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'){timetracking_time=0;timetracking_total_time=response.time_spent;timetrStopTimer();timetrStartTimer();$('#timetr-start').addClass('disabled').attr('disabled','disabled');$('#timetr-pause').removeClass('disabled').removeAttr('disabled');}else{showAjaxError(response);}
button.button('reset');loaderHide();});});$('.timetr-log-value').click(function(e){var span=$(this);span.hide();var time_spent=span.attr('data-time-spent');var html='<div>';html+='<input type="number" value="'+timetrFormatTime(time_spent,'hours',true)+'" class="form-control timetr-edit-value timetr-edit-h" /> : ';html+='<input type="number" value="'+timetrFormatTime(time_spent,'minutes',true)+'" class="form-control timetr-edit-value timetr-edit-m" /> : ';html+='<input type="number" value="'+timetrFormatTime(time_spent,'seconds',true)+'" class="form-control timetr-edit-value timetr-edit-s" /> &nbsp;';html+='<button class="btn btn-sm btn-primary timetr-edit-value timetr-save-timelog" type="button" data-loading-text=""><i class="glyphicon glyphicon-ok"></i></button>';html+='</div>';$(html).insertAfter(span);$('.timetr-save-timelog').click(function(e){timetrSaveTimelog($(this)[0]);});});if(timelog_dialog){fsAddFilter('conversation.can_change_user',function(value,params){if(!value){return value;}
if(getGlobalAttr('auth_user_id')==getConvData('user_id')&&getGlobalAttr('auth_user_id')!=params.trigger.attr('data-user_id')&&timetracking_time){timetrShowDialog(function(){params.trigger.trigger('fs-conv-user-change');});}else{params.trigger.trigger('fs-conv-user-change');}},999);fsAddFilter('conversation.can_change_status',function(value,params){if(!value){return value;}
var status=params.trigger.attr('data-status');if((status==3||status==4)&&getGlobalAttr('auth_user_id')==getConvData('user_id')&&timetracking_time){timetrShowDialog(function(){params.trigger.trigger('fs-conv-status-change');});}else{params.trigger.trigger('fs-conv-status-change');}},999);fsAddFilter('conversation.can_submit',function(value,params){if(!value||typeof(params)=="undefined"||typeof(params.trigger)=="undefined"){return value;}
var conv_status=convGetStatus();if(conv_status==3||conv_status==4){return value;}
var status=$('.note-statusbar:first select[name="status"]:first').val();if((status==3||status==4)&&getGlobalAttr('auth_user_id')==getConvData('user_id')&&timetracking_time&&!$(params.trigger).attr('data-timetr-submit')){fs_send_reply_allowed=false;timetrShowDialog(function(){fs_send_reply_allowed=true;$(params.trigger).attr('data-timetr-submit','1');params.trigger.click();});return false;}else{return true;}},999);}
var block=$('#time-tracking');if(block&&block.attr('data-paused')!='1'){timetrStartTimer();}else{if(timetracking_time==-1){timetracking_time=parseInt($('#time-tracking').attr('data-current-time'));}}});}
function timetrShowDialog(callback,cancel_callback){var modal_html='<div>'+'<div class="margin-top-10">'+Lang.get("messages.timetr_modal_text")+'</div>'+'<div class="timetr-edit-time">'+'<input type="number" class="hours input-lg" size="3" min="0" value="'+timetrFormatTime(timetracking_time,'hours')+'"/> : '+'<input type="number" class="minutes input-lg" min="0" max="60" value="'+timetrFormatTime(timetracking_time,'minutes')+'"/> : '+'<input type="number" class="seconds input-lg" min="0" max="60" value="'+timetrFormatTime(timetracking_time,'seconds')+'"/>'+'<div class="timetr-hhmmss">'+'(HH:mm:ss)'+'</div>'+'</div>'+'</div>';var footer_html='<button class="btn btn-link timetr-cancel" data-loading-text="'+Lang.get("messages.cancel")+'">'+Lang.get("messages.cancel")+'</button>'+'<button class="btn btn-primary timetr-submit-time" data-loading-text="'+Lang.get("messages.submit_time")+'">'+Lang.get("messages.submit_time")+'</button>';showModalDialog(modal_html,{title:Lang.get("messages.time_tracking"),no_close_btn:Lang.get("messages.time_tracking"),footer:footer_html,no_header:false,no_footer:false,width_auto:false,no_close_btn:true,on_show:function(modal){modal.children().find('.timetr-submit-time:first').click(function(e){var button=$(this);button.button('loading');fsAjax({action:'submit_time',conversation_id:getGlobalAttr('conversation_id'),hours:modal.children().find('.hours:first').val(),minutes:modal.children().find('.minutes:first').val(),seconds:modal.children().find('.seconds:first').val()},laroute.route('time_tracking.ajax'),function(response){showAjaxResult(response);button.button('reset');modal.modal('hide');callback();},true,function(response){showAjaxResult(response);modal.modal('hide');callback();});});modal.children().find('.timetr-cancel:first').click(function(e){if(typeof(cancel_callback)!="undefined"){cancel_callback(modal);return;}
var button=$(this);button.button('loading');fsAjax({action:'cancel',conversation_id:getGlobalAttr('conversation_id')},laroute.route('time_tracking.ajax'),function(response){showAjaxResult(response);button.button('reset');modal.modal('hide');callback();},true,function(response){showAjaxResult(response);modal.modal('hide');callback();});});}});}
function timetrStartTimer(){if(timetracking_time==-1){timetracking_time=parseInt($('#time-tracking').attr('data-current-time'));}
if(isNaN(timetracking_time)||timetracking_interval||!timetrIsActive()){return;}
if(timetracking_total_time==-1){timetracking_total_time=parseInt($('#time-tracking').attr('data-total-time'));if(isNaN(timetracking_total_time)){timetracking_total_time=0;}}
timetracking_interval=setInterval(function(){timetracking_time+=1;timetracking_total_time+=1;timetrRenderTimer();},1000);}
function timetrIsActive(){return $('#timetr-time').length;}
function timetrStopTimer(){clearInterval(timetracking_interval);timetracking_interval=null;}
function timetrRenderTimer(){if(timetracking_time==-1||isNaN(timetracking_time)){return;}
var time=timetrFormatTime(timetracking_time);$('#timetr-time').text(time);var time=timetrFormatTime(timetracking_total_time);$('#timetr-total').text(time);}
function timetrFormatTime(timestamp,hms,no_pad){var hours=Math.floor(timestamp / 3600);var minutes=Math.floor((timestamp / 60)%60);var seconds=timestamp%60;if(typeof(no_pad)=="undefined"){hours=timetrPadStart(hours,2,'0');minutes=timetrPadStart(minutes,2,'0');seconds=timetrPadStart(seconds,2,'0');}
if(typeof(hms)!="undefined"){if(hms=='hours'){return hours;}else if(hms=='minutes'){return minutes;}else if(hms=='seconds'){return seconds;}}
return hours+':'+minutes+':'+seconds;}
function timetrPadStart(str,targetLength,padString){targetLength=targetLength>>0;str=str+'';padString=String((typeof padString!=='undefined'?padString:' '));if(str.length>targetLength){return String(str);}else{targetLength=targetLength-str.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}
return padString.slice(0,targetLength)+String(str);}};function timetrSaveTimelog(el){var button=$(el);var h=Math.abs(parseInt(button.parent().children('.timetr-edit-h:first').val()));var m=Math.abs(parseInt(button.parent().children('.timetr-edit-m:first').val()));var s=Math.abs(parseInt(button.parent().children('.timetr-edit-s:first').val()));if(isNaN(h)){h=0;}
if(isNaN(m)){m=0;}
if(isNaN(s)){s=0;}
var time_spent=h*3600+m*60+s;button.button('loading');fsAjax({action:'edit',time_spent:time_spent,timelog_id:button.parents('tr:first').attr('data-timelog-id')},laroute.route('time_tracking.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){button.parent().prev().attr('data-time-spent',time_spent).text(timetrFormatTime(time_spent)).show();button.parent().remove();}else{showAjaxError(response);}},true);}
(function(){var module_routes=[{"uri":"users\/2fa\/ajax","name":"twofactorauth.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initUserAuthSettings(tfa_enabled,next_page){$(document).ready(function(){if(!tfa_enabled){$('#tfa_enabled').change(function(e){if($(this).is(':checked')){window.location.href=next_page;}});}});}
(function(){var module_routes=[{"uri":"users\/fields\/ajax-admin","name":"userfields.ajax_admin"},{"uri":"users\/fields\/ajax-search","name":"userfields.ajax_search"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function ufInitUserFieldsAdmin(){$(document).ready(function(){ufInitUserFieldsForm('.uf-user-field-form','user_field_update');$(".uf-user-field-delete").click(function(e){var button=$(this);showModalConfirm(Lang.get("messages.uf_confirm_delete_user_field"),'uf-delete-ok',{on_show:function(modal){var user_field_id=button.attr('data-user_field_id');modal.children().find('.uf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'user_field_delete',user_field_id:user_field_id},laroute.route('userfields.ajax_admin'),function(response){showAjaxResult(response);button.button('reset');$('#uf-user-field-'+user_field_id).remove();});});}},Lang.get("messages.delete"));e.preventDefault();});if($('#uf-user-fields-index').length){sortable('#uf-user-fields-index',{handle:'.handle',})[0].addEventListener('sortupdate',function(e){var user_fields=[];$('#uf-user-fields-index > .panel').each(function(idx,el){user_fields.push($(this).attr('data-user-field-id'));});fsAjax({action:'user_field_update_sort_order',user_fields:user_fields,},laroute.route('userfields.ajax_admin'),function(response){showAjaxResult(response);});});}});}
function ufInitNewUserField(jmodal){$(document).ready(function(){ufInitUserFieldsForm('.uf-new-user-field-form','user_field_create');});}
function ufInitUserFieldsForm(selector,action){$(selector).on('submit',function(e){var user_field_id=$(this).attr('data-user_field_id');var data=$(this).serialize();data+='&action='+action;if(user_field_id){data+='&user_field_id='+user_field_id;}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('userfields.ajax_admin'),function(response){if(isAjaxSuccess(response)){if(typeof(response.msg_success)!="undefined"){button.button('reset');showFloatingAlert('success',response.msg_success);var html=' '+htmlEscape(response.name)+' <small>(ID: '+user_field_id+')</small>';if(response.required){html+=' <i class="required-asterisk"></i>';}
$('#uf-user-field-'+user_field_id+' .panel-title a:first span:first').html(html);}else{window.location.href='';}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});$(selector+' :input[name="type"]:first').on('change',function(e){$(selector+' .cf-type :input').attr('disabled','disabled');$(selector+' .cf-type-'+$(this).val()+' :input').removeAttr('disabled');$(selector+' .cf-type').addClass('hidden');$(selector+' .cf-type-'+$(this).val()).removeClass('hidden');});ufApplyOptionsListeners(selector);}
function ufApplyOptionsListeners(selector){$(selector+' .cf-option[data-inited!="1"] .cf-option-add').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');var new_option=container.children('.cf-option:first').clone();var max_id=1;container.children('.cf-option').find('input').each(function(index,el){if($(this).attr('data-option-id')>max_id){max_id=$(this).attr('data-option-id')*1;}});new_option.removeAttr('data-inited');new_option.children('input:first').attr('name','options['+(max_id+1)+']').attr('data-option-id',max_id+1).val('');new_option.appendTo(container);cfApplyOptionsListeners(selector);});$(selector+' .cf-option[data-inited!="1"] .cf-option-remove').on('click',function(e){var button=$(e.target);var container=button.parents('.cf-options:first');if(container.children('.cf-option').length==1){return;}
showModalConfirm(Lang.get("messages.uf_confirm_delete_option"),'cf-option-remove-ok',{on_show:function(modal){modal.children().find('.cf-option-remove-ok:first').click(function(e){button.parents('.cf-option:first').addClass('cf-removed').children('input:first').attr('disabled','disabled');modal.modal('hide');});}},Lang.get("messages.delete"));});$(selector+' .cf-option[data-inited!="1"] .cf-option-restore').on('click',function(e){var button=$(e.target);button.parents('.cf-option:first').removeClass('cf-removed').children('input:first').removeAttr('disabled');});$(selector+' .cf-option[data-inited!="1"]').attr('data-inited','1');sortable(selector+' .cf-options',{handle:'.cf-option-handle',});}
function ufInitUserFields(){$(document).ready(function(){$('.uf-cf-type-date').flatpickr({allowInput:true});ufCfInitAutosuggest();});}
function ufCfInitAutosuggest(){$('.uf-cf-autosuggest:visible').each(function(index,el){var input=$(this);if(input.data('select2')){return;}
var placeholder='';if(!input.attr('required')){placeholder=input.children('option:first').text();}
var options={ajax:{url:laroute.route('userfields.ajax_search'),dataType:'json',delay:250,cache:true,data:function(params){return{q:params.term,user_field_id:input.attr('name'),page:params.page};}},allowClear:true,placeholder:placeholder,tags:true,minimumInputLength:1,language:{inputTooShort:function(args){return"";}}}
input.select2(options);});}
function ufInit(user_vars){fsAddFilter('editor.vars',function(vars){vars.user={...vars.user,...user_vars};return vars;});}
(function(){var module_routes=[{"uri":"wallboards\/ajax","name":"wallboards.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var WB_FILTERS_SEPARATOR='|';var WB_REFRESH_INTERVAL=60;function wbInit(text_delete){$(document).ready(function(){$('#wb-wallboards-list').change(function(e){window.location.href=$(this).val();});wbApplyListeners();wbShowParams();$('.wb-param li a').click(function(e){var li=$(this).parent();var param=li.parents('.wb-param').attr('data-param');if(param!='filters'){li.parent().children('li').removeClass('active');li.addClass('active');}
wbShow();e.preventDefault();});$('#wb-delete-wallboard').click(function(e){showModalConfirm('<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+text_delete+'</span>','wb-confirm-delete-wallboard',{on_show:function(modal){modal.children().find('.wb-confirm-delete-wallboard:first').click(function(e){var button=$(this);button.attr('data-loading-text',Lang.get("messages.delete")+'');button.button('loading');fsAjax({action:'delete_wallboard',wallboard_id:getGlobalAttr('wallboard_id')},laroute.route('wallboards.ajax'),function(response){button.button('reset');if(isAjaxSuccess(response)){window.location.href='';modal.modal('hide');}else{showAjaxError(response);}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('#wb-btn-refresh').click(function(e){wbShow();e.preventDefault();});$('.wb-filter-date').flatpickr();$('#wb-toolbar .wb-filter-date').change(function(e){$('#wb-date-period').val('custom');wbShow();});$('#wb-date-period').change(function(e){var option=$(this).children('option:selected');var date_from=option.attr('data-date-from');var date_to=option.attr('data-date-to');if(option.val()=='all'){$('.wb-filter-date').attr('disabled','disabled').attr('data-force-disable','1');wbShow();}else{if(option.val()!='custom'){$('#wb-toolbar .wb-filter-date[name="from"]').val(date_from);if(date_to){$('#wb-toolbar .wb-filter-date[name="to"]').val(date_to);}
wbShow();}
$('.wb-filter-date').removeAttr('disabled').removeAttr('data-force-disable');}});setInterval(function(){wbShow(true);},WB_REFRESH_INTERVAL*1000);$('#wb-wallboard')[0].addEventListener('sortupdate',function(e){var widget_ids=[];$(e.target).children('.wb-widget').each(function(index,el){widget_ids.push($(this).attr('data-widget-id'));});fsAjax({action:'move_widget',wallboard_id:getGlobalAttr('wallboard_id'),widgets:widget_ids},laroute.route('wallboards.ajax'),function(response){showAjaxResult(response);},true);});});}
function wbApplyListeners(){$('.wb-more').off('click').click(function(e){knLoadRows($(this),false);});initModals('div');$('.wb-widget-footer a').off('click').click(function(e){e.stopPropagation();});sortable('#wb-wallboard',{handle:'.wb-widget-header',items:'.wb-widget',forcePlaceholderSize:true});}
function wbGetParams(){var params={};params.wallboard_id=getGlobalAttr('wallboard_id');params.filters={};params.filters.date={};params.filters.date.period=$('#wb-date-period').val();params.filters.date.from=$('#wb-toolbar .wb-filter-date[name="from"]').val();params.filters.date.to=$('#wb-toolbar .wb-filter-date[name="to"]').val();return params;}
function wbShowParams(){$('.wb-param-counter').each(function(i,el){var j_el=$(el);var count=j_el.parents('.wb-param:first').children('ul:first').children('li.active').length;if(!count){j_el.text('');}else{j_el.text(' ('+count+')');}});}
function wbShow(no_toolbar_disable){var btn_refresh=$('#wb-btn-refresh i:first');if(btn_refresh.hasClass('glyphicon-spin')){return;}
btn_refresh.addClass('glyphicon-spin');if(typeof(no_toolbar_disable)=="undefined"){toolbar=$('#wb-toolbar :input[data-force-disable!="1"]');}else{toolbar=$('#does_not_exist');}
toolbar.attr('disabled','disabled');fsAjax({action:'show',wb:wbGetParams()},laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)&&response.html){$('#wb-wallboard').html(response.html);wbApplyListeners();initModals();initTooltips();}else{showAjaxResult(response);}
loaderHide();btn_refresh.removeClass('glyphicon-spin');toolbar.removeAttr('disabled');},false,function(response){showAjaxResult(response);loaderHide();btn_refresh.removeClass('glyphicon-spin');toolbar.removeAttr('disabled');});}
function wbInitWallboardModal(){$(document).ready(function(){$('.wb-wallboard-name:visible:first').focus();$('.wb-wallboard-form:visible:first').on('submit',function(e){var wallboard_id=$(this).attr('data-wallboard-id');var data=$(this).serialize();if(wallboard_id){data+='&wallboard_id='+wallboard_id;data+='&action=update_wallboard';}else{data+='&action=new_wallboard';}
var button=$(this).children().find('button:first');button.button('loading');fsAjax(data,laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(wallboard_id){window.location.href='';}else{window.location.href=response.wallboard_url;}}else{showAjaxError(response);button.button('reset');}
loaderHide();});e.preventDefault();return false;});});}
function wbInitWidgetModal(){$(document).ready(function(){if(!$('.wb-widget-form:visible:first .wb-widget-submit:first').length){$('.wb-widget-form:visible:first :input').attr('disabled','disabled');}
$('.wb-widget-form-title:visible:first').focus();$('.wb-widget-form:visible:first').on('submit',function(e){var widget_id=$(this).attr('data-widget-id');var data=$(this).serialize();if(widget_id){data+='&action=update_widget';}else{data+='&action=new_widget';}
var button=$(this).children().find('.wb-widget-submit:first');button.button('loading');fsAjax(data,laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
wbShow();$('.modal:visible:first').modal('hide');}else{showAjaxError(response);button.button('reset');}},true);e.preventDefault();return false;});$('#wb-delete-widget').click(function(e){var button=$(this);showModalConfirm(wb_text_delete_card,'wb-confirm-delete-widget',{on_show:function(modal){modal.children().find('.wb-confirm-delete-widget:first').click(function(e){button.button('loading');modal.modal('hide');var widget_id=button.parents('.wb-widget-form:first').attr('data-widget-id');fsAjax({action:'delete_widget',wallboard_id:getGlobalAttr('wallboard_id'),widget_id:widget_id},laroute.route('wallboards.ajax'),function(response){if(isAjaxSuccess(response)){if(response.msg_success){showFloatingAlert("success",response.msg_success);}
$('.modal:visible').modal('hide');wbShow();}else{showAjaxError(response);button.button('reset');}},true);});}},Lang.get("messages.delete"));e.preventDefault();});$('.wb-filter-mailbox:visible:first').change(function(e){var mailbox_id=$(this).val();if(mailbox_id){$('.modal-body .wb-mailbox-filter').hide();$('.modal-body .wb-mailbox-filter[data-mailbox-id="'+mailbox_id+'"]').show();}else{$('.modal-body .wb-mailbox-filter').show();}
$('.modal-body .wb-mailbox-filter:hidden :input').val('');}).change();$('.wb-type-date').flatpickr();initTooltips();});}
function wbInitFilterModal(){$(document).ready(function(){$('.wb-type-date:visible').flatpickr({allowInput:true});$('.wb-filter-form:visible:first').on('submit',function(e){var fields=$(this).serializeArray();var filter=$(this).children(':input[name="filter"]').val();var selected=[];var cf_data={};for(var i in fields){if(filter=='custom_field'){matches=fields[i].name.match(/selected\[op\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['op']=fields[i].value;}
matches=fields[i].name.match(/selected\[value\]\[(\d+)\]/);if(matches&&typeof(matches[1])!="undefined"&&matches[1]){if(typeof(cf_data[matches[1]])=="undefined"){cf_data[matches[1]]={};}
cf_data[matches[1]]['value']=fields[i].value;}}else{if(fields[i].name=='selected[]'){selected.push(fields[i].value);}}}
if(filter=='custom_field'){for(var cf_id in cf_data){if(cf_data[cf_id].value!=''){selected.push(value=JSON.stringify({id:cf_id,value:cf_data[cf_id].value,op:cf_data[cf_id].op}));}}}
var li=$('.wb-param[data-param="filters"] li[data-param-name="'+filter+'"]');li.attr('data-param-value',selected.join(KN_FILTERS_SEPARATOR));var a=li.children('a:first');if(selected.length){li.addClass('active');a.children('.wb-filter-counter:first').text('('+selected.length+')');}else{li.removeClass('active');a.children('.wb-filter-counter:first').text('');}
var href=a.attr('href');href=href.replace(/&selected.*/,'');for(var i in selected){href+='&selected%5B'+i+'%5D='+encodeURIComponent(selected[i]);}
a.attr('href',href);$('.wb-reset-filter').removeClass('hidden');wbShow();wbShowParams();$('.modal:visible:first').modal('hide');e.preventDefault();return false;});});}
(function(){var module_routes=[{"uri":"woocommerce\/ajax","name":"woocommerce.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();var wc_customer_emails=[];function initWooCommerce(customer_emails,load){wc_customer_emails=customer_emails;if(!Array.isArray(wc_customer_emails)){wc_customer_emails=[];}
$(document).ready(function(){if(load){wcLoadOrders();}
$('.wc-refresh').click(function(e){wcLoadOrders();e.preventDefault();});});}
function wcLoadOrders(){$('#wc-orders').addClass('wc-loading');fsAjax({action:'orders',customer_emails:wc_customer_emails,mailbox_id:getGlobalAttr('mailbox_id')},laroute.route('woocommerce.ajax'),function(response){if(typeof(response.status)!="undefined"&&response.status=='success'&&typeof(response.html)!="undefined"&&response.html){$('#wc-orders').html(response.html);$('#wc-orders').removeClass('wc-loading');$('.wc-refresh').click(function(e){wcLoadOrders();e.preventDefault();});}else{}},true);}
(function(){var module_routes=[{"uri":"mailbox\/workflows\/ajax","name":"mailboxes.workflows.ajax"}];if(typeof(laroute)!="undefined"){laroute.add_routes(module_routes);}else{contole.log('laroute not initialized, can not add module routes:');contole.log(module_routes);}})();function initUpdateWorkflow(type_automatic,msg_confirm_delete){$(document).ready(function(){$('#type').change(function(e){$('.wf-type').addClass('hidden');if($(this).val()==type_automatic){$('.wf-type-auto').removeClass('hidden');$('#wf-conditions-tab').removeClass('hidden');}else{$('.wf-type-manual').removeClass('hidden');$('#wf-conditions-tab').addClass('hidden');}
wfShowProperSaveButtons();});$('#apply_to_prev').change(function(e){if($(this).is(':checked')){$('#apply-to-prev-alert').removeClass('hidden');}else{$('#apply-to-prev-alert').addClass('hidden');}
wfShowProperSaveButtons();});$('#active').change(function(e){wfShowProperSaveButtons();});wfShowProperSaveButtons();$('.wf-block-and-trigger').click(function(e){var clone=$(this).parents('.wf-blocks:first').children().find('.wf-and-block:first').clone();clone.removeAttr('data-applied');var children=clone.children();children.find('.wf-or-block:gt(0)').remove();children.find('.wf-or-block').removeAttr('data-applied').removeClass('has-error');wfResetInputs(children);children.find('.wf-block-operator').addClass('hidden');children.find('.wf-block-value').addClass('hidden');children.find('.select2').remove();clone.appendTo($(this).parent().prev());wfChangeNames(children.find('.wf-or-block'),true);wfApplyBlockListeners();});wfApplyBlockListeners();$('.wf-or-block .wf-block-type').change();$("#wf-delete-trigger").click(function(e){var button=$(this);showModalConfirm(msg_confirm_delete,'wf-delete-ok',{on_show:function(modal){var workflow_id=button.attr('data-wf_id');if(!workflow_id){return;}
modal.children().find('.wf-delete-ok:first').click(function(e){button.button('loading');modal.modal('hide');fsAjax({action:'delete',workflow_id:workflow_id},laroute.route('mailboxes.workflows.ajax'),function(response){if(isAjaxSuccess(response)){window.location.href=response.redirect_url;}else{showAjaxResult(response);button.button('reset');}});});}},Lang.get("messages.delete"));e.preventDefault();});});}
function wfApplyBlockListeners(){$('.wf-or-block[data-applied!="1"] .wf-block-type').change(function(e){var val=$(this).val();var block=$(this).parents('.wf-block').children();block.find('.wf-block-operator').addClass('hidden');block.find('.wf-block-operator :input').attr('disabled','disabled');block.find('.wf-block-operator-'+val).removeClass('hidden');block.find('.wf-block-operator-'+val+' :input').removeAttr('disabled');block.find('.wf-block-value').addClass('hidden');block.find('.wf-block-value :input').attr('disabled','disabled');block.find('.wf-block-value-'+val).removeClass('hidden');block.find('.wf-block-value-'+val+' :input').removeAttr('disabled');block.find('.wf-block-operator-'+val+' select').change();});$('.wf-or-block[data-applied!="1"] .wf-block-operator select').change(function(e){var block=$(this).parents('.wf-block').children();var type=block.find('.wf-block-type:first').val();var val_wrapper=block.find('.wf-block-value-'+type);var values_visible_if=val_wrapper.attr('data-values-visible-if');if(values_visible_if){var operators=values_visible_if.split(',');if($.inArray($(this).val(),operators)!==-1){block.find('.wf-block-value-'+type).removeClass('hidden');block.find('.wf-block-value-'+type+' :input').removeAttr('disabled');}else{block.find('.wf-block-value-'+type).addClass('hidden');block.find('.wf-block-value-'+type+' :input').attr('disabled');}}
var multi_values=block.find('.wf-multi-value');if(multi_values.length){multi_values.addClass('hidden').attr('disabled','disabled');block.find('.wf-multi-value-'+$(this).val()).removeClass('hidden').removeAttr('disabled');}}).change();$('.wf-or-block[data-applied!="1"] .wf-or-block-remove').click(function(e){if($(this).parents('.wf-and-block:first').children().find('.wf-block').length==1){if($(this).parents('.wf-and-blocks:first').children('.wf-and-block').length>1){$(this).parents('.wf-and-block:first').remove();}}else{$(this).parents('.wf-block:first').remove();}});$('.wf-or-block[data-applied!="1"] .wf-block-value :input').on('keyup keypress',function(e){if($(this).val()){$(this).parents('.wf-or-block:first').removeClass('has-error');}});$('.wf-or-block[data-applied!="1"] :input.input-date').flatpickr({allowInput:true});$('.wf-or-block').attr('data-applied','1');$('.wf-and-block[data-applied!="1"] .wf-block-or-trigger').click(function(e){var clone=$(this).parents('.wf-blocks:first').children().find('.wf-or-block:first:visible').clone();clone.removeAttr('data-applied').removeClass('has-error');wfResetInputs(clone.children());clone.children().find('.wf-block-operator').addClass('hidden');clone.children().find('.wf-block-value').addClass('hidden');clone.children().find('.select2').remove();clone.appendTo($(this).parent().prev());wfChangeNames(clone,false);wfApplyBlockListeners();});$('.wf-and-block').attr('data-applied','1');$('.wf-email-modal').off('click').on('click',function(e){triggerModal($(this));e.preventDefault();});$('.wf-multiselect').select2({multiple:true,tags:true});}
function wfResetInputs(parent){parent.find(':input').val('');parent.find('select').prop("selectedIndex",0);}
function wfChangeNames(block,adding_and){var and_index=0;if(typeof(adding_and)!="undefined"&&adding_and){and_index=parseInt(block.parents('.wf-and-blocks:first').attr('data-max-index'));and_index++;block.parents('.wf-or-blocks:first').attr('data-max-index','-1');}else{and_index=block.parents('.wf-and-block:first').index();}
if(isNaN(and_index)||and_index<0){and_index=0;}
var or_index=parseInt(block.parents('.wf-or-blocks:first').attr('data-max-index'))+1;block.find('input,select').each(function(index,el){var name=$(this).attr('name');if(!name){return;}
name=name.replace(/^([^\[]+)\[[^\]]+\]\[[^\]]+\]/,'$1['+and_index+']['+or_index+']');$(this).attr('name',name);});block.parents('.wf-and-blocks:first').attr('data-max-index',and_index);block.parents('.wf-or-blocks:first').attr('data-max-index',or_index);}
function initWorkflows(){$(document).ready(function(){if($('.wf-index').length){var sortables=sortable('.wf-index',{handle:'.handle',});for(var i in sortables){sortables[i].addEventListener('sortupdate',function(e){var workflows=[];$('.wf-index > .panel').each(function(idx,el){workflows.push($(this).attr('data-wf-id'));});fsAjax({action:'update_sort_order',workflows:workflows,},laroute.route('mailboxes.workflows.ajax'),function(response){showAjaxResult(response);});});}}});}
function initWfEmailForm(modal,trigger){var values=trigger.next().val();try{values=JSON.parse(values);modal.children().find('.wf-email-input').each(function(i,el){if(typeof(values[$(this).attr('name')])!="undefined"){if($(this).is(':checkbox')){if(values[$(this).attr('name')]=='1'){$(this).prop("checked",true);}else{$(this).prop("checked",false);}}else{$(this).val(values[$(this).attr('name')]);}}});}catch(e){}
summernoteInit('.wf-email-form-editor:first',{insertVar:true,disableDragAndDrop:false,callbacks:{onImageUpload:function(files){if(!files){return;}
for(var i=0;i<files.length;i++){editorSendFile(files[i],false,false,'.wf-email-form-editor:first');}},onInit:function(){editorProcessInsertVar($('.wf-email-form-editor:first'),$(this));},}});modal.children().find('.wf-email-form:first').submit(function(e){var button=$(this).children().find('.btn-primary:first');button.button('loading');var values={};modal.children().find('.wf-email-input').each(function(i,el){if($(this).is(':checkbox')){if($(this).is(':checked')){values[$(this).attr('name')]=$(this).val();}}else{values[$(this).attr('name')]=$(this).val();}});trigger.next().val(JSON.stringify(values));e.preventDefault();modal.modal('hide');});}
function initRunWorkflow(modal){$(document).ready(function(){modal.children().find('.btn').click(function(e){wfRunManualWorkflow($(this),[getGlobalAttr('conversation_id')]);e.preventDefault();});});}
function wfRunManualWorkflow(button,conversation_ids){button.button('loading');fsAjax({action:'run',workflow_id:button.attr('data-wf-id'),conversation_id:conversation_ids,folder_id:getQueryParam('folder_id')},laroute.route('mailboxes.workflows.ajax'),function(response){if(isAjaxSuccess(response)){if(typeof(response.redirect_url)!="undefined"&&response.redirect_url){window.location.href=response.redirect_url;}else{window.location.href='';}}else{showAjaxResult(response);button.button('reset');}},true);}
function initWorkflowsBulk(){$(document).ready(function(){$('#bulk-workflow-list a').click(function(e){var conversation_ids=getSelectedConversations();wfRunManualWorkflow($(this),conversation_ids)
e.preventDefault();});});}
function wfShowProperSaveButtons(){var execute=false;if($('#type').val()==1){if($('#active').is(':checked')&&$('#apply_to_prev').is(':checked')){execute=true;}}else{}
$('.wf-save').addClass('hidden');if(execute){$('.wf-save-execute').removeClass('hidden');}else{$('.wf-save-save').removeClass('hidden');}}